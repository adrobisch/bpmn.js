/*! KineticJS v4.7.0 2013-09-16 http://www.kineticjs.com by Eric Rowell @ericdrowell - MIT License https://github.com/ericdrowell/KineticJS/wiki/License*/

/*! bpmn.js https://github.com/adrobisch/bpmn.js by Andreas Drobisch @adrobisch - LGPL v3 License http://www.gnu.org/licenses/lgpl.html */

define("dojo/has",["require","module"],function(e,t){var n=e.has||function(){};if(!n("dojo-has-api")){var r=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location==location&&window.document==document,i=this,s=r&&document,o=s&&s.createElement("DiV"),u=t.config&&t.config()||{};n=function(e){return typeof u[e]=="function"?u[e]=u[e](i,s,o):u[e]},n.cache=u,n.add=function(e,t,r,i){return(typeof u[e]=="undefined"||i)&&(u[e]=t),r&&n(e)},n.add("host-browser",r),n.add("dom",r),n.add("dojo-dom-ready-api",1),n.add("dojo-sniff",1)}if(n("host-browser")){n.add("dom-addeventlistener",!!document.addEventListener),n.add("touch","ontouchstart"in document),n.add("device-width",screen.availWidth||innerWidth);var a=document.createElement("form");n.add("dom-attributes-explicit",a.attributes.length==0),n.add("dom-attributes-specified-flag",a.attributes.length>0&&a.attributes.length<40)}return n.clearElement=function(e){return e.innerHTML="",e},n.normalize=function(e,t){var r=e.match(/[\?:]|[^:\?]*/g),i=0,s=function(e){var t=r[i++];return t==":"?0:r[i++]=="?"?!e&&n(t)?s():(s(!0),s(e)):t||0};return e=s(),e&&t(e)},n.load=function(e,t,n){e?t([e],n):n()},n}),define("dojo/_base/config",["../has","require"],function(e,t){var n={};if(e("dojo-config-api")){var r=t.rawConfig,i;for(i in r)n[i]=r[i]}else{var s=function(t,n,r){for(i in t)i!="has"&&e.add(n+i,t[i],0,r)};n=e("dojo-loader")?t.rawConfig:this.dojoConfig||this.djConfig||{},s(n,"config",1),s(n.has,"",1)}return n}),define("dojo/_base/kernel",["../has","./config","require","module"],function(e,t,n,r){var i,s,o={},u={},a={config:t,global:this,dijit:o,dojox:u},f={dojo:["dojo",a],dijit:["dijit",o],dojox:["dojox",u]},l=n.map&&n.map[r.id.match(/[^\/]+/)[0]],c;for(s in l)f[s]?f[s][0]=l[s]:f[s]=[l[s],{}];for(s in f)c=f[s],c[1]._scopeName=c[0],t.noGlobals||(this[c[0]]=c[1]);a.scopeMap=f,a.baseUrl=a.config.baseUrl=n.baseUrl,a.isAsync=!e("dojo-loader")||n.async,a.locale=t.locale;var h="$Rev: 30226 $".match(/\d+/);a.version={major:1,minor:8,patch:3,flag:"",revision:h?+h[0]:NaN,toString:function(){var e=a.version;return e.major+"."+e.minor+"."+e.patch+e.flag+" ("+e.revision+")"}},e.add("extend-dojo",1),Function("d","d.eval = function(){return d.global.eval ? d.global.eval(arguments[0]) : eval(arguments[0]);}")(a),e("host-rhino")?a.exit=function(e){quit(e)}:a.exit=function(){},e.add("dojo-guarantee-console",1);if(e("dojo-guarantee-console")){typeof console!="undefined"||(console={});var p=["assert","count","debug","dir","dirxml","error","group","groupEnd","info","profile","profileEnd","time","timeEnd","trace","warn","log"],d;i=0;while(d=p[i++])console[d]||function(){var e=d+"";console[e]="log"in console?function(){var t=Array.apply({},arguments);t.unshift(e+":"),console.log(t.join(" "))}:function(){},console[e]._fake=!0}()}e.add("dojo-debug-messages",!!t.isDebug),a.deprecated=a.experimental=function(){},e("dojo-debug-messages")&&(a.deprecated=function(e,t,n){var r="DEPRECATED: "+e;t&&(r+=" "+t),n&&(r+=" -- will be removed in version: "+n),console.warn(r)},a.experimental=function(e,t){var n="EXPERIMENTAL: "+e+" -- APIs subject to change without notice.";t&&(n+=" "+t),console.warn(n)}),e.add("dojo-modulePaths",1);if(e("dojo-modulePaths")&&t.modulePaths){a.deprecated("dojo.modulePaths","use paths configuration");var v={};for(s in t.modulePaths)v[s.replace(/\./g,"/")]=t.modulePaths[s];n({paths:v})}return e.add("dojo-moduleUrl",1),e("dojo-moduleUrl")&&(a.moduleUrl=function(e,t){a.deprecated("dojo.moduleUrl()","use require.toUrl","2.0");var r=null;return e&&(r=n.toUrl(e.replace(/\./g,"/")+(t?"/"+t:"")+"/*.*").replace(/\/\*\.\*/,"")+(t?"":"/")),r}),a._hasResource={},a}),define("dojo/sniff",["./has"],function(e){if(e("host-browser")){var t=navigator,n=t.userAgent,r=t.appVersion,i=parseFloat(r);e.add("air",n.indexOf("AdobeAIR")>=0),e.add("khtml",r.indexOf("Konqueror")>=0?i:undefined),e.add("webkit",parseFloat(n.split("WebKit/")[1])||undefined),e.add("chrome",parseFloat(n.split("Chrome/")[1])||undefined),e.add("safari",r.indexOf("Safari")>=0&&!e("chrome")?parseFloat(r.split("Version/")[1]):undefined),e.add("mac",r.indexOf("Macintosh")>=0),e.add("quirks",document.compatMode=="BackCompat"),e.add("ios",/iPhone|iPod|iPad/.test(n)),e.add("android",parseFloat(n.split("Android ")[1])||undefined);if(!e("webkit")){n.indexOf("Opera")>=0&&e.add("opera",i>=9.8?parseFloat(n.split("Version/")[1])||i:i),n.indexOf("Gecko")>=0&&!e("khtml")&&!e("webkit")&&e.add("mozilla",i),e("mozilla")&&e.add("ff",parseFloat(n.split("Firefox/")[1]||n.split("Minefield/")[1])||undefined);if(document.all&&!e("opera")){var s=parseFloat(r.split("MSIE ")[1])||undefined,o=document.documentMode;o&&o!=5&&Math.floor(s)!=o&&(s=o),e.add("ie",s)}e.add("wii",typeof opera!="undefined"&&opera.wiiremote)}}return e}),define("dojo/_base/lang",["./kernel","../has","../sniff"],function(e,t){t.add("bug-for-in-skips-shadowed",function(){for(var e in{toString:1})return 0;return 1});var n=t("bug-for-in-skips-shadowed")?"hasOwnProperty.valueOf.isPrototypeOf.propertyIsEnumerable.toLocaleString.toString.constructor".split("."):[],r=n.length,i=function(t,n,r){var i,s=0,o=e.global;if(!r){if(!t.length)return o;i=t[s++];try{r=e.scopeMap[i]&&e.scopeMap[i][1]}catch(u){}r=r||(i in o?o[i]:n?o[i]={}:undefined)}while(r&&(i=t[s++]))r=i in r?r[i]:n?r[i]={}:undefined;return r},s=Object.prototype.toString,o=function(e,t,n){return(n||[]).concat(Array.prototype.slice.call(e,t||0))},u=/\{([^\}]+)\}/g,a={_extraNames:n,_mixin:function(e,i,s){var o,u,a,f={};for(o in i){u=i[o];if(!(o in e)||e[o]!==u&&(!(o in f)||f[o]!==u))e[o]=s?s(u):u}if(t("bug-for-in-skips-shadowed")&&i)for(a=0;a<r;++a){o=n[a],u=i[o];if(!(o in e)||e[o]!==u&&(!(o in f)||f[o]!==u))e[o]=s?s(u):u}return e},mixin:function(e,t){e||(e={});for(var n=1,r=arguments.length;n<r;n++)a._mixin(e,arguments[n]);return e},setObject:function(e,t,n){var r=e.split("."),s=r.pop(),o=i(r,!0,n);return o&&s?o[s]=t:undefined},getObject:function(e,t,n){return i(e.split("."),t,n)},exists:function(e,t){return a.getObject(e,!1,t)!==undefined},isString:function(e){return typeof e=="string"||e instanceof String},isArray:function(e){return e&&(e instanceof Array||typeof e=="array")},isFunction:function(e){return s.call(e)==="[object Function]"},isObject:function(e){return e!==undefined&&(e===null||typeof e=="object"||a.isArray(e)||a.isFunction(e))},isArrayLike:function(e){return e&&e!==undefined&&!a.isString(e)&&!a.isFunction(e)&&(!e.tagName||e.tagName.toLowerCase()!="form")&&(a.isArray(e)||isFinite(e.length))},isAlien:function(e){return e&&!a.isFunction(e)&&/\{\s*\[native code\]\s*\}/.test(String(e))},extend:function(e,t){for(var n=1,r=arguments.length;n<r;n++)a._mixin(e.prototype,arguments[n]);return e},_hitchArgs:function(t,n){var r=a._toArray(arguments,2),i=a.isString(n);return function(){var s=a._toArray(arguments),o=i?(t||e.global)[n]:n;return o&&o.apply(t||this,r.concat(s))}},hitch:function(t,n){if(arguments.length>2)return a._hitchArgs.apply(e,arguments);n||(n=t,t=null);if(a.isString(n)){t=t||e.global;if(!t[n])throw['lang.hitch: scope["',n,'"] is null (scope="',t,'")'].join("");return function(){return t[n].apply(t,arguments||[])}}return t?function(){return n.apply(t,arguments||[])}:n},delegate:function(){function e(){}return function(t,n){e.prototype=t;var r=new e;return e.prototype=null,n&&a._mixin(r,n),r}}(),_toArray:t("ie")?function(){function e(e,t,n){var r=n||[];for(var i=t||0;i<e.length;i++)r.push(e[i]);return r}return function(t){return(t.item?e:o).apply(this,arguments)}}():o,partial:function(t){var n=[null];return a.hitch.apply(e,n.concat(a._toArray(arguments)))},clone:function(e){if(!e||typeof e!="object"||a.isFunction(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);var t,n,r;if(a.isArray(e)){t=[];for(n=0,r=e.length;n<r;++n)n in e&&t.push(a.clone(e[n]))}else t=e.constructor?new e.constructor:{};return a._mixin(t,e,a.clone)},trim:String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},replace:function(e,t,n){return e.replace(n||u,a.isFunction(t)?t:function(e,n){return a.getObject(n,!1,t)})}};return t("extend-dojo")&&a.mixin(e,a),a}),define("dojo/_base/declare",["./kernel","../has","./lang"],function(e,t,n){function f(e,t){throw new Error("declare"+(t?" "+t:"")+": "+e)}function l(e,t){var n=[],r=[{cls:0,refs:[]}],i={},o=1,a=e.length,l=0,c,h,p,d,v,m,g,y;for(;l<a;++l){p=e[l],p?s.call(p)!="[object Function]"&&f("mixin #"+l+" is not a callable constructor.",t):f("mixin #"+l+" is unknown. Did you use dojo.require to pull it in?",t),h=p._meta?p._meta.bases:[p],d=0;for(c=h.length-1;c>=0;--c)v=h[c].prototype,v.hasOwnProperty("declaredClass")||(v.declaredClass="uniqName_"+u++),g=v.declaredClass,i.hasOwnProperty(g)||(i[g]={count:0,refs:[],cls:h[c]},++o),m=i[g],d&&d!==m&&(m.refs.push(d),++d.count),d=m;++d.count,r[0].refs.push(d)}while(r.length){d=r.pop(),n.push(d.cls),--o;while(y=d.refs,y.length==1){d=y[0];if(!d||--d.count){d=0;break}n.push(d.cls),--o}if(d)for(l=0,a=y.length;l<a;++l)d=y[l],--d.count||r.push(d)}return o&&f("can't build consistent linearization",t),p=e[0],n[0]=p?p._meta&&p===n[n.length-p._meta.bases.length]?p._meta.bases.length:1:0,n}function c(e,t,n){var r,s,o,u,l,c,h,p,d,v=this._inherited=this._inherited||{};typeof e=="string"&&(r=e,e=t,t=n),n=0,u=e.callee,r=r||u.nom,r||f("can't deduce a name to call inherited()",this.declaredClass),l=this.constructor._meta,o=l.bases,d=v.p;if(r!=a){if(v.c!==u){d=0,c=o[0],l=c._meta;if(l.hidden[r]!==u){s=l.chains,s&&typeof s[r]=="string"&&f("calling chained method with inherited: "+r,this.declaredClass);do{l=c._meta,h=c.prototype;if(l&&(h[r]===u&&h.hasOwnProperty(r)||l.hidden[r]===u))break}while(c=o[++d]);d=c?d:-1}}c=o[++d];if(c){h=c.prototype;if(c._meta&&h.hasOwnProperty(r))n=h[r];else{p=i[r];do{h=c.prototype,n=h[r];if(n&&(c._meta?h.hasOwnProperty(r):n!==p))break}while(c=o[++d])}}n=c&&n||i[r]}else{if(v.c!==u){d=0,l=o[0]._meta;if(l&&l.ctor!==u){s=l.chains,(!s||s.constructor!=="manual")&&f("calling chained constructor with inherited",this.declaredClass);while(c=o[++d]){l=c._meta;if(l&&l.ctor===u)break}d=c?d:-1}}while(c=o[++d]){l=c._meta,n=l?l.ctor:c;if(n)break}n=c&&n}v.c=n,v.p=d;if(n)return t===!0?n:n.apply(this,t||e)}function h(e,t){return typeof e=="string"?this.__inherited(e,t,!0):this.__inherited(e,!0)}function p(e,t,n){var r=this.getInherited(e,t);if(r)return r.apply(this,n||t||e)}function v(e){var t=this.constructor._meta.bases;for(var n=0,r=t.length;n<r;++n)if(t[n]===e)return!0;return this instanceof e}function m(e,r){for(var i in r)i!=a&&r.hasOwnProperty(i)&&(e[i]=r[i]);if(t("bug-for-in-skips-shadowed"))for(var s=n._extraNames,o=s.length;o;)i=s[--o],i!=a&&r.hasOwnProperty(i)&&(e[i]=r[i])}function g(e,r){var o,u;for(o in r)u=r[o],(u!==i[o]||!(o in i))&&o!=a&&(s.call(u)=="[object Function]"&&(u.nom=o),e[o]=u);if(t("bug-for-in-skips-shadowed"))for(var f=n._extraNames,l=f.length;l;)o=f[--l],u=r[o],(u!==i[o]||!(o in i))&&o!=a&&(s.call(u)=="[object Function]"&&(u.nom=o),e[o]=u);return e}function y(e){return C.safeMixin(this.prototype,e),this}function b(e){return C([this].concat(e))}function w(e,t){return function(){var n=arguments,r=n,i=n[0],s,o,u,a=e.length,f;if(!(this instanceof n.callee))return N(n);if(t&&(i&&i.preamble||this.preamble)){f=new Array(e.length),f[0]=n;for(o=0;;){i=n[0],i&&(s=i.preamble,s&&(n=s.apply(this,n)||n)),s=e[o].prototype,s=s.hasOwnProperty("preamble")&&s.preamble,s&&(n=s.apply(this,n)||n);if(++o==a)break;f[o]=n}}for(o=a-1;o>=0;--o)s=e[o],u=s._meta,s=u?u.ctor:s,s&&s.apply(this,f?f[o]:n);s=this.postscript,s&&s.apply(this,r)}}function E(e,t){return function(){var n=arguments,r=n,i=n[0],s;if(!(this instanceof n.callee))return N(n);t&&(i&&(s=i.preamble,s&&(r=s.apply(this,r)||r)),s=this.preamble,s&&s.apply(this,r)),e&&e.apply(this,n),s=this.postscript,s&&s.apply(this,n)}}function S(e){return function(){var t=arguments,n=0,r,i;if(!(this instanceof t.callee))return N(t);for(;r=e[n];++n){i=r._meta,r=i?i.ctor:r;if(r){r.apply(this,t);break}}r=this.postscript,r&&r.apply(this,t)}}function x(e,t,n){return function(){var r,i,s,o=0,u=1;n&&(o=t.length-1,u=-1);for(;r=t[o];o+=u)i=r._meta,s=(i?i.hidden:r.prototype)[e],s&&s.apply(this,arguments)}}function T(e){o.prototype=e.prototype;var t=new o;return o.prototype=null,t}function N(e){var t=e.callee,n=T(t);return t.apply(n,e),n}function C(e,t,o){typeof e!="string"&&(o=t,t=e,e=""),o=o||{};var u,p,g,N,k,L,A,O=1,M=t;s.call(t)=="[object Array]"?(L=l(t,e),g=L[0],O=L.length-g,t=L[O]):(L=[0],t?s.call(t)=="[object Function]"?(g=t._meta,L=L.concat(g?g.bases:t)):f("base class is not a callable constructor.",e):t!==null&&f("unknown base class. Did you use dojo.require to pull it in?",e));if(t)for(p=O-1;;--p){u=T(t);if(!p)break;g=L[p],(g._meta?m:r)(u,g.prototype),N=new Function,N.superclass=t,N.prototype=u,t=u.constructor=N}else u={};C.safeMixin(u,o),g=o.constructor,g!==i.constructor&&(g.nom=a,u.constructor=g);for(p=O-1;p;--p)g=L[p]._meta,g&&g.chains&&(A=r(A||{},g.chains));u["-chains-"]&&(A=r(A||{},u["-chains-"])),g=!A||!A.hasOwnProperty(a),L[0]=N=A&&A.constructor==="manual"?S(L):L.length==1?E(o.constructor,g):w(L,g),N._meta={bases:L,hidden:o,chains:A,parents:M,ctor:o.constructor},N.superclass=t&&t.prototype,N.extend=y,N.createSubclass=b,N.prototype=u,u.constructor=N,u.getInherited=h,u.isInstanceOf=v,u.inherited=d,u.__inherited=c,e&&(u.declaredClass=e,n.setObject(e,N));if(A)for(k in A)u[k]&&typeof A[k]=="string"&&k!=a&&(g=u[k]=x(k,L,A[k]==="after"),g.nom=k);return N}var r=n.mixin,i=Object.prototype,s=i.toString,o=new Function,u=0,a="constructor",d=e.config.isDebug?p:c;return e.safeMixin=C.safeMixin=g,e.declare=C,C}),define("bpmn/Clazz",["dojo/_base/declare","dojo/_base/lang"],function(e,t){var n={constructor:function(e){this.text=null,this.reference={},this.attribute={},e&&t.mixin(this,e)},addReference:function(e){this.reference[e.name]=e;var t=this.__internalFieldName(e.name);e.containment===!0?this[t]=[]:this[t]=null,this[e.name]=function(t){return this.accessor(e.name,t)}},addAttribute:function(e){this.attribute[e.name]=e,this[e.name]=function(t){return this.accessor(e.name,t)}},accessor:function(e,t){var n=this.__internalFieldName(e);return t!=null&&t!=undefined&&(this[n]=t),this[n]},__internalFieldName:function(e){return"_"+e},init:function(){},setText:function(e){this.text=e}};return e("bpmn.Clazz",null,n)}),define("dojo/_base/array",["./kernel","../has","./lang"],function(e,t,n){function s(e){return r[e]=new Function("item","index","array",e)}function o(e){var t=!e;return function(n,i,o){var u=0,a=n&&n.length||0,f;a&&typeof n=="string"&&(n=n.split("")),typeof i=="string"&&(i=r[i]||s(i));if(o)for(;u<a;++u){f=!i.call(o,n[u],u,n);if(e^f)return!f}else for(;u<a;++u){f=!i(n[u],u,n);if(e^f)return!f}return t}}function u(e){var t=1,n=0,r=0;return e||(t=n=r=-1),function(s,o,u,f){if(f&&t>0)return a.lastIndexOf(s,o,u);var l=s&&s.length||0,c=e?l+r:n,h;u===i?h=e?n:l+r:u<0?(h=l+u,h<0&&(h=n)):h=u>=l?l+r:u,l&&typeof s=="string"&&(s=s.split(""));for(;h!=c;h+=t)if(s[h]==o)return h;return-1}}var r={},i,a={every:o(!1),some:o(!0),indexOf:u(!0),lastIndexOf:u(!1),forEach:function(e,t,n){var i=0,o=e&&e.length||0;o&&typeof e=="string"&&(e=e.split("")),typeof t=="string"&&(t=r[t]||s(t));if(n)for(;i<o;++i)t.call(n,e[i],i,e);else for(;i<o;++i)t(e[i],i,e)},map:function(e,t,n,i){var o=0,u=e&&e.length||0,a=new(i||Array)(u);u&&typeof e=="string"&&(e=e.split("")),typeof t=="string"&&(t=r[t]||s(t));if(n)for(;o<u;++o)a[o]=t.call(n,e[o],o,e);else for(;o<u;++o)a[o]=t(e[o],o,e);return a},filter:function(e,t,n){var i=0,o=e&&e.length||0,u=[],a;o&&typeof e=="string"&&(e=e.split("")),typeof t=="string"&&(t=r[t]||s(t));if(n)for(;i<o;++i)a=e[i],t.call(n,a,i,e)&&u.push(a);else for(;i<o;++i)a=e[i],t(a,i,e)&&u.push(a);return u},clearCache:function(){r={}}};return t("extend-dojo")&&n.mixin(e,a),a}),define("dojox/collections/_base",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array"],function(e,t,n){var r=t.getObject("dojox.collections",!0);return r.DictionaryEntry=function(e,t){this.key=e,this.value=t,this.valueOf=function(){return this.value},this.toString=function(){return String(this.value)}},r.Iterator=function(e){var t=0;this.element=e[t]||null,this.atEnd=function(){return t>=e.length},this.get=function(){return this.atEnd()?null:(this.element=e[t++],this.element)},this.map=function(t,r){return n.map(e,t,r)},this.reset=function(){t=0,this.element=e[t]}},r.DictionaryIterator=function(e){var t=[],r={};for(var i in e)r[i]||t.push(e[i]);var s=0;this.element=t[s]||null,this.atEnd=function(){return s>=t.length},this.get=function(){return this.atEnd()?null:(this.element=t[s++],this.element)},this.map=function(e,r){return n.map(t,e,r)},this.reset=function(){s=0,this.element=t[s]}},r}),define("dojox/collections/Dictionary",["dojo/_base/kernel","dojo/_base/array","./_base"],function(e,t,n){return n.Dictionary=function(t){var r={};this.count=0;var i={};this.add=function(e,t){var i=e in r;r[e]=new n.DictionaryEntry(e,t),i||this.count++},this.clear=function(){r={},this.count=0},this.clone=function(){return new n.Dictionary(this)},this.contains=this.containsKey=function(e){return i[e]?!1:r[e]!=null},this.containsValue=function(e){var t=this.getIterator();while(t.get())if(t.element.value==e)return!0;return!1},this.entry=function(e){return r[e]},this.forEach=function(t,n){var s=[];for(var o in r)i[o]||s.push(r[o]);e.forEach(s,t,n)},this.getKeyList=function(){return this.getIterator().map(function(e){return e.key})},this.getValueList=function(){return this.getIterator().map(function(e){return e.value})},this.item=function(e){return e in r?r[e].valueOf():undefined},this.getIterator=function(){return new n.DictionaryIterator(r)},this.remove=function(e){return e in r&&!i[e]?(delete r[e],this.count--,!0):!1};if(t){var s=t.getIterator();while(s.get())this.add(s.element.key,s.element.value)}},n.Dictionary}),define("bpmn/util/Index",["dojo/_base/declare","dojox/collections/Dictionary"],function(e,t){var n={constructor:function(){this._={}},add:function(e,t){this._[e]=t},addArray:function(e,t){this._[e]||(this._[e]=[]),this._[e].push(t)},addMap:function(e,t,n){this._[e]||(this._[e]={}),this._[e][t]=n},item:function(e){return this._[e]}};return e("bpmn.util.Index",null,n)}),define("bpmn/BaseElement",["dojo/_base/declare","bpmn/Clazz","bpmn/util/Index"],function(e,t){var n={constructor:function(){this.addReference({name:"documentation",type:function(){}}),this.addAttribute({name:"id",type:String}),this.addAttribute({name:"name",type:String});var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)});this.id(e)},init:function(){this._definitions.index.add(this.id(),this),this._definitions.index.addMap(this.declaredClass,this.id(),this)}};return e("bpmn.BaseElement",t,n)}),define("bpmn/CallableElement",["dojo/_base/declare","bpmn/BaseElement"],function(e,t){var n={constructor:function(){this.addAttribute({name:"name",type:String})}};return e("bpmn.CallableElement",t,n)}),define("bpmn/Package",["dojo/_base/declare"],function(e){var t={tagMap:{},constructor:function(){},registerClass:function(e){var t=e.prototype.tag;return t&&(this.tagMap[t.toLowerCase()]=e),e}},n=e("bpmn.Package",null,t);return window.bpmnPackage=new n}),define("bpmn/FlowElement",["dojo/_base/declare","bpmn/BaseElement","bpmn/Package"],function(e,t,n){var r={tag:"flowElement",constructor:function(){},getDiagramElement:function(){return this._definitions.index.item(this.id()+":di")},getBounds:function(){return this.getDiagramElement().bounds()},getWaypoints:function(){return this.getDiagramElement().waypoints()}};return n.registerClass(e("bpmn.FlowElement",t,r))}),define("bpmn/FlowElementsContainer",["dojo/_base/declare","bpmn/BaseElement","bpmn/FlowElement"],function(e,t,n){var r={constructor:function(){this.addReference({name:"flowElements",containment:!0,type:n})}};return e("bpmn.FlowElementsContainer",t,r)}),define("bpmn/Process",["dojo/_base/declare","bpmn/CallableElement","bpmn/FlowElementsContainer","bpmn/Package"],function(e,t,n,r){var i={tag:"process",constructor:function(){this.addAttribute({name:"isExecutable",containment:!0,type:"boolean"})}};return r.registerClass(e("bpmn.Process",[n,t],i))}),define("bpmn/Collaboration",["dojo/_base/declare","bpmn/Package"],function(e,t){var n={tag:"collaboration",constructor:function(){}};return t.registerClass(e("bpmn.Collaboration",null,n))}),define("bpmn/di/DiagramElement",["dojo/_base/declare","bpmn/Clazz","bpmn/Package"],function(e,t,n){var r={tag:"diagramElement",constructor:function(){this.addAttribute({name:"id",type:String}),this.addAttribute({name:"bpmnElement",type:String})},init:function(){this._definitions.index.add(this.bpmnElement()+":di",this)}};return n.registerClass(e("bpmn.DiagramElement",t,r))}),define("bpmn/di/Bounds",["dojo/_base/declare","bpmn/Clazz","bpmn/Package"],function(e,t,n){var r={tag:"Bounds",constructor:function(){this.addAttribute({name:"x",type:"float"}),this.addAttribute({name:"y",type:"float"}),this.addAttribute({name:"width",type:"float"}),this.addAttribute({name:"height",type:"float"})}};return n.registerClass(e("bpmn.Bounds",t,r))}),define("bpmn/di/BPMNShape",["dojo/_base/declare","bpmn/di/DiagramElement","bpmn/di/Bounds","bpmn/Package"],function(e,t,n,r){var i={tag:"BPMNShape",constructor:function(){this.addReference({name:"bounds",type:n})}};return r.registerClass(e("bpmn.BPMNShape",t,i))}),define("bpmn/di/Waypoint",["dojo/_base/declare","bpmn/Clazz","bpmn/Package"],function(e,t,n){var r={tag:"waypoint",constructor:function(){this.addAttribute({name:"x",type:"float"}),this.addAttribute({name:"y",type:"float"})},__internalFieldName:function(e){return e}};return n.registerClass(e("bpmn.Waypoint",t,r))}),define("bpmn/di/BPMNEdge",["dojo/_base/declare","bpmn/di/DiagramElement","bpmn/di/Waypoint","bpmn/Package"],function(e,t,n,r){var i={tag:"BPMNEdge",constructor:function(){this.addReference({name:"waypoints",containment:!0,type:n})}};return r.registerClass(e("bpmn.BPMNEdge",t,i))}),define("bpmn/di/BPMNPlane",["dojo/_base/declare","bpmn/Clazz","bpmn/Package","bpmn/di/BPMNShape","bpmn/di/BPMNEdge"],function(e,t,n){var r={tag:"BPMNPlane",constructor:function(){this.addReference({name:"diagramElements",containment:!0,type:bpmn.DiagramElement})}};return n.registerClass(e("bpmn.BPMNPlane",t,r))}),define("bpmn/di/BPMNDiagram",["dojo/_base/declare","bpmn/Clazz","bpmn/di/BPMNPlane","bpmn/Package"],function(e,t,n,r){var i={tag:"BPMNDiagram",constructor:function(){this.addReference({name:"plane",type:n})}};return r.registerClass(e("bpmn.BPMNDiagram",t,i))}),define("bpmn/FlowNode",["dojo/_base/declare","bpmn/FlowElement","bpmn/Package"],function(e,t,n){var r={tag:"flowNode",constructor:function(){},incoming:function(){var e=this._definitions.index.item("target:"+this.id());return e?e:[]},outgoing:function(){var e=this._definitions.index.item("source:"+this.id());return e?e:[]}};return n.registerClass(e("bpmn.FlowNode",t,r))}),define("bpmn/Event",["dojo/_base/declare","bpmn/FlowNode","bpmn/Package"],function(e,t,n){var r={tag:"event",constructor:function(){}};return n.registerClass(e("bpmn.Event",t,r))}),define("bpmn/CatchEvent",["dojo/_base/declare","bpmn/Event","bpmn/Package"],function(e,t,n){var r={tag:"catchEvent",constructor:function(){}};return n.registerClass(e("bpmn.CatchEvent",t,r))}),define("bpmn/StartEvent",["dojo/_base/declare","bpmn/CatchEvent","bpmn/Package"],function(e,t,n){var r={tag:"startEvent",constructor:function(){}};return n.registerClass(e("bpmn.StartEvent",t,r))}),define("bpmn/ThrowEvent",["dojo/_base/declare","bpmn/Event","bpmn/Package"],function(e,t,n){var r={tag:"throwEvent",constructor:function(){}};return n.registerClass(e("bpmn.ThrowEvent",t,r))}),define("bpmn/EndEvent",["dojo/_base/declare","bpmn/ThrowEvent","bpmn/Package"],function(e,t,n){var r={tag:"endEvent",constructor:function(){}};return n.registerClass(e("bpmn.EndEvent",t,r))}),define("bpmn/BoundaryEvent",["dojo/_base/declare","bpmn/CatchEvent","bpmn/Package"],function(e,t,n){var r={tag:"boundaryEvent",constructor:function(){}};return n.registerClass(e("bpmn.BoundaryEvent",t,r))}),define("bpmn/Activity",["dojo/_base/declare","bpmn/FlowNode","bpmn/Package"],function(e,t,n){var r={tag:"activity",constructor:function(){}};return n.registerClass(e("bpmn.Activity",t,r))}),define("bpmn/Task",["dojo/_base/declare","bpmn/Activity","bpmn/Package"],function(e,t,n){var r={tag:"task",constructor:function(){}};return n.registerClass(e("bpmn.Task",t,r))}),define("bpmn/UserTask",["dojo/_base/declare","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"userTask",constructor:function(){}};return n.registerClass(e("bpmn.UserTask",t,r))}),define("bpmn/ServiceTask",["dojo/_base/declare","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"serviceTask",constructor:function(){}};return n.registerClass(e("bpmn.ServiceTask",t,r))}),define("bpmn/BusinessRuleTask",["dojo/_base/declare","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"businessRuleTask",constructor:function(){}};return n.registerClass(e("bpmn.BusinessRuleTask",t,r))}),define("bpmn/ReceiveTask",["dojo/_base/declare","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"receiveTask",constructor:function(){}};return n.registerClass(e("bpmn.ReceiveTask",t,r))}),define("bpmn/SubProcess",["dojo/_base/declare","bpmn/Activity","bpmn/FlowElementsContainer","bpmn/Package"],function(e,t,n,r){var i={tag:"subProcess",constructor:function(){}};return r.registerClass(e("bpmn.SubProcess",[t,n],i))}),define("bpmn/Gateway",["dojo/_base/declare","bpmn/FlowNode","bpmn/Package"],function(e,t,n){var r={tag:"gateway",constructor:function(){}};return n.registerClass(e("bpmn.Gateway",t,r))}),define("bpmn/ExclusiveGateway",["dojo/_base/declare","bpmn/Gateway","bpmn/Package"],function(e,t,n){var r={tag:"exclusiveGateway",constructor:function(){this.addAttribute({name:"default",type:String})},getDefault:function(){return this._definitions.index.item(this.default())}};return n.registerClass(e("bpmn.ExclusiveGateway",t,r))}),define("bpmn/ParallelGateway",["dojo/_base/declare","bpmn/Gateway","bpmn/Package"],function(e,t,n){var r={tag:"parallelGateway",constructor:function(){}};return n.registerClass(e("bpmn.ParallelGateway",t,r))}),define("bpmn/ConditionExpression",["dojo/_base/declare","bpmn/BaseElement","bpmn/Package"],function(e,t,n){var r={tag:"conditionExpression",constructor:function(){}};return n.registerClass(e("bpmn.ConditionExpression",t,r))}),define("bpmn/SequenceFlow",["dojo/_base/declare","bpmn/FlowElement","bpmn/ConditionExpression","bpmn/Package"],function(e,t,n,r){var i={tag:"sequenceFlow",constructor:function(){this.addAttribute({name:"sourceRef",type:String}),this.addAttribute({name:"targetRef",type:String}),this.addReference({name:"conditionExpression",type:n})},getSourceRef:function(){return this._definitions.index.item(this._sourceRef)},getTargetRef:function(){return this._definitions.index.item(this._targetRef)},init:function(){this.inherited(arguments),this._definitions.index.addArray("target:"+this.targetRef(),this),this._definitions.index.addArray("source:"+this.sourceRef(),this)}};return r.registerClass(e("bpmn.SequenceFlow",t,i))}),define("bpmn/Definitions",["dojo/_base/declare","bpmn/BaseElement","bpmn/Process","bpmn/Collaboration","bpmn/di/BPMNDiagram","bpmn/util/Index","bpmn/StartEvent","bpmn/EndEvent","bpmn/BoundaryEvent","bpmn/UserTask","bpmn/ServiceTask","bpmn/BusinessRuleTask","bpmn/ReceiveTask","bpmn/SubProcess","bpmn/ExclusiveGateway","bpmn/ParallelGateway","bpmn/SequenceFlow"],function(e,t,n,r,i,s){var o={tag:"definitions",constructor:function(){this.addReference({name:"collaboration",type:r}),this.addReference({name:"process",containment:!0,type:n}),this.addReference({name:"bpmnDiagram",type:i}),this.index=new s}};return e("bpmn.Defintions",t,o)}),define("bpmn/execution/TokenStore",["dojo/_base/declare","dojo/_base/lang"],function(e,t){var n={constructor:function(e){this.tokenMap=e?e:{}},add:function(e,t){this.tokenMap[e]||(this.tokenMap[e]=[]),this.tokenMap[e].push(t)},drop:function(e,t){if(this.tokenMap[e])for(var n=0;n<t;n++)this.tokenMap[e].pop()},query:function(e){return this.tokenMap[e]?this.tokenMap[e]:[]},count:function(){var e=0;for(var t in this.tokenMap)e+=this.tokenMap[t].length;return e}};return e("bpmn.TokenStore",null,n)}),define("dojo/errors/create",["../_base/lang"],function(e){return function(t,n,r,i){r=r||Error;var s=function(e){if(r===Error){Error.captureStackTrace&&Error.captureStackTrace(this,s);var t=Error.call(this,e),i;for(i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);this.message=e,this.stack=t.stack}else r.apply(this,arguments);n&&n.apply(this,arguments)};return s.prototype=e.delegate(r.prototype,i),s.prototype.name=t,s.prototype.constructor=s,s}}),define("dojo/errors/CancelError",["./create"],function(e){return e("CancelError",null,null,{dojoType:"cancel"})}),define("dojo/promise/Promise",["../_base/lang"],function(e){function t(){throw new TypeError("abstract")}return e.extend(function(){},{then:function(e,n,r){t()},cancel:function(e,n){t()},isResolved:function(){t()},isRejected:function(){t()},isFulfilled:function(){t()},isCanceled:function(){t()},always:function(e){return this.then(e,e)},otherwise:function(e){return this.then(null,e)},trace:function(){return this},traceRejected:function(){return this},toString:function(){return"[object Promise]"}})}),define("dojo/Deferred",["./has","./_base/lang","./errors/CancelError","./promise/Promise","./has!config-deferredInstrumentation?./promise/instrumentation"],function(e,t,n,r,i){var s=0,o=1,u=2,a="This deferred has already been fulfilled.",f=Object.freeze||function(){},l=function(t,n,r,i,s){e("config-deferredInstrumentation")&&n===u&&d.instrumentRejected&&t.length===0&&d.instrumentRejected(r,!1,i,s);for(var o=0;o<t.length;o++)c(t[o],n,r,i)},c=function(t,n,r,i){var a=t[n],f=t.deferred;if(a)try{var l=a(r);if(n===s)typeof l!="undefined"&&p(f,n,l);else{if(l&&typeof l.then=="function"){t.cancel=l.cancel,l.then(h(f,o),h(f,u),h(f,s));return}p(f,o,l)}}catch(c){p(f,u,c)}else p(f,n,r);e("config-deferredInstrumentation")&&n===u&&d.instrumentRejected&&d.instrumentRejected(r,!!a,i,f.promise)},h=function(e,t){return function(n){p(e,t,n)}},p=function(e,t,n){if(!e.isCanceled())switch(t){case s:e.progress(n);break;case o:e.resolve(n);break;case u:e.reject(n)}},d=function(t){var i=this.promise=new r,h=this,p,v,m,g=!1,y=[];e("config-deferredInstrumentation")&&Error.captureStackTrace&&(Error.captureStackTrace(h,d),Error.captureStackTrace(i,d)),this.isResolved=i.isResolved=function(){return p===o},this.isRejected=i.isRejected=function(){return p===u},this.isFulfilled=i.isFulfilled=function(){return!!p},this.isCanceled=i.isCanceled=function(){return g},this.progress=function(e,t){if(!p)return l(y,s,e,null,h),i;if(t===!0)throw new Error(a);return i},this.resolve=function(e,t){if(!p)return l(y,p=o,v=e,null,h),y=null,i;if(t===!0)throw new Error(a);return i};var b=this.reject=function(t,n){if(!p)return e("config-deferredInstrumentation")&&Error.captureStackTrace&&Error.captureStackTrace(m={},b),l(y,p=u,v=t,m,h),y=null,i;if(n===!0)throw new Error(a);return i};this.then=i.then=function(e,t,n){var r=[n,e,t];return r.cancel=i.cancel,r.deferred=new d(function(e){return r.cancel&&r.cancel(e)}),p&&!y?c(r,p,v,m):y.push(r),r.deferred.promise},this.cancel=i.cancel=function(e,r){if(!p){if(t){var i=t(e);e=typeof i=="undefined"?e:i}g=!0;if(!p)return typeof e=="undefined"&&(e=new n),b(e),e;if(p===u&&v===e)return e}else if(r===!0)throw new Error(a)},f(i)};return d.prototype.toString=function(){return"[object Deferred]"},i&&i(d),d}),define("dojo/aspect",[],function(){function n(e,n,r,i){var s=e[n],o=n=="around",u;if(o){var a=r(function(){return s.advice(this,arguments)});u={remove:function(){u.cancelled=!0},advice:function(e,t){return u.cancelled?s.advice(e,t):a.apply(e,t)}}}else u={remove:function(){var t=u.previous,r=u.next;!r&&!t?delete e[n]:(t?t.next=r:e[n]=r,r&&(r.previous=t))},id:t++,advice:r,receiveArguments:i};if(s&&!o)if(n=="after"){while(s.next&&(s=s.next));s.next=u,u.previous=s}else n=="before"&&(e[n]=u,u.next=s,s.previous=u);else e[n]=u;return u}function r(r){return function(i,s,o,u){var a=i[s],f;if(!a||a.target!=i)i[s]=f=function(){var n=t,r=arguments,i=f.before;while(i)r=i.advice.apply(this,r)||r,i=i.next;if(f.around)var s=f.around.advice(this,r);var o=f.after;while(o&&o.id<n){if(o.receiveArguments){var u=o.advice.apply(this,r);s=u===e?s:u}else s=o.advice.call(this,s,r);o=o.next}return s},a&&(f.around={advice:function(e,t){return a.apply(e,t)}}),f.target=i;var l=n(f||a,r,o,u);return o=null,l}}var e,t=0,i=r("after"),s=r("before"),o=r("around");return{before:s,around:o,after:i}}),define("dojo/on",["./has!dom-addeventlistener?:./aspect","./_base/kernel","./has"],function(e,t,n){function o(e,t,r,o,u){var a=t.match(/(.*):(.*)/);if(a)return t=a[2],a=a[1],i.selector(a,t).call(u,e,r);n("touch")&&(s.test(t)&&(r=x(r)),!n("event-orientationchange")&&t=="orientationchange"&&(t="resize",e=window,r=x(r))),p&&(r=p(r));if(e.addEventListener){var f=t in c,l=f?c[t]:t;return e.addEventListener(l,r,f),{remove:function(){e.removeEventListener(l,r,f)}}}t="on"+t;if(g&&e.attachEvent)return g(e,t,r);throw new Error("Target must be an event emitter")}function u(){this.cancelable=!1}function a(){this.bubbles=!1}if(n("dom")){var r=window.ScriptEngineMajorVersion;n.add("jscript",r&&r()+ScriptEngineMinorVersion()/10),n.add("event-orientationchange",n("touch")&&!n("android")),n.add("event-stopimmediatepropagation",window.Event&&!!window.Event.prototype&&!!window.Event.prototype.stopImmediatePropagation)}var i=function(e,t,n,r){return typeof e.on=="function"&&typeof t!="function"?e.on(t,n):i.parse(e,t,n,o,r,this)};i.pausable=function(e,t,n,r){var s,o=i(e,t,function(){if(!s)return n.apply(this,arguments)},r);return o.pause=function(){s=!0},o.resume=function(){s=!1},o},i.once=function(e,t,n,r){var s=i(e,t,function(){return s.remove(),n.apply(this,arguments)});return s},i.parse=function(e,t,n,r,i,s){if(t.call)return t.call(s,e,n);if(t.indexOf(",")>-1){var o=t.split(/\s*,\s*/),u=[],a=0,f;while(f=o[a++])u.push(r(e,f,n,i,s));return u.remove=function(){for(var e=0;e<u.length;e++)u[e].remove()},u}return r(e,t,n,i,s)};var s=/^touch/;i.selector=function(e,n,r){return function(s,o){function f(n){u=u&&u.matches?u:t.query;while(!u.matches(n,e,s))if(n==s||r===!1||!(n=n.parentNode)||n.nodeType!=1)return;return n}var u=typeof e=="function"?{matches:e}:this,a=n.bubble;return a?i(s,a(f),o):i(s,n,function(e){var t=f(e.target);return t&&o.call(t,e)})}};var f=[].slice,l=i.emit=function(e,t,n){var r=f.call(arguments,2),i="on"+t;if("parentNode"in e){var s=r[0]={};for(var o in n)s[o]=n[o];s.preventDefault=u,s.stopPropagation=a,s.target=e,s.type=t,n=s}do e[i]&&e[i].apply(e,r);while(n&&n.bubbles&&(e=e.parentNode));return n&&n.cancelable&&n},c={};if(!n("event-stopimmediatepropagation"))var h=function(){this.immediatelyStopped=!0,this.modified=!0},p=function(e){return function(t){if(!t.immediatelyStopped)return t.stopImmediatePropagation=h,e.apply(this,arguments)}};if(n("dom-addeventlistener"))c={focusin:"focus",focusout:"blur"},i.emit=function(e,t,n){if(e.dispatchEvent&&document.createEvent){var r=e.ownerDocument.createEvent("HTMLEvents");r.initEvent(t,!!n.bubbles,!!n.cancelable);for(var s in n){var o=n[s];s in r||(r[s]=n[s])}return e.dispatchEvent(r)&&r}return l.apply(i,arguments)};else{i._fixEvent=function(e,t){if(!e){var n=t&&(t.ownerDocument||t.document||t).parentWindow||window;e=n.event}if(!e)return e;d&&e.type==d.type&&(e=d);if(!e.target){e.target=e.srcElement,e.currentTarget=t||e.srcElement,e.type=="mouseover"&&(e.relatedTarget=e.fromElement),e.type=="mouseout"&&(e.relatedTarget=e.toElement),e.stopPropagation||(e.stopPropagation=b,e.preventDefault=w);switch(e.type){case"keypress":var r="charCode"in e?e.charCode:e.keyCode;r==10?(r=0,e.keyCode=13):r==13||r==27?r=0:r==3&&(r=99),e.charCode=r,y(e)}}return e};var d,v=function(e){this.handle=e};v.prototype.remove=function(){delete _dojoIEListeners_[this.handle]};var m=function(e){return function(t){t=i._fixEvent(t,this);var n=e.call(this,t);return t.modified&&(d||setTimeout(function(){d=null}),d=t),n}},g=function(t,r,i){i=m(i);if(((t.ownerDocument?t.ownerDocument.parentWindow:t.parentWindow||t.window||window)!=top||n("jscript")<5.8)&&!n("config-_allow_leaks")){typeof _dojoIEListeners_=="undefined"&&(_dojoIEListeners_=[]);var s=t[r];if(!s||!s.listeners){var o=s;s=Function("event","var callee = arguments.callee; for(var i = 0; i<callee.listeners.length; i++){var listener = _dojoIEListeners_[callee.listeners[i]]; if(listener){listener.call(this,event);}}"),s.listeners=[],t[r]=s,s.global=this,o&&s.listeners.push(_dojoIEListeners_.push(o)-1)}var u;return s.listeners.push(u=s.global._dojoIEListeners_.push(i)-1),new v(u)}return e.after(t,r,i,!0)},y=function(e){e.keyChar=e.charCode?String.fromCharCode(e.charCode):"",e.charOrCode=e.keyChar||e.keyCode},b=function(){this.cancelBubble=!0},w=i._preventDefault=function(){this.bubbledKeyCode=this.keyCode;if(this.ctrlKey)try{this.keyCode=0}catch(e){}this.defaultPrevented=!0,this.returnValue=!1}}if(n("touch"))var E=function(){},S=window.orientation,x=function(e){return function(t){var n=t.corrected;if(!n){var r=t.type;try{delete t.type}catch(i){}if(t.type){E.prototype=t;var n=new E;n.preventDefault=function(){t.preventDefault()},n.stopPropagation=function(){t.stopPropagation()}}else n=t,n.type=r;t.corrected=n;if(r=="resize")return S==window.orientation?null:(S=window.orientation,n.type="orientationchange",e.call(this,n));"rotation"in n||(n.rotation=0,n.scale=1);var s=n.changedTouches[0];for(var o in s)delete n[o],n[o]=s[o]}return e.call(this,n)}};return i}),define("dojo/Evented",["./aspect","./on"],function(e,t){function r(){}var n=e.after;return r.prototype={on:function(e,r){return t.parse(this,e,r,function(e,t){return n(e,"on"+t,r,!0)})},emit:function(e,n){var r=[this];return r.push.apply(r,arguments),t.emit.apply(t,r)}},r}),define("dojo/topic",["./Evented"],function(e){var t=new e;return{publish:function(e,n){return t.emit.apply(t,arguments)},subscribe:function(e,n){return t.on.apply(t,arguments)}}}),define("bpmn/execution/Instance",["bpmn/execution/TokenStore","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Deferred","dojo/topic"],function(e,t,n,r,i,s){var o={constructor:function(t,n,r,i){this.definitions=t,this.configuration=n,this.tokenStore=new e(r),this.variables=i?i:{},this.behaviours["bpmn.StartEvent"]=this.behaviours.takeAll,this.behaviours["bpmn.EndEvent"]=this.behaviours.takeNone,this.behaviours["bpmn.UserTask"]=this.behaviours.takeNone,this.behaviours["bpmn.ServiceTask"]=this.behaviours.takeAll,this.behaviours["bpmn.ExclusiveGateway"]=this.behaviours.xor,this.behaviours["bpmn.ParallelGateway"]=this.behaviours.and},behaviours:{takeAll:function(e){return this.dropToken(e.id(),this.tokenStore),e.outgoing()},takeNone:function(e){return[]},xor:function(e){this.dropToken(e.id(),this.tokenStore);if(e.outgoing().length==1)return e.outgoing();var t=null;n.map(e.outgoing(),function(e){var n=this.configuration[e.id()];!t&&n&&n(this)&&(t=e)},this);if(!t&&!e.getDefault())throw new Error("No transition evaluated to true and no default defined");return t},and:function(e){var t=!0,i=this.tokenStore.query(e.id()),s={};if(e.incoming().length==1)return r.hitch(this,this.behaviours.takeAll)(e);for(var o=0;o<i.length;o++){var u=i[o];s[u.from]=u}var a=[];return n.map(e.incoming(),function(e){s[e.id()]?a.push(e):t=!1},this),t?(n.map(a,function(e){r.hitch(this,this.dropToken)(e.sourceRef(),this.tokenStore)},this),r.hitch(this,this.behaviours.takeAll)(e)):[]}},dropToken:function(e,t,n){t.query(e).length>0&&t.drop(e,n?n:1)},copyVariables:function(e){if(e)for(var t in e)this.variables[t]=e[t]},start:function(e,t){return this.tokenStore.add(e,{from:null}),this.trigger(e,t)},trigger:function(e,t,n,o){console.log("trigger",e);var u=new i,o=o?o:new i;this.copyVariables(t);var a=this.definitions.index.item(e),f=n?this.behaviours[n]:this.behaviours[a.declaredClass],c=[].concat(r.hitch(this,f)(a,this.tokenStore));return console.log("next",c),c.length>0&&this.configuration.leave&&(this.configuration.leave(a),s.publish("flow:leave:"+a.id(),a)),c.length==0&&o.resolve(),c.map(function(e){this.tokenStore.add(e.targetRef(),{from:e.id()});var t="flow:enter:"+e.targetRef();s.publish(t,e.getTargetRef()),this.configuration.enter&&this.configuration.enter(e.getTargetRef());var n=this;u.then(function(){console.log("then for",e.id()),n.trigger(e.targetRef(),null,null,o)})},this),this.configuration[e]&&this.configuration[e]?this.configuration[e]({instance:this,promise:u}):(console.log("resolving",e,this.tokenStore.tokenMap),u.resolve()),o}};return t("bpmn.Instance",null,o)}),function(e){function n(t,r){if(!(this instanceof n))return new n(t,r);var s=this;i(s),s.q=s.c="",s.bufferCheckPosition=e.MAX_BUFFER_LENGTH,s.opt=r||{},s.opt.lowercase=s.opt.lowercase||s.opt.lowercasetags,s.looseCase=s.opt.lowercase?"toLowerCase":"toUpperCase",s.tags=[],s.closed=s.closedRoot=s.sawRoot=!1,s.tag=s.error=null,s.strict=!!t,s.noscript=!!t||!!s.opt.noscript,s.state=k.BEGIN,s.ENTITIES=Object.create(e.ENTITIES),s.attribList=[],s.opt.xmlns&&(s.ns=Object.create(w)),s.trackPosition=s.opt.position!==!1,s.trackPosition&&(s.position=s.line=s.column=0),L(s,"onready")}function r(n){var r=Math.max(e.MAX_BUFFER_LENGTH,10),i=0;for(var s=0,o=t.length;s<o;s++){var u=n[t[s]].length;if(u>r)switch(t[s]){case"textNode":O(n);break;case"cdata":A(n,"oncdata",n.cdata),n.cdata="";break;case"script":A(n,"onscript",n.script),n.script="";break;default:_(n,"Max buffer length exceeded: "+t[s])}i=Math.max(i,u)}n.bufferCheckPosition=e.MAX_BUFFER_LENGTH-i+n.position}function i(e){for(var n=0,r=t.length;n<r;n++)e[t[n]]=""}function a(e,t){return new f(e,t)}function f(e,t){if(!(this instanceof f))return new f(e,t);s.apply(this),this._parser=new n(e,t),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(e){r.emit("error",e),r._parser.error=null},u.forEach(function(e){Object.defineProperty(r,"on"+e,{get:function(){return r._parser["on"+e]},set:function(t){if(!t)return r.removeAllListeners(e),r._parser["on"+e]=t;r.on(e,t)},enumerable:!0,configurable:!1})})}function x(e){return e.split("").reduce(function(e,t){return e[t]=!0,e},{})}function T(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function N(e,t){return T(e)?!!t.match(e):e[t]}function C(e,t){return!N(e,t)}function L(e,t,n){e[t]&&e[t](n)}function A(e,t,n){e.textNode&&O(e),L(e,t,n)}function O(e){e.textNode=M(e.opt,e.textNode),e.textNode&&L(e,"ontext",e.textNode),e.textNode=""}function M(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function _(e,t){return O(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,L(e,"onerror",t),e}function D(e){return e.closedRoot||P(e,"Unclosed root tag"),e.state!==k.TEXT&&_(e,"Unexpected end"),O(e),e.c="",e.closed=!0,L(e,"onend"),n.call(e,e.strict,e.opt),e}function P(e,t){if(!(typeof e=="object"&&e instanceof n))throw new Error("bad call to strictFail");e.strict&&_(e,t)}function H(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0}function B(e){var t=e.indexOf(":"),n=t<0?["",e]:e.split(":"),r=n[0],i=n[1];return e==="xmlns"&&(r="xmlns",i=""),{prefix:r,local:i}}function j(e){e.strict||(e.attribName=e.attribName[e.looseCase]());if(e.attribList.hasOwnProperty(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))return e.attribName=e.attribValue="";if(e.opt.xmlns){var t=B(e.attribName),n=t.prefix,r=t.local;if(n==="xmlns")if(r==="xml"&&e.attribValue!==y)P(e,"xml: prefix must be bound to "+y+"\n"+"Actual: "+e.attribValue);else if(r==="xmlns"&&e.attribValue!==b)P(e,"xmlns: prefix must be bound to "+b+"\n"+"Actual: "+e.attribValue);else{var i=e.tag,s=e.tags[e.tags.length-1]||e;i.ns===s.ns&&(i.ns=Object.create(s.ns)),i.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,A(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}function F(e,t){if(e.opt.xmlns){var n=e.tag,r=B(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||r.prefix,n.prefix&&!n.uri&&P(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName));var i=e.tags[e.tags.length-1]||e;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach(function(t){A(e,"onopennamespace",{prefix:t,uri:n.ns[t]})});for(var s=0,o=e.attribList.length;s<o;s++){var u=e.attribList[s],a=u[0],f=u[1],l=B(a),c=l.prefix,h=l.local,p=c==""?"":n.ns[c]||"",d={name:a,value:f,prefix:c,local:h,uri:p};c&&c!="xmlns"&&!p&&(P(e,"Unbound namespace prefix: "+JSON.stringify(c)),d.uri=c),e.tag.attributes[a]=d,A(e,"onattribute",d)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),A(e,"onopentag",e.tag),t||(!e.noscript&&e.tagName.toLowerCase()==="script"?e.state=k.SCRIPT:e.state=k.TEXT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function I(e){if(!e.tagName){P(e,"Weird empty close tag."),e.textNode+="</>",e.state=k.TEXT;return}if(e.script){if(e.tagName!=="script"){e.script+="</"+e.tagName+">",e.tagName="",e.state=k.SCRIPT;return}A(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());var r=n;while(t--){var i=e.tags[t];if(i.name===r)break;P(e,"Unexpected close tag")}if(t<0){P(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",e.state=k.TEXT;return}e.tagName=n;var s=e.tags.length;while(s-->t){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,A(e,"onclosetag",e.tagName);var u={};for(var a in o.ns)u[a]=o.ns[a];var f=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==f.ns&&Object.keys(o.ns).forEach(function(t){var n=o.ns[t];A(e,"onclosenamespace",{prefix:t,uri:n})})}t===0&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=k.TEXT}function q(e){var t=e.entity,n=t.toLowerCase(),r,i="";return e.ENTITIES[t]?e.ENTITIES[t]:e.ENTITIES[n]?e.ENTITIES[n]:(t=n,t.charAt(0)==="#"&&(t.charAt(1)==="x"?(t=t.slice(2),r=parseInt(t,16),i=r.toString(16)):(t=t.slice(1),r=parseInt(t,10),i=r.toString(10))),t=t.replace(/^0+/,""),i.toLowerCase()!==t?(P(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCharCode(r))}function R(e){var t=this;if(this.error)throw this.error;if(t.closed)return _(t,"Cannot write after close. Assign an onready handler.");if(e===null)return D(t);var n=0,i="";while(t.c=i=e.charAt(n++)){t.trackPosition&&(t.position++,i==="\n"?(t.line++,t.column=0):t.column++);switch(t.state){case k.BEGIN:i==="<"?(t.state=k.OPEN_WAKA,t.startTagPosition=t.position):C(l,i)&&(P(t,"Non-whitespace before first tag."),t.textNode=i,t.state=k.TEXT);continue;case k.TEXT:if(t.sawRoot&&!t.closedRoot){var s=n-1;while(i&&i!=="<"&&i!=="&")i=e.charAt(n++),i&&t.trackPosition&&(t.position++,i==="\n"?(t.line++,t.column=0):t.column++);t.textNode+=e.substring(s,n-1)}i==="<"?(t.state=k.OPEN_WAKA,t.startTagPosition=t.position):(C(l,i)&&(!t.sawRoot||t.closedRoot)&&P(t,"Text data outside of root node."),i==="&"?t.state=k.TEXT_ENTITY:t.textNode+=i);continue;case k.SCRIPT:i==="<"?t.state=k.SCRIPT_ENDING:t.script+=i;continue;case k.SCRIPT_ENDING:i==="/"?t.state=k.CLOSE_TAG:(t.script+="<"+i,t.state=k.SCRIPT);continue;case k.OPEN_WAKA:if(i==="!")t.state=k.SGML_DECL,t.sgmlDecl="";else if(!N(l,i))if(N(E,i))t.state=k.OPEN_TAG,t.tagName=i;else if(i==="/")t.state=k.CLOSE_TAG,t.tagName="";else if(i==="?")t.state=k.PROC_INST,t.procInstName=t.procInstBody="";else{P(t,"Unencoded <");if(t.startTagPosition+1<t.position){var o=t.position-t.startTagPosition;i=(new Array(o)).join(" ")+i}t.textNode+="<"+i,t.state=k.TEXT}continue;case k.SGML_DECL:(t.sgmlDecl+i).toUpperCase()===m?(A(t,"onopencdata"),t.state=k.CDATA,t.sgmlDecl="",t.cdata=""):t.sgmlDecl+i==="--"?(t.state=k.COMMENT,t.comment="",t.sgmlDecl=""):(t.sgmlDecl+i).toUpperCase()===g?(t.state=k.DOCTYPE,(t.doctype||t.sawRoot)&&P(t,"Inappropriately located doctype declaration"),t.doctype="",t.sgmlDecl=""):i===">"?(A(t,"onsgmldeclaration",t.sgmlDecl),t.sgmlDecl="",t.state=k.TEXT):N(p,i)?(t.state=k.SGML_DECL_QUOTED,t.sgmlDecl+=i):t.sgmlDecl+=i;continue;case k.SGML_DECL_QUOTED:i===t.q&&(t.state=k.SGML_DECL,t.q=""),t.sgmlDecl+=i;continue;case k.DOCTYPE:i===">"?(t.state=k.TEXT,A(t,"ondoctype",t.doctype),t.doctype=!0):(t.doctype+=i,i==="["?t.state=k.DOCTYPE_DTD:N(p,i)&&(t.state=k.DOCTYPE_QUOTED,t.q=i));continue;case k.DOCTYPE_QUOTED:t.doctype+=i,i===t.q&&(t.q="",t.state=k.DOCTYPE);continue;case k.DOCTYPE_DTD:t.doctype+=i,i==="]"?t.state=k.DOCTYPE:N(p,i)&&(t.state=k.DOCTYPE_DTD_QUOTED,t.q=i);continue;case k.DOCTYPE_DTD_QUOTED:t.doctype+=i,i===t.q&&(t.state=k.DOCTYPE_DTD,t.q="");continue;case k.COMMENT:i==="-"?t.state=k.COMMENT_ENDING:t.comment+=i;continue;case k.COMMENT_ENDING:i==="-"?(t.state=k.COMMENT_ENDED,t.comment=M(t.opt,t.comment),t.comment&&A(t,"oncomment",t.comment),t.comment=""):(t.comment+="-"+i,t.state=k.COMMENT);continue;case k.COMMENT_ENDED:i!==">"?(P(t,"Malformed comment"),t.comment+="--"+i,t.state=k.COMMENT):t.state=k.TEXT;continue;case k.CDATA:i==="]"?t.state=k.CDATA_ENDING:t.cdata+=i;continue;case k.CDATA_ENDING:i==="]"?t.state=k.CDATA_ENDING_2:(t.cdata+="]"+i,t.state=k.CDATA);continue;case k.CDATA_ENDING_2:i===">"?(t.cdata&&A(t,"oncdata",t.cdata),A(t,"onclosecdata"),t.cdata="",t.state=k.TEXT):i==="]"?t.cdata+="]":(t.cdata+="]]"+i,t.state=k.CDATA);continue;case k.PROC_INST:i==="?"?t.state=k.PROC_INST_ENDING:N(l,i)?t.state=k.PROC_INST_BODY:t.procInstName+=i;continue;case k.PROC_INST_BODY:if(!t.procInstBody&&N(l,i))continue;i==="?"?t.state=k.PROC_INST_ENDING:t.procInstBody+=i;continue;case k.PROC_INST_ENDING:i===">"?(A(t,"onprocessinginstruction",{name:t.procInstName,body:t.procInstBody}),t.procInstName=t.procInstBody="",t.state=k.TEXT):(t.procInstBody+="?"+i,t.state=k.PROC_INST_BODY);continue;case k.OPEN_TAG:N(S,i)?t.tagName+=i:(H(t),i===">"?F(t):i==="/"?t.state=k.OPEN_TAG_SLASH:(C(l,i)&&P(t,"Invalid character in tag name"),t.state=k.ATTRIB));continue;case k.OPEN_TAG_SLASH:i===">"?(F(t,!0),I(t)):(P(t,"Forward-slash in opening tag not followed by >"),t.state=k.ATTRIB);continue;case k.ATTRIB:if(N(l,i))continue;i===">"?F(t):i==="/"?t.state=k.OPEN_TAG_SLASH:N(E,i)?(t.attribName=i,t.attribValue="",t.state=k.ATTRIB_NAME):P(t,"Invalid attribute name");continue;case k.ATTRIB_NAME:i==="="?t.state=k.ATTRIB_VALUE:i===">"?(P(t,"Attribute without value"),t.attribValue=t.attribName,j(t),F(t)):N(l,i)?t.state=k.ATTRIB_NAME_SAW_WHITE:N(S,i)?t.attribName+=i:P(t,"Invalid attribute name");continue;case k.ATTRIB_NAME_SAW_WHITE:if(i==="=")t.state=k.ATTRIB_VALUE;else{if(N(l,i))continue;P(t,"Attribute without value"),t.tag.attributes[t.attribName]="",t.attribValue="",A(t,"onattribute",{name:t.attribName,value:""}),t.attribName="",i===">"?F(t):N(E,i)?(t.attribName=i,t.state=k.ATTRIB_NAME):(P(t,"Invalid attribute name"),t.state=k.ATTRIB)}continue;case k.ATTRIB_VALUE:if(N(l,i))continue;N(p,i)?(t.q=i,t.state=k.ATTRIB_VALUE_QUOTED):(P(t,"Unquoted attribute value"),t.state=k.ATTRIB_VALUE_UNQUOTED,t.attribValue=i);continue;case k.ATTRIB_VALUE_QUOTED:if(i!==t.q){i==="&"?t.state=k.ATTRIB_VALUE_ENTITY_Q:t.attribValue+=i;continue}j(t),t.q="",t.state=k.ATTRIB;continue;case k.ATTRIB_VALUE_UNQUOTED:if(C(v,i)){i==="&"?t.state=k.ATTRIB_VALUE_ENTITY_U:t.attribValue+=i;continue}j(t),i===">"?F(t):t.state=k.ATTRIB;continue;case k.CLOSE_TAG:if(!t.tagName){if(N(l,i))continue;C(E,i)?t.script?(t.script+="</"+i,t.state=k.SCRIPT):P(t,"Invalid tagname in closing tag."):t.tagName=i}else i===">"?I(t):N(S,i)?t.tagName+=i:t.script?(t.script+="</"+t.tagName,t.tagName="",t.state=k.SCRIPT):(C(l,i)&&P(t,"Invalid tagname in closing tag"),t.state=k.CLOSE_TAG_SAW_WHITE);continue;case k.CLOSE_TAG_SAW_WHITE:if(N(l,i))continue;i===">"?I(t):P(t,"Invalid characters in closing tag");continue;case k.TEXT_ENTITY:case k.ATTRIB_VALUE_ENTITY_Q:case k.ATTRIB_VALUE_ENTITY_U:switch(t.state){case k.TEXT_ENTITY:var u=k.TEXT,a="textNode";break;case k.ATTRIB_VALUE_ENTITY_Q:var u=k.ATTRIB_VALUE_QUOTED,a="attribValue";break;case k.ATTRIB_VALUE_ENTITY_U:var u=k.ATTRIB_VALUE_UNQUOTED,a="attribValue"}i===";"?(t[a]+=q(t),t.entity="",t.state=u):N(d,i)?t.entity+=i:(P(t,"Invalid character entity"),t[a]+="&"+t.entity+i,t.entity="",t.state=u);continue;default:throw new Error(t,"Unknown state: "+t.state)}}return t.position>=t.bufferCheckPosition&&r(t),t}e.parser=function(e,t){return new n(e,t)},e.SAXParser=n,e.SAXStream=f,e.createStream=a,e.MAX_BUFFER_LENGTH=65536;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),n.prototype={end:function(){D(this)},write:R,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{var s=require("stream").Stream}catch(o){var s=function(){}}var u=e.EVENTS.filter(function(e){return e!=="error"&&e!=="end"});f.prototype=Object.create(s.prototype,{constructor:{value:f}}),f.prototype.write=function(e){return this._parser.write(e.toString()),this.emit("data",e),!0},f.prototype.end=function(e){return e&&e.length&&this._parser.write(e.toString()),this._parser.end(),!0},f.prototype.on=function(e,t){var n=this;return!n._parser["on"+e]&&u.indexOf(e)!==-1&&(n._parser["on"+e]=function(){var t=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),s.prototype.on.call(n,e,t)};var l="\r\n	 ",c="0124356789",h="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",p="'\"",d=c+h+"#",v=l+">",m="[CDATA[",g="DOCTYPE",y="http://www.w3.org/XML/1998/namespace",b="http://www.w3.org/2000/xmlns/",w={xml:y,xmlns:b};l=x(l),c=x(c),h=x(h);var E=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;p=x(p),d=x(d),v=x(v);var k=0;e.STATE={BEGIN:k++,TEXT:k++,TEXT_ENTITY:k++,OPEN_WAKA:k++,SGML_DECL:k++,SGML_DECL_QUOTED:k++,DOCTYPE:k++,DOCTYPE_QUOTED:k++,DOCTYPE_DTD:k++,DOCTYPE_DTD_QUOTED:k++,COMMENT_STARTING:k++,COMMENT:k++,COMMENT_ENDING:k++,COMMENT_ENDED:k++,CDATA:k++,CDATA_ENDING:k++,CDATA_ENDING_2:k++,PROC_INST:k++,PROC_INST_BODY:k++,PROC_INST_ENDING:k++,OPEN_TAG:k++,OPEN_TAG_SLASH:k++,ATTRIB:k++,ATTRIB_NAME:k++,ATTRIB_NAME_SAW_WHITE:k++,ATTRIB_VALUE:k++,ATTRIB_VALUE_QUOTED:k++,ATTRIB_VALUE_UNQUOTED:k++,ATTRIB_VALUE_ENTITY_Q:k++,ATTRIB_VALUE_ENTITY_U:k++,CLOSE_TAG:k++,CLOSE_TAG_SAW_WHITE:k++,SCRIPT:k++,SCRIPT_ENDING:k++},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var n=e.ENTITIES[t],r=typeof n=="number"?String.fromCharCode(n):n;e.ENTITIES[t]=r});for(var k in e.STATE)e.STATE[e.STATE[k]]=k;k=e.STATE}(typeof exports=="undefined"?sax={}:exports),define("sax",function(e){return function(){var t,n;return t||e.sax}}(this)),define("bpmn/util/Serializer",["dojo/_base/declare","bpmn/Package","bpmn/Definitions","sax"],function(e,t,n){var r={constructor:function(){},fromXML:function(e){if(!e)return;var r=function(e,t,n,r){if(t.attributes[e]){var i=t.attributes[e].value;r=="float"&&(i=parseFloat(i)),r=="boolean"&&(i=i.toLowerCase()=="true"),r=="integer"&&(i=parseInt(i)),n[e](i)}},i=sax.parser(!0,{xmlns:!0,lowercase:!0,trim:!0});i.stack=[],Array.prototype.peek=function(){return this.length==0?null:this[this.length-1]};var s={definitions:function(e){i.definitions=new n,i.stack.push(i.definitions)},"default":function(e){var n=i.stack.peek(),s=e.local.toLowerCase(),o=t.tagMap[s]?t.tagMap[s]():new bpmn.BaseElement;i.stack.push(o),o._definitions=i.definitions;for(var u in o.attribute)r(u,e,o,o.attribute[u].type);var a=null;for(var f in n.reference){var l=n.reference[f];if(o.isInstanceOf(l.type)){a=l;break}}o.init(),a&&a.containment===!0?n[a.name]().push(o):a&&n[a.name](o)}};return i.onerror=function(e){console.log("error",e)},i.onopentag=function(e){s[e.local]?s[e.local](e):s["default"](e)},i.onclosetag=function(e){i.stack.pop()},i.ontext=function(e){i.stack.peek().setText(e)},i.onend=function(){},i.write(e).close(),i.definitions}};return e("bpmn.util.Serializer",null,r)});var Kinetic={};!function(){Kinetic={version:"4.7.0",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,UA:function(){var e=navigator.userAgent.toLowerCase(),t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}(),Filters:{},Node:function(e){this._init(e)},Shape:function(e){this.__init(e)},Container:function(e){this.__init(e)},Stage:function(e){this.___init(e)},Layer:function(e){this.___init(e)},Group:function(e){this.___init(e)},isDragging:function(){var e=Kinetic.DD;return e?e.isDragging:!1},isDragReady:function(){var e=Kinetic.DD;return e?!!e.node:!1},_addId:function(e,t){void 0!==t&&(this.ids[t]=e)},_removeId:function(e){void 0!==e&&delete this.ids[e]},_addName:function(e,t){void 0!==t&&(void 0===this.names[t]&&(this.names[t]=[]),this.names[t].push(e))},_removeName:function(e,t){if(void 0!==e){var n=this.names[e];if(void 0!==n){for(var r=0;r<n.length;r++){var i=n[r];i._id===t&&n.splice(r,1)}0===n.length&&delete this.names[e]}}}}}(),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("kinetic",t):e.returnExports=t()}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var e=[].slice.call(arguments),t=e.length,n=0;for(this.length=t;t>n;n++)this[n]=e[n];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(e){for(var t=0;t<this.length;t++)e(this[t],t)},Kinetic.Collection.prototype.toArray=function(){var e,t=[],n=this.length;for(e=0;n>e;e++)t.push(this[e]);return t},Kinetic.Collection.toCollection=function(e){var t,n=new Kinetic.Collection,r=e.length;for(t=0;r>t;t++)n.push(e[t]);return n},Kinetic.Collection.mapMethods=function(e){var t,n=e.length;for(t=0;n>t;t++)!function(t){var n=e[t];Kinetic.Collection.prototype[n]=function(){var e,t=this.length;for(args=[].slice.call(arguments),e=0;t>e;e++)this[e][n].apply(this[e],args)}}(t)},Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t},scale:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,s=this.m[0]*-n+this.m[2]*t,o=this.m[1]*-n+this.m[3]*t;this.m[0]=r,this.m[1]=i,this.m[2]=s,this.m[3]=o},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(e,t){var n=this.m[0]+this.m[2]*t,r=this.m[1]+this.m[3]*t,i=this.m[2]+this.m[0]*e,s=this.m[3]+this.m[1]*e;this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=s},multiply:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],i=this.m[1]*e.m[2]+this.m[3]*e.m[3],s=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],o=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o},invert:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,i=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o},getMatrix:function(){return this.m},setAbsolutePosition:function(e,t){var n=this.m[0],r=this.m[1],i=this.m[2],s=this.m[3],o=this.m[4],u=this.m[5],a=(n*(t-u)-r*(e-o))/(n*s-r*i),f=(e-o-i*a)/n;this.translate(f,a)}};var e="canvas",t="2d",n="[object Array]",r="[object Number]",i="[object String]",s=Math.PI/180,o=180/Math.PI,u="#",a="",f="0",l="Kinetic warning: ",c="Kinetic error: ",h="rgb(",p={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(e){return!!e&&1==e.nodeType},_isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isObject:function(e){return!!e&&e.constructor==Object},_isArray:function(e){return Object.prototype.toString.call(e)==n},_isNumber:function(e){return Object.prototype.toString.call(e)==r},_isString:function(e){return Object.prototype.toString.call(e)==i},_hasMethods:function(e){var t,n=[];for(t in e)this._isFunction(e[t])&&n.push(t);return n.length>0},_isInDocument:function(e){for(;e=e.parentNode;)if(e==document)return!0;return!1},_roundArrValues:function(e){var t,n,r=[],i=e.length,s=Kinetic.Util._isNumber;for(t=0;i>t;t++)n=e[t],s(n)&&(n=Math.round(1e3*n)/1e3),r.push(n);return r},_getXY:function(e){if(this._isNumber(e))return{x:e,y:e};if(this._isArray(e)){if(1===e.length){var t=e[0];if(this._isNumber(t))return{x:t,y:t};if(this._isArray(t))return{x:t[0],y:t[1]};if(this._isObject(t))return t}else if(e.length>=2)return{x:e[0],y:e[1]}}else if(this._isObject(e))return e;return null},_getSize:function(e){if(this._isNumber(e))return{width:e,height:e};if(this._isArray(e))if(1===e.length){var t=e[0];if(this._isNumber(t))return{width:t,height:t};if(this._isArray(t)){if(t.length>=4)return{width:t[2],height:t[3]};if(t.length>=2)return{width:t[0],height:t[1]}}else if(this._isObject(t))return t}else{if(e.length>=4)return{width:e[2],height:e[3]};if(e.length>=2)return{width:e[0],height:e[1]}}else if(this._isObject(e))return e;return null},_getPoints:function(e){var t,n,r=[];if(void 0===e)return[];if(n=e.length,this._isArray(e[0])){for(t=0;n>t;t++)r.push({x:e[t][0],y:e[t][1]});return r}if(this._isObject(e[0]))return e;for(t=0;n>t;t+=2)r.push({x:e[t],y:e[t+1]});return r},_getImage:function(n,r){var i,s,o;n?this._isElement(n)?r(n):this._isString(n)?(i=new Image,i.onload=function(){r(i)},i.src=n):n.data?(s=document.createElement(e),s.width=n.width,s.height=n.height,_context=s.getContext(t),_context.putImageData(n,0,0),o=s.toDataURL(),i=new Image,i.onload=function(){r(i)},i.src=o):r(null):r(null)},_rgbToHex:function(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},_hexToRgb:function(e){e=e.replace(u,a);var t=parseInt(e,16);return{r:255&t>>16,g:255&t>>8,b:255&t}},getRandomColor:function(){for(var e=(16777215*Math.random()<<0).toString(16);e.length<6;)e=f+e;return u+e},get:function(e,t){return void 0===e?t:e},getRGB:function(e){var t;return e in p?(t=p[e],{r:t[0],g:t[1],b:t[2]}):e[0]===u?this._hexToRgb(e.substring(1)):e.substr(0,4)===h?(t=d.exec(e.replace(/ /g,"")),{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}):{r:0,g:0,b:0}},_merge:function(e,t){var n=this._clone(t);for(var r in e)n[r]=this._isObject(e[r])?this._merge(e[r],n[r]):e[r];return n},_clone:function(e){var t={};for(var n in e)t[n]=this._isObject(e[n])?this._clone(e[n]):e[n];return t},_degToRad:function(e){return e*s},_radToDeg:function(e){return e*o},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},error:function(e){throw new Error(c+e)},warn:function(e){window.console&&console.warn&&console.warn(l+e)},extend:function(e,t){for(var n in t.prototype)n in e.prototype||(e.prototype[n]=t.prototype[n])},addMethods:function(e,t){var n;for(n in t)e.prototype[n]=t[n]},_getControlPoints:function(e,t,n,r){var i=e.x,s=e.y,o=t.x,u=t.y,a=n.x,f=n.y,l=Math.sqrt(Math.pow(o-i,2)+Math.pow(u-s,2)),c=Math.sqrt(Math.pow(a-o,2)+Math.pow(f-u,2)),h=r*l/(l+c),p=r*c/(l+c),d=o-h*(a-i),v=u-h*(f-s),m=o+p*(a-i),g=u+p*(f-s);return[{x:d,y:v},{x:m,y:g}]},_expandPoints:function(e,t){var n,r,i=e.length,s=[];for(n=1;i-1>n;n++)r=Kinetic.Util._getControlPoints(e[n-1],e[n],e[n+1],t),s.push(r[0]),s.push(e[n]),s.push(r[1]);return s},_removeLastLetter:function(e){return e.substring(0,e.length-1)}}}(),function(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;Kinetic.Canvas=function(e){this.init(e)},Kinetic.Canvas.prototype={init:function(e){e=e||{};var t=e.pixelRatio||Kinetic.pixelRatio||i;this.pixelRatio=t,this._canvas=document.createElement("canvas"),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(e){this.pixelRatio=e,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px"},setHeight:function(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(e,t){this.setWidth(e),this.setHeight(t)},toDataURL:function(e,t){try{return this._canvas.toDataURL(e,t)}catch(n){try{return this._canvas.toDataURL()}catch(r){return Kinetic.Util.warn("Unable to get data URL. "+r.message),""}}}},Kinetic.SceneCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e),this.context=new Kinetic.SceneContext(this),this.setSize(t,n)},Kinetic.SceneCanvas.prototype={setWidth:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,e),n.scale(t,t)},setHeight:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,e),n.scale(t,t)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e),this.context=new Kinetic.HitContext(this),this.setSize(t,n)},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var e=",",t="(",n=")",r="([",i="])",s=";",o="()",u="=",a=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(e){this.init(e)},Kinetic.Context.prototype={init:function(e){this.canvas=e,this._context=e._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},getTrace:function(a){var l,p,v,m,y=this.traceArr,w=y.length,E="";for(l=0;w>l;l++)p=y[l],v=p.method,v?(m=p.args,E+=v,E+=a?o:Kinetic.Util._isArray(m[0])?r+m.join(e)+i:t+m.join(e)+n):(E+=p.property,a||(E+=u+p.val)),E+=s;return E},clearTrace:function(){this.traceArr=[]},_trace:function(e){var t,n=this.traceArr;n.push(e),t=n.length,t>=Kinetic.traceArrMax&&n.shift()},reset:function(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)},getCanvas:function(){return this.canvas},clear:function(e){var t,n,r=this.getCanvas();e?(t=Kinetic.Util._getXY(e),n=Kinetic.Util._getSize(e),this.clearRect(t.x||0,t.y||0,n.width,n.height)):this.clearRect(0,0,r.getWidth(),r.getHeight())},fillShape:function(e){e.getFillEnabled()&&this._fill(e)},strokeShape:function(e){e.getStrokeEnabled()&&this._stroke(e)},fillStrokeShape:function(e){var t=e.getFillEnabled();t&&this._fill(e),e.getStrokeEnabled()&&this._stroke(e,e.hasShadow()&&e.hasFill()&&t)},_applyLineCap:function(e){var t=e.getLineCap();t&&this.setAttr("lineCap",t)},_applyOpacity:function(e){var t=e.getAbsoluteOpacity();1!==t&&this.setAttr("globalAlpha",t)},_applyLineJoin:function(e){var t=e.getLineJoin();t&&this.setAttr("lineJoin",t)},_applyAncestorTransforms:function(e){var t=e.getAbsoluteTransform().getMatrix();this.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_clip:function(e){var t=e.getClipX()||0,n=e.getClipY()||0,r=e.getClipWidth(),i=e.getClipHeight();this.save(),this._applyAncestorTransforms(e),this.beginPath(),this.rect(t,n,r,i),this.clip(),this.reset(),e._drawChildren(this.getCanvas()),this.restore()},setAttr:function(e,t){this._context[e]=t},arc:function(){var e=arguments;this._context.arc(e[0],e[1],e[2],e[3],e[4],e[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var e=arguments;this._context.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])},clearRect:function(){var e=arguments;this._context.clearRect(e[0],e[1],e[2],e[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createLinearGradient:function(){var e=arguments;return this._context.createLinearGradient(e[0],e[1],e[2],e[3])},createPattern:function(){var e=arguments;return this._context.createPattern(e[0],e[1])},createRadialGradient:function(){var e=arguments;return this._context.createRadialGradient(e[0],e[1],e[2],e[3],e[4],e[5])},drawImage:function(){var e=arguments,t=this._context;3===e.length?t.drawImage(e[0],e[1],e[2]):5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},fill:function(){this._context.fill()},fillText:function(){var e=arguments;this._context.fillText(e[0],e[1],e[2])},getImageData:function(){var e=arguments;return this._context.getImageData(e[0],e[1],e[2],e[3])},lineTo:function(){var e=arguments;this._context.lineTo(e[0],e[1])},moveTo:function(){var e=arguments;this._context.moveTo(e[0],e[1])},rect:function(){var e=arguments;this._context.rect(e[0],e[1],e[2],e[3])},putImageData:function(){var e=arguments;this._context.putImageData(e[0],e[1],e[2])},quadraticCurveTo:function(){var e=arguments;this._context.quadraticCurveTo(e[0],e[1],e[2],e[3])},restore:function(){this._context.restore()},rotate:function(){var e=arguments;this._context.rotate(e[0])},save:function(){this._context.save()},scale:function(){var e=arguments;this._context.scale(e[0],e[1])},setLineDash:function(){var e=arguments,t=this._context;this._context.setLineDash?t.setLineDash(e[0]):"mozDash"in t?t.mozDash=e[0]:"webkitLineDash"in t&&(t.webkitLineDash=e[0])},setTransform:function(){var e=arguments;this._context.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},stroke:function(){this._context.stroke()},strokeText:function(){var e=arguments;this._context.strokeText(e[0],e[1],e[2])},transform:function(){var e=arguments;this._context.transform(e[0],e[1],e[2],e[3],e[4],e[5])},translate:function(){var e=arguments;this._context.translate(e[0],e[1])},_enableTrace:function(){var e,t,n=this,r=a.length,i=Kinetic.Util._roundArrValues,s=this.setAttr;for(e=0;r>e;e++)!function(e){var r,s=n[e];n[e]=function(){return t=i(Array.prototype.slice.call(arguments,0)),r=s.apply(n,arguments),n._trace({method:e,args:t}),r}}(a[e]);n.setAttr=function(){s.apply(n,arguments),n._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(e){Kinetic.Context.call(this,e)},Kinetic.SceneContext.prototype={_fillColor:function(e){var t=e.getFill();this.setAttr("fillStyle",t),e._fillFunc(this)},_fillPattern:function(e){var t=e.getFillPatternImage(),n=e.getFillPatternX(),r=e.getFillPatternY(),i=e.getFillPatternScale(),s=e.getFillPatternRotation(),o=e.getFillPatternOffset(),u=e.getFillPatternRepeat();(n||r)&&this.translate(n||0,r||0),s&&this.rotate(s),i&&this.scale(i.x,i.y),o&&this.translate(-1*o.x,-1*o.y),this.setAttr("fillStyle",this.createPattern(t,u||"repeat")),this.fill()},_fillLinearGradient:function(e){var t=e.getFillLinearGradientStartPoint(),n=e.getFillLinearGradientEndPoint(),r=e.getFillLinearGradientColorStops(),i=this.createLinearGradient(t.x,t.y,n.x,n.y);if(r){for(var s=0;s<r.length;s+=2)i.addColorStop(r[s],r[s+1]);this.setAttr("fillStyle",i),this.fill()}},_fillRadialGradient:function(e){for(var t=e.getFillRadialGradientStartPoint(),n=e.getFillRadialGradientEndPoint(),r=e.getFillRadialGradientStartRadius(),i=e.getFillRadialGradientEndRadius(),s=e.getFillRadialGradientColorStops(),o=this.createRadialGradient(t.x,t.y,r,n.x,n.y,i),u=0;u<s.length;u+=2)o.addColorStop(s[u],s[u+1]);this.setAttr("fillStyle",o),this.fill()},_fill:function(e,t){var n=e.getFill(),r=e.getFillPatternImage(),i=e.getFillLinearGradientColorStops(),s=e.getFillRadialGradientColorStops(),o=e.getFillPriority();!t&&e.hasShadow()&&(this.save(),this._applyShadow(e)),n&&"color"===o?this._fillColor(e):r&&"pattern"===o?this._fillPattern(e):i&&"linear-gradient"===o?this._fillLinearGradient(e):s&&"radial-gradient"===o?this._fillRadialGradient(e):n?this._fillColor(e):r?this._fillPattern(e):i?this._fillLinearGradient(e):s&&this._fillRadialGradient(e),!t&&e.hasShadow()&&(this.restore(),this._fill(e,!0))},_stroke:function(e,t){var n=e.getStroke(),r=e.getStrokeWidth(),i=e.getDashArray(),s=e.getStrokeScaleEnabled();(n||r)&&(s||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(e),i&&e.getDashArrayEnabled()&&this.setLineDash(i),!t&&e.hasShadow()&&this._applyShadow(e),this.setAttr("lineWidth",r||2),this.setAttr("strokeStyle",n||"black"),e._strokeFunc(this),!t&&e.hasShadow()&&this._stroke(e,!0),s||this.restore())},applyShadow:function(e,t){this.save(),this._applyShadow(e),t(),this.restore(),t()},_applyShadow:function(e){var t,n,r,i,s,o;e.hasShadow()&&e.getShadowEnabled()&&(t=Kinetic.Util,n=e.getAbsoluteOpacity(),r=t.get(e.getShadowColor(),"black"),i=t.get(e.getShadowBlur(),5),o=t.get(e.getShadowOpacity(),0),s=t.get(e.getShadowOffset(),{x:0,y:0}),o&&this.setAttr("globalAlpha",o*n),this.setAttr("shadowColor",r),this.setAttr("shadowBlur",i),this.setAttr("shadowOffsetX",s.x),this.setAttr("shadowOffsetY",s.y))}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(e){Kinetic.Context.call(this,e)},Kinetic.HitContext.prototype={_fill:function(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()},_stroke:function(e){var t=e.getStroke(),n=e.getStrokeWidth();(t||n)&&(this._applyLineCap(e),this.setAttr("lineWidth",n||2),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this))}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var e="add",t="b",n="Deg",r="g",i="get",s="#",o="r",u="RGB",a="set",f="B",l="G",c="Height",h="R",p="Width",d="X",v="Y";Kinetic.Factory={addGetterSetter:function(e,t,n){this.addGetter(e,t,n),this.addSetter(e,t)},addPointGetterSetter:function(e,t,n){this.addPointGetter(e,t,n),this.addPointSetter(e,t),this.addGetter(e,t+d,n),this.addGetter(e,t+v,n),this.addSetter(e,t+d),this.addSetter(e,t+v)},addBoxGetterSetter:function(e,t,n){this.addBoxGetter(e,t,n),this.addBoxSetter(e,t),this.addGetter(e,t+d,n),this.addGetter(e,t+v,n),this.addGetter(e,t+p,n),this.addGetter(e,t+c,n),this.addSetter(e,t+d),this.addSetter(e,t+v),this.addSetter(e,t+p),this.addSetter(e,t+c)},addPointsGetterSetter:function(e,t){this.addPointsGetter(e,t),this.addPointsSetter(e,t),this.addPointAdder(e,t)},addRotationGetterSetter:function(e,t,n){this.addRotationGetter(e,t,n),this.addRotationSetter(e,t)},addColorGetterSetter:function(e,n){this.addGetter(e,n),this.addSetter(e,n),this.addColorRGBGetter(e,n),this.addColorComponentGetter(e,n,o),this.addColorComponentGetter(e,n,r),this.addColorComponentGetter(e,n,t),this.addColorRGBSetter(e,n),this.addColorComponentSetter(e,n,o),this.addColorComponentSetter(e,n,r),this.addColorComponentSetter(e,n,t)},addColorRGBGetter:function(e,t){var n=i+Kinetic.Util._capitalize(t)+u;e.prototype[n]=function(){return Kinetic.Util.getRGB(this.attrs[t])}},addColorComponentGetter:function(e,t,n){var r=i+Kinetic.Util._capitalize(t),s=r+Kinetic.Util._capitalize(n);e.prototype[s]=function(){return this[r+u]()[n]}},addPointsGetter:function(e,t){var n=i+Kinetic.Util._capitalize(t);e.prototype[n]=function(){var e=this.attrs[t];return void 0===e?[]:e}},addGetter:function(e,t,n){var r=i+Kinetic.Util._capitalize(t);e.prototype[r]=function(){var e=this.attrs[t];return void 0===e?n:e}},addPointGetter:function(e,t){var n=i+Kinetic.Util._capitalize(t);e.prototype[n]=function(){var e=this;return{x:e[n+d](),y:e[n+v]()}}},addBoxGetter:function(e,t){var n=i+Kinetic.Util._capitalize(t);e.prototype[n]=function(){var e=this;return{x:e[n+d](),y:e[n+v](),width:e[n+p](),height:e[n+c]()}}},addRotationGetter:function(e,t,r){var s=i+Kinetic.Util._capitalize(t);e.prototype[s]=function(){var e=this.attrs[t];return void 0===e&&(e=r),e},e.prototype[s+n]=function(){var e=this.attrs[t];return void 0===e&&(e=r),Kinetic.Util._radToDeg(e)}},addColorRGBSetter:function(e,t){var n=a+Kinetic.Util._capitalize(t)+u;e.prototype[n]=function(e){var n=e&&void 0!==e.r?0|e.r:this.getAttr(t+h),r=e&&void 0!==e.g?0|e.g:this.getAttr(t+l),i=e&&void 0!==e.b?0|e.b:this.getAttr(t+f);this._setAttr(t,s+Kinetic.Util._rgbToHex(n,r,i))}},addColorComponentSetter:function(e,t,n){var r=a+Kinetic.Util._capitalize(t),i=r+Kinetic.Util._capitalize(n);e.prototype[i]=function(e){var t={};t[n]=e,this[r+u](t)}},addPointsSetter:function(e,t){var n=a+Kinetic.Util._capitalize(t);e.prototype[n]=function(e){var t=Kinetic.Util._getPoints(e);this._setAttr("points",t)}},addSetter:function(e,t){var n=a+Kinetic.Util._capitalize(t);e.prototype[n]=function(e){this._setAttr(t,e)}},addPointSetter:function(e,t){var n=a+Kinetic.Util._capitalize(t);e.prototype[n]=function(){var e=Kinetic.Util._getXY([].slice.call(arguments)),r=this.attrs[t],i=0,s=0;e&&(i=e.x,s=e.y,this._fireBeforeChangeEvent(t,r,e),void 0!==i&&this[n+d](i),void 0!==s&&this[n+v](s),this._fireChangeEvent(t,r,e))}},addBoxSetter:function(e,t){var n=a+Kinetic.Util._capitalize(t);e.prototype[n]=function(){var e,r,i,s,o=[].slice.call(arguments),u=Kinetic.Util._getXY(o),a=Kinetic.Util._getSize(o),f=Kinetic.Util._merge(u,a),l=this.attrs[t];f&&(e=f.x,r=f.y,i=f.width,s=f.height,this._fireBeforeChangeEvent(t,l,f),void 0!==e&&this[n+d](e),void 0!==r&&this[n+v](r),void 0!==i&&this[n+p](i),void 0!==s&&this[n+c](s),this._fireChangeEvent(t,l,f))}},addRotationSetter:function(e,t){var r=a+Kinetic.Util._capitalize(t);e.prototype[r]=function(e){this._setAttr(t,e)},e.prototype[r+n]=function(e){this._setAttr(t,Kinetic.Util._degToRad(e))}},addPointAdder:function(t,n){var r=e+Kinetic.Util._removeLastLetter(Kinetic.Util._capitalize(n));t.prototype[r]=function(){var e=Kinetic.Util._getXY([].slice.call(arguments)),t=this.attrs[n];e&&(this._fireBeforeChangeEvent(n,t,e),this.attrs[n].push(e),this._fireChangeEvent(n,t,e))}}}}(),function(){var e="absoluteOpacity",t="absoluteTransform",n="before",r="Change",i="children",s=".",o="",u="get",a="id",f="kinetic",l="listening",c="mouseenter",h="mouseleave",p="name",d="set",v="Shape",m=" ",g="stage",y="transform",b="Stage",w="visible",E=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic"].join(m);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(n){var r=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this.cache={},this.setAttrs(n),this.on(E,function(){this._clearCache(y),r._clearSelfAndChildrenCache(t)}),this.on("visibleChange.kinetic",function(){r._clearSelfAndChildrenCache(w)}),this.on("listeningChange.kinetic",function(){r._clearSelfAndChildrenCache(l)}),this.on("opacityChange.kinetic",function(){r._clearSelfAndChildrenCache(e)})},clearCache:function(){this.cache={}},_clearCache:function(e){delete this.cache[e]},_getCache:function(e,t){var n=this.cache[e];return void 0===n&&(this.cache[e]=t.call(this)),this.cache[e]},_clearSelfAndChildrenCache:function(e){this._clearCache(e),this.children&&this.getChildren().each(function(t){t._clearSelfAndChildrenCache(e)})},on:function(e,t){var n,r,i,u,a,f=e.split(m),l=f.length;for(n=0;l>n;n++)r=f[n],i=r.split(s),u=i[0],a=i[1]||o,this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:a,handler:t});return this},off:function(e){var t,n,r,i,o,u,a=e.split(m),f=a.length;for(t=0;f>t;t++)if(r=a[t],i=r.split(s),o=i[0],u=i[1],o)this.eventListeners[o]&&this._off(o,u);else for(n in this.eventListeners)this._off(n,u);return this},remove:function(){var n=this.getParent();return n&&n.children&&(n.children.splice(this.index,1),n._setChildrenIndices(),delete this.parent),this._clearSelfAndChildrenCache(g),this._clearSelfAndChildrenCache(t),this._clearSelfAndChildrenCache(w),this._clearSelfAndChildrenCache(l),this._clearSelfAndChildrenCache(e),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(e){var t=u+Kinetic.Util._capitalize(e);return Kinetic.Util._isFunction(this[t])?this[t]():this.attrs[e]},getAncestors:function(){for(var e=this.getParent(),t=new Kinetic.Collection;e;)t.push(e),e=e.getParent();return t},setAttr:function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=d+Kinetic.Util._capitalize(t),r=this[n];return e.shift(),Kinetic.Util._isFunction(r)?r.apply(this,e):this.attrs[t]=e[0],this},getAttrs:function(){return this.attrs||{}},setAttrs:function(e){var t,n;if(e)for(t in e)t===i||(n=d+Kinetic.Util._capitalize(t),Kinetic.Util._isFunction(this[n])?this[n](e[t]):this._setAttr(t,e[t]));return this},isListening:function(){return this._getCache(l,this._isListening)},_isListening:function(){var e=this.getListening(),t=this.getParent();return e&&t&&!t.isListening()?!1:e},isVisible:function(){return this._getCache(w,this._isVisible)},_isVisible:function(){var e=this.getVisible(),t=this.getParent();return e&&t&&!t.isVisible()?!1:e},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function e(a){for(t=[],n=a.length,r=0;n>r;r++)i=a[r],u++,i.nodeType!==v&&(t=t.concat(i.getChildren().toArray())),i._id===o._id&&(r=n);t.length>0&&t[0].getLevel()<=s&&e(t)}var t,n,r,i,s=this.getLevel(),o=this,u=0;return o.nodeType!==b&&e(o.getStage().getChildren()),u},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},setPosition:function(){var e=Kinetic.Util._getXY([].slice.call(arguments));return this.setX(e.x),this.setY(e.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var e=this.getAbsoluteTransform().getMatrix(),t=new Kinetic.Transform,n=this.getOffset();return t.m=e.slice(),t.translate(n.x,n.y),t.getTranslation()},setAbsolutePosition:function(){var e,t=Kinetic.Util._getXY([].slice.call(arguments)),n=this._clearTransform();return this.attrs.x=n.x,this.attrs.y=n.y,delete n.x,delete n.y,e=this.getAbsoluteTransform(),e.invert(),e.translate(t.x,t.y),t={x:this.attrs.x+e.getTranslation().x,y:this.attrs.y+e.getTranslation().y},this.setPosition(t.x,t.y),this._setTransform(n),this},_setTransform:function(e){var n;for(n in e)this.attrs[n]=e[n];this._clearCache(y),this._clearSelfAndChildrenCache(t)},_clearTransform:function(){var e={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(y),this._clearSelfAndChildrenCache(t),e},move:function(){var e=Kinetic.Util._getXY([].slice.call(arguments)),t=this.getX(),n=this.getY();return void 0!==e.x&&(t+=e.x),void 0!==e.y&&(n+=e.y),this.setPosition(t,n),this},_eachAncestorReverse:function(e,t){var n,r,i=[],s=this.getParent();for(t&&i.unshift(this);s;)i.unshift(s),s=s.parent;for(n=i.length,r=0;n>r;r++)e(i[r])},rotate:function(e){return this.setRotation(this.getRotation()+e),this},rotateDeg:function(e){return this.setRotation(this.getRotation()+Kinetic.Util._degToRad(e)),this},moveToTop:function(){var e=this.index;return this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var e=this.index,t=this.parent.getChildren().length;return t-1>e?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(e){var t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(e,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var e=this.getOpacity();return this.getParent()&&(e*=this.getParent().getAbsoluteOpacity()),e},moveTo:function(e){return Kinetic.Node.prototype.remove.call(this),e.add(this),this},toObject:function(){var e,t,n=Kinetic.Util,r={},i=this.getAttrs();r.attrs={};for(e in i)t=i[e],n._isFunction(t)||n._isElement(t)||n._isObject(t)&&n._hasMethods(t)||(r.attrs[e]=t);return r.className=this.getClassName(),r},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this._getCache(g,this._getStage)},_getStage:function(){var e=this.getParent();return e?e.getStage():void 0},fire:function(e,t,n){return n?this._fireAndBubble(e,t||{}):this._fire(e,t||{}),this},getAbsoluteTransform:function(){return this._getCache(t,this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var e,t=new Kinetic.Transform;return this._eachAncestorReverse(function(n){e=n.getTransform(),t.multiply(e)},!0),t},_getTransform:function(){var e=new Kinetic.Transform,t=this.getX(),n=this.getY(),r=this.getRotation(),i=this.getScaleX(),s=this.getScaleY(),o=this.getSkewX(),u=this.getSkewY(),a=this.getOffsetX(),f=this.getOffsetY();return(0!==t||0!==n)&&e.translate(t,n),0!==r&&e.rotate(r),(0!==o||0!==u)&&e.skew(o,u),(1!==i||1!==s)&&e.scale(i,s),(0!==a||0!==f)&&e.translate(-1*a,-1*f),e},clone:function(e){var t,n,r,i,s,o=this.getClassName(),u=new Kinetic[o](this.attrs);for(t in this.eventListeners)for(n=this.eventListeners[t],r=n.length,i=0;r>i;i++)s=n[i],s.name.indexOf(f)<0&&(u.eventListeners[t]||(u.eventListeners[t]=[]),u.eventListeners[t].push(s));return u.setAttrs(e),u},toDataURL:function(e){e=e||{};var t=e.mimeType||null,n=e.quality||null,r=this.getStage(),i=e.x||0,s=e.y||0,o=new Kinetic.SceneCanvas({width:e.width||r.getWidth(),height:e.height||r.getHeight(),pixelRatio:1}),u=o.getContext();return u.save(),(i||s)&&u.translate(-1*i,-1*s),this.drawScene(o),u.restore(),o.toDataURL(t,n)},toImage:function(e){Kinetic.Util._getImage(this.toDataURL(e),function(t){e.callback(t)})},setSize:function(){var e=Kinetic.Util._getSize(Array.prototype.slice.call(arguments));return this.setWidth(e.width),this.setHeight(e.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(e){return this.nodeType===e?[this]:[]},_off:function(e,t){var n,r,i=this.eventListeners[e];for(n=0;n<i.length;n++)if(r=i[n].name,!("kinetic"===r&&"kinetic"!==t||t&&r!==t)){if(i.splice(n,1),0===i.length){delete this.eventListeners[e];break}n--}},_fireBeforeChangeEvent:function(e,t,i){this._fire(n+Kinetic.Util._capitalize(e)+r,{oldVal:t,newVal:i})},_fireChangeEvent:function(e,t,n){this._fire(e+r,{oldVal:t,newVal:n})},setId:function(e){var t=this.getId();return Kinetic._removeId(t),Kinetic._addId(this,e),this._setAttr(a,e),this},setName:function(e){var t=this.getName();return Kinetic._removeName(t,this._id),Kinetic._addName(this,e),this._setAttr(p,e),this},_setAttr:function(e,t){var n;void 0!==t&&(n=this.attrs[e],this._fireBeforeChangeEvent(e,n,t),this.attrs[e]=t,this._fireChangeEvent(e,n,t))},_fireAndBubble:function(e,t,n){var r=!0;t&&this.nodeType===v&&(t.targetNode=this),e===c&&n&&this._id===n._id?r=!1:e===h&&n&&this._id===n._id&&(r=!1),r&&(this._fire(e,t),t&&!t.cancelBubble&&this.parent&&(n&&n.parent?this._fireAndBubble.call(this.parent,e,t,n.parent):this._fireAndBubble.call(this.parent,e,t)))},_fire:function(e,t){var n,r,i=this.eventListeners[e];if(i)for(n=i.length,r=0;n>r;r++)i[r].handler.call(this,t)},draw:function(){return this.drawScene(),this.drawHit(),this},shouldDrawHit:function(){return this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},isDraggable:function(){return!1},getTransform:function(){return this._getCache(y,this._getTransform)}}),Kinetic.Node.create=function(e,t){return this._createNode(JSON.parse(e),t)},Kinetic.Node._createNode=function(e,t){var n,r,i,s=Kinetic.Node.prototype.getClassName.call(e),o=e.children;if(t&&(e.attrs.container=t),n=new Kinetic[s](e.attrs),o)for(r=o.length,i=0;r>i;i++)n.add(this._createNode(o[i]));return n},Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addRotationGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"scale",1),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"skew",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"offset",0),Kinetic.Factory.addSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening",!0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible",!0),Kinetic.Collection.mapMethods(["on","off","remove","destroy","show","hide","move","rotate","moveToTop","moveUp","moveDown","moveToBottom","moveTo","fire","draw"])}(),function(){function e(e){window.setTimeout(e,1e3/60)}var t=500;Kinetic.Animation=function(e,t){this.func=e,this.setLayers(t),this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={setLayers:function(e){var t=[];t=e?e.length>0?e:[e]:[],this.layers=t},getLayers:function(){return this.layers},addLayer:function(e){var t,n,r=this.layers;if(r){for(t=r.length,n=0;t>n;n++)if(r[n]._id===e._id)return!1}else this.layers=[];return this.layers.push(e),!0},isRunning:function(){for(var e=Kinetic.Animation,t=e.animations,n=0;n<t.length;n++)if(t[n].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(e){this.animations.push(e),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(e){for(var t=e.id,n=this.animations,r=n.length,i=0;r>i;i++)if(n[i].id===t){this.animations.splice(i,1);break}},Kinetic.Animation._runFrames=function(){var e,t,n,r,i,s,o,u,a={},f=this.animations;for(r=0;r<f.length;r++){for(e=f[r],t=e.layers,n=e.func,e._updateFrameObject((new Date).getTime()),s=t.length,i=0;s>i;i++)o=t[i],void 0!==o._id&&(a[o._id]=o);n&&n.call(e,e.frame)}for(u in a)a[u].draw()},Kinetic.Animation._animationLoop=function(){var e=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){e._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var e=this;this.animRunning||(this.animRunning=!0,e._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||e}(),Kinetic.Animation.requestAnimFrame=function(t){var n=Kinetic.DD&&Kinetic.DD.isDragging?e:RAF;n(t)};var n=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(e){n.call(this,e)},Kinetic.Layer.prototype.batchDraw=function(){var e=this;this.batchAnim||(this.batchAnim=new Kinetic.Animation(function(){e.lastBatchDrawTime&&(new Date).getTime()-e.lastBatchDrawTime>t&&e.batchAnim.stop()},this)),this.lastBatchDrawTime=(new Date).getTime(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(e){e.batchDraw()})}}(),function(){var e={node:1,duration:1,easing:1,onFinish:1,yoyo:1},t=1,n=2,r=3,i=0;Kinetic.Tween=function(t){var n,r=this,o=t.node,u=o._id,l=t.duration||1,c=t.easing||Kinetic.Easings.Linear,h=!!t.yoyo;this.node=o,this._id=i++,this.anim=new Kinetic.Animation(function(){r.tween.onEnterFrame()},o.getLayer()||o.getLayers()),this.tween=new s(n,function(e){r._tweenFunc(e)},c,0,1,1e3*l,h),this._addListeners(),Kinetic.Tween.attrs[u]||(Kinetic.Tween.attrs[u]={}),Kinetic.Tween.attrs[u][this._id]||(Kinetic.Tween.attrs[u][this._id]={}),Kinetic.Tween.tweens[u]||(Kinetic.Tween.tweens[u]={});for(n in t)void 0===e[n]&&this._addAttr(n,t[n]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(e,t){var n,r,i,s,o,u,a,f=this.node,l=f._id;if(i=Kinetic.Tween.tweens[l][e],i&&delete Kinetic.Tween.attrs[l][i][e],n=f.getAttr(e),Kinetic.Util._isArray(t))for(t=Kinetic.Util._getPoints(t),r=[],o=t.length,s=0;o>s;s++)u=n[s],a=t[s],r.push({x:a.x-u.x,y:a.y-u.y});else r=t-n;Kinetic.Tween.attrs[l][this._id][e]={start:n,diff:r},Kinetic.Tween.tweens[l][e]=this._id},_tweenFunc:function(e){var t,n,r,i,s,o,u,a,f,l=this.node,c=Kinetic.Tween.attrs[l._id][this._id];for(t in c){if(n=c[t],r=n.start,i=n.diff,Kinetic.Util._isArray(r))for(s=[],u=r.length,o=0;u>o;o++)a=r[o],f=i[o],s.push({x:a.x+f.x*e,y:a.y+f.y*e});else s=r+i*e;l.setAttr(t,s)}},_addListeners:function(){var e=this;this.tween.onPlay=function(){e.anim.start()},this.tween.onReverse=function(){e.anim.start()},this.tween.onPause=function(){e.anim.stop()},this.tween.onFinish=function(){e.onFinish&&e.onFinish()},this.tween.onReset=function(){e.onReset&&e.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var e=this.node;return this.tween.reset(),(e.getLayer()||e.getLayers()).draw(),this},seek:function(e){var t=this.node;return this.tween.seek(1e3*e),(t.getLayer()||t.getLayers()).draw(),this},pause:function(){return this.tween.pause(),this},finish:function(){var e=this.node;return this.tween.finish(),(e.getLayer()||e.getLayers()).draw(),this},destroy:function(){var e,t=this.node._id,n=this._id,r=Kinetic.Tween.tweens[t];this.pause();for(e in r)delete Kinetic.Tween.tweens[t][e];delete Kinetic.Tween.attrs[t][n]}};var s=function(e,t,n,r,i,s,o){this.prop=e,this.propFunc=t,this.begin=r,this._pos=r,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=o,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=i-this.begin,this.pause()};s.prototype={fire:function(e){var t=this[e];t&&t()},setTime:function(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>e?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())},getTime:function(){return this._time},setPosition:function(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e},getPosition:function(e){return void 0===e&&(e=this._time),this.func(e,this.begin,this._change,this.duration)},play:function(){this.state=n,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=r,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var e=this.getTimer()-this._startTime;this.state===n?this.setTime(e):this.state===r&&this.setTime(this.duration-e)},pause:function(){this.state=t,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(e,t,n,r){var i=1.70158;return n*(e/=r)*e*((i+1)*e-i)+t},BackEaseOut:function(e,t,n,r){var i=1.70158;return n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},BackEaseInOut:function(e,t,n,r){var i=1.70158;return(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},ElasticEaseIn:function(e,t,n,r,i,s){var o=0;return 0===e?t:1==(e/=r)?t+n:(s||(s=.3*r),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t)},ElasticEaseOut:function(e,t,n,r,i,s){var o=0;return 0===e?t:1==(e/=r)?t+n:(s||(s=.3*r),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},ElasticEaseInOut:function(e,t,n,r,i,s){var o=0;return 0===e?t:2==(e/=r/2)?t+n:(s||(s=r*.3*1.5),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),1>e?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:.5*i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},BounceEaseOut:function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:2/2.75>e?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},BounceEaseIn:function(e,t,n,r){return n-Kinetic.Easings.BounceEaseOut(r-e,0,n,r)+t},BounceEaseInOut:function(e,t,n,r){return r/2>e?.5*Kinetic.Easings.BounceEaseIn(2*e,0,n,r)+t:.5*Kinetic.Easings.BounceEaseOut(2*e-r,0,n,r)+.5*n+t},EaseIn:function(e,t,n,r){return n*(e/=r)*e+t},EaseOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},EaseInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},StrongEaseIn:function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},StrongEaseOut:function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},StrongEaseInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},Linear:function(e,t,n,r){return n*e/r+t}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(e){var t=Kinetic.DD,n=t.node;n&&(n._setDragPosition(e),t.isDragging||(t.isDragging=!0,n.fire("dragstart",e,!0)),n.fire("dragmove",e,!0))},_endDragBefore:function(e){var t,n,r=Kinetic.DD,i=r.node;i&&(t=i.nodeType,n=i.getLayer(),r.anim.stop(),r.isDragging&&(r.isDragging=!1,Kinetic.listenClickTap=!1,e&&(e.dragEndNode=i)),delete r.node,(n||i).draw())},_endDragAfter:function(e){e=e||{};var t=e.dragEndNode;e&&t&&t.fire("dragend",e,!0)}},Kinetic.Node.prototype.startDrag=function(){var e=Kinetic.DD,t=this.getStage(),n=this.getLayer(),r=t.getPointerPosition(),i=this.getAbsolutePosition();r&&(e.node&&e.node.stopDrag(),e.node=this,e.offset.x=r.x-i.x,e.offset.y=r.y-i.y,e.anim.setLayers(n||this.getLayers()),e.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(e){var t=Kinetic.DD,n=this.getStage().getPointerPosition(),r=this.getDragBoundFunc(),i={x:n.x-t.offset.x,y:n.y-t.offset.y};void 0!==r&&(i=r.call(this,i,e)),this.setAbsolutePosition(i)},Kinetic.Node.prototype.stopDrag=function(){var e=Kinetic.DD,t={};e._endDragBefore(t),e._endDragAfter(t)},Kinetic.Node.prototype.setDraggable=function(e){this._setAttr("draggable",e),this._dragChange()};var e=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var t=Kinetic.DD;t.node&&t.node._id===this._id&&this.stopDrag(),e.call(this)},Kinetic.Node.prototype.isDragging=function(){var e=Kinetic.DD;return e.node&&e.node._id===this._id&&e.isDragging},Kinetic.Node.prototype._listenDrag=function(){this._dragCleanup();var e=this;this.on("mousedown.kinetic touchstart.kinetic",function(t){Kinetic.DD.node||e.startDrag(t)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var e=this.getStage(),t=Kinetic.DD;e&&t.node&&t.node._id===this._id&&t.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable;var t=document.getElementsByTagName("html")[0];t.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),t.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),t.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),t.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(e){this.children=new Kinetic.Collection,Kinetic.Node.call(this,e)},getChildren:function(){return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var e,t=this.children;t.length>0;)e=t[0],e.hasChildren()&&e.removeChildren(),e.remove();return this},destroyChildren:function(){for(var e=this.children;e.length>0;)e[0].destroy();return this},add:function(e){var t=this.children;return this._validateAdd(e),e.index=t.length,e.parent=this,t.push(e),this._fire("add",{child:e}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},get:function(e){var t,n,r,i,s,o,u,a=[],f=e.replace(/ /g,"").split(","),l=f.length;for(t=0;l>t;t++)if(r=f[t],"#"===r.charAt(0))s=this._getNodeById(r.slice(1)),s&&a.push(s);else if("."===r.charAt(0))i=this._getNodesByName(r.slice(1)),a=a.concat(i);else for(o=this.getChildren(),u=o.length,n=0;u>n;n++)a=a.concat(o[n]._get(r));return Kinetic.Collection.toCollection(a)},_getNodeById:function(e){var t=Kinetic.ids[e];return void 0!==t&&this.isAncestorOf(t)?t:null},_getNodesByName:function(e){var t=Kinetic.names[e]||[];return this._getDescendants(t)},_get:function(e){for(var t=Kinetic.Node.prototype._get.call(this,e),n=this.getChildren(),r=n.length,i=0;r>i;i++)t=t.concat(n[i]._get(e));return t},toObject:function(){var e=Kinetic.Node.prototype.toObject.call(this);e.children=[];for(var t=this.getChildren(),n=t.length,r=0;n>r;r++){var i=t[r];e.children.push(i.toObject())}return e},_getDescendants:function(e){for(var t=[],n=e.length,r=0;n>r;r++){var i=e[r];this.isAncestorOf(i)&&t.push(i)}return t},isAncestorOf:function(e){for(var t=e.getParent();t;){if(t._id===this._id)return!0;t=t.getParent()}return!1},clone:function(e){var t=Kinetic.Node.prototype.clone.call(this,e);return this.getChildren().each(function(e){t.add(e.clone())}),t},getAllIntersections:function(){for(var e=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),t=[],n=this.get("Shape"),r=n.length,i=0;r>i;i++){var s=n[i];s.isVisible()&&s.intersects(e)&&t.push(s)}return t},_setChildrenIndices:function(){this.children.each(function(e,t){e.index=t})},drawScene:function(e){var t=this.getLayer(),n=this.getClipWidth()&&this.getClipHeight();return!e&&t&&(e=t.getCanvas()),this.isVisible()&&(n?e.getContext()._clip(this):this._drawChildren(e)),this},_drawChildren:function(e){this.children.each(function(t){t.drawScene(e)})},drawHit:function(){var e,t=this.getClipWidth()&&this.getClipHeight()&&"Stage"!==this.nodeType,n=0,r=0,i=[];if(this.shouldDrawHit()){for(t&&(e=this.getLayer().hitCanvas,e.getContext()._clip(this)),i=this.children,r=i.length,n=0;r>n;n++)i[n].drawHit();t&&e.getContext()._context.restore()}return this}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Factory.addBoxGetterSetter(Kinetic.Container,"clip")}(),function(){function e(e){e.fill()}function t(e){e.stroke()}function n(e){e.fill()}function r(e){e.stroke()}function i(){this._clearCache(s)}var s="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(s){this.nodeType="Shape",this._fillFunc=e,this._strokeFunc=t,this._fillFuncHit=n,this._strokeFuncHit=r;for(var o,u=Kinetic.shapes;;)if(o=Kinetic.Util.getRandomColor(),o&&!(o in u))break;this.colorKey=o,u[o]=this,Kinetic.Node.call(this,s),this._setDrawFuncs(),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic",i)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(s,this._hasShadow)},_hasShadow:function(){return 0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},_get:function(e){return this.className===e||this.nodeType===e?[this]:[]},intersects:function(){var e=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),t=this.getStage(),n=t.hitCanvas;n.getContext().clear(),this.drawScene(n);var r=n.context.getImageData(0|e.x,0|e.y,1,1).data;return r[3]>0},enableFill:function(){return this._setAttr("fillEnabled",!0),this},disableFill:function(){return this._setAttr("fillEnabled",!1),this},enableStroke:function(){return this._setAttr("strokeEnabled",!0),this},disableStroke:function(){return this._setAttr("strokeEnabled",!1),this},enableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!0),this},disableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!1),this},enableShadow:function(){return this._setAttr("shadowEnabled",!0),this},disableShadow:function(){return this._setAttr("shadowEnabled",!1),this},enableDashArray:function(){return this._setAttr("dashArrayEnabled",!0),this},disableDashArray:function(){return this._setAttr("dashArrayEnabled",!1),this},destroy:function(){return Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey],this},drawScene:function(e){e=e||this.getLayer().getCanvas();var t=this.getDrawFunc(),n=e.getContext();return t&&this.isVisible()&&(n.save(),n._applyOpacity(this),n._applyLineJoin(this),n._applyAncestorTransforms(this),t.call(this,n),n.restore()),this},drawHit:function(){var e=this.getAttrs(),t=e.drawHitFunc||e.drawFunc,n=this.getLayer().hitCanvas,r=n.getContext();return t&&this.shouldDrawHit()&&(r.save(),r._applyLineJoin(this),r._applyAncestorTransforms(this),t.call(this,r),r.restore()),this},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawHitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArray"),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArrayEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternOffset",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternScale",1),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"shadowOffset",0),Kinetic.Factory.addRotationGetterSetter(Kinetic.Shape,"fillPatternRotation",0)}(),function(){function e(e,t){e.content.addEventListener(t,function(n){e[x+t](n)},!1)}var t="Stage",n="string",r="px",i="mouseout",s="mouseleave",o="mouseover",u="mouseenter",a="mousemove",f="mousedown",l="mouseup",c="click",h="dblclick",p="touchstart",d="touchend",v="tap",m="dbltap",g="touchmove",y="div",b="relative",w="inline-block",E="kineticjs-content",S=" ",x="_",T="container",N="",C=[f,a,l,i,p,g,d,o],k=C.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(e){Kinetic.Container.call(this,e),this.nodeType=t,this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.stages.push(this)},_validateAdd:function(e){"Layer"!==e.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(e){return typeof e===n&&(e=document.getElementById(e)),this._setAttr(T,e),this},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(e){return Kinetic.Node.prototype.setHeight.call(this,e),this._resizeDOM(),this},setWidth:function(e){return Kinetic.Node.prototype.setWidth.call(this,e),this._resizeDOM(),this},clear:function(){var e,t=this.children,n=t.length;for(e=0;n>e;e++)t[e].clear();return this},destroy:function(){var e=this.content;Kinetic.Container.prototype.destroy.call(this),e&&Kinetic.Util._isInDocument(e)&&this.getContainer().removeChild(e)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getPointerPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(e){function t(i){var s=a[i],f=s.toDataURL(),l=new Image;l.onload=function(){u.drawImage(l,0,0),i<a.length-1?t(i+1):e.callback(o.toDataURL(n,r))},l.src=f}e=e||{};var n=e.mimeType||null,r=e.quality||null,i=e.x||0,s=e.y||0,o=new Kinetic.SceneCanvas({width:e.width||this.getWidth(),height:e.height||this.getHeight(),pixelRatio:1}),u=o.getContext()._context,a=this.children;(i||s)&&u.translate(-1*i,-1*s),t(0)},toImage:function(e){var t=e.callback;e.callback=function(e){Kinetic.Util._getImage(e,function(e){t(e)})},this.toDataURL(e)},getIntersection:function(){var e,t,n=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),r=this.getChildren(),i=r.length,s=i-1;for(e=s;e>=0;e--)if(t=r[e].getIntersection(n))return t;return null},_resizeDOM:function(){if(this.content){var e,t,n=this.getWidth(),i=this.getHeight(),s=this.getChildren(),o=s.length;for(this.content.style.width=n+r,this.content.style.height=i+r,this.bufferCanvas.setSize(n,i,1),this.hitCanvas.setSize(n,i),e=0;o>e;e++)t=s[e],t.getCanvas().setSize(n,i),t.hitCanvas.setSize(n,i),t.draw()}},add:function(e){return Kinetic.Container.prototype.add.call(this,e),e.canvas.setSize(this.attrs.width,this.attrs.height),e.hitCanvas.setSize(this.attrs.width,this.attrs.height),e.draw(),this.content.appendChild(e.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_setPointerPosition:function(e){e||(e=window.event),this._setMousePosition(e),this._setTouchPosition(e)},_bindContentEvents:function(){var t;for(t=0;k>t;t++)e(this,C[t])},_mouseover:function(e){this._fire(o,e)},_mouseout:function(e){this._setPointerPosition(e);var t=this.targetShape;t&&!Kinetic.isDragging()&&(t._fireAndBubble(i,e),t._fireAndBubble(s,e),this.targetShape=null),this.mousePos=void 0,this._fire(i,e)},_mousemove:function(e){this._setPointerPosition(e);var t,n=Kinetic.DD,r=this.getIntersection(this.getPointerPosition());r?(t=r.shape,t&&(Kinetic.isDragging()||255!==r.pixel[3]||this.targetShape&&this.targetShape._id===t._id?t._fireAndBubble(a,e):(this.targetShape&&(this.targetShape._fireAndBubble(i,e,t),this.targetShape._fireAndBubble(s,e,t)),t._fireAndBubble(o,e,this.targetShape),t._fireAndBubble(u,e,this.targetShape),this.targetShape=t))):(this._fire(a,e),this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(i,e),this.targetShape._fireAndBubble(s,e),this.targetShape=null)),n&&n._drag(e),e.preventDefault&&e.preventDefault()},_mousedown:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=t&&t.shape?t.shape:this;Kinetic.listenClickTap=!0,this.clickStartShape=n,n._fireAndBubble(f,e),e.preventDefault&&e.preventDefault()},_mouseup:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=t&&t.shape?t.shape:this;n._fireAndBubble(l,e),Kinetic.listenClickTap&&n._id===this.clickStartShape._id&&(n._fireAndBubble(c,e),Kinetic.inDblClickWindow?(n._fireAndBubble(h,e),Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow)),Kinetic.listenClickTap=!1,e.preventDefault&&e.preventDefault()},_touchstart:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=t&&t.shape?t.shape:this;Kinetic.listenClickTap=!0,this.tapStartShape=n,n._fireAndBubble(p,e),n.isListening()&&e.preventDefault&&e.preventDefault()},_touchend:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=t&&t.shape?t.shape:this;n._fireAndBubble(d,e),Kinetic.listenClickTap&&n._id===this.tapStartShape._id&&(n._fireAndBubble(v,e),Kinetic.inDblClickWindow?(n._fireAndBubble(m,e),Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow)),Kinetic.listenClickTap=!1,n.isListening()&&e.preventDefault&&e.preventDefault()},_touchmove:function(e){this._setPointerPosition(e);var t=Kinetic.DD,n=this.getIntersection(this.getPointerPosition()),r=n&&n.shape?n.shape:this;r._fireAndBubble(g,e),t&&t._drag(e),r.isListening()&&e.preventDefault&&e.preventDefault()},_setMousePosition:function(e){var t=void 0!==e.offsetX?e.offsetX:e.layerX||e.clientX-this._getContentPosition().left,n=void 0!==e.offsetY?e.offsetY:e.layerY||e.clientY-this._getContentPosition().top;this.mousePos={x:t,y:n}},_setTouchPosition:function(e){var t,n,r;void 0!==e.touches&&1===e.touches.length&&(t=e.touches[0],n=t.clientX-this._getContentPosition().left,r=t.clientY-this._getContentPosition().top,this.touchPos={x:n,y:r})},_getContentPosition:function(){var e=this.content.getBoundingClientRect();return{top:e.top,left:e.left}},_buildDOM:function(){var e=this.getContainer();e.innerHTML=N,this.content=document.createElement(y),this.content.style.position=b,this.content.style.display=w,this.content.className=E,e.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(e,t){var n,r,i=e.split(S),s=i.length;for(n=0;s>n;n++)r=i[n],this.content.addEventListener(r,t,!1)}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container")}(),function(){var e="#",t="beforeDraw",n="draw";Kinetic.Util.addMethods(Kinetic.Layer,{___init:function(e){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.Container.call(this,e)},_validateAdd:function(e){var t=e.getType();"Group"!==t&&"Shape"!==t&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(){var t,n,r,i=Kinetic.Util._getXY(Array.prototype.slice.call(arguments));if(this.isVisible()&&this.isListening()){if(t=this.hitCanvas.context._context.getImageData(0|i.x,0|i.y,1,1).data,255===t[3])return n=Kinetic.Util._rgbToHex(t[0],t[1],t[2]),r=Kinetic.shapes[e+n],{shape:r,pixel:t};if(t[0]>0||t[1]>0||t[2]>0||t[3]>0)return{pixel:t}}return null},drawScene:function(e){return e=e||this.getCanvas(),this._fire(t,{node:this}),this.getClearBeforeDraw()&&e.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,e),this._fire(n,{node:this}),this},drawHit:function(){var e=this.getLayer();return e&&e.getClearBeforeDraw()&&e.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this),this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(e){return this.getCanvas().clear(e),this},setVisible:function(e){return Kinetic.Node.prototype.setVisible.call(this,e),e?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},setZIndex:function(e){Kinetic.Node.prototype.setZIndex.call(this,e);var t=this.getStage();return t&&(t.content.removeChild(this.getCanvas()._canvas),e<t.getChildren().length-1?t.content.insertBefore(this.getCanvas()._canvas,t.getChildren()[e+1].getCanvas()._canvas):t.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var e=this.getStage();e&&(e.content.removeChild(this.getCanvas()._canvas),e.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var e=this.getStage();e&&(e.content.removeChild(this.getCanvas()._canvas),this.index<e.getChildren().length-1?e.content.insertBefore(this.getCanvas()._canvas,e.getChildren()[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas),e.content.insertBefore(this.getCanvas()._canvas,t[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas),e.content.insertBefore(this.getCanvas()._canvas,t[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var e=this.getStage(),t=this.getCanvas(),n=t._canvas;return Kinetic.Node.prototype.remove.call(this),e&&n&&Kinetic.Util._isInDocument(n)&&e.content.removeChild(n),this},getStage:function(){return this.parent}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(e){this.nodeType="Group",Kinetic.Container.call(this,e)},_validateAdd:function(e){var t=e.getType();"Group"!==t&&"Shape"!==t&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container)}(),function(){Kinetic.Rect=function(e){this.___init(e)},Kinetic.Rect.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Rect"},drawFunc:function(e){var t=this.getCornerRadius(),n=this.getWidth(),r=this.getHeight();e.beginPath(),t?(e.moveTo(t,0),e.lineTo(n-t,0),e.arc(n-t,t,t,3*Math.PI/2,0,!1),e.lineTo(n,r-t),e.arc(n-t,r-t,t,0,Math.PI/2,!1),e.lineTo(t,r),e.arc(t,r-t,t,Math.PI/2,Math.PI,!1),e.lineTo(0,t),e.arc(t,t,t,Math.PI,3*Math.PI/2,!1)):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0)}(),function(){var e=2*Math.PI-1e-4,t="Circle";Kinetic.Circle=function(e){this.___init(e)},Kinetic.Circle.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t},drawFunc:function(t){t.beginPath(),t.arc(0,0,this.getRadius(),0,e,!1),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius(e/2)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0)}(),function(){var e=2*Math.PI-1e-4,t="Ellipse";Kinetic.Ellipse=function(e){this.___init(e)},Kinetic.Ellipse.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t},drawFunc:function(t){var n=this.getRadius();t.beginPath(),t.save(),n.x!==n.y&&t.scale(1,n.y/n.x),t.arc(0,0,n.x,0,e,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius({x:e/2})},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius({y:e/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addPointGetterSetter(Kinetic.Ellipse,"radius",0)}(),function(){Kinetic.Wedge=function(e){this.___init(e)},Kinetic.Wedge.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Wedge"},drawFunc:function(e){e.beginPath(),e.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addRotationGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1)}(),function(){var e="Image",t="set";Kinetic.Image=function(e){this.___init(e)},Kinetic.Image.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className=e},drawFunc:function(e){var t,n,r=this.getWidth(),i=this.getHeight(),s=this.getCropX()||0,o=this.getCropY()||0,u=this.getCropWidth(),a=this.getCropHeight();this.getFilter()&&this._applyFilter&&(this.applyFilter(),this._applyFilter=!1),n=this.filterCanvas?this.filterCanvas._canvas:this.getImage(),e.beginPath(),e.rect(0,0,r,i),e.closePath(),e.fillStrokeShape(this),n&&(t=u&&a?[n,s,o,u,a,0,0,r,i]:[n,0,0,r,i],this.hasShadow()?e.applyShadow(this,function(){e.drawImage.apply(e,t)}):e.drawImage.apply(e,t))},drawHitFunc:function(e){var t=this.getWidth(),n=this.getHeight(),r=this.imageHitRegion;r?(e.drawImage(r,0,0,t,n),e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.strokeShape(this)):(e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this))},applyFilter:function(){var e,t,n,r=this.getImage(),i=this.getWidth(),s=this.getHeight(),o=this.getFilter();this.filterCanvas?(e=this.filterCanvas,e.getContext().clear()):e=this.filterCanvas=new Kinetic.SceneCanvas({width:i,height:s,pixelRatio:1}),t=e.getContext();try{t.drawImage(r,0,0,e.getWidth(),e.getHeight()),n=t.getImageData(0,0,e.getWidth(),e.getHeight()),o.call(this,n),t.putImageData(n,0,0)}catch(u){this.clearFilter(),Kinetic.Util.warn("Unable to apply filter. "+u.message)}},clearFilter:function(){this.filterCanvas=null,this._applyFilter=!1},createImageHitRegion:function(e){var t,n,r,i,s,o=this,u=this.getWidth(),a=this.getHeight(),f=new Kinetic.SceneCanvas({width:u,height:a}),l=f.getContext()._context,c=this.getImage();l.drawImage(c,0,0);try{for(t=l.getImageData(0,0,u,a),n=t.data,s=n.length,r=Kinetic.Util._hexToRgb(this.colorKey),i=0;s>i;i+=4)n[i+3]>0&&(n[i]=r.r,n[i+1]=r.g,n[i+2]=r.b);Kinetic.Util._getImage(t,function(t){o.imageHitRegion=t,e&&e()})}catch(h){Kinetic.Util.warn("Unable to create image hit region. "+h.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},getWidth:function(){var e=this.getImage();return this.attrs.width||(e?e.width:0)},getHeight:function(){var e=this.getImage();return this.attrs.height||(e?e.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addFilterGetterSetter=function(e,t,n){this.addGetter(e,t,n),this.addFilterSetter(e,t)},Kinetic.Factory.addFilterSetter=function(e,n){var r=t+Kinetic.Util._capitalize(n);e.prototype[r]=function(e){this._setAttr(n,e),this._applyFilter=!0}},Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addBoxGetterSetter(Kinetic.Image,"crop"),Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filter")}(),function(){Kinetic.Polygon=function(e){this.___init(e)},Kinetic.Polygon.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Polygon"},drawFunc:function(e){var t=this.getPoints(),n=t.length;e.beginPath(),e.moveTo(t[0].x,t[0].y);for(var r=1;n>r;r++)e.lineTo(t[r].x,t[r].y);e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Polygon,Kinetic.Shape),Kinetic.Factory.addPointsGetterSetter(Kinetic.Polygon,"points")}(),function(){function e(e){e.fillText(this.partialText,0,0)}function t(e){e.strokeText(this.partialText,0,0)}var n="auto",r="Calibri",i="canvas",s="center",o="Change.kinetic",u="2d",a="-",f="",l="left",c="text",h="Text",p="middle",d="normal",v="px ",m=" ",g="right",y="word",b="char",w="none",E=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],S=E.length,x=document.createElement(i).getContext(u);Kinetic.Text=function(e){this.___init(e)},Kinetic.Text.prototype={___init:function(r){var i=this;void 0===r.width&&(r.width=n),void 0===r.height&&(r.height=n),Kinetic.Shape.call(this,r),this._fillFunc=e,this._strokeFunc=t,this.className=h;for(var s=0;S>s;s++)this.on(E[s]+o,i._setTextData);this._setTextData()},drawFunc:function(e){var t=this.getPadding(),n=(this.getFontStyle(),this.getFontSize(),this.getFontFamily(),this.getTextHeight()),r=this.getLineHeight()*n,i=this.textArr,o=i.length,u=this.getWidth();e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",p),e.setAttr("textAlign",l),e.save(),e.translate(t,0),e.translate(0,t+n/2);for(var a=0;o>a;a++){var f=i[a],c=f.text,h=f.width;e.save(),this.getAlign()===g?e.translate(u-h-2*t,0):this.getAlign()===s&&e.translate((u-h-2*t)/2,0),this.partialText=c,e.fillStrokeShape(this),e.restore(),e.translate(0,r)}e.restore()},drawHitFunc:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)},setText:function(e){var t=Kinetic.Util._isString(e)?e:e.toString();this._setAttr(c,t)},getWidth:function(){return this.attrs.width===n?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===n?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(e){var t,n=x,r=this.getFontSize();return n.save(),n.font=this._getContextFont(),t=n.measureText(e),n.restore(),{width:t.width,height:parseInt(r,10)}},_getContextFont:function(){return this.getFontStyle()+m+this.getFontSize()+v+this.getFontFamily()},_addTextLine:function(e,t){return this.textArr.push({text:e,width:t})},_getTextWidth:function(e){return x.measureText(e).width},_setTextData:function(){var e=this.getText().split("\n"),t=+this.getFontSize(),r=0,i=this.getLineHeight()*t,s=this.attrs.width,o=this.attrs.height,u=s!==n,f=o!==n,l=this.getPadding(),c=s-2*l,h=o-2*l,p=0,d=this.getWrap(),g=d!==w,y=d!==b&&g;this.textArr=[],x.save(),x.font=this.getFontStyle()+m+t+v+this.getFontFamily();for(var E=0,S=e.length;S>E;++E){var T=e[E],N=this._getTextWidth(T);if(u&&N>c)for(;T.length>0;){for(var C=0,k=T.length,L="",A=0;k>C;){var O=C+k>>>1,M=T.slice(0,O+1),_=this._getTextWidth(M);c>=_?(C=O+1,L=M,A=_):k=O}if(!L)break;if(y){var D=Math.max(L.lastIndexOf(m),L.lastIndexOf(a))+1;D>0&&(C=D,L=L.slice(0,C),A=this._getTextWidth(L))}if(this._addTextLine(L,A),p+=i,!g||f&&p+i>h)break;if(T=T.slice(C),T.length>0&&(N=this._getTextWidth(T),c>=N)){this._addTextLine(T,N),p+=i;break}}else this._addTextLine(T,N),p+=i,r=Math.max(r,N);if(f&&p+i>h)break}x.restore(),this.textHeight=t,this.textWidth=r}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily",r),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",d),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",l),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",y),Kinetic.Factory.addGetter(Kinetic.Text,c,f),Kinetic.Factory.addSetter(Kinetic.Text,"width"),Kinetic.Factory.addSetter(Kinetic.Text,"height")}(),function(){Kinetic.Line=function(e){this.___init(e)},Kinetic.Line.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Line"},drawFunc:function(e){var t,n,r=this.getPoints(),i=r.length;for(e.beginPath(),e.moveTo(r[0].x,r[0].y),t=1;i>t;t++)n=r[t],e.lineTo(n.x,n.y);e.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addPointsGetterSetter(Kinetic.Line,"points")}(),function(){Kinetic.Spline=function(e){this.___init(e)},Kinetic.Spline.prototype={___init:function(e){var t=this;Kinetic.Shape.call(this,e),this.className="Spline",this.on("pointsChange.kinetic tensionChange.kinetic",function(){t._setAllPoints()}),this._setAllPoints()},drawFunc:function(e){var t,n,r,i,s=this.getPoints(),o=s.length,u=this.getTension();if(e.beginPath(),e.moveTo(s[0].x,s[0].y),0!==u&&o>2){for(t=this.allPoints,n=t.length,r=2,e.quadraticCurveTo(t[0].x,t[0].y,t[1].x,t[1].y);n-1>r;)e.bezierCurveTo(t[r].x,t[r++].y,t[r].x,t[r++].y,t[r].x,t[r++].y);e.quadraticCurveTo(t[n-1].x,t[n-1].y,s[o-1].x,s[o-1].y)}else for(r=1;o>r;r++)i=s[r],e.lineTo(i.x,i.y);e.strokeShape(this)},_setAllPoints:function(){this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension())}},Kinetic.Util.extend(Kinetic.Spline,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Spline,"tension",1),Kinetic.Factory.addPointsGetterSetter(Kinetic.Spline,"points")}(),function(){Kinetic.Blob=function(e){this.___init(e)},Kinetic.Blob.prototype={___init:function(e){var t=this;Kinetic.Shape.call(this,e),this.className="Blob",this.on("pointsChange.kinetic tensionChange.kinetic",function(){t._setAllPoints()}),this._setAllPoints()},drawFunc:function(e){var t,n,r,i,s=this.getPoints(),o=s.length,u=this.getTension();if(e.beginPath(),e.moveTo(s[0].x,s[0].y),0!==u&&o>2)for(t=this.allPoints,n=t.length,r=0;n-1>r;)e.bezierCurveTo(t[r].x,t[r++].y,t[r].x,t[r++].y,t[r].x,t[r++].y);else for(r=1;o>r;r++)i=s[r],e.lineTo(i.x,i.y);e.closePath(),e.fillStrokeShape(this)},_setAllPoints:function(){var e=this.getPoints(),t=e.length,n=this.getTension(),r=Kinetic.Util,i=r._getControlPoints(e[t-1],e[0],e[1],n),s=r._getControlPoints(e[t-2],e[t-1],e[0],n);this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension()),this.allPoints.unshift(i[1]),this.allPoints.push(s[0]),this.allPoints.push(e[t-1]),this.allPoints.push(s[1]),this.allPoints.push(i[0]),this.allPoints.push(e[0])}},Kinetic.Util.extend(Kinetic.Blob,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Blob,"tension",1),Kinetic.Factory.addPointsGetterSetter(Kinetic.Blob,"points")}(),function(){Kinetic.Sprite=function(e){this.___init(e)},Kinetic.Sprite.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Sprite",this.anim=new Kinetic.Animation;var t=this;this.on("animationChange.kinetic",function(){t.setIndex(0)})},drawFunc:function(e){var t=this.getAnimation(),n=this.getIndex(),r=this.getAnimations()[t][n],i=this.getImage();i&&e.drawImage(i,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},drawHitFunc:function(e){var t=this.getAnimation(),n=this.getIndex(),r=this.getAnimations()[t][n];e.beginPath(),e.rect(0,0,r.width,r.height),e.closePath(),e.fill(this)},start:function(){var e=this,t=this.getLayer();this.anim.setLayers(t),this.interval=setInterval(function(){var t=e.getIndex();e._updateIndex(),e.afterFrameFunc&&t===e.afterFrameIndex&&(e.afterFrameFunc(),delete e.afterFrameFunc,delete e.afterFrameIndex)},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(e,t){this.afterFrameIndex=e,this.afterFrameFunc=t},_updateIndex:function(){var e=this.getIndex(),t=this.getAnimation(),n=this.getAnimations(),r=n[t],i=r.length;i-1>e?this.setIndex(e+1):this.setIndex(0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"index",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17)}(),function(){Kinetic.Path=function(e){this.___init(e)},Kinetic.Path.prototype={___init:function(e){this.dataArray=[];var t=this;Kinetic.Shape.call(this,e),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){t.dataArray=Kinetic.Path.parsePathData(this.getData())})},drawFunc:function(e){var t=this.dataArray,n=!1;e.beginPath();for(var r=0;r<t.length;r++){var i=t[r].command,s=t[r].points;switch(i){case"L":e.lineTo(s[0],s[1]);break;case"M":e.moveTo(s[0],s[1]);break;case"C":e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var o=s[0],u=s[1],a=s[2],f=s[3],l=s[4],c=s[5],h=s[6],p=s[7],d=a>f?a:f,v=a>f?1:a/f,m=a>f?f/a:1;e.translate(o,u),e.rotate(h),e.scale(v,m),e.arc(0,0,d,l,l+c,1-p),e.scale(1/v,1/m),e.rotate(-h),e.translate(-o,-u);break;case"z":e.closePath(),n=!0}}n?e.fillStrokeShape(this):e.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))},Kinetic.Path.getPointOnLine=function(e,t,n,r,i,s,o){void 0===s&&(s=t),void 0===o&&(o=n);var u=(i-n)/(r-t+1e-8),a=Math.sqrt(e*e/(1+u*u));t>r&&(a*=-1);var f,l=u*a;if(r===t)f={x:s,y:o+l};else if((o-n)/(s-t+1e-8)===u)f={x:s+a,y:o+l};else{var c,h,p=this.getLineLength(t,n,r,i);if(1e-8>p)return void 0;var d=(s-t)*(r-t)+(o-n)*(i-n);d/=p*p,c=t+d*(r-t),h=n+d*(i-n);var v=this.getLineLength(s,o,c,h),m=Math.sqrt(e*e-v*v);a=Math.sqrt(m*m/(1+u*u)),t>r&&(a*=-1),l=u*a,f={x:c+a,y:h+l}}return f},Kinetic.Path.getPointOnCubicBezier=function(e,t,n,r,i,s,o,u,a){function f(e){return e*e*e}function l(e){return 3*e*e*(1-e)}function c(e){return 3*e*(1-e)*(1-e)}function h(e){return(1-e)*(1-e)*(1-e)}var p=u*f(e)+s*l(e)+r*c(e)+t*h(e),d=a*f(e)+o*l(e)+i*c(e)+n*h(e);return{x:p,y:d}},Kinetic.Path.getPointOnQuadraticBezier=function(e,t,n,r,i,s,o){function u(e){return e*e}function a(e){return 2*e*(1-e)}function f(e){return(1-e)*(1-e)}var l=s*u(e)+r*a(e)+t*f(e),c=o*u(e)+i*a(e)+n*f(e);return{x:l,y:c}},Kinetic.Path.getPointOnEllipticalArc=function(e,t,n,r,i,s){var o=Math.cos(s),u=Math.sin(s),a={x:n*Math.cos(i),y:r*Math.sin(i)};return{x:e+(a.x*o-a.y*u),y:t+(a.x*u+a.y*o)}},Kinetic.Path.parsePathData=function(e){if(!e)return[];var t=e,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(var r=0;r<n.length;r++)t=t.replace(new RegExp(n[r],"g"),"|"+n[r]);var i=t.split("|"),s=[],o=0,u=0;for(r=1;r<i.length;r++){var a=i[r],f=a.charAt(0);a=a.slice(1),a=a.replace(new RegExp(",-","g"),"-"),a=a.replace(new RegExp("-","g"),",-"),a=a.replace(new RegExp("e,-","g"),"e-");var l=a.split(",");l.length>0&&""===l[0]&&l.shift();for(var c=0;c<l.length;c++)l[c]=parseFloat(l[c]);for(;l.length>0&&!isNaN(l[0]);){var h,p,d,v,m,g,y,b,w,E,S=null,x=[],T=o,N=u;switch(f){case"l":o+=l.shift(),u+=l.shift(),S="L",x.push(o,u);break;case"L":o=l.shift(),u=l.shift(),x.push(o,u);break;case"m":o+=l.shift(),u+=l.shift(),S="M",x.push(o,u),f="l";break;case"M":o=l.shift(),u=l.shift(),S="M",x.push(o,u),f="L";break;case"h":o+=l.shift(),S="L",x.push(o,u);break;case"H":o=l.shift(),S="L",x.push(o,u);break;case"v":u+=l.shift(),S="L",x.push(o,u);break;case"V":u=l.shift(),S="L",x.push(o,u);break;case"C":x.push(l.shift(),l.shift(),l.shift(),l.shift()),o=l.shift(),u=l.shift(),x.push(o,u);break;case"c":x.push(o+l.shift(),u+l.shift(),o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),S="C",x.push(o,u);break;case"S":p=o,d=u,h=s[s.length-1],"C"===h.command&&(p=o+(o-h.points[2]),d=u+(u-h.points[3])),x.push(p,d,l.shift(),l.shift()),o=l.shift(),u=l.shift(),S="C",x.push(o,u);break;case"s":p=o,d=u,h=s[s.length-1],"C"===h.command&&(p=o+(o-h.points[2]),d=u+(u-h.points[3])),x.push(p,d,o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),S="C",x.push(o,u);break;case"Q":x.push(l.shift(),l.shift()),o=l.shift(),u=l.shift(),x.push(o,u);break;case"q":x.push(o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),S="Q",x.push(o,u);break;case"T":p=o,d=u,h=s[s.length-1],"Q"===h.command&&(p=o+(o-h.points[0]),d=u+(u-h.points[1])),o=l.shift(),u=l.shift(),S="Q",x.push(p,d,o,u);break;case"t":p=o,d=u,h=s[s.length-1],"Q"===h.command&&(p=o+(o-h.points[0]),d=u+(u-h.points[1])),o+=l.shift(),u+=l.shift(),S="Q",x.push(p,d,o,u);break;case"A":v=l.shift(),m=l.shift(),g=l.shift(),y=l.shift(),b=l.shift(),w=o,E=u,o=l.shift(),u=l.shift(),S="A",x=this.convertEndpointToCenterParameterization(w,E,o,u,y,b,v,m,g);break;case"a":v=l.shift(),m=l.shift(),g=l.shift(),y=l.shift(),b=l.shift(),w=o,E=u,o+=l.shift(),u+=l.shift(),S="A",x=this.convertEndpointToCenterParameterization(w,E,o,u,y,b,v,m,g)}s.push({command:S||f,points:x,start:{x:T,y:N},pathLength:this.calcLength(T,N,S||f,x)})}("z"===f||"Z"===f)&&s.push({command:"z",points:[],start:void 0,pathLength:0})}return s},Kinetic.Path.calcLength=function(e,n,r,i){var s,o,u,a=Kinetic.Path;switch(r){case"L":return a.getLineLength(e,n,i[0],i[1]);case"C":for(s=0,o=a.getPointOnCubicBezier(0,e,n,i[0],i[1],i[2],i[3],i[4],i[5]),t=.01;1>=t;t+=.01)u=a.getPointOnCubicBezier(t,e,n,i[0],i[1],i[2],i[3],i[4],i[5]),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;return s;case"Q":for(s=0,o=a.getPointOnQuadraticBezier(0,e,n,i[0],i[1],i[2],i[3]),t=.01;1>=t;t+=.01)u=a.getPointOnQuadraticBezier(t,e,n,i[0],i[1],i[2],i[3]),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;return s;case"A":s=0;var f=i[4],l=i[5],c=i[4]+l,h=Math.PI/180;if(Math.abs(f-c)<h&&(h=Math.abs(f-c)),o=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],f,0),0>l)for(t=f-h;t>c;t-=h)u=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],t,0),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;else for(t=f+h;c>t;t+=h)u=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],t,0),s+=a.getLineLength(o.x,o.y,u.x,u.y),o=u;return u=a.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],c,0),s+=a.getLineLength(o.x,o.y,u.x,u.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(e,t,n,r,i,s,o,u,a){var f=a*(Math.PI/180),l=Math.cos(f)*(e-n)/2+Math.sin(f)*(t-r)/2,c=-1*Math.sin(f)*(e-n)/2+Math.cos(f)*(t-r)/2,h=l*l/(o*o)+c*c/(u*u);h>1&&(o*=Math.sqrt(h),u*=Math.sqrt(h));var p=Math.sqrt((o*o*u*u-o*o*c*c-u*u*l*l)/(o*o*c*c+u*u*l*l));i==s&&(p*=-1),isNaN(p)&&(p=0);var d=p*o*c/u,v=p*-u*l/o,m=(e+n)/2+Math.cos(f)*d-Math.sin(f)*v,g=(t+r)/2+Math.sin(f)*d+Math.cos(f)*v,y=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},b=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(y(e)*y(t))},w=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(b(e,t))},E=w([1,0],[(l-d)/o,(c-v)/u]),S=[(l-d)/o,(c-v)/u],x=[(-1*l-d)/o,(-1*c-v)/u],T=w(S,x);return b(S,x)<=-1&&(T=Math.PI),b(S,x)>=1&&(T=0),0===s&&T>0&&(T-=2*Math.PI),1==s&&0>T&&(T+=2*Math.PI),[m,g,o,u,E,T,f,s]},Kinetic.Factory.addGetterSetter(Kinetic.Path,"data")}(),function(){function e(e){e.fillText(this.partialText,0,0)}function t(e){e.strokeText(this.partialText,0,0)}var n="",r="Calibri",i="normal";Kinetic.TextPath=function(e){this.___init(e)},Kinetic.TextPath.prototype={___init:function(n){var r=this;this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],Kinetic.Shape.call(this,n),this._fillFunc=e,this._strokeFunc=t,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){r.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",r._setTextData),r._setTextData()},drawFunc:function(e){this.charArr,e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline","middle"),e.setAttr("textAlign","left"),e.save();for(var t=this.glyphInfo,n=0;n<t.length;n++){e.save();var r=t[n].p0;t[n].p1,parseFloat(this.attrs.fontSize),e.translate(r.x,r.y),e.rotate(t[n].rotation),this.partialText=t[n].text,e.fillStrokeShape(this),e.restore()}},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(e){Kinetic.Text.prototype.setText.call(this,e)},_getTextSize:function(e){var t=this.dummyCanvas,n=t.getContext("2d");n.save(),n.font=this._getContextFont();var r=n.measureText(e);return n.restore(),{width:r.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var e=this,t=this._getTextSize(this.attrs.text);this.textWidth=t.width,this.textHeight=t.height,this.glyphInfo=[];for(var n,r,i,s=this.attrs.text.split(""),o=-1,u=0,a=function(){u=0;for(var t=e.dataArray,r=o+1;r<t.length;r++){if(t[r].pathLength>0)return o=r,t[r];"M"==t[r].command&&(n={x:t[r].points[0],y:t[r].points[1]})}return{}},f=function(t){var s=e._getTextSize(t).width,o=0,f=0;for(r=void 0;Math.abs(s-o)/s>.01&&25>f;){f++;for(var l=o;void 0===i;)i=a(),i&&l+i.pathLength<s&&(l+=i.pathLength,i=void 0);if(i==={}||void 0===n)return void 0;var c=!1;switch(i.command){case"L":Kinetic.Path.getLineLength(n.x,n.y,i.points[0],i.points[1])>s?r=Kinetic.Path.getPointOnLine(s,n.x,n.y,i.points[0],i.points[1],n.x,n.y):i=void 0;break;case"A":var h=i.points[4],p=i.points[5],d=i.points[4]+p;0===u?u=h+1e-8:s>o?u+=Math.PI/180*p/Math.abs(p):u-=Math.PI/360*p/Math.abs(p),(0>p&&d>u||p>=0&&u>d)&&(u=d,c=!0),r=Kinetic.Path.getPointOnEllipticalArc(i.points[0],i.points[1],i.points[2],i.points[3],u,i.points[6]);break;case"C":0===u?u=s>i.pathLength?1e-8:s/i.pathLength:s>o?u+=(s-o)/i.pathLength:u-=(o-s)/i.pathLength,u>1&&(u=1,c=!0),r=Kinetic.Path.getPointOnCubicBezier(u,i.start.x,i.start.y,i.points[0],i.points[1],i.points[2],i.points[3],i.points[4],i.points[5]);break;case"Q":0===u?u=s/i.pathLength:s>o?u+=(s-o)/i.pathLength:u-=(o-s)/i.pathLength,u>1&&(u=1,c=!0),r=Kinetic.Path.getPointOnQuadraticBezier(u,i.start.x,i.start.y,i.points[0],i.points[1],i.points[2],i.points[3])}void 0!==r&&(o=Kinetic.Path.getLineLength(n.x,n.y,r.x,r.y)),c&&(c=!1,i=void 0)}},l=0;l<s.length&&(f(s[l]),void 0!==n&&void 0!==r);l++){var c=Kinetic.Path.getLineLength(n.x,n.y,r.x,r.y),h=0,p=Kinetic.Path.getPointOnLine(h+c/2,n.x,n.y,r.x,r.y),d=Math.atan2(r.y-n.y,r.x-n.x);this.glyphInfo.push({transposeX:p.x,transposeY:p.y,text:s[l],rotation:d,p0:n,p1:r}),n=r}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily",r),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",i),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",n)}(),function(){Kinetic.RegularPolygon=function(e){this.___init(e)},Kinetic.RegularPolygon.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="RegularPolygon"},drawFunc:function(e){var t,n,r,i=this.attrs.sides,s=this.attrs.radius;for(e.beginPath(),e.moveTo(0,0-s),t=1;i>t;t++)n=s*Math.sin(2*t*Math.PI/i),r=-1*s*Math.cos(2*t*Math.PI/i),e.lineTo(n,r);e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0)}(),function(){Kinetic.Star=function(e){this.___init(e)},Kinetic.Star.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Star"},drawFunc:function(e){var t=e._context,n=this.attrs.innerRadius,r=this.attrs.outerRadius,i=this.attrs.numPoints;t.beginPath(),t.moveTo(0,0-this.attrs.outerRadius);for(var s=1;2*i>s;s++){var o=0===s%2?r:n,u=o*Math.sin(s*Math.PI/i),a=-1*o*Math.cos(s*Math.PI/i);t.lineTo(u,a)}t.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0)}(),function(){var e=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],t="Change.kinetic",n="none",r="up",i="right",s="down",o="left",u="Label",a=e.length;Kinetic.Label=function(e){this.____init(e)},Kinetic.Label.prototype={____init:function(e){var t=this;this.className=u,Kinetic.Group.call(this,e),this.on("add.kinetic",function(e){t._addListeners(e.child),t._sync()})},getText:function(){return this.get("Text")[0]},getTag:function(){return this.get("Tag")[0]},_addListeners:function(n){var r,i=this,s=function(){i._sync()};for(r=0;a>r;r++)n.on(e[r]+t,s)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var e,t,n,u,a,l,c=this.getText(),h=this.getTag();if(c&&h){switch(e=c.getWidth(),t=c.getHeight(),n=h.getPointerDirection(),u=h.getPointerWidth(),pointerHeight=h.getPointerHeight(),a=0,l=0,n){case r:a=e/2,l=-1*pointerHeight;break;case i:a=e+u,l=t/2;break;case s:a=e/2,l=t+pointerHeight;break;case o:a=-1*u,l=t/2}h.setAttrs({x:-1*a,y:-1*l,width:e,height:t}),c.setAttrs({x:-1*a,y:-1*l})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Tag=function(e){this.___init(e)},Kinetic.Tag.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Tag"},drawFunc:function(e){var t=this.getWidth(),n=this.getHeight(),u=this.getPointerDirection(),a=this.getPointerWidth(),l=this.getPointerHeight();this.getCornerRadius(),e.beginPath(),e.moveTo(0,0),u===r&&(e.lineTo((t-a)/2,0),e.lineTo(t/2,-1*l),e.lineTo((t+a)/2,0)),e.lineTo(t,0),u===i&&(e.lineTo(t,(n-l)/2),e.lineTo(t+a,n/2),e.lineTo(t,(n+l)/2)),e.lineTo(t,n),u===s&&(e.lineTo((t+a)/2,n),e.lineTo(t/2,n+l),e.lineTo((t-a)/2,n)),e.lineTo(0,n),u===o&&(e.lineTo(0,(n+l)/2),e.lineTo(-1*a,n/2),e.lineTo(0,(n-l)/2)),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",n),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0)}(),function(){Kinetic.Filters.Grayscale=function(e){for(var t=e.data,n=0;n<t.length;n+=4){var r=.34*t[n]+.5*t[n+1]+.16*t[n+2];t[n]=r,t[n+1]=r,t[n+2]=r}}}(),function(){Kinetic.Filters.Brighten=function(e){for(var t=this.getFilterBrightness(),n=e.data,r=0;r<n.length;r+=4)n[r]+=t,n[r+1]+=t,n[r+2]+=t},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterBrightness",0)}(),function(){Kinetic.Filters.Invert=function(e){for(var t=e.data,n=0;n<t.length;n+=4)t[n]=255-t[n],t[n+1]=255-t[n+1],t[n+2]=255-t[n+2]}}(),function(){function e(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function t(t,i){var s,o,u,f,l,h,p,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=t.data,D=t.width,P=t.height,H=i+i+1,B=D-1,j=P-1,F=i+1,I=F*(F+1)/2,q=new e,R=null,U=q,z=null,W=null,X=n[i],V=r[i];for(u=1;H>u;u++)U=U.next=new e,u==F&&(R=U);for(U.next=q,p=h=0,o=0;P>o;o++){for(x=T=N=C=v=m=g=y=0,b=F*(k=_[h]),w=F*(L=_[h+1]),E=F*(A=_[h+2]),S=F*(O=_[h+3]),v+=I*k,m+=I*L,g+=I*A,y+=I*O,U=q,u=0;F>u;u++)U.r=k,U.g=L,U.b=A,U.a=O,U=U.next;for(u=1;F>u;u++)f=h+((u>B?B:u)<<2),v+=(U.r=k=_[f])*(M=F-u),m+=(U.g=L=_[f+1])*M,g+=(U.b=A=_[f+2])*M,y+=(U.a=O=_[f+3])*M,x+=k,T+=L,N+=A,C+=O,U=U.next;for(z=q,W=R,s=0;D>s;s++)_[h+3]=O=y*X>>V,0!==O?(O=255/O,_[h]=(v*X>>V)*O,_[h+1]=(m*X>>V)*O,_[h+2]=(g*X>>V)*O):_[h]=_[h+1]=_[h+2]=0,v-=b,m-=w,g-=E,y-=S,b-=z.r,w-=z.g,E-=z.b,S-=z.a,f=p+((f=s+i+1)<B?f:B)<<2,x+=z.r=_[f],T+=z.g=_[f+1],N+=z.b=_[f+2],C+=z.a=_[f+3],v+=x,m+=T,g+=N,y+=C,z=z.next,b+=k=W.r,w+=L=W.g,E+=A=W.b,S+=O=W.a,x-=k,T-=L,N-=A,C-=O,W=W.next,h+=4;p+=D}for(s=0;D>s;s++){for(T=N=C=x=m=g=y=v=0,h=s<<2,b=F*(k=_[h]),w=F*(L=_[h+1]),E=F*(A=_[h+2]),S=F*(O=_[h+3]),v+=I*k,m+=I*L,g+=I*A,y+=I*O,U=q,u=0;F>u;u++)U.r=k,U.g=L,U.b=A,U.a=O,U=U.next;for(l=D,u=1;i>=u;u++)h=l+s<<2,v+=(U.r=k=_[h])*(M=F-u),m+=(U.g=L=_[h+1])*M,g+=(U.b=A=_[h+2])*M,y+=(U.a=O=_[h+3])*M,x+=k,T+=L,N+=A,C+=O,U=U.next,j>u&&(l+=D);for(h=s,z=q,W=R,o=0;P>o;o++)f=h<<2,_[f+3]=O=y*X>>V,O>0?(O=255/O,_[f]=(v*X>>V)*O,_[f+1]=(m*X>>V)*O,_[f+2]=(g*X>>V)*O):_[f]=_[f+1]=_[f+2]=0,v-=b,m-=w,g-=E,y-=S,b-=z.r,w-=z.g,E-=z.b,S-=z.a,f=s+((f=o+F)<j?f:j)*D<<2,v+=x+=z.r=_[f],m+=T+=z.g=_[f+1],g+=N+=z.b=_[f+2],y+=C+=z.a=_[f+3],z=z.next,b+=k=W.r,w+=L=W.g,E+=A=W.b,S+=O=W.a,x-=k,T-=L,N-=A,C-=O,W=W.next,h+=D}}var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(e){var n=0|this.getFilterRadius();n>0&&t(e,n)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterRadius",0)}(),function(){function e(e,t,n){var r=4*(n*e.width+t),i=[];return i.push(e.data[r++],e.data[r++],e.data[r++],e.data[r++]),i}function t(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function n(e){for(var t=[0,0,0],n=0;n<e.length;n++)t[0]+=e[n][0],t[1]+=e[n][1],t[2]+=e[n][2];return t[0]/=e.length,t[1]/=e.length,t[2]/=e.length,t}function r(r,i){var s=e(r,0,0),o=e(r,r.width-1,0),u=e(r,0,r.height-1),f=e(r,r.width-1,r.height-1),l=i||10;if(t(s,o)<l&&t(o,f)<l&&t(f,u)<l&&t(u,s)<l){for(var h=n([o,s,f,u]),p=[],d=0;d<r.width*r.height;d++){var v=t(h,[r.data[4*d],r.data[4*d+1],r.data[4*d+2]]);p[d]=l>v?0:255}return p}}function i(e,t){for(var n=0;n<e.width*e.height;n++)e.data[4*n+3]=t[n]}function s(e,t,n){for(var r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[],u=0;n>u;u++)for(var a=0;t>a;a++){for(var f=u*t+a,l=0,c=0;i>c;c++)for(var h=0;i>h;h++){var p=u+c-s,d=a+h-s;if(p>=0&&n>p&&d>=0&&t>d){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=2040===l?255:0}return o}function o(e,t,n){for(var r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[],u=0;n>u;u++)for(var a=0;t>a;a++){for(var f=u*t+a,l=0,c=0;i>c;c++)for(var h=0;i>h;h++){var p=u+c-s,d=a+h-s;if(p>=0&&n>p&&d>=0&&t>d){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l>=1020?255:0}return o}function u(e,t,n){for(var r=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[],u=0;n>u;u++)for(var a=0;t>a;a++){for(var f=u*t+a,l=0,c=0;i>c;c++)for(var h=0;i>h;h++){var p=u+c-s,d=a+h-s;if(p>=0&&n>p&&d>=0&&t>d){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l}return o}Kinetic.Filters.Mask=function(e){var t=this.getFilterThreshold(),n=r(e,t);return n&&(n=s(n,e.width,e.height),n=o(n,e.width,e.height),n=u(n,e.width,e.height),i(e,n)),e},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterThreshold",0)}(),function(){var e=function(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),s=r-i,o=s/2,u=s/(1-Math.abs(2*o-1)),a=0;return r==e?a=(t-n)/s%6:r==t?a=(n-e)/s+2:r==n&&(a=(e-t)/s+4),[(60*a+360)%360,u,o]},t=function(e,t,n,r){e/=255,t/=255,n/=255;var i=Math.max(e,t,n),s=Math.min(e,t,n),o=i-s,u=o/2,a=(o/(1-Math.abs(2*u-1)),0);i==e?a=(t-n)/o%6:i==t?a=(n-e)/o+2:i==n&&(a=(e-t)/o+4),a*=60,a%=360,a+=r,a%=360,a/=60;var f=0,l=0,c=0,h=o*(1-Math.abs(a%2-1)),p=u-o/2;return a>=0&&1>a?(f=o,l=h):a>=1&&2>a?(l=o,f=h):a>=2&&3>a?(l=o,c=h):a>=3&&4>a?(c=o,l=h):a>=4&&5>a?(c=o,f=h):a>=5&&6>a&&(f=o,c=h),f+=p,l+=p,c+=p,f=255*f,l=255*l,c=255*c,[f,l,c]},n=function(e,n){for(var r,i=e.data,s=0;s<i.length;s+=4)r=t(i[s+0],i[s+1],i[s+2],n),i[s+0]=r[0],i[s+1]=r[1],i[s+2]=r[2]};Kinetic.Filters.ShiftHue=function(e){n(e,this.getFilterHueShiftDeg()%360)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterHueShiftDeg",0),Kinetic.Filters.Colorize=function(t){for(var r=t.data,i=this.getFilterColorizeColor(),s=e(i[0],i[1],i[2]),o=s[0],u=0;u<r.length;u+=4)r[u+1]=0,r[u+2]=0;n(t,o)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterColorizeColor",[255,0,0])}(),function(){var e=function(e,t){var n=e.data,r=e.width,i=e.height,s=r*i,o=[];o.length=4*r*i;var u,a,f,l,c,h,p,d,v,m,g,y=t.length,b=t[0].length,w=Math.floor(t.length/2),E=Math.floor(t[0].length/2);for(h=0;i>h;h+=1)for(c=0;r>c;c+=1){for(u=0,a=0,f=0,l=0,m=0;y>m;m+=1)for(g=0;b>g;g+=1)p=(c+m-w)%r,p=p>0?p:-p,d=(h+m-E)%i,d=d>0?d:-d,v=4*(d*r+p),u+=t[g][m]*n[v+0],a+=t[g][m]*n[v+1],f+=t[g][m]*n[v+2];v=4*(h*r+c),o[v+0]=u,o[v+1]=a,o[v+2]=f}var S=4*s;for(v=0;S>v;v+=4)n[v+0]=o[v+0],n[v+1]=o[v+1],n[v+2]=o[v+2]},t=function(e,t,n){var r=e-t;return Math.pow(Math.E,-r*r/(2*n*n))},n=function(e,n,r){0===e%2&&(e+=1);var i,s,o,u=[];for(i=0;e>i;i+=1){for(o=[],s=0;e>s;s+=1)o.push(n*t(i,e/2,r)*t(s,e/2,r));u.push(o)}return u},r=function(e,t){var r=n(e,t,1),i=Math.floor(e/2);return r[i][i]+=1-t,r},i=function(e,t){var r=n(e,-t,1),i=Math.floor(e/2);return r[i][i]+=1+t,r};Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterAmount",50),Kinetic.Filters.UnsharpMask=function(t){e(t,i(5,this.getFilterAmount()/100))},Kinetic.Filters.SoftBlur=function(t){e(t,r(5,this.getFilterAmount()/100))},Kinetic.Filters.Edge=function(t){var n=this.getFilterAmount()/100;0!==n&&e(t,[[0,-1*n,0],[-1*n,1-n+4*n,-1*n],[0,-1*n,0]])},Kinetic.Filters.Emboss=function(t){var n=this.getFilterAmount()/100;0!==n&&e(t,[[-1*n,-0.5*n,0],[-0.5*n,1+.5*n,.5*n],[0,.5*n,1*n]])}}(),define("bpmn/util/diagram/Canvas",["kinetic"],function(e){var t=function(n){this.scale=n.scale;var r=this.stage=new e.Stage({container:n.container,width:n.width?n.width:500,height:n.height?n.height:500});r.setScale(this.scale,this.scale),this.shapeLayer=new e.Layer,this.connectionsLayer=new e.Layer,this.labelLayer=new e.Layer,r.add(this.shapeLayer),r.add(this.connectionsLayer),r.add(this.labelLayer),this.createGroup=function(t){return new e.Group(t)},this.createRect=function(t){return new e.Rect(t)},this.createCircle=function(t){return new e.Circle(t)},this.createLine=function(t){return new e.Line(t)},this.createText=function(t){return new e.Text(t)},this.createPolygon=function(t){return new e.Polygon(t)},this.createPath=function(t){return new e.Path(t)},this.createArrowLine=function(t,n,r){var i=r?r:6,s=t[t.length-2],o=t[t.length-1],u=t[t.length-4],a=t[t.length-3],f=Math.atan2(o-a,s-u);n.points=t.concat([s-i*Math.cos(f-Math.PI/6),o-i*Math.sin(f-Math.PI/6),s,o,s-i*Math.cos(f+Math.PI/6),o-i*Math.sin(f+Math.PI/6)]);var l=new e.Line(n);return l},this.expandCanvasIfNeeded=function(e){var t=10,n=e.getX(),r=e.getY(),i=e.getWidth(),s=e.getHeight();(n+i)*this.scale>this.stage.getWidth()&&this.stage.setWidth((n+i+t)*this.scale),(r+s)*this.scale>this.stage.getHeight()&&this.stage.setHeight((r+s+t)*this.scale)}};return t}),define("bpmn/editor/ActivityRenderer",[],function(){var e=function(e){this.markerPaths={"bpmn.ServiceTask":"m 22.701284,14.663851 c 0.432742,0 0.835353,-0.363368 0.894226,-0.807377 0,0 0.08274,-0.624013 0.08274,-1.366108 0,-0.742094 -0.08274,-1.366107 -0.08274,-1.366107 -0.05909,-0.444249 -0.461484,-0.807376 -0.894226,-0.807376 h -2.236261 c -0.432975,0 -0.882637,-0.285846 -0.998992,-0.6350536 -0.116355,-0.3492066 -0.276519,-1.4695496 0.02967,-1.7863558 L 21.076473,6.2586397 C 21.382428,5.9415935 21.40607,5.4006221 21.128856,5.0562152 L 19.269014,3.1299359 C 18.936402,2.8426498 18.414191,2.8671302 18.107771,3.1841824 L 16.526998,4.8210152 C 16.221042,5.1380613 15.710883,5.2657441 15.394032,5.1049407 15.076952,4.9441373 14.18852,4.2658838 14.18852,3.8175543 V 1.501988 c 0,-0.4483294 -0.350922,-0.86497745 -0.779725,-0.92617905 0,0 -0.60264,-0.085927 -1.319319,-0.085927 -0.716679,0 -1.319319,0.085927 -1.319319,0.085927 -0.429034,0.06096 -0.7799559,0.47784965 -0.7799559,0.92617905 v 2.3155663 c 0,0.4483295 -0.275824,0.9136994 -0.6133031,1.0344211 C 9.0394192,4.9724583 7.9576789,5.1383013 7.6514912,4.8212576 L 6.0707181,3.1844175 C 5.7645304,2.8673702 5.2420872,2.8428899 4.9097076,3.1299359 L 3.0496339,5.0559751 C 2.7721873,5.4003821 2.7958294,5.9413535 3.1020167,6.2583996 L 4.682558,7.8952336 C 4.9887458,8.2122798 5.1122872,8.7402903 4.9567595,9.0683769 4.8012323,9.3964637 4.14644,10.316643 3.7134658,10.316643 H 1.4774369 c -0.4329742,0 -0.83535274,0.363367 -0.89445788,0.807376 0,0 -0.082979,0.624013 -0.082979,1.366107 0,0.742335 0.082979,1.366108 0.082979,1.366108 0.0588733,0.444249 0.46148368,0.807376 0.89445788,0.807376 h 2.2362607 c 0.4329742,0 0.882405,0.285607 0.9987611,0.635054 0.116356,0.349206 0.2765193,1.46931 -0.029668,1.786356 l -1.5805412,1.636594 c -0.3061877,0.317046 -0.3298298,0.858017 -0.052384,1.202424 l 1.859842,1.926279 c 0.3326113,0.287047 0.8548228,0.262806 1.1610105,-0.05425 l 1.5807733,-1.636829 c 0.3061877,-0.316806 0.8161146,-0.444729 1.1331963,-0.283925 0.3170817,0.160802 1.2055136,0.839057 1.2055136,1.287386 v 2.315567 c 0,0.448089 0.3509218,0.864976 0.7799558,0.925938 0,0 0.602408,0.08568 1.319319,0.08568 0.71691,0 1.319319,-0.08568 1.319319,-0.08568 0.429035,-0.06119 0.779725,-0.477849 0.779725,-0.925938 v -2.315567 c 0,-0.448329 0.275825,-0.913939 0.613303,-1.034421 0.337479,-0.120482 1.419219,-0.286086 1.725407,0.03071 l 1.580541,1.636833 c 0.306188,0.316807 0.828631,0.341288 1.161243,0.05425 l 1.859842,-1.925559 c 0.277214,-0.344407 0.253804,-0.885138 -0.05262,-1.202424 l -1.58054,-1.636586 c -0.306188,-0.317046 -0.42973,-0.845056 -0.274202,-1.173383 0.155296,-0.328327 0.81032,-1.248266 1.243294,-1.248266 h 2.236492 z m -10.612039,2.218844 c -2.342882,0 -4.2421275,-1.966359 -4.2421275,-4.392569 0,-2.425728 1.8992455,-4.3925682 4.2421275,-4.3925682 2.342882,0 4.242127,1.9666002 4.242127,4.3925682 0,2.42597 -1.899245,4.392569 -4.242127,4.392569 z","bpmn.UserTask":"M 12.253681,11.77491 C 11.634895,10.657313 10.877364,9.7523027 10.117807,9.1196049 9.2316574,9.7684998 8.152074,10.163303 6.9752673,10.163303 5.7964351,10.163303 4.715839,9.7674875 3.8307021,9.1196049 3.0711453,9.7523027 2.313614,10.657313 1.6928029,11.77491 c -1.44011956,2.594568 -1.59810737,5.255948 -0.3544598,5.946348 0.5570083,0.310781 1.1413607,0.07896 1.7449552,-0.502109 -0.106338,0.589168 -0.1681153,1.22794 -0.1681153,1.896068 0,2.968112 1.1535136,5.372364 2.5754039,5.372364 0.8567801,0 1.2811192,-0.875654 1.4846804,-2.215961 0.2035612,1.340307 0.6279003,2.215961 1.4816421,2.215961 1.4239158,0 2.5774296,-2.404252 2.5774296,-5.372364 0,-0.668128 -0.06178,-1.3069 -0.170141,-1.896068 0.60562,0.581069 1.18896,0.81289 1.746981,0.502109 1.243647,-0.6904 1.082621,-3.35178 -0.357498,-5.946348 z M 6.9742546,9.1509867 c 2.3920975,0 4.3325124,-1.9395984 4.3325124,-4.3317023 0,-2.3921039 -1.9404149,-4.33170228 -4.3325124,-4.33170228 -2.3931103,0 -4.3345375,1.93959838 -4.3345375,4.33170228 0,2.3921039 1.9414272,4.3317023 4.3345375,4.3317023 z","bpmn.BusinessRuleTask":"M 0.49999997,0.68485673 V 3.8369982 H 24.501049 V 0.68485673 H 0.49999997 z m 0,17.05141427 H 24.501049 V 14.58413 H 0.49999997 v 3.152141 z m 0,-6.949637 H 24.501049 V 7.6344932 H 0.49999997 v 3.1521408 z m 0,13.898223 H 24.501049 V 21.532715 H 0.49999997 v 3.152142 z","bpmn.ReceiveTask":"M 1.7164479,0.59270005 9.5482144,6.784475 17.408905,0.54332386 z M 0.70000001,1.254341 l 0,11.06027 17.69642899,0 0,-11.06027 -8.8482146,6.6361608 z"},this.createRectangle=function(t){var n=e.skin().activity_corner_radius,r=e.canvas.createRect({width:t.width(),height:t.height(),cornerRadius:n,stroke:e.skin().activity_stroke,fill:e.skin().activity_fill,strokeWidth:2});return r},this.getPathForActivityType=function(e){return this.markerPaths[e.declaredClass]},this.createMarker=function(t){var n=e.canvas.createPath({x:3,y:3,data:t,stroke:e.skin().activity_stroke,fill:e.skin().activity_fill,scale:.6});return n},this.render=function(e,t){var n=e.getBounds(),r=this.createRectangle(n),i=this.getPathForActivityType(e),s=this.createMarker(i);return t.add(r),t.add(s),t}};return e}),define("bpmn/editor/EventRenderer",[],function(){var e=function(){this.render=function(e,t){var n=e.getBounds(),r=this.canvas.createCircle({width:n.width(),height:n.height(),stroke:this.skin().event_stroke,strokeWidth:2,draggable:!0});return t.add(r),t}};return e}),define("bpmn/editor/GatewayRenderer",[],function(){var e=function(){this.render=function(e,t){var n=e.getBounds(),r=this.canvas.createPolygon({points:[0,n.height()/2,n.width()/2,0,n.width(),n.height()/2,n.width()/2,n.height()],stroke:"black",strokeWidth:2,draggable:!0});return t.add(r),t}};return e}),define("bpmn/editor/LabelRenderer",[],function(){var e=function(e){this.renderCentered=function(e,t,n){var r=this.createLabelText(n);return r.setY(e.height()/2-r.getFontSize()),r.setWidth(e.width()),t.add(r),t},this.createLabelText=function(t){return e.canvas.createText({text:t,fontSize:e.skin().label_font_size,fontFamily:e.skin().label_font_family,fill:e.skin().label_fill,align:"center"})}};return e}),define("bpmn/editor/Renderer",["dojo/_base/declare","dojo/_base/array","bpmn/Activity","bpmn/Gateway","bpmn/Event","bpmn/SequenceFlow","bpmn/util/diagram/Canvas","bpmn/editor/ActivityRenderer","bpmn/editor/EventRenderer","bpmn/editor/GatewayRenderer","bpmn/editor/LabelRenderer"],function(e,t,n,r,i,s,o,u,a,f,l){var c={skins:{"default":{event_stroke:"black",activity_stroke:"black",activity_fill:"white",activity_corner_radius:10,label_font_family:"Arial",label_font_size:12,label_fill:"black"}},constructor:function(e,t){this.definitions=e,this.skinName="default",this.bindDelegates(),this.evaluateOptionsAndDefaults(t),this.canvas=new o(this.options)},bindDelegates:function(){this.activity=new u(this),this.renderEvent=(new a).render,this.renderGateway=(new f).render,this.label=new l(this)},evaluateOptionsAndDefaults:function(e){this.options=e,this.skinName=e.skin?e.skin:"default",this.options.scale=e.scale?e.scale:1},render:function(){this.renderElements(),this.canvas.shapeLayer.draw(),this.canvas.connectionsLayer.draw(),this.canvas.labelLayer.draw()},renderElements:function(){if(this.definitions.process().length>1)throw new Error("Only single process models are supported");t.forEach(this.definitions.process(),function(e){t.forEach(e.flowElements(),function(e){this.renderElement(e)},this)},this)},renderElement:function(e){var t=this.canvas.createGroup({draggable:!0});e instanceof s?(this.renderConnection(e,t),this.canvas.connectionsLayer.add(t)):e instanceof n?(this.label.renderCentered(e.getBounds(),this.activity.render(e,t),e.name()),this.canvas.shapeLayer.add(t),this.setGroupBounds(t,e.getBounds())):e instanceof i?(this.renderEvent(e,t),this.canvas.shapeLayer.add(t),this.setGroupBounds(t,this.eventBounds(e))):e instanceof r?(this.renderGateway(e,t),this.canvas.shapeLayer.add(t),this.setGroupBounds(t,e.getBounds())):console.log("unable to render flowElement",e),this.canvas.expandCanvasIfNeeded(t)},eventBounds:function(e){var t=e.getBounds();return{x:function(){return t.x()+t.width()/2},y:function(){return t.y()+t.height()/2},width:function(){return t.width()},height:function(){return t.height()}}},setGroupBounds:function(e,t){e.setX(t.x()),e.setY(t.y()),e.setWidth(t.width()),e.setHeight(t.height())},renderConnection:function(e,n){var r=[];t.forEach(e.getWaypoints(),function(e){r.push(e.x),r.push(e.y)});var i=this.canvas.createArrowLine(r,{stroke:"black",strokeWidth:2,lineCap:"round",lineJoin:"round"});return n.add(i),n},skin:function(){return this.skins[this.skinName]}};return e("bpmn.Renderer",null,c)}),define("bpmn/Bpmn",["dojo/_base/declare","bpmn/Definitions","bpmn/execution/Instance","bpmn/util/Serializer","bpmn/editor/Renderer"],function(e,t,n,r,i){var s={constructor:function(){}};return e("bpmn.Bpmn",null,s)});