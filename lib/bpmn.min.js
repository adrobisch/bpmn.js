/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */

/*
 * KineticJS JavaScript Framework v5.1.1
 * http://www.kineticjs.com/
 * Copyright 2013, Eric Rowell
 * Licensed under the MIT or GPL Version 2 licenses.
 * Date: 2014-05-09
 *
 * Copyright (C) 2011 - 2013 by Eric Rowell
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

/*

     StackBlur - a fast almost Gaussian Blur For Canvas

     Version:   0.5
     Author:    Mario Klingemann
     Contact:   mario@quasimondo.com
     Website:   http://www.quasimondo.com/StackBlurForCanvas
     Twitter:   @quasimondo

     In case you find this class useful - especially in commercial projects -
     I am not totally unhappy for a small donation to my PayPal account
     mario@quasimondo.de

     Or support me on flattr:
     https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript

     Copyright (c) 2010 Mario Klingemann

     Permission is hereby granted, free of charge, to any person
     obtaining a copy of this software and associated documentation
     files (the "Software"), to deal in the Software without
     restriction, including without limitation the rights to use,
     copy, modify, merge, publish, distribute, sublicense, and/or sell
     copies of the Software, and to permit persons to whom the
     Software is furnished to do so, subject to the following
     conditions:

     The above copyright notice and this permission notice shall be
     included in all copies or substantial portions of the Software.

     THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
     EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
     OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
     NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
     HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
     WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
     FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
     OTHER DEALINGS IN THE SOFTWARE.
     */

/**
     * Emboss Filter.
     * Pixastic Lib - Emboss filter - v0.1.0
     * Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk, http://blog.nihilogic.dk/
     * License: [http://www.pixastic.com/lib/license.txt]
     * @function
     * @memberof Kinetic.Filters
     * @param {Object} imageData
     * @example
     * node.cache();
     * node.filters([Kinetic.Filters.Emboss]);
     * node.embossStrength(0.8);
     * node.embossWhiteLevel(0.3);
     * node.embossDirection('right');
     * node.embossBlend(true);
     */

/**
     * Sepia Filter
     * Based on: Pixastic Lib - Sepia filter - v0.1.0
     * Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk, http://blog.nihilogic.dk/
     * @function
     * @name Sepia
     * @memberof Kinetic.Filters
     * @param {Object} imageData
     * @author Jacob Seidelin <jseidelin@nihilogic.dk>
     * @license MPL v1.1 [http://www.pixastic.com/lib/license.txt]
     * @example
     * node.cache();
     * node.filters([Kinetic.Filters.Sepia]);
     */

/**
     * Solarize Filter
     * Pixastic Lib - Solarize filter - v0.1.0
     * Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk, http://blog.nihilogic.dk/
     * License: [http://www.pixastic.com/lib/license.txt]
     * @function
     * @name Solarize
     * @memberof Kinetic.Filters
     * @param {Object} imageData
     * @example
     * node.cache();
     * node.filters([Kinetic.Filters.Solarize]);
     */

/*! bpmn.js https://github.com/adrobisch/bpmn.js by Andreas Drobisch @adrobisch - MIT License */

define("dojo/has",["require","module"],function(e,t){var n=e.has||function(){};if(!n("dojo-has-api")){var r=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location==location&&window.document==document,i=this,s=r&&document,o=s&&s.createElement("DiV"),u=t.config&&t.config()||{};n=function(e){return typeof u[e]=="function"?u[e]=u[e](i,s,o):u[e]},n.cache=u,n.add=function(e,t,r,i){return(typeof u[e]=="undefined"||i)&&(u[e]=t),r&&n(e)},n.add("host-browser",r),n.add("dom",r),n.add("dojo-dom-ready-api",1),n.add("dojo-sniff",1)}if(n("host-browser")){n.add("dom-addeventlistener",!!document.addEventListener),n.add("touch","ontouchstart"in document||window.navigator.msMaxTouchPoints>0),n.add("device-width",screen.availWidth||innerWidth);var a=document.createElement("form");n.add("dom-attributes-explicit",a.attributes.length==0),n.add("dom-attributes-specified-flag",a.attributes.length>0&&a.attributes.length<40)}return n.clearElement=function(e){return e.innerHTML="",e},n.normalize=function(e,t){var r=e.match(/[\?:]|[^:\?]*/g),i=0,s=function(e){var t=r[i++];return t==":"?0:r[i++]=="?"?!e&&n(t)?s():(s(!0),s(e)):t||0};return e=s(),e&&t(e)},n.load=function(e,t,n){e?t([e],n):n()},n}),define("dojo/_base/config",["../has","require"],function(e,t){var n={};if(e("dojo-config-api")){var r=t.rawConfig,i;for(i in r)n[i]=r[i]}else{var s=function(t,n,r){for(i in t)i!="has"&&e.add(n+i,t[i],0,r)};n=e("dojo-loader")?t.rawConfig:this.dojoConfig||this.djConfig||{},s(n,"config",1),s(n.has,"",1)}return!n.locale&&typeof navigator!="undefined"&&(n.locale=(navigator.language||navigator.userLanguage).toLowerCase()),n}),define("dojo/_base/kernel",["../has","./config","require","module"],function(e,t,n,r){var i,s,o={},u={},a={config:t,global:this,dijit:o,dojox:u},f={dojo:["dojo",a],dijit:["dijit",o],dojox:["dojox",u]},l=n.map&&n.map[r.id.match(/[^\/]+/)[0]],c;for(s in l)f[s]?f[s][0]=l[s]:f[s]=[l[s],{}];for(s in f)c=f[s],c[1]._scopeName=c[0],t.noGlobals||(this[c[0]]=c[1]);a.scopeMap=f,a.baseUrl=a.config.baseUrl=n.baseUrl,a.isAsync=!e("dojo-loader")||n.async,a.locale=t.locale;var h="$Rev: 43d05c6 $".match(/\d+/);a.version={major:1,minor:9,patch:1,flag:"",revision:h?+h[0]:NaN,toString:function(){var e=a.version;return e.major+"."+e.minor+"."+e.patch+e.flag+" ("+e.revision+")"}},e.add("extend-dojo",1),Function("d","d.eval = function(){return d.global.eval ? d.global.eval(arguments[0]) : eval(arguments[0]);}")(a),e("host-rhino")?a.exit=function(e){quit(e)}:a.exit=function(){},e.add("dojo-guarantee-console",1);if(e("dojo-guarantee-console")){typeof console!="undefined"||(console={});var p=["assert","count","debug","dir","dirxml","error","group","groupEnd","info","profile","profileEnd","time","timeEnd","trace","warn","log"],d;i=0;while(d=p[i++])console[d]||function(){var e=d+"";console[e]="log"in console?function(){var t=Array.apply({},arguments);t.unshift(e+":"),console.log(t.join(" "))}:function(){},console[e]._fake=!0}()}e.add("dojo-debug-messages",!!t.isDebug),a.deprecated=a.experimental=function(){},e("dojo-debug-messages")&&(a.deprecated=function(e,t,n){var r="DEPRECATED: "+e;t&&(r+=" "+t),n&&(r+=" -- will be removed in version: "+n),console.warn(r)},a.experimental=function(e,t){var n="EXPERIMENTAL: "+e+" -- APIs subject to change without notice.";t&&(n+=" "+t),console.warn(n)}),e.add("dojo-modulePaths",1);if(e("dojo-modulePaths")&&t.modulePaths){a.deprecated("dojo.modulePaths","use paths configuration");var v={};for(s in t.modulePaths)v[s.replace(/\./g,"/")]=t.modulePaths[s];n({paths:v})}return e.add("dojo-moduleUrl",1),e("dojo-moduleUrl")&&(a.moduleUrl=function(e,t){a.deprecated("dojo.moduleUrl()","use require.toUrl","2.0");var r=null;return e&&(r=n.toUrl(e.replace(/\./g,"/")+(t?"/"+t:"")+"/*.*").replace(/\/\*\.\*/,"")+(t?"":"/")),r}),a._hasResource={},a}),define("dojo/sniff",["./has"],function(e){if(e("host-browser")){var t=navigator,n=t.userAgent,r=t.appVersion,i=parseFloat(r);e.add("air",n.indexOf("AdobeAIR")>=0),e.add("msapp",parseFloat(n.split("MSAppHost/")[1])||undefined),e.add("khtml",r.indexOf("Konqueror")>=0?i:undefined),e.add("webkit",parseFloat(n.split("WebKit/")[1])||undefined),e.add("chrome",parseFloat(n.split("Chrome/")[1])||undefined),e.add("safari",r.indexOf("Safari")>=0&&!e("chrome")?parseFloat(r.split("Version/")[1]):undefined),e.add("mac",r.indexOf("Macintosh")>=0),e.add("quirks",document.compatMode=="BackCompat");if(n.match(/(iPhone|iPod|iPad)/)){var s=RegExp.$1.replace(/P/,"p"),o=n.match(/OS ([\d_]+)/)?RegExp.$1:"1",u=parseFloat(o.replace(/_/,".").replace(/_/g,""));e.add(s,u),e.add("ios",u)}e.add("android",parseFloat(n.split("Android ")[1])||undefined),e.add("bb",(n.indexOf("BlackBerry")>=0||n.indexOf("BB10")>=0)&&parseFloat(n.split("Version/")[1])||undefined),e.add("svg",typeof SVGAngle!="undefined");if(!e("webkit")){n.indexOf("Opera")>=0&&e.add("opera",i>=9.8?parseFloat(n.split("Version/")[1])||i:i),n.indexOf("Gecko")>=0&&!e("khtml")&&!e("webkit")&&e.add("mozilla",i),e("mozilla")&&e.add("ff",parseFloat(n.split("Firefox/")[1]||n.split("Minefield/")[1])||undefined);if(document.all&&!e("opera")){var a=parseFloat(r.split("MSIE ")[1])||undefined,f=document.documentMode;f&&f!=5&&Math.floor(a)!=f&&(a=f),e.add("ie",a)}e.add("wii",typeof opera!="undefined"&&opera.wiiremote)}}return e}),define("dojo/_base/lang",["./kernel","../has","../sniff"],function(e,t){t.add("bug-for-in-skips-shadowed",function(){for(var e in{toString:1})return 0;return 1});var n=t("bug-for-in-skips-shadowed")?"hasOwnProperty.valueOf.isPrototypeOf.propertyIsEnumerable.toLocaleString.toString.constructor".split("."):[],r=n.length,i=function(t,n,r){var i,s=0,o=e.global;if(!r){if(!t.length)return o;i=t[s++];try{r=e.scopeMap[i]&&e.scopeMap[i][1]}catch(u){}r=r||(i in o?o[i]:n?o[i]={}:undefined)}while(r&&(i=t[s++]))r=i in r?r[i]:n?r[i]={}:undefined;return r},s=Object.prototype.toString,o=function(e,t,n){return(n||[]).concat(Array.prototype.slice.call(e,t||0))},u=/\{([^\}]+)\}/g,a={_extraNames:n,_mixin:function(e,i,s){var o,u,a,f={};for(o in i){u=i[o];if(!(o in e)||e[o]!==u&&(!(o in f)||f[o]!==u))e[o]=s?s(u):u}if(t("bug-for-in-skips-shadowed")&&i)for(a=0;a<r;++a){o=n[a],u=i[o];if(!(o in e)||e[o]!==u&&(!(o in f)||f[o]!==u))e[o]=s?s(u):u}return e},mixin:function(e,t){e||(e={});for(var n=1,r=arguments.length;n<r;n++)a._mixin(e,arguments[n]);return e},setObject:function(e,t,n){var r=e.split("."),s=r.pop(),o=i(r,!0,n);return o&&s?o[s]=t:undefined},getObject:function(e,t,n){return i(e.split("."),t,n)},exists:function(e,t){return a.getObject(e,!1,t)!==undefined},isString:function(e){return typeof e=="string"||e instanceof String},isArray:function(e){return e&&(e instanceof Array||typeof e=="array")},isFunction:function(e){return s.call(e)==="[object Function]"},isObject:function(e){return e!==undefined&&(e===null||typeof e=="object"||a.isArray(e)||a.isFunction(e))},isArrayLike:function(e){return e&&e!==undefined&&!a.isString(e)&&!a.isFunction(e)&&(!e.tagName||e.tagName.toLowerCase()!="form")&&(a.isArray(e)||isFinite(e.length))},isAlien:function(e){return e&&!a.isFunction(e)&&/\{\s*\[native code\]\s*\}/.test(String(e))},extend:function(e,t){for(var n=1,r=arguments.length;n<r;n++)a._mixin(e.prototype,arguments[n]);return e},_hitchArgs:function(t,n){var r=a._toArray(arguments,2),i=a.isString(n);return function(){var s=a._toArray(arguments),o=i?(t||e.global)[n]:n;return o&&o.apply(t||this,r.concat(s))}},hitch:function(t,n){if(arguments.length>2)return a._hitchArgs.apply(e,arguments);n||(n=t,t=null);if(a.isString(n)){t=t||e.global;if(!t[n])throw['lang.hitch: scope["',n,'"] is null (scope="',t,'")'].join("");return function(){return t[n].apply(t,arguments||[])}}return t?function(){return n.apply(t,arguments||[])}:n},delegate:function(){function e(){}return function(t,n){e.prototype=t;var r=new e;return e.prototype=null,n&&a._mixin(r,n),r}}(),_toArray:t("ie")?function(){function e(e,t,n){var r=n||[];for(var i=t||0;i<e.length;i++)r.push(e[i]);return r}return function(t){return(t.item?e:o).apply(this,arguments)}}():o,partial:function(t){var n=[null];return a.hitch.apply(e,n.concat(a._toArray(arguments)))},clone:function(e){if(!e||typeof e!="object"||a.isFunction(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);var t,n,r;if(a.isArray(e)){t=[];for(n=0,r=e.length;n<r;++n)n in e&&t.push(a.clone(e[n]))}else t=e.constructor?new e.constructor:{};return a._mixin(t,e,a.clone)},trim:String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},replace:function(e,t,n){return e.replace(n||u,a.isFunction(t)?t:function(e,n){return a.getObject(n,!1,t)})}};return t("extend-dojo")&&a.mixin(e,a),a}),define("dojo/_base/declare",["./kernel","../has","./lang"],function(e,t,n){function f(e,t){throw new Error("declare"+(t?" "+t:"")+": "+e)}function l(e,t){var n=[],r=[{cls:0,refs:[]}],i={},o=1,a=e.length,l=0,c,h,p,d,v,m,g,y;for(;l<a;++l){p=e[l],p?s.call(p)!="[object Function]"&&f("mixin #"+l+" is not a callable constructor.",t):f("mixin #"+l+" is unknown. Did you use dojo.require to pull it in?",t),h=p._meta?p._meta.bases:[p],d=0;for(c=h.length-1;c>=0;--c)v=h[c].prototype,v.hasOwnProperty("declaredClass")||(v.declaredClass="uniqName_"+u++),g=v.declaredClass,i.hasOwnProperty(g)||(i[g]={count:0,refs:[],cls:h[c]},++o),m=i[g],d&&d!==m&&(m.refs.push(d),++d.count),d=m;++d.count,r[0].refs.push(d)}while(r.length){d=r.pop(),n.push(d.cls),--o;while(y=d.refs,y.length==1){d=y[0];if(!d||--d.count){d=0;break}n.push(d.cls),--o}if(d)for(l=0,a=y.length;l<a;++l)d=y[l],--d.count||r.push(d)}return o&&f("can't build consistent linearization",t),p=e[0],n[0]=p?p._meta&&p===n[n.length-p._meta.bases.length]?p._meta.bases.length:1:0,n}function c(e,t,n){var r,s,o,u,l,c,h,p,d,v=this._inherited=this._inherited||{};typeof e=="string"&&(r=e,e=t,t=n),n=0,u=e.callee,r=r||u.nom,r||f("can't deduce a name to call inherited()",this.declaredClass),l=this.constructor._meta,o=l.bases,d=v.p;if(r!=a){if(v.c!==u){d=0,c=o[0],l=c._meta;if(l.hidden[r]!==u){s=l.chains,s&&typeof s[r]=="string"&&f("calling chained method with inherited: "+r,this.declaredClass);do{l=c._meta,h=c.prototype;if(l&&(h[r]===u&&h.hasOwnProperty(r)||l.hidden[r]===u))break}while(c=o[++d]);d=c?d:-1}}c=o[++d];if(c){h=c.prototype;if(c._meta&&h.hasOwnProperty(r))n=h[r];else{p=i[r];do{h=c.prototype,n=h[r];if(n&&(c._meta?h.hasOwnProperty(r):n!==p))break}while(c=o[++d])}}n=c&&n||i[r]}else{if(v.c!==u){d=0,l=o[0]._meta;if(l&&l.ctor!==u){s=l.chains,(!s||s.constructor!=="manual")&&f("calling chained constructor with inherited",this.declaredClass);while(c=o[++d]){l=c._meta;if(l&&l.ctor===u)break}d=c?d:-1}}while(c=o[++d]){l=c._meta,n=l?l.ctor:c;if(n)break}n=c&&n}v.c=n,v.p=d;if(n)return t===!0?n:n.apply(this,t||e)}function h(e,t){return typeof e=="string"?this.__inherited(e,t,!0):this.__inherited(e,!0)}function p(e,t,n){var r=this.getInherited(e,t);if(r)return r.apply(this,n||t||e)}function v(e){var t=this.constructor._meta.bases;for(var n=0,r=t.length;n<r;++n)if(t[n]===e)return!0;return this instanceof e}function m(e,r){for(var i in r)i!=a&&r.hasOwnProperty(i)&&(e[i]=r[i]);if(t("bug-for-in-skips-shadowed"))for(var s=n._extraNames,o=s.length;o;)i=s[--o],i!=a&&r.hasOwnProperty(i)&&(e[i]=r[i])}function g(e,r){var o,u;for(o in r)u=r[o],(u!==i[o]||!(o in i))&&o!=a&&(s.call(u)=="[object Function]"&&(u.nom=o),e[o]=u);if(t("bug-for-in-skips-shadowed"))for(var f=n._extraNames,l=f.length;l;)o=f[--l],u=r[o],(u!==i[o]||!(o in i))&&o!=a&&(s.call(u)=="[object Function]"&&(u.nom=o),e[o]=u);return e}function y(e){return C.safeMixin(this.prototype,e),this}function b(e,t){return C([this].concat(e),t||{})}function w(e,t){return function(){var n=arguments,r=n,i=n[0],s,o,u,a=e.length,f;if(!(this instanceof n.callee))return N(n);if(t&&(i&&i.preamble||this.preamble)){f=new Array(e.length),f[0]=n;for(o=0;;){i=n[0],i&&(s=i.preamble,s&&(n=s.apply(this,n)||n)),s=e[o].prototype,s=s.hasOwnProperty("preamble")&&s.preamble,s&&(n=s.apply(this,n)||n);if(++o==a)break;f[o]=n}}for(o=a-1;o>=0;--o)s=e[o],u=s._meta,s=u?u.ctor:s,s&&s.apply(this,f?f[o]:n);s=this.postscript,s&&s.apply(this,r)}}function E(e,t){return function(){var n=arguments,r=n,i=n[0],s;if(!(this instanceof n.callee))return N(n);t&&(i&&(s=i.preamble,s&&(r=s.apply(this,r)||r)),s=this.preamble,s&&s.apply(this,r)),e&&e.apply(this,n),s=this.postscript,s&&s.apply(this,n)}}function S(e){return function(){var t=arguments,n=0,r,i;if(!(this instanceof t.callee))return N(t);for(;r=e[n];++n){i=r._meta,r=i?i.ctor:r;if(r){r.apply(this,t);break}}r=this.postscript,r&&r.apply(this,t)}}function x(e,t,n){return function(){var r,i,s,o=0,u=1;n&&(o=t.length-1,u=-1);for(;r=t[o];o+=u)i=r._meta,s=(i?i.hidden:r.prototype)[e],s&&s.apply(this,arguments)}}function T(e){o.prototype=e.prototype;var t=new o;return o.prototype=null,t}function N(e){var t=e.callee,n=T(t);return t.apply(n,e),n}function C(e,t,o){typeof e!="string"&&(o=t,t=e,e=""),o=o||{};var u,p,g,N,k,L,A,O=1,M=t;s.call(t)=="[object Array]"?(L=l(t,e),g=L[0],O=L.length-g,t=L[O]):(L=[0],t?s.call(t)=="[object Function]"?(g=t._meta,L=L.concat(g?g.bases:t)):f("base class is not a callable constructor.",e):t!==null&&f("unknown base class. Did you use dojo.require to pull it in?",e));if(t)for(p=O-1;;--p){u=T(t);if(!p)break;g=L[p],(g._meta?m:r)(u,g.prototype),N=new Function,N.superclass=t,N.prototype=u,t=u.constructor=N}else u={};C.safeMixin(u,o),g=o.constructor,g!==i.constructor&&(g.nom=a,u.constructor=g);for(p=O-1;p;--p)g=L[p]._meta,g&&g.chains&&(A=r(A||{},g.chains));u["-chains-"]&&(A=r(A||{},u["-chains-"])),g=!A||!A.hasOwnProperty(a),L[0]=N=A&&A.constructor==="manual"?S(L):L.length==1?E(o.constructor,g):w(L,g),N._meta={bases:L,hidden:o,chains:A,parents:M,ctor:o.constructor},N.superclass=t&&t.prototype,N.extend=y,N.createSubclass=b,N.prototype=u,u.constructor=N,u.getInherited=h,u.isInstanceOf=v,u.inherited=d,u.__inherited=c,e&&(u.declaredClass=e,n.setObject(e,N));if(A)for(k in A)u[k]&&typeof A[k]=="string"&&k!=a&&(g=u[k]=x(k,L,A[k]==="after"),g.nom=k);return N}var r=n.mixin,i=Object.prototype,s=i.toString,o=new Function,u=0,a="constructor",d=e.config.isDebug?p:c;return e.safeMixin=C.safeMixin=g,e.declare=C,C}),define("bpmn/Clazz",["dojo/_base/declare","dojo/_base/lang"],function(e,t){var n={constructor:function(e){this.text=null,this.reference={},this.attribute={},e&&t.mixin(this,e)},addReference:function(e){this.reference[e.name]=e;var t=this.__internalFieldName(e.name);e.containment===!0?this[t]=[]:this[t]=null,this[e.name]=function(t){return this.accessor(e.name,t)}},addAttribute:function(e){this.attribute[e.name]=e,this[e.name]=function(t){return this.accessor(e.name,t)}},accessor:function(e,t){var n=this.__internalFieldName(e);return t!=null&&t!=undefined&&(this[n]=t),this[n]},__internalFieldName:function(e){return"_"+e},init:function(){},setText:function(e){this.text=e}};return e("bpmn.Clazz",null,n)}),define("bpmn/util/Index",["dojo/_base/declare"],function(e){var t={constructor:function(){this._={}},add:function(e,t){this._[e]=t},addArray:function(e,t){this._[e]||(this._[e]=[]),this._[e].push(t)},addMap:function(e,t,n){this._[e]||(this._[e]={}),this._[e][t]=n},item:function(e){return this._[e]}};return e("bpmn.util.Index",null,t)}),define("bpmn/BaseElement",["dojo/_base/declare","bpmn/Clazz","bpmn/util/Index"],function(e,t){var n={constructor:function(){this.addReference({name:"documentation",type:function(){}}),this.addAttribute({name:"id",type:String}),this.addAttribute({name:"name",type:String});var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)});this.id(e)},init:function(){this._definitions.index.add(this.id(),this),this._definitions.index.addMap(this.declaredClass,this.id(),this)}};return e("bpmn.BaseElement",t,n)}),define("bpmn/CallableElement",["dojo/_base/declare","bpmn/BaseElement"],function(e,t){var n={constructor:function(){this.addAttribute({name:"name",type:String})}};return e("bpmn.CallableElement",t,n)}),define("bpmn/Package",["dojo/_base/declare"],function(e){var t={tagMap:{},constructor:function(){},registerClass:function(e){var t=e.prototype.tag;return t&&(this.tagMap[t.toLowerCase()]=e),e}},n=e("bpmn.Package",null,t);return window.bpmnPackage=new n}),define("bpmn/FlowElement",["dojo/_base/declare","bpmn/BaseElement","bpmn/Package"],function(e,t,n){var r={tag:"flowElement",constructor:function(){},getDiagramElement:function(){return this._definitions.index.item(this.id()+":di")},getBounds:function(){return this.getDiagramElement().bounds()},getWaypoints:function(){return this.getDiagramElement().waypoints()}};return n.registerClass(e("bpmn.FlowElement",t,r))}),define("bpmn/FlowElementsContainer",["dojo/_base/declare","bpmn/BaseElement","bpmn/FlowElement"],function(e,t,n){var r={constructor:function(){this.addReference({name:"flowElements",containment:!0,type:n})}};return e("bpmn.FlowElementsContainer",t,r)}),define("bpmn/Process",["dojo/_base/declare","bpmn/CallableElement","bpmn/FlowElementsContainer","bpmn/Package"],function(e,t,n,r){var i={tag:"process",constructor:function(){this.addAttribute({name:"isExecutable",containment:!0,type:"boolean"})}};return r.registerClass(e("bpmn.Process",[n,t],i))}),define("bpmn/Collaboration",["dojo/_base/declare","bpmn/Package"],function(e,t){var n={tag:"collaboration",constructor:function(){}};return t.registerClass(e("bpmn.Collaboration",null,n))}),define("bpmn/di/DiagramElement",["dojo/_base/declare","bpmn/Clazz","bpmn/Package"],function(e,t,n){var r={tag:"diagramElement",constructor:function(){this.addAttribute({name:"id",type:String}),this.addAttribute({name:"bpmnElement",type:String})},init:function(){this._definitions.index.add(this.bpmnElement()+":di",this)}};return n.registerClass(e("bpmn.DiagramElement",t,r))}),define("bpmn/di/Bounds",["dojo/_base/declare","bpmn/Clazz","bpmn/Package"],function(e,t,n){var r={tag:"Bounds",constructor:function(){this.addAttribute({name:"x",type:"float"}),this.addAttribute({name:"y",type:"float"}),this.addAttribute({name:"width",type:"float"}),this.addAttribute({name:"height",type:"float"})}};return n.registerClass(e("bpmn.Bounds",t,r))}),define("bpmn/di/BPMNShape",["dojo/_base/declare","bpmn/di/DiagramElement","bpmn/di/Bounds","bpmn/Package"],function(e,t,n,r){var i={tag:"BPMNShape",constructor:function(){this.addReference({name:"bounds",type:n})}};return r.registerClass(e("bpmn.BPMNShape",t,i))}),define("bpmn/di/Waypoint",["dojo/_base/declare","bpmn/Clazz","bpmn/Package"],function(e,t,n){var r={tag:"waypoint",constructor:function(){this.addAttribute({name:"x",type:"float"}),this.addAttribute({name:"y",type:"float"})},__internalFieldName:function(e){return e}};return n.registerClass(e("bpmn.Waypoint",t,r))}),define("bpmn/di/BPMNEdge",["dojo/_base/declare","bpmn/di/DiagramElement","bpmn/di/Waypoint","bpmn/Package"],function(e,t,n,r){var i={tag:"BPMNEdge",constructor:function(){this.addReference({name:"waypoints",containment:!0,type:n})}};return r.registerClass(e("bpmn.BPMNEdge",t,i))}),define("bpmn/di/BPMNPlane",["dojo/_base/declare","bpmn/Clazz","bpmn/Package","bpmn/di/BPMNShape","bpmn/di/BPMNEdge","bpmn/di/DiagramElement"],function(e,t,n,r,i,s){var o={tag:"BPMNPlane",constructor:function(){this.addReference({name:"diagramElements",containment:!0,type:s})}};return n.registerClass(e("bpmn.BPMNPlane",t,o))}),define("bpmn/di/BPMNDiagram",["dojo/_base/declare","bpmn/Clazz","bpmn/di/BPMNPlane","bpmn/Package"],function(e,t,n,r){var i={tag:"BPMNDiagram",constructor:function(){this.addReference({name:"plane",type:n})}};return r.registerClass(e("bpmn.BPMNDiagram",t,i))}),define("bpmn/FlowNode",["dojo/_base/declare","bpmn/FlowElement","bpmn/Package"],function(e,t,n){var r={tag:"flowNode",constructor:function(){},incoming:function(){var e=this._definitions.index.item("target:"+this.id());return e?e:[]},outgoing:function(){var e=this._definitions.index.item("source:"+this.id());return e?e:[]}};return n.registerClass(e("bpmn.FlowNode",t,r))}),define("bpmn/Event",["dojo/_base/declare","bpmn/FlowNode","bpmn/Package"],function(e,t,n){var r={tag:"event",constructor:function(){}};return n.registerClass(e("bpmn.Event",t,r))}),define("bpmn/CatchEvent",["dojo/_base/declare","bpmn/Event","bpmn/Package"],function(e,t,n){var r={tag:"catchEvent",constructor:function(){}};return n.registerClass(e("bpmn.CatchEvent",t,r))}),define("bpmn/StartEvent",["dojo/_base/declare","bpmn/CatchEvent","bpmn/Package"],function(e,t,n){var r={tag:"startEvent",constructor:function(){}};return n.registerClass(e("bpmn.StartEvent",t,r))}),define("bpmn/ThrowEvent",["dojo/_base/declare","bpmn/Event","bpmn/Package"],function(e,t,n){var r={tag:"throwEvent",constructor:function(){}};return n.registerClass(e("bpmn.ThrowEvent",t,r))}),define("bpmn/EndEvent",["dojo/_base/declare","bpmn/ThrowEvent","bpmn/Package"],function(e,t,n){var r={tag:"endEvent",constructor:function(){}};return n.registerClass(e("bpmn.EndEvent",t,r))}),define("bpmn/BoundaryEvent",["dojo/_base/declare","bpmn/CatchEvent","bpmn/Package"],function(e,t,n){var r={tag:"boundaryEvent",constructor:function(){}};return n.registerClass(e("bpmn.BoundaryEvent",t,r))}),define("bpmn/Activity",["dojo/_base/declare","bpmn/FlowNode","bpmn/Package"],function(e,t,n){var r={tag:"activity",constructor:function(){}};return n.registerClass(e("bpmn.Activity",t,r))}),define("bpmn/Task",["dojo/_base/declare","bpmn/Activity","bpmn/Package"],function(e,t,n){var r={tag:"task",constructor:function(){}};return n.registerClass(e("bpmn.Task",t,r))}),define("bpmn/UserTask",["dojo/_base/declare","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"userTask",constructor:function(){}};return n.registerClass(e("bpmn.UserTask",t,r))}),define("bpmn/ServiceTask",["dojo/_base/declare","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"serviceTask",constructor:function(){}};return n.registerClass(e("bpmn.ServiceTask",t,r))}),define("bpmn/BusinessRuleTask",["dojo/_base/declare","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"businessRuleTask",constructor:function(){}};return n.registerClass(e("bpmn.BusinessRuleTask",t,r))}),define("bpmn/ReceiveTask",["dojo/_base/declare","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"receiveTask",constructor:function(){}};return n.registerClass(e("bpmn.ReceiveTask",t,r))}),define("bpmn/SubProcess",["dojo/_base/declare","bpmn/Activity","bpmn/FlowElementsContainer","bpmn/Package"],function(e,t,n,r){var i={tag:"subProcess",constructor:function(){}};return r.registerClass(e("bpmn.SubProcess",[t,n],i))}),define("bpmn/Gateway",["dojo/_base/declare","bpmn/FlowNode","bpmn/Package"],function(e,t,n){var r={tag:"gateway",constructor:function(){}};return n.registerClass(e("bpmn.Gateway",t,r))}),define("bpmn/ExclusiveGateway",["dojo/_base/declare","bpmn/Gateway","bpmn/Package"],function(e,t,n){var r={tag:"exclusiveGateway",constructor:function(){this.addAttribute({name:"default",type:String})},getDefault:function(){return this._definitions.index.item(this.default())}};return n.registerClass(e("bpmn.ExclusiveGateway",t,r))}),define("bpmn/ParallelGateway",["dojo/_base/declare","bpmn/Gateway","bpmn/Package"],function(e,t,n){var r={tag:"parallelGateway",constructor:function(){}};return n.registerClass(e("bpmn.ParallelGateway",t,r))}),define("bpmn/ConditionExpression",["dojo/_base/declare","bpmn/BaseElement","bpmn/Package"],function(e,t,n){var r={tag:"conditionExpression",constructor:function(){}};return n.registerClass(e("bpmn.ConditionExpression",t,r))}),define("bpmn/SequenceFlow",["dojo/_base/declare","bpmn/FlowElement","bpmn/ConditionExpression","bpmn/Package"],function(e,t,n,r){var i={tag:"sequenceFlow",constructor:function(){this.addAttribute({name:"sourceRef",type:String}),this.addAttribute({name:"targetRef",type:String}),this.addReference({name:"conditionExpression",type:n})},getSourceRef:function(){return this._definitions.index.item(this._sourceRef)},getTargetRef:function(){return this._definitions.index.item(this._targetRef)},init:function(){this.inherited(arguments),this._definitions.index.addArray("target:"+this.targetRef(),this),this._definitions.index.addArray("source:"+this.sourceRef(),this)}};return r.registerClass(e("bpmn.SequenceFlow",t,i))}),define("bpmn/Definitions",["dojo/_base/declare","bpmn/BaseElement","bpmn/Process","bpmn/Collaboration","bpmn/di/BPMNDiagram","bpmn/util/Index","bpmn/StartEvent","bpmn/EndEvent","bpmn/BoundaryEvent","bpmn/UserTask","bpmn/ServiceTask","bpmn/BusinessRuleTask","bpmn/ReceiveTask","bpmn/SubProcess","bpmn/ExclusiveGateway","bpmn/ParallelGateway","bpmn/SequenceFlow"],function(e,t,n,r,i,s){var o={tag:"definitions",constructor:function(){this.addReference({name:"collaboration",type:r}),this.addReference({name:"process",containment:!0,type:n}),this.addReference({name:"bpmnDiagram",type:i}),this.index=new s}};return e("bpmn.Defintions",t,o)}),define("bpmn/execution/TokenStore",["dojo/_base/declare","dojo/_base/lang"],function(e,t){var n={constructor:function(e){this.tokenMap=e?e:{}},add:function(e,t){this.tokenMap[e]||(this.tokenMap[e]=[]),this.tokenMap[e].push(t)},drop:function(e,t){if(this.tokenMap[e])for(var n=0;n<t;n++)this.tokenMap[e].pop()},query:function(e){return this.tokenMap[e]?this.tokenMap[e]:[]},count:function(){var e=0;for(var t in this.tokenMap)e+=this.tokenMap[t].length;return e}};return e("bpmn.TokenStore",null,n)}),define("dojo/_base/array",["./kernel","../has","./lang"],function(e,t,n){function s(e){return r[e]=new Function("item","index","array",e)}function o(e){var t=!e;return function(n,i,o){var u=0,a=n&&n.length||0,f;a&&typeof n=="string"&&(n=n.split("")),typeof i=="string"&&(i=r[i]||s(i));if(o)for(;u<a;++u){f=!i.call(o,n[u],u,n);if(e^f)return!f}else for(;u<a;++u){f=!i(n[u],u,n);if(e^f)return!f}return t}}function u(e){var t=1,n=0,r=0;return e||(t=n=r=-1),function(s,o,u,f){if(f&&t>0)return a.lastIndexOf(s,o,u);var l=s&&s.length||0,c=e?l+r:n,h;u===i?h=e?n:l+r:u<0?(h=l+u,h<0&&(h=n)):h=u>=l?l+r:u,l&&typeof s=="string"&&(s=s.split(""));for(;h!=c;h+=t)if(s[h]==o)return h;return-1}}var r={},i,a={every:o(!1),some:o(!0),indexOf:u(!0),lastIndexOf:u(!1),forEach:function(e,t,n){var i=0,o=e&&e.length||0;o&&typeof e=="string"&&(e=e.split("")),typeof t=="string"&&(t=r[t]||s(t));if(n)for(;i<o;++i)t.call(n,e[i],i,e);else for(;i<o;++i)t(e[i],i,e)},map:function(e,t,n,i){var o=0,u=e&&e.length||0,a=new(i||Array)(u);u&&typeof e=="string"&&(e=e.split("")),typeof t=="string"&&(t=r[t]||s(t));if(n)for(;o<u;++o)a[o]=t.call(n,e[o],o,e);else for(;o<u;++o)a[o]=t(e[o],o,e);return a},filter:function(e,t,n){var i=0,o=e&&e.length||0,u=[],a;o&&typeof e=="string"&&(e=e.split("")),typeof t=="string"&&(t=r[t]||s(t));if(n)for(;i<o;++i)a=e[i],t.call(n,a,i,e)&&u.push(a);else for(;i<o;++i)a=e[i],t(a,i,e)&&u.push(a);return u},clearCache:function(){r={}}};return t("extend-dojo")&&n.mixin(e,a),a}),define("dojo/errors/create",["../_base/lang"],function(e){return function(t,n,r,i){r=r||Error;var s=function(e){if(r===Error){Error.captureStackTrace&&Error.captureStackTrace(this,s);var t=Error.call(this,e),i;for(i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);this.message=e,this.stack=t.stack}else r.apply(this,arguments);n&&n.apply(this,arguments)};return s.prototype=e.delegate(r.prototype,i),s.prototype.name=t,s.prototype.constructor=s,s}}),define("dojo/errors/CancelError",["./create"],function(e){return e("CancelError",null,null,{dojoType:"cancel"})}),define("dojo/promise/Promise",["../_base/lang"],function(e){function t(){throw new TypeError("abstract")}return e.extend(function(){},{then:function(e,n,r){t()},cancel:function(e,n){t()},isResolved:function(){t()},isRejected:function(){t()},isFulfilled:function(){t()},isCanceled:function(){t()},always:function(e){return this.then(e,e)},otherwise:function(e){return this.then(null,e)},trace:function(){return this},traceRejected:function(){return this},toString:function(){return"[object Promise]"}})}),define("dojo/Deferred",["./has","./_base/lang","./errors/CancelError","./promise/Promise","./has!config-deferredInstrumentation?./promise/instrumentation"],function(e,t,n,r,i){var s=0,o=1,u=2,a="This deferred has already been fulfilled.",f=Object.freeze||function(){},l=function(t,n,r,i,s){e("config-deferredInstrumentation")&&n===u&&d.instrumentRejected&&t.length===0&&d.instrumentRejected(r,!1,i,s);for(var o=0;o<t.length;o++)c(t[o],n,r,i)},c=function(t,n,r,i){var a=t[n],f=t.deferred;if(a)try{var l=a(r);if(n===s)typeof l!="undefined"&&p(f,n,l);else{if(l&&typeof l.then=="function"){t.cancel=l.cancel,l.then(h(f,o),h(f,u),h(f,s));return}p(f,o,l)}}catch(c){p(f,u,c)}else p(f,n,r);e("config-deferredInstrumentation")&&n===u&&d.instrumentRejected&&d.instrumentRejected(r,!!a,i,f.promise)},h=function(e,t){return function(n){p(e,t,n)}},p=function(e,t,n){if(!e.isCanceled())switch(t){case s:e.progress(n);break;case o:e.resolve(n);break;case u:e.reject(n)}},d=function(t){var i=this.promise=new r,h=this,p,v,m,g=!1,y=[];e("config-deferredInstrumentation")&&Error.captureStackTrace&&(Error.captureStackTrace(h,d),Error.captureStackTrace(i,d)),this.isResolved=i.isResolved=function(){return p===o},this.isRejected=i.isRejected=function(){return p===u},this.isFulfilled=i.isFulfilled=function(){return!!p},this.isCanceled=i.isCanceled=function(){return g},this.progress=function(e,t){if(!p)return l(y,s,e,null,h),i;if(t===!0)throw new Error(a);return i},this.resolve=function(e,t){if(!p)return l(y,p=o,v=e,null,h),y=null,i;if(t===!0)throw new Error(a);return i};var b=this.reject=function(t,n){if(!p)return e("config-deferredInstrumentation")&&Error.captureStackTrace&&Error.captureStackTrace(m={},b),l(y,p=u,v=t,m,h),y=null,i;if(n===!0)throw new Error(a);return i};this.then=i.then=function(e,t,n){var r=[n,e,t];return r.cancel=i.cancel,r.deferred=new d(function(e){return r.cancel&&r.cancel(e)}),p&&!y?c(r,p,v,m):y.push(r),r.deferred.promise},this.cancel=i.cancel=function(e,r){if(!p){if(t){var i=t(e);e=typeof i=="undefined"?e:i}g=!0;if(!p)return typeof e=="undefined"&&(e=new n),b(e),e;if(p===u&&v===e)return e}else if(r===!0)throw new Error(a)},f(i)};return d.prototype.toString=function(){return"[object Deferred]"},i&&i(d),d}),define("dojo/aspect",[],function(){function n(e,n,r,i){var s=e[n],o=n=="around",u;if(o){var a=r(function(){return s.advice(this,arguments)});u={remove:function(){a&&(a=e=r=null)},advice:function(e,t){return a?a.apply(e,t):s.advice(e,t)}}}else u={remove:function(){if(u.advice){var t=u.previous,i=u.next;!i&&!t?delete e[n]:(t?t.next=i:e[n]=i,i&&(i.previous=t)),e=r=u.advice=null}},id:t++,advice:r,receiveArguments:i};if(s&&!o)if(n=="after"){while(s.next&&(s=s.next));s.next=u,u.previous=s}else n=="before"&&(e[n]=u,u.next=s,s.previous=u);else e[n]=u;return u}function r(r){return function(i,s,o,u){var a=i[s],f;if(!a||a.target!=i)i[s]=f=function(){var n=t,r=arguments,i=f.before;while(i)r=i.advice.apply(this,r)||r,i=i.next;if(f.around)var s=f.around.advice(this,r);var o=f.after;while(o&&o.id<n){if(o.receiveArguments){var u=o.advice.apply(this,r);s=u===e?s:u}else s=o.advice.call(this,s,r);o=o.next}return s},a&&(f.around={advice:function(e,t){return a.apply(e,t)}}),f.target=i;var l=n(f||a,r,o,u);return o=null,l}}var e,t=0,i=r("after"),s=r("before"),o=r("around");return{before:s,around:o,after:i}}),define("dojo/on",["./has!dom-addeventlistener?:./aspect","./_base/kernel","./sniff"],function(e,t,n){function o(e,t,r,o,u){var a=t.match(/(.*):(.*)/);if(a)return t=a[2],a=a[1],i.selector(a,t).call(u,e,r);n("touch")&&(s.test(t)&&(r=x(r)),!n("event-orientationchange")&&t=="orientationchange"&&(t="resize",e=window,r=x(r))),p&&(r=p(r));if(e.addEventListener){var f=t in c,l=f?c[t]:t;return e.addEventListener(l,r,f),{remove:function(){e.removeEventListener(l,r,f)}}}t="on"+t;if(g&&e.attachEvent)return g(e,t,r);throw new Error("Target must be an event emitter")}function u(){this.cancelable=!1,this.defaultPrevented=!0}function a(){this.bubbles=!1}if(n("dom")){var r=window.ScriptEngineMajorVersion;n.add("jscript",r&&r()+ScriptEngineMinorVersion()/10),n.add("event-orientationchange",n("touch")&&!n("android")),n.add("event-stopimmediatepropagation",window.Event&&!!window.Event.prototype&&!!window.Event.prototype.stopImmediatePropagation),n.add("event-focusin",function(e,t,n){return!!n.attachEvent})}var i=function(e,t,n,r){return typeof e.on=="function"&&typeof t!="function"&&!e.nodeType?e.on(t,n):i.parse(e,t,n,o,r,this)};i.pausable=function(e,t,n,r){var s,o=i(e,t,function(){if(!s)return n.apply(this,arguments)},r);return o.pause=function(){s=!0},o.resume=function(){s=!1},o},i.once=function(e,t,n,r){var s=i(e,t,function(){return s.remove(),n.apply(this,arguments)});return s},i.parse=function(e,t,n,r,i,s){if(t.call)return t.call(s,e,n);if(t.indexOf(",")>-1){var o=t.split(/\s*,\s*/),u=[],a=0,f;while(f=o[a++])u.push(r(e,f,n,i,s));return u.remove=function(){for(var e=0;e<u.length;e++)u[e].remove()},u}return r(e,t,n,i,s)};var s=/^touch/;i.selector=function(e,n,r){return function(s,o){function f(n){u=u&&u.matches?u:t.query;while(!u.matches(n,e,s))if(n==s||r===!1||!(n=n.parentNode)||n.nodeType!=1)return;return n}var u=typeof e=="function"?{matches:e}:this,a=n.bubble;return a?i(s,a(f),o):i(s,n,function(e){var t=f(e.target);return t&&o.call(t,e)})}};var f=[].slice,l=i.emit=function(e,t,n){var r=f.call(arguments,2),i="on"+t;if("parentNode"in e){var s=r[0]={};for(var o in n)s[o]=n[o];s.preventDefault=u,s.stopPropagation=a,s.target=e,s.type=t,n=s}do e[i]&&e[i].apply(e,r);while(n&&n.bubbles&&(e=e.parentNode));return n&&n.cancelable&&n},c=n("event-focusin")?{}:{focusin:"focus",focusout:"blur"};if(!n("event-stopimmediatepropagation"))var h=function(){this.immediatelyStopped=!0,this.modified=!0},p=function(e){return function(t){if(!t.immediatelyStopped)return t.stopImmediatePropagation=h,e.apply(this,arguments)}};if(n("dom-addeventlistener"))i.emit=function(e,t,n){if(e.dispatchEvent&&document.createEvent){var r=e.ownerDocument.createEvent("HTMLEvents");r.initEvent(t,!!n.bubbles,!!n.cancelable);for(var s in n)s in r||(r[s]=n[s]);return e.dispatchEvent(r)&&r}return l.apply(i,arguments)};else{i._fixEvent=function(e,t){if(!e){var n=t&&(t.ownerDocument||t.document||t).parentWindow||window;e=n.event}if(!e)return e;try{d&&e.type==d.type&&e.srcElement==d.target&&(e=d)}catch(r){}if(!e.target){e.target=e.srcElement,e.currentTarget=t||e.srcElement,e.type=="mouseover"&&(e.relatedTarget=e.fromElement),e.type=="mouseout"&&(e.relatedTarget=e.toElement),e.stopPropagation||(e.stopPropagation=b,e.preventDefault=w);switch(e.type){case"keypress":var i="charCode"in e?e.charCode:e.keyCode;i==10?(i=0,e.keyCode=13):i==13||i==27?i=0:i==3&&(i=99),e.charCode=i,y(e)}}return e};var d,v=function(e){this.handle=e};v.prototype.remove=function(){delete _dojoIEListeners_[this.handle]};var m=function(e){return function(t){t=i._fixEvent(t,this);var n=e.call(this,t);return t.modified&&(d||setTimeout(function(){d=null}),d=t),n}},g=function(t,r,i){i=m(i);if(((t.ownerDocument?t.ownerDocument.parentWindow:t.parentWindow||t.window||window)!=top||n("jscript")<5.8)&&!n("config-_allow_leaks")){typeof _dojoIEListeners_=="undefined"&&(_dojoIEListeners_=[]);var s=t[r];if(!s||!s.listeners){var o=s;s=Function("event","var callee = arguments.callee; for(var i = 0; i<callee.listeners.length; i++){var listener = _dojoIEListeners_[callee.listeners[i]]; if(listener){listener.call(this,event);}}"),s.listeners=[],t[r]=s,s.global=this,o&&s.listeners.push(_dojoIEListeners_.push(o)-1)}var u;return s.listeners.push(u=s.global._dojoIEListeners_.push(i)-1),new v(u)}return e.after(t,r,i,!0)},y=function(e){e.keyChar=e.charCode?String.fromCharCode(e.charCode):"",e.charOrCode=e.keyChar||e.keyCode},b=function(){this.cancelBubble=!0},w=i._preventDefault=function(){this.bubbledKeyCode=this.keyCode;if(this.ctrlKey)try{this.keyCode=0}catch(e){}this.defaultPrevented=!0,this.returnValue=!1,this.modified=!0}}if(n("touch"))var E=function(){},S=window.orientation,x=function(e){return function(t){var r=t.corrected;if(!r){var i=t.type;try{delete t.type}catch(s){}if(t.type){if(n("mozilla")){var r={};for(var o in t)r[o]=t[o]}else{E.prototype=t;var r=new E}r.preventDefault=function(){t.preventDefault()},r.stopPropagation=function(){t.stopPropagation()}}else r=t,r.type=i;t.corrected=r;if(i=="resize")return S==window.orientation?null:(S=window.orientation,r.type="orientationchange",e.call(this,r));"rotation"in r||(r.rotation=0,r.scale=1);var u=r.changedTouches[0];for(var a in u)delete r[a],r[a]=u[a]}return e.call(this,r)}};return i}),define("dojo/Evented",["./aspect","./on"],function(e,t){function r(){}var n=e.after;return r.prototype={on:function(e,r){return t.parse(this,e,r,function(e,t){return n(e,"on"+t,r,!0)})},emit:function(e,n){var r=[this];return r.push.apply(r,arguments),t.emit.apply(t,r)}},r}),define("dojo/topic",["./Evented"],function(e){var t=new e;return{publish:function(e,n){return t.emit.apply(t,arguments)},subscribe:function(e,n){return t.on.apply(t,arguments)}}}),define("bpmn/execution/Instance",["bpmn/execution/TokenStore","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Deferred","dojo/topic"],function(e,t,n,r,i,s){var o={constructor:function(t,n,r,i){this.definitions=t,this.configuration=n,this.tokenStore=new e(r),this.variables=i?i:{},this.behaviours["bpmn.StartEvent"]=this.behaviours.takeAll,this.behaviours["bpmn.EndEvent"]=this.behaviours.takeNone,this.behaviours["bpmn.UserTask"]=this.behaviours.takeNone,this.behaviours["bpmn.ServiceTask"]=this.behaviours.takeAll,this.behaviours["bpmn.ExclusiveGateway"]=this.behaviours.xor,this.behaviours["bpmn.ParallelGateway"]=this.behaviours.and},behaviours:{takeAll:function(e){return this.dropToken(e.id(),this.tokenStore),e.outgoing()},takeNone:function(e){return[]},xor:function(e){this.dropToken(e.id(),this.tokenStore);if(e.outgoing().length==1)return e.outgoing();var t=null;n.map(e.outgoing(),function(e){var n=this.configuration[e.id()];!t&&n&&n(this)&&(t=e)},this);if(!t&&!e.getDefault())throw new Error("No transition evaluated to true and no default defined");return t},and:function(e){var t=!0,i=this.tokenStore.query(e.id()),s={};if(e.incoming().length==1)return r.hitch(this,this.behaviours.takeAll)(e);for(var o=0;o<i.length;o++){var u=i[o];s[u.from]=u}var a=[];return n.map(e.incoming(),function(e){s[e.id()]?a.push(e):t=!1},this),t?(n.map(a,function(e){r.hitch(this,this.dropToken)(e.sourceRef(),this.tokenStore)},this),r.hitch(this,this.behaviours.takeAll)(e)):[]}},dropToken:function(e,t,n){t.query(e).length>0&&t.drop(e,n?n:1)},copyVariables:function(e){if(e)for(var t in e)this.variables[t]=e[t]},start:function(e,t){return this.tokenStore.add(e,{from:null}),this.trigger(e,t)},trigger:function(e,t,n,o){console.log("trigger",e);var u=new i,o=o?o:new i;this.copyVariables(t);var a=this.definitions.index.item(e),f=n?this.behaviours[n]:this.behaviours[a.declaredClass],c=[].concat(r.hitch(this,f)(a,this.tokenStore));return console.log("next",c),c.length>0&&this.configuration.leave&&(this.configuration.leave(a),s.publish("flow:leave:"+a.id(),a)),c.length==0&&o.resolve(),c.map(function(e){this.tokenStore.add(e.targetRef(),{from:e.id()});var t="flow:enter:"+e.targetRef();s.publish(t,e.getTargetRef()),this.configuration.enter&&this.configuration.enter(e.getTargetRef());var n=this;u.then(function(){console.log("then for",e.id()),n.trigger(e.targetRef(),null,null,o)})},this),this.configuration[e]&&this.configuration[e]?this.configuration[e]({instance:this,promise:u}):(console.log("resolving",e,this.tokenStore.tokenMap),u.resolve()),o}};return t("bpmn.Instance",null,o)}),function(e){function n(t,r){if(!(this instanceof n))return new n(t,r);var s=this;i(s),s.q=s.c="",s.bufferCheckPosition=e.MAX_BUFFER_LENGTH,s.opt=r||{},s.opt.lowercase=s.opt.lowercase||s.opt.lowercasetags,s.looseCase=s.opt.lowercase?"toLowerCase":"toUpperCase",s.tags=[],s.closed=s.closedRoot=s.sawRoot=!1,s.tag=s.error=null,s.strict=!!t,s.noscript=!!t||!!s.opt.noscript,s.state=L.BEGIN,s.ENTITIES=Object.create(e.ENTITIES),s.attribList=[],s.opt.xmlns&&(s.ns=Object.create(E)),s.trackPosition=s.opt.position!==!1,s.trackPosition&&(s.position=s.line=s.column=0),A(s,"onready")}function r(n){var r=Math.max(e.MAX_BUFFER_LENGTH,10),i=0;for(var s=0,o=t.length;s<o;s++){var u=n[t[s]].length;if(u>r)switch(t[s]){case"textNode":M(n);break;case"cdata":O(n,"oncdata",n.cdata),n.cdata="";break;case"script":O(n,"onscript",n.script),n.script="";break;default:D(n,"Max buffer length exceeded: "+t[s])}i=Math.max(i,u)}n.bufferCheckPosition=e.MAX_BUFFER_LENGTH-i+n.position}function i(e){for(var n=0,r=t.length;n<r;n++)e[t[n]]=""}function s(e){M(e),e.cdata!==""&&(O(e,"oncdata",e.cdata),e.cdata=""),e.script!==""&&(O(e,"onscript",e.script),e.script="")}function f(e,t){return new l(e,t)}function l(e,t){if(!(this instanceof l))return new l(e,t);o.apply(this),this._parser=new n(e,t),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(e){r.emit("error",e),r._parser.error=null},this._decoder=null,a.forEach(function(e){Object.defineProperty(r,"on"+e,{get:function(){return r._parser["on"+e]},set:function(t){if(!t)return r.removeAllListeners(e),r._parser["on"+e]=t;r.on(e,t)},enumerable:!0,configurable:!1})})}function T(e){return e.split("").reduce(function(e,t){return e[t]=!0,e},{})}function N(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function C(e,t){return N(e)?!!t.match(e):e[t]}function k(e,t){return!C(e,t)}function A(e,t,n){e[t]&&e[t](n)}function O(e,t,n){e.textNode&&M(e),A(e,t,n)}function M(e){e.textNode=_(e.opt,e.textNode),e.textNode&&A(e,"ontext",e.textNode),e.textNode=""}function _(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function D(e,t){return M(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,A(e,"onerror",t),e}function P(e){return e.closedRoot||H(e,"Unclosed root tag"),e.state!==L.BEGIN&&e.state!==L.TEXT&&D(e,"Unexpected end"),M(e),e.c="",e.closed=!0,A(e,"onend"),n.call(e,e.strict,e.opt),e}function H(e,t){if(!(typeof e=="object"&&e instanceof n))throw new Error("bad call to strictFail");e.strict&&D(e,t)}function B(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0}function j(e,t){var n=e.indexOf(":"),r=n<0?["",e]:e.split(":"),i=r[0],s=r[1];return t&&e==="xmlns"&&(i="xmlns",s=""),{prefix:i,local:s}}function F(e){e.strict||(e.attribName=e.attribName[e.looseCase]());if(e.attribList.indexOf(e.attribName)!==-1||e.tag.attributes.hasOwnProperty(e.attribName))return e.attribName=e.attribValue="";if(e.opt.xmlns){var t=j(e.attribName,!0),n=t.prefix,r=t.local;if(n==="xmlns")if(r==="xml"&&e.attribValue!==b)H(e,"xml: prefix must be bound to "+b+"\n"+"Actual: "+e.attribValue);else if(r==="xmlns"&&e.attribValue!==w)H(e,"xmlns: prefix must be bound to "+w+"\n"+"Actual: "+e.attribValue);else{var i=e.tag,s=e.tags[e.tags.length-1]||e;i.ns===s.ns&&(i.ns=Object.create(s.ns)),i.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,O(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}function I(e,t){if(e.opt.xmlns){var n=e.tag,r=j(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(H(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var i=e.tags[e.tags.length-1]||e;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach(function(t){O(e,"onopennamespace",{prefix:t,uri:n.ns[t]})});for(var s=0,o=e.attribList.length;s<o;s++){var u=e.attribList[s],a=u[0],f=u[1],l=j(a,!0),c=l.prefix,h=l.local,p=c==""?"":n.ns[c]||"",d={name:a,value:f,prefix:c,local:h,uri:p};c&&c!="xmlns"&&!p&&(H(e,"Unbound namespace prefix: "+JSON.stringify(c)),d.uri=c),e.tag.attributes[a]=d,O(e,"onattribute",d)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),O(e,"onopentag",e.tag),t||(!e.noscript&&e.tagName.toLowerCase()==="script"?e.state=L.SCRIPT:e.state=L.TEXT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function q(e){if(!e.tagName){H(e,"Weird empty close tag."),e.textNode+="</>",e.state=L.TEXT;return}if(e.script){if(e.tagName!=="script"){e.script+="</"+e.tagName+">",e.tagName="",e.state=L.SCRIPT;return}O(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());var r=n;while(t--){var i=e.tags[t];if(i.name===r)break;H(e,"Unexpected close tag")}if(t<0){H(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",e.state=L.TEXT;return}e.tagName=n;var s=e.tags.length;while(s-->t){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,O(e,"onclosetag",e.tagName);var u={};for(var a in o.ns)u[a]=o.ns[a];var f=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==f.ns&&Object.keys(o.ns).forEach(function(t){var n=o.ns[t];O(e,"onclosenamespace",{prefix:t,uri:n})})}t===0&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=L.TEXT}function R(e){var t=e.entity,n=t.toLowerCase(),r,i="";return e.ENTITIES[t]?e.ENTITIES[t]:e.ENTITIES[n]?e.ENTITIES[n]:(t=n,t.charAt(0)==="#"&&(t.charAt(1)==="x"?(t=t.slice(2),r=parseInt(t,16),i=r.toString(16)):(t=t.slice(1),r=parseInt(t,10),i=r.toString(10))),t=t.replace(/^0+/,""),i.toLowerCase()!==t?(H(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(r))}function U(e){var t=this;if(this.error)throw this.error;if(t.closed)return D(t,"Cannot write after close. Assign an onready handler.");if(e===null)return P(t);var n=0,i="";while(t.c=i=e.charAt(n++)){t.trackPosition&&(t.position++,i==="\n"?(t.line++,t.column=0):t.column++);switch(t.state){case L.BEGIN:i==="<"?(t.state=L.OPEN_WAKA,t.startTagPosition=t.position):k(c,i)&&(H(t,"Non-whitespace before first tag."),t.textNode=i,t.state=L.TEXT);continue;case L.TEXT:if(t.sawRoot&&!t.closedRoot){var s=n-1;while(i&&i!=="<"&&i!=="&")i=e.charAt(n++),i&&t.trackPosition&&(t.position++,i==="\n"?(t.line++,t.column=0):t.column++);t.textNode+=e.substring(s,n-1)}i==="<"?(t.state=L.OPEN_WAKA,t.startTagPosition=t.position):(k(c,i)&&(!t.sawRoot||t.closedRoot)&&H(t,"Text data outside of root node."),i==="&"?t.state=L.TEXT_ENTITY:t.textNode+=i);continue;case L.SCRIPT:i==="<"?t.state=L.SCRIPT_ENDING:t.script+=i;continue;case L.SCRIPT_ENDING:i==="/"?t.state=L.CLOSE_TAG:(t.script+="<"+i,t.state=L.SCRIPT);continue;case L.OPEN_WAKA:if(i==="!")t.state=L.SGML_DECL,t.sgmlDecl="";else if(!C(c,i))if(C(S,i))t.state=L.OPEN_TAG,t.tagName=i;else if(i==="/")t.state=L.CLOSE_TAG,t.tagName="";else if(i==="?")t.state=L.PROC_INST,t.procInstName=t.procInstBody="";else{H(t,"Unencoded <");if(t.startTagPosition+1<t.position){var o=t.position-t.startTagPosition;i=(new Array(o)).join(" ")+i}t.textNode+="<"+i,t.state=L.TEXT}continue;case L.SGML_DECL:(t.sgmlDecl+i).toUpperCase()===g?(O(t,"onopencdata"),t.state=L.CDATA,t.sgmlDecl="",t.cdata=""):t.sgmlDecl+i==="--"?(t.state=L.COMMENT,t.comment="",t.sgmlDecl=""):(t.sgmlDecl+i).toUpperCase()===y?(t.state=L.DOCTYPE,(t.doctype||t.sawRoot)&&H(t,"Inappropriately located doctype declaration"),t.doctype="",t.sgmlDecl=""):i===">"?(O(t,"onsgmldeclaration",t.sgmlDecl),t.sgmlDecl="",t.state=L.TEXT):C(d,i)?(t.state=L.SGML_DECL_QUOTED,t.sgmlDecl+=i):t.sgmlDecl+=i;continue;case L.SGML_DECL_QUOTED:i===t.q&&(t.state=L.SGML_DECL,t.q=""),t.sgmlDecl+=i;continue;case L.DOCTYPE:i===">"?(t.state=L.TEXT,O(t,"ondoctype",t.doctype),t.doctype=!0):(t.doctype+=i,i==="["?t.state=L.DOCTYPE_DTD:C(d,i)&&(t.state=L.DOCTYPE_QUOTED,t.q=i));continue;case L.DOCTYPE_QUOTED:t.doctype+=i,i===t.q&&(t.q="",t.state=L.DOCTYPE);continue;case L.DOCTYPE_DTD:t.doctype+=i,i==="]"?t.state=L.DOCTYPE:C(d,i)&&(t.state=L.DOCTYPE_DTD_QUOTED,t.q=i);continue;case L.DOCTYPE_DTD_QUOTED:t.doctype+=i,i===t.q&&(t.state=L.DOCTYPE_DTD,t.q="");continue;case L.COMMENT:i==="-"?t.state=L.COMMENT_ENDING:t.comment+=i;continue;case L.COMMENT_ENDING:i==="-"?(t.state=L.COMMENT_ENDED,t.comment=_(t.opt,t.comment),t.comment&&O(t,"oncomment",t.comment),t.comment=""):(t.comment+="-"+i,t.state=L.COMMENT);continue;case L.COMMENT_ENDED:i!==">"?(H(t,"Malformed comment"),t.comment+="--"+i,t.state=L.COMMENT):t.state=L.TEXT;continue;case L.CDATA:i==="]"?t.state=L.CDATA_ENDING:t.cdata+=i;continue;case L.CDATA_ENDING:i==="]"?t.state=L.CDATA_ENDING_2:(t.cdata+="]"+i,t.state=L.CDATA);continue;case L.CDATA_ENDING_2:i===">"?(t.cdata&&O(t,"oncdata",t.cdata),O(t,"onclosecdata"),t.cdata="",t.state=L.TEXT):i==="]"?t.cdata+="]":(t.cdata+="]]"+i,t.state=L.CDATA);continue;case L.PROC_INST:i==="?"?t.state=L.PROC_INST_ENDING:C(c,i)?t.state=L.PROC_INST_BODY:t.procInstName+=i;continue;case L.PROC_INST_BODY:if(!t.procInstBody&&C(c,i))continue;i==="?"?t.state=L.PROC_INST_ENDING:t.procInstBody+=i;continue;case L.PROC_INST_ENDING:i===">"?(O(t,"onprocessinginstruction",{name:t.procInstName,body:t.procInstBody}),t.procInstName=t.procInstBody="",t.state=L.TEXT):(t.procInstBody+="?"+i,t.state=L.PROC_INST_BODY);continue;case L.OPEN_TAG:C(x,i)?t.tagName+=i:(B(t),i===">"?I(t):i==="/"?t.state=L.OPEN_TAG_SLASH:(k(c,i)&&H(t,"Invalid character in tag name"),t.state=L.ATTRIB));continue;case L.OPEN_TAG_SLASH:i===">"?(I(t,!0),q(t)):(H(t,"Forward-slash in opening tag not followed by >"),t.state=L.ATTRIB);continue;case L.ATTRIB:if(C(c,i))continue;i===">"?I(t):i==="/"?t.state=L.OPEN_TAG_SLASH:C(S,i)?(t.attribName=i,t.attribValue="",t.state=L.ATTRIB_NAME):H(t,"Invalid attribute name");continue;case L.ATTRIB_NAME:i==="="?t.state=L.ATTRIB_VALUE:i===">"?(H(t,"Attribute without value"),t.attribValue=t.attribName,F(t),I(t)):C(c,i)?t.state=L.ATTRIB_NAME_SAW_WHITE:C(x,i)?t.attribName+=i:H(t,"Invalid attribute name");continue;case L.ATTRIB_NAME_SAW_WHITE:if(i==="=")t.state=L.ATTRIB_VALUE;else{if(C(c,i))continue;H(t,"Attribute without value"),t.tag.attributes[t.attribName]="",t.attribValue="",O(t,"onattribute",{name:t.attribName,value:""}),t.attribName="",i===">"?I(t):C(S,i)?(t.attribName=i,t.state=L.ATTRIB_NAME):(H(t,"Invalid attribute name"),t.state=L.ATTRIB)}continue;case L.ATTRIB_VALUE:if(C(c,i))continue;C(d,i)?(t.q=i,t.state=L.ATTRIB_VALUE_QUOTED):(H(t,"Unquoted attribute value"),t.state=L.ATTRIB_VALUE_UNQUOTED,t.attribValue=i);continue;case L.ATTRIB_VALUE_QUOTED:if(i!==t.q){i==="&"?t.state=L.ATTRIB_VALUE_ENTITY_Q:t.attribValue+=i;continue}F(t),t.q="",t.state=L.ATTRIB_VALUE_CLOSED;continue;case L.ATTRIB_VALUE_CLOSED:C(c,i)?t.state=L.ATTRIB:i===">"?I(t):i==="/"?t.state=L.OPEN_TAG_SLASH:C(S,i)?(H(t,"No whitespace between attributes"),t.attribName=i,t.attribValue="",t.state=L.ATTRIB_NAME):H(t,"Invalid attribute name");continue;case L.ATTRIB_VALUE_UNQUOTED:if(k(m,i)){i==="&"?t.state=L.ATTRIB_VALUE_ENTITY_U:t.attribValue+=i;continue}F(t),i===">"?I(t):t.state=L.ATTRIB;continue;case L.CLOSE_TAG:if(!t.tagName){if(C(c,i))continue;k(S,i)?t.script?(t.script+="</"+i,t.state=L.SCRIPT):H(t,"Invalid tagname in closing tag."):t.tagName=i}else i===">"?q(t):C(x,i)?t.tagName+=i:t.script?(t.script+="</"+t.tagName,t.tagName="",t.state=L.SCRIPT):(k(c,i)&&H(t,"Invalid tagname in closing tag"),t.state=L.CLOSE_TAG_SAW_WHITE);continue;case L.CLOSE_TAG_SAW_WHITE:if(C(c,i))continue;i===">"?q(t):H(t,"Invalid characters in closing tag");continue;case L.TEXT_ENTITY:case L.ATTRIB_VALUE_ENTITY_Q:case L.ATTRIB_VALUE_ENTITY_U:switch(t.state){case L.TEXT_ENTITY:var u=L.TEXT,a="textNode";break;case L.ATTRIB_VALUE_ENTITY_Q:var u=L.ATTRIB_VALUE_QUOTED,a="attribValue";break;case L.ATTRIB_VALUE_ENTITY_U:var u=L.ATTRIB_VALUE_UNQUOTED,a="attribValue"}i===";"?(t[a]+=R(t),t.entity="",t.state=u):C(v,i)?t.entity+=i:(H(t,"Invalid character entity"),t[a]+="&"+t.entity+i,t.entity="",t.state=u);continue;default:throw new Error(t,"Unknown state: "+t.state)}}return t.position>=t.bufferCheckPosition&&r(t),t}e.parser=function(e,t){return new n(e,t)},e.SAXParser=n,e.SAXStream=l,e.createStream=f,e.MAX_BUFFER_LENGTH=65536;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),n.prototype={end:function(){P(this)},write:U,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){s(this)}};try{var o=require("stream").Stream}catch(u){var o=function(){}}var a=e.EVENTS.filter(function(e){return e!=="error"&&e!=="end"});l.prototype=Object.create(o.prototype,{constructor:{value:l}}),l.prototype.write=function(e){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(e)){if(!this._decoder){var t=require("string_decoder").StringDecoder;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},l.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},l.prototype.on=function(e,t){var n=this;return!n._parser["on"+e]&&a.indexOf(e)!==-1&&(n._parser["on"+e]=function(){var t=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),o.prototype.on.call(n,e,t)};var c="\r\n	 ",h="0124356789",p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",d="'\"",v=h+p+"#",m=c+">",g="[CDATA[",y="DOCTYPE",b="http://www.w3.org/XML/1998/namespace",w="http://www.w3.org/2000/xmlns/",E={xml:b,xmlns:w};c=T(c),h=T(h),p=T(p);var S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,x=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;d=T(d),v=T(v),m=T(m);var L=0;e.STATE={BEGIN:L++,TEXT:L++,TEXT_ENTITY:L++,OPEN_WAKA:L++,SGML_DECL:L++,SGML_DECL_QUOTED:L++,DOCTYPE:L++,DOCTYPE_QUOTED:L++,DOCTYPE_DTD:L++,DOCTYPE_DTD_QUOTED:L++,COMMENT_STARTING:L++,COMMENT:L++,COMMENT_ENDING:L++,COMMENT_ENDED:L++,CDATA:L++,CDATA_ENDING:L++,CDATA_ENDING_2:L++,PROC_INST:L++,PROC_INST_BODY:L++,PROC_INST_ENDING:L++,OPEN_TAG:L++,OPEN_TAG_SLASH:L++,ATTRIB:L++,ATTRIB_NAME:L++,ATTRIB_NAME_SAW_WHITE:L++,ATTRIB_VALUE:L++,ATTRIB_VALUE_QUOTED:L++,ATTRIB_VALUE_CLOSED:L++,ATTRIB_VALUE_UNQUOTED:L++,ATTRIB_VALUE_ENTITY_Q:L++,ATTRIB_VALUE_ENTITY_U:L++,CLOSE_TAG:L++,CLOSE_TAG_SAW_WHITE:L++,SCRIPT:L++,SCRIPT_ENDING:L++},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var n=e.ENTITIES[t],r=typeof n=="number"?String.fromCharCode(n):n;e.ENTITIES[t]=r});for(var L in e.STATE)e.STATE[e.STATE[L]]=L;L=e.STATE,String.fromCodePoint||function(){var e=String.fromCharCode,t=Math.floor,n=function(){var n=16384,r=[],i,s,o=-1,u=arguments.length;if(!u)return"";var a="";while(++o<u){var f=Number(arguments[o]);if(!isFinite(f)||f<0||f>1114111||t(f)!=f)throw RangeError("Invalid code point: "+f);f<=65535?r.push(f):(f-=65536,i=(f>>10)+55296,s=f%1024+56320,r.push(i,s));if(o+1==u||r.length>n)a+=e.apply(null,r),r.length=0}return a};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:n,configurable:!0,writable:!0}):String.fromCodePoint=n}()}(typeof exports=="undefined"?sax={}:exports),define("sax",function(e){return function(){var t,n;return t||e.sax}}(this)),define("bpmn/util/Serializer",["dojo/_base/declare","bpmn/Package","bpmn/Definitions","bpmn/BaseElement","sax"],function(e,t,n,r){var i={constructor:function(){},fromXML:function(e){if(!e)return;var i=function(e,t,n,r){if(t.attributes[e]){var i=t.attributes[e].value;r=="float"&&(i=parseFloat(i)),r=="boolean"&&(i=i.toLowerCase()=="true"),r=="integer"&&(i=parseInt(i)),n[e](i)}},s=sax.parser(!0,{xmlns:!0,lowercase:!0,trim:!0});s.stack=[],Array.prototype.peek=function(){return this.length==0?null:this[this.length-1]};var o={definitions:function(e){s.definitions=new n,s.stack.push(s.definitions)},"default":function(e){var n=s.stack.peek(),o=e.local.toLowerCase(),u=t.tagMap[o]?t.tagMap[o]():new r;s.stack.push(u),u._definitions=s.definitions;for(var a in u.attribute)i(a,e,u,u.attribute[a].type);var f=null;for(var l in n.reference){var c=n.reference[l];if(u.isInstanceOf(c.type)){f=c;break}}u.init(),f&&f.containment===!0?n[f.name]().push(u):f&&n[f.name](u)}};return s.onerror=function(e){console.log("error",e)},s.onopentag=function(e){o[e.local]?o[e.local](e):o["default"](e)},s.onclosetag=function(e){s.stack.pop()},s.ontext=function(e){s.stack.peek().setText(e)},s.onend=function(){},s.write(e).close(),s.definitions}};return e("bpmn.util.Serializer",null,i)});var Kinetic={};(function(e){var t=Math.PI/180;Kinetic={version:"5.1.1",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:undefined,dragDistance:0,angleDeg:!0,UA:function(){var t=e.navigator&&e.navigator.userAgent||"",n=t.toLowerCase(),r=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[],i=!!t.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);return{browser:r[1]||"",version:r[2]||"0",mobile:i}}(),Filters:{},Node:function(e){this._init(e)},Shape:function(e){this.__init(e)},Container:function(e){this.__init(e)},Stage:function(e){this.___init(e)},BaseLayer:function(e){this.___init(e)},Layer:function(e){this.____init(e)},FastLayer:function(e){this.____init(e)},Group:function(e){this.___init(e)},isDragging:function(){var e=Kinetic.DD;return e?e.isDragging:!1},isDragReady:function(){var e=Kinetic.DD;return e?!!e.node:!1},_addId:function(e,t){t!==undefined&&(this.ids[t]=e)},_removeId:function(e){e!==undefined&&delete this.ids[e]},_addName:function(e,t){t!==undefined&&(this.names[t]===undefined&&(this.names[t]=[]),this.names[t].push(e))},_removeName:function(e,t){if(e!==undefined){var n=this.names[e];if(n!==undefined){for(var r=0;r<n.length;r++){var i=n[r];i._id===t&&n.splice(r,1)}n.length===0&&delete this.names[e]}}},getAngle:function(e){return this.angleDeg?e*t:e}}})(this),function(e,t){if(typeof exports=="object"){var n=t();if(global.window===global)Kinetic.document=global.document,Kinetic.window=global;else{var r=require("canvas"),i=require("jsdom").jsdom,s=i("<!DOCTYPE html><html><head></head><body></body></html>");Kinetic.document=s,Kinetic.window=Kinetic.document.createWindow(),Kinetic.window.Image=r.Image,Kinetic._nodeCanvas=r}Kinetic.root=e,module.exports=n;return}typeof define=="function"&&define.amd&&define("kinetic",t),Kinetic.document=document,Kinetic.window=window,Kinetic.root=e}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var e=[].slice.call(arguments),t=e.length,n=0;this.length=t;for(;n<t;n++)this[n]=e[n];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(e){for(var t=0;t<this.length;t++)e(this[t],t)},Kinetic.Collection.prototype.toArray=function(){var e=[],t=this.length,n;for(n=0;n<t;n++)e.push(this[n]);return e},Kinetic.Collection.toCollection=function(e){var t=new Kinetic.Collection,n=e.length,r;for(r=0;r<n;r++)t.push(e[r]);return t},Kinetic.Collection._mapMethod=function(e){Kinetic.Collection.prototype[e]=function(){var t=this.length,n,r=[].slice.call(arguments);for(n=0;n<t;n++)this[n][e].apply(this[n],r);return this}},Kinetic.Collection.mapMethods=function(e){var t=e.prototype;for(var n in t)Kinetic.Collection._mapMethod(n)},Kinetic.Transform=function(e){this.m=e&&e.slice()||[1,0,0,1,0,0]},Kinetic.Transform.prototype={copy:function(){return new Kinetic.Transform(this.m)},point:function(e){var t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}},translate:function(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this},scale:function(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,s=this.m[0]*-n+this.m[2]*t,o=this.m[1]*-n+this.m[3]*t;return this.m[0]=r,this.m[1]=i,this.m[2]=s,this.m[3]=o,this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(e,t){var n=this.m[0]+this.m[2]*t,r=this.m[1]+this.m[3]*t,i=this.m[2]+this.m[0]*e,s=this.m[3]+this.m[1]*e;return this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=s,this},multiply:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],i=this.m[1]*e.m[2]+this.m[3]*e.m[3],s=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],o=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o,this},invert:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,i=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o,this},getMatrix:function(){return this.m},setAbsolutePosition:function(e,t){var n=this.m[0],r=this.m[1],i=this.m[2],s=this.m[3],o=this.m[4],u=this.m[5],a=(n*(t-u)-r*(e-o))/(n*s-r*i),f=(e-o-i*a)/n;return this.translate(f,a)}};var e="canvas",t="2d",n="[object Array]",r="[object Number]",i="[object String]",s=Math.PI/180,o=180/Math.PI,u="#",a="",f="0",l="Kinetic warning: ",c="Kinetic error: ",h="rgb(",p={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(e){return!!e&&e.nodeType==1},_isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isObject:function(e){return!!e&&e.constructor==Object},_isArray:function(e){return Object.prototype.toString.call(e)==n},_isNumber:function(e){return Object.prototype.toString.call(e)==r},_isString:function(e){return Object.prototype.toString.call(e)==i},_throttle:function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:(new Date).getTime(),o=null,s=e.apply(r,i),r=i=null};return function(){var f=(new Date).getTime();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),r=i=null):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},_hasMethods:function(e){var t=[],n;for(n in e)this._isFunction(e[n])&&t.push(n);return t.length>0},createCanvasElement:function(){var e=Kinetic.document.createElement("canvas");return e.style=e.style||{},e},isBrowser:function(){return typeof exports!="object"},_isInDocument:function(e){while(e=e.parentNode)if(e==Kinetic.document)return!0;return!1},_simplifyArray:function(e){var t=[],n=e.length,r=Kinetic.Util,i,s;for(i=0;i<n;i++)s=e[i],r._isNumber(s)?s=Math.round(s*1e3)/1e3:r._isString(s)||(s=s.toString()),t.push(s);return t},_getImage:function(e,n){var r,i;if(!e)n(null);else if(this._isElement(e))n(e);else if(this._isString(e))r=new Kinetic.window.Image,r.onload=function(){n(r)},r.src=e;else if(e.data){i=Kinetic.Util.createCanvasElement(),i.width=e.width,i.height=e.height;var s=i.getContext(t);s.putImageData(e,0,0),this._getImage(i.toDataURL(),n)}else n(null)},_getRGBAString:function(e){var t=e.red||0,n=e.green||0,r=e.blue||0,i=e.alpha||1;return["rgba(",t,",",n,",",r,",",i,")"].join(a)},_rgbToHex:function(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},_hexToRgb:function(e){e=e.replace(u,a);var t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:t&255}},getRandomColor:function(){var e=(Math.random()*16777215<<0).toString(16);while(e.length<6)e=f+e;return u+e},get:function(e,t){return e===undefined?t:e},getRGB:function(e){var t;return e in p?(t=p[e],{r:t[0],g:t[1],b:t[2]}):e[0]===u?this._hexToRgb(e.substring(1)):e.substr(0,4)===h?(t=d.exec(e.replace(/ /g,"")),{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}):{r:0,g:0,b:0}},_merge:function(e,t){var n=this._clone(t);for(var r in e)this._isObject(e[r])?n[r]=this._merge(e[r],n[r]):n[r]=e[r];return n},cloneObject:function(e){var t={};for(var n in e)this._isObject(e[n])?t[n]=this.cloneObject(e[n]):this._isArray(e[n])?t[n]=this.cloneArray(e[n]):t[n]=e[n];return t},cloneArray:function(e){return e.slice(0)},_degToRad:function(e){return e*s},_radToDeg:function(e){return e*o},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},error:function(e){throw new Error(c+e)},warn:function(e){Kinetic.root.console&&console.warn&&console.warn(l+e)},extend:function(e,t){for(var n in t.prototype)n in e.prototype||(e.prototype[n]=t.prototype[n])},addMethods:function(e,t){var n;for(n in t)e.prototype[n]=t[n]},_getControlPoints:function(e,t,n,r,i,s,o){var u=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),a=Math.sqrt(Math.pow(i-n,2)+Math.pow(s-r,2)),f=o*u/(u+a),l=o*a/(u+a),c=n-f*(i-e),h=r-f*(s-t),p=n+l*(i-e),d=r+l*(s-t);return[c,h,p,d]},_expandPoints:function(e,t){var n=e.length,r=[],i,s;for(i=2;i<n-2;i+=2)s=Kinetic.Util._getControlPoints(e[i-2],e[i-1],e[i],e[i+1],e[i+2],e[i+3],t),r.push(s[0]),r.push(s[1]),r.push(e[i]),r.push(e[i+1]),r.push(s[2]),r.push(s[3]);return r},_removeLastLetter:function(e){return e.substring(0,e.length-1)}}}(),function(){var e=Kinetic.Util.createCanvasElement(),t=e.getContext("2d"),n=Kinetic.UA.mobile?function(){var e=window.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return e/n}():1;Kinetic.Canvas=function(e){this.init(e)},Kinetic.Canvas.prototype={init:function(e){e=e||{};var t=e.pixelRatio||Kinetic.pixelRatio||n;this.pixelRatio=t,this._canvas=Kinetic.Util.createCanvasElement(),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(e){this.pixelRatio=e,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px"},setHeight:function(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(e,t){this.setWidth(e),this.setHeight(t)},toDataURL:function(e,t){try{return this._canvas.toDataURL(e,t)}catch(n){try{return this._canvas.toDataURL()}catch(r){return Kinetic.Util.warn("Unable to get data URL. "+r.message),""}}}},Kinetic.SceneCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e),this.context=new Kinetic.SceneContext(this),this.setSize(t,n)},Kinetic.SceneCanvas.prototype={setWidth:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,e),n.scale(t,t)},setHeight:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,e),n.scale(t,t)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e),this.context=new Kinetic.HitContext(this),this.setSize(t,n)},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var e=",",t="(",n=")",r="([",i="])",s=";",o="()",u="=",a=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(e){this.init(e)},Kinetic.Context.prototype={init:function(e){this.canvas=e,this._context=e._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(e){e.getFillEnabled()&&this._fill(e)},strokeShape:function(e){e.getStrokeEnabled()&&this._stroke(e)},fillStrokeShape:function(e){var t=e.getFillEnabled();t&&this._fill(e),e.getStrokeEnabled()&&this._stroke(e)},getTrace:function(a){var f=this.traceArr,l=f.length,c="",h,p,d,v;for(h=0;h<l;h++)p=f[h],d=p.method,d?(v=p.args,c+=d,a?c+=o:Kinetic.Util._isArray(v[0])?c+=r+v.join(e)+i:c+=t+v.join(e)+n):(c+=p.property,a||(c+=u+p.val)),c+=s;return c},clearTrace:function(){this.traceArr=[]},_trace:function(e){var t=this.traceArr,n;t.push(e),n=t.length,n>=Kinetic.traceArrMax&&t.shift()},reset:function(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)},getCanvas:function(){return this.canvas},clear:function(e){var t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth(),t.getHeight())},_applyLineCap:function(e){var t=e.getLineCap();t&&this.setAttr("lineCap",t)},_applyOpacity:function(e){var t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)},_applyLineJoin:function(e){var t=e.getLineJoin();t&&this.setAttr("lineJoin",t)},setAttr:function(e,t){this._context[e]=t},arc:function(){var e=arguments;this._context.arc(e[0],e[1],e[2],e[3],e[4],e[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var e=arguments;this._context.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])},clearRect:function(){var e=arguments;this._context.clearRect(e[0],e[1],e[2],e[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var e=arguments;if(e.length===2)return this._context.createImageData(e[0],e[1]);if(e.length===1)return this._context.createImageData(e[0])},createLinearGradient:function(){var e=arguments;return this._context.createLinearGradient(e[0],e[1],e[2],e[3])},createPattern:function(){var e=arguments;return this._context.createPattern(e[0],e[1])},createRadialGradient:function(){var e=arguments;return this._context.createRadialGradient(e[0],e[1],e[2],e[3],e[4],e[5])},drawImage:function(){var e=arguments,t=this._context;e.length===3?t.drawImage(e[0],e[1],e[2]):e.length===5?t.drawImage(e[0],e[1],e[2],e[3],e[4]):e.length===9&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},fill:function(){this._context.fill()},fillText:function(){var e=arguments;this._context.fillText(e[0],e[1],e[2])},getImageData:function(){var e=arguments;return this._context.getImageData(e[0],e[1],e[2],e[3])},lineTo:function(){var e=arguments;this._context.lineTo(e[0],e[1])},moveTo:function(){var e=arguments;this._context.moveTo(e[0],e[1])},rect:function(){var e=arguments;this._context.rect(e[0],e[1],e[2],e[3])},putImageData:function(){var e=arguments;this._context.putImageData(e[0],e[1],e[2])},quadraticCurveTo:function(){var e=arguments;this._context.quadraticCurveTo(e[0],e[1],e[2],e[3])},restore:function(){this._context.restore()},rotate:function(){var e=arguments;this._context.rotate(e[0])},save:function(){this._context.save()},scale:function(){var e=arguments;this._context.scale(e[0],e[1])},setLineDash:function(){var e=arguments,t=this._context;this._context.setLineDash?t.setLineDash(e[0]):"mozDash"in t?t.mozDash=e[0]:"webkitLineDash"in t&&(t.webkitLineDash=e[0])},setTransform:function(){var e=arguments;this._context.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},stroke:function(){this._context.stroke()},strokeText:function(){var e=arguments;this._context.strokeText(e[0],e[1],e[2])},transform:function(){var e=arguments;this._context.transform(e[0],e[1],e[2],e[3],e[4],e[5])},translate:function(){var e=arguments;this._context.translate(e[0],e[1])},_enableTrace:function(){var e=this,t=a.length,n=Kinetic.Util._simplifyArray,r=this.setAttr,i,s,o=function(t){var r=e[t],i;e[t]=function(){return s=n(Array.prototype.slice.call(arguments,0)),i=r.apply(e,arguments),e._trace({method:t,args:s}),i}};for(i=0;i<t;i++)o(a[i]);e.setAttr=function(){r.apply(e,arguments),e._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(e){Kinetic.Context.call(this,e)},Kinetic.SceneContext.prototype={_fillColor:function(e){var t=e.fill()||Kinetic.Util._getRGBAString({red:e.fillRed(),green:e.fillGreen(),blue:e.fillBlue(),alpha:e.fillAlpha()});this.setAttr("fillStyle",t),e._fillFunc(this)},_fillPattern:function(e){var t=e.getFillPatternImage(),n=e.getFillPatternX(),r=e.getFillPatternY(),i=e.getFillPatternScale(),s=Kinetic.getAngle(e.getFillPatternRotation()),o=e.getFillPatternOffset(),u=e.getFillPatternRepeat();(n||r)&&this.translate(n||0,r||0),s&&this.rotate(s),i&&this.scale(i.x,i.y),o&&this.translate(-1*o.x,-1*o.y),this.setAttr("fillStyle",this.createPattern(t,u||"repeat")),this.fill()},_fillLinearGradient:function(e){var t=e.getFillLinearGradientStartPoint(),n=e.getFillLinearGradientEndPoint(),r=e.getFillLinearGradientColorStops(),i=this.createLinearGradient(t.x,t.y,n.x,n.y);if(r){for(var s=0;s<r.length;s+=2)i.addColorStop(r[s],r[s+1]);this.setAttr("fillStyle",i),this.fill()}},_fillRadialGradient:function(e){var t=e.getFillRadialGradientStartPoint(),n=e.getFillRadialGradientEndPoint(),r=e.getFillRadialGradientStartRadius(),i=e.getFillRadialGradientEndRadius(),s=e.getFillRadialGradientColorStops(),o=this.createRadialGradient(t.x,t.y,r,n.x,n.y,i);for(var u=0;u<s.length;u+=2)o.addColorStop(s[u],s[u+1]);this.setAttr("fillStyle",o),this.fill()},_fill:function(e){var t=e.fill()||e.fillRed()||e.fillGreen()||e.fillBlue(),n=e.getFillPatternImage(),r=e.getFillLinearGradientColorStops(),i=e.getFillRadialGradientColorStops(),s=e.getFillPriority();t&&s==="color"?this._fillColor(e):n&&s==="pattern"?this._fillPattern(e):r&&s==="linear-gradient"?this._fillLinearGradient(e):i&&s==="radial-gradient"?this._fillRadialGradient(e):t?this._fillColor(e):n?this._fillPattern(e):r?this._fillLinearGradient(e):i&&this._fillRadialGradient(e)},_stroke:function(e){var t=e.dash(),n=e.getStrokeScaleEnabled();e.hasStroke()&&(n||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(e),t&&e.dashEnabled()&&this.setLineDash(t),this.setAttr("lineWidth",e.strokeWidth()),this.setAttr("strokeStyle",e.stroke()||Kinetic.Util._getRGBAString({red:e.strokeRed(),green:e.strokeGreen(),blue:e.strokeBlue(),alpha:e.strokeAlpha()})),e._strokeFunc(this),n||this.restore())},_applyShadow:function(e){var t=Kinetic.Util,n=e.getAbsoluteOpacity(),r=t.get(e.getShadowColor(),"black"),i=t.get(e.getShadowBlur(),5),s=t.get(e.getShadowOpacity(),1),o=t.get(e.getShadowOffset(),{x:0,y:0});s&&this.setAttr("globalAlpha",s*n),this.setAttr("shadowColor",r),this.setAttr("shadowBlur",i),this.setAttr("shadowOffsetX",o.x),this.setAttr("shadowOffsetY",o.y)}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(e){Kinetic.Context.call(this,e)},Kinetic.HitContext.prototype={_fill:function(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()},_stroke:function(e){e.hasStroke()&&(this._applyLineCap(e),this.setAttr("lineWidth",e.strokeWidth()),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this))}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var e="absoluteOpacity",t="absoluteTransform",n="add",r="b",i="before",s="black",o="Change",u="children",a="Deg",f=".",l="",c="g",h="get",p="#",d="id",v="kinetic",m="listening",g="mouseenter",y="mouseleave",b="name",w="off",E="on",S="_get",x="r",T="RGB",N="set",C="Shape",k=" ",L="Stage",A="transform",O="B",M="G",_="Height",D="R",P="Width",H="X",B="Y",j="visible",F="x",I="y";Kinetic.Factory={addGetterSetter:function(e,t,n,r,i){this.addGetter(e,t,n),this.addSetter(e,t,r,i),this.addOverloadedGetterSetter(e,t)},addGetter:function(e,t,n){var r=h+Kinetic.Util._capitalize(t);e.prototype[r]=function(){var e=this.attrs[t];return e===undefined?n:e}},addSetter:function(e,t,n,r){var i=N+Kinetic.Util._capitalize(t);e.prototype[i]=function(e){return n&&(e=n.call(this,e)),this._setAttr(t,e),r&&r.call(this),this}},addComponentsGetterSetter:function(e,t,n,r,i){var s=n.length,o=Kinetic.Util._capitalize,u=h+o(t),a=N+o(t),f,l;e.prototype[u]=function(){var e={};for(f=0;f<s;f++)l=n[f],e[l]=this.getAttr(t+o(l));return e},e.prototype[a]=function(e){var n=this.attrs[t],s;r&&(e=r.call(this,e));for(s in e)this._setAttr(t+o(s),e[s]);return this._fireChangeEvent(t,n,e),i&&i.call(this),this},this.addOverloadedGetterSetter(e,t)},addOverloadedGetterSetter:function(e,t){var n=Kinetic.Util._capitalize(t),r=N+n,i=h+n;e.prototype[t]=function(){return arguments.length?(this[r](arguments[0]),this):this[i]()}},backCompat:function(e,t){var n;for(n in t)e.prototype[n]=e.prototype[t[n]]},afterSetFilter:function(){this._filterUpToDate=!1}},Kinetic.Validators={RGBComponent:function(e){return e>255?255:e<0?0:Math.round(e)},alphaComponent:function(e){return e>1?1:e<1e-4?1e-4:e}}}(),function(){var e="absoluteOpacity",t="absoluteTransform",n="before",r="Change",i="children",s=".",o="",u="get",a="id",f="kinetic",l="listening",c="mouseenter",h="mouseleave",p="name",d="set",v="Shape",m=" ",g="stage",y="transform",b="Stage",w="visible",E=["id"],S=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(m);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(n){var r=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this._cache={},this._filterUpToDate=!1,this.setAttrs(n),this.on(S,function(){this._clearCache(y),r._clearSelfAndDescendantCache(t)}),this.on("visibleChange.kinetic",function(){r._clearSelfAndDescendantCache(w)}),this.on("listeningChange.kinetic",function(){r._clearSelfAndDescendantCache(l)}),this.on("opacityChange.kinetic",function(){r._clearSelfAndDescendantCache(e)})},_clearCache:function(e){e?delete this._cache[e]:this._cache={}},_getCache:function(e,t){var n=this._cache[e];return n===undefined&&(this._cache[e]=t.call(this)),this._cache[e]},_clearSelfAndDescendantCache:function(e){this._clearCache(e),this.children&&this.getChildren().each(function(t){t._clearSelfAndDescendantCache(e)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(e){var t=e||{},n=t.x||0,r=t.y||0,i=t.width||this.width(),s=t.height||this.height(),o=t.drawBorder||!1,u=this.getLayer();if(i===0||s===0){Kinetic.Util.warn("Width or height of caching configuration equals 0. Cache is ignored.");return}var a=new Kinetic.SceneCanvas({pixelRatio:1,width:i,height:s}),f=new Kinetic.SceneCanvas({pixelRatio:1,width:i,height:s}),l=new Kinetic.HitCanvas({width:i,height:s}),c=this.transformsEnabled(),h=this.x(),p=this.y(),d=a.getContext(),v=l.getContext();return l.isCache=!0,this.clearCache(),d.save(),v.save(),o&&(d.save(),d.beginPath(),d.rect(0,0,i,s),d.closePath(),d.setAttr("strokeStyle","red"),d.setAttr("lineWidth",5),d.stroke(),d.restore()),d.translate(n*-1,r*-1),v.translate(n*-1,r*-1),this.nodeType==="Shape"&&u&&(d.translate(this.x()*-1,this.y()*-1),v.translate(this.x()*-1,this.y()*-1)),this.drawScene(a,this),this.drawHit(l,this),d.restore(),v.restore(),this._cache.canvas={scene:a,filter:f,hit:l},this},_drawCachedSceneCanvas:function(e){e.save(),this.getLayer()._applyTransform(this,e),e.drawImage(this._getCachedSceneCanvas()._canvas,0,0),e.restore()},_getCachedSceneCanvas:function(){var e=this.filters(),t=this._cache.canvas,n=t.scene,r=t.filter,i=r.getContext(),s,o,u,a;if(e){if(!this._filterUpToDate){try{s=e.length,i.clear(),i.drawImage(n._canvas,0,0),o=i.getImageData(0,0,r.getWidth(),r.getHeight());for(u=0;u<s;u++)a=e[u],a.call(this,o),i.putImageData(o,0,0)}catch(f){Kinetic.Util.warn("Unable to apply filter. "+f.message)}this._filterUpToDate=!0}return r}return n},_drawCachedHitCanvas:function(e){var t=this._cache.canvas,n=t.hit;e.save(),this.getLayer()._applyTransform(this,e),e.drawImage(n._canvas,0,0),e.restore()},on:function(e,t){var n=e.split(m),r=n.length,i,u,a,f,l;for(i=0;i<r;i++)u=n[i],a=u.split(s),f=a[0],l=a[1]||o,this.eventListeners[f]||(this.eventListeners[f]=[]),this.eventListeners[f].push({name:l,handler:t});return this},off:function(e){var t=e.split(m),n=t.length,r,i,o,u,a,f;for(r=0;r<n;r++){o=t[r],u=o.split(s),a=u[0],f=u[1];if(a)this.eventListeners[a]&&this._off(a,f);else for(i in this.eventListeners)this._off(i,f)}return this},dispatchEvent:function(e){var t={target:this,type:e.type,evt:e};this.fire(e.type,t)},addEventListener:function(e,t){this.on(e,function(e){t.call(this,e.evt)})},removeEventListener:function(e){this.off(e)},remove:function(){var n=this.getParent();return n&&n.children&&(n.children.splice(this.index,1),n._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache(g),this._clearSelfAndDescendantCache(t),this._clearSelfAndDescendantCache(w),this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(e),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(e){var t=u+Kinetic.Util._capitalize(e);return Kinetic.Util._isFunction(this[t])?this[t]():this.attrs[e]},getAncestors:function(){var e=this.getParent(),t=new Kinetic.Collection;while(e)t.push(e),e=e.getParent();return t},getAttrs:function(){return this.attrs||{}},setAttrs:function(e){var t,n;if(e)for(t in e)t!==i&&(n=d+Kinetic.Util._capitalize(t),Kinetic.Util._isFunction(this[n])?this[n](e[t]):this._setAttr(t,e[t]));return this},isListening:function(){return this._getCache(l,this._isListening)},_isListening:function(){var e=this.getListening(),t=this.getParent();return e==="inherit"?t?t.isListening():!0:e},isVisible:function(){return this._getCache(w,this._isVisible)},_isVisible:function(){var e=this.getVisible(),t=this.getParent();return e==="inherit"?t?t.isVisible():!0:e},shouldDrawHit:function(e){var t=this.getLayer();return(e&&e.isCache||t&&t.hitGraphEnabled())&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function u(a){r=[],i=a.length;for(s=0;s<i;s++)o=a[s],n++,o.nodeType!==v&&(r=r.concat(o.getChildren().toArray())),o._id===t._id&&(s=i);r.length>0&&r[0].getDepth()<=e&&u(r)}var e=this.getDepth(),t=this,n=0,r,i,s,o;return t.nodeType!==b&&u(t.getStage().getChildren()),n},getDepth:function(){var e=0,t=this.parent;while(t)e++,t=t.parent;return e},setPosition:function(e){return this.setX(e.x),this.setY(e.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var e=this.getAbsoluteTransform().getMatrix(),t=new Kinetic.Transform,n=this.offset();return t.m=e.slice(),t.translate(n.x,n.y),t.getTranslation()},setAbsolutePosition:function(e){var t=this._clearTransform(),n;return this.attrs.x=t.x,this.attrs.y=t.y,delete t.x,delete t.y,n=this.getAbsoluteTransform(),n.invert(),n.translate(e.x,e.y),e={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this.setPosition({x:e.x,y:e.y}),this._setTransform(t),this},_setTransform:function(e){var n;for(n in e)this.attrs[n]=e[n];this._clearCache(y),this._clearSelfAndDescendantCache(t)},_clearTransform:function(){var e={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(y),this._clearSelfAndDescendantCache(t),e},move:function(e){var t=e.x,n=e.y,r=this.getX(),i=this.getY();return t!==undefined&&(r+=t),n!==undefined&&(i+=n),this.setPosition({x:r,y:i}),this},_eachAncestorReverse:function(e,t){var n=[],r=this.getParent(),i,s;if(t&&t._id===this._id)return e(this),!0;n.unshift(this);while(r&&(!t||r._id!==t._id))n.unshift(r),r=r.parent;i=n.length;for(s=0;s<i;s++)e(n[s])},rotate:function(e){return this.setRotation(this.getRotation()+e),this},moveToTop:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveToTop function is ignored.");return}var e=this.index;return this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveUp function is ignored.");return}var e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveDown function is ignored.");return}var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){if(!this.parent){Kinetic.Util.warn("Node has no parent. moveToBottom function is ignored.");return}var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(e){if(!this.parent){Kinetic.Util.warn("Node has no parent. zIndex parameter is ignored.");return}var t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(e,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var e=this.getOpacity();return this.getParent()&&(e*=this.getParent().getAbsoluteOpacity()),e},moveTo:function(e){return Kinetic.Node.prototype.remove.call(this),e.add(this),this},toObject:function(){var e=Kinetic.Util,t={},n=this.getAttrs(),r,i,s,o;t.attrs={};for(r in n)i=n[r],!e._isFunction(i)&&!e._isElement(i)&&(!e._isObject(i)||!e._hasMethods(i))&&(s=this[r],delete n[r],o=s?s.call(this):null,n[r]=i,o!==i&&(t.attrs[r]=i));return t.className=this.getClassName(),t},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var e=this.getParent();return e?e.getLayer():null},getStage:function(){return this._getCache(g,this._getStage)},_getStage:function(){var e=this.getParent();return e?e.getStage():undefined},fire:function(e,t,n){return n?this._fireAndBubble(e,t||{}):this._fire(e,t||{}),this},getAbsoluteTransform:function(e){return e?this._getAbsoluteTransform(e):this._getCache(t,this._getAbsoluteTransform)},_getAbsoluteTransform:function(e){var t=new Kinetic.Transform,n,r;return this._eachAncestorReverse(function(e){n=e.transformsEnabled(),r=e.getTransform(),n==="all"?t.multiply(r):n==="position"&&t.translate(e.x(),e.y())},e),t},getTransform:function(){return this._getCache(y,this._getTransform)},_getTransform:function(){var e=new Kinetic.Transform,t=this.getX(),n=this.getY(),r=Kinetic.getAngle(this.getRotation()),i=this.getScaleX(),s=this.getScaleY(),o=this.getSkewX(),u=this.getSkewY(),a=this.getOffsetX(),f=this.getOffsetY();return(t!==0||n!==0)&&e.translate(t,n),r!==0&&e.rotate(r),(o!==0||u!==0)&&e.skew(o,u),(i!==1||s!==1)&&e.scale(i,s),(a!==0||f!==0)&&e.translate(-1*a,-1*f),e},clone:function(e){var t=this.getClassName(),n=Kinetic.Util.cloneObject(this.attrs),r,i,s,o,u;for(var a in E){var l=E[a];delete n[l]}for(r in e)n[r]=e[r];var c=new Kinetic[t](n);for(r in this.eventListeners){i=this.eventListeners[r],s=i.length;for(o=0;o<s;o++)u=i[o],u.name.indexOf(f)<0&&(c.eventListeners[r]||(c.eventListeners[r]=[]),c.eventListeners[r].push(u))}return c},toDataURL:function(e){e=e||{};var t=e.mimeType||null,n=e.quality||null,r=this.getStage(),i=e.x||0,s=e.y||0,o=new Kinetic.SceneCanvas({width:e.width||this.getWidth()||(r?r.getWidth():0),height:e.height||this.getHeight()||(r?r.getHeight():0),pixelRatio:1}),u=o.getContext();return u.save(),(i||s)&&u.translate(-1*i,-1*s),this.drawScene(o),u.restore(),o.toDataURL(t,n)},toImage:function(e){Kinetic.Util._getImage(this.toDataURL(e),function(t){e.callback(t)})},setSize:function(e){return this.setWidth(e.width),this.setHeight(e.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return this.attrs.dragDistance!==undefined?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Kinetic.dragDistance},_get:function(e){return this.className===e||this.nodeType===e?[this]:[]},_off:function(e,t){var n=this.eventListeners[e],r,i;for(r=0;r<n.length;r++){i=n[r].name;if((i!=="kinetic"||t==="kinetic")&&(!t||i===t)){n.splice(r,1);if(n.length===0){delete this.eventListeners[e];break}r--}}},_fireChangeEvent:function(e,t,n){this._fire(e+r,{oldVal:t,newVal:n})},setId:function(e){var t=this.getId();return Kinetic._removeId(t),Kinetic._addId(this,e),this._setAttr(a,e),this},setName:function(e){var t=this.getName();return Kinetic._removeName(t,this._id),Kinetic._addName(this,e),this._setAttr(p,e),this},setAttr:function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],r=d+Kinetic.Util._capitalize(t),i=this[r];return Kinetic.Util._isFunction(i)?i.call(this,n):this._setAttr(t,n),this},_setAttr:function(e,t){var n;t!==undefined&&(n=this.attrs[e],this.attrs[e]=t,this._fireChangeEvent(e,n,t))},_setComponentAttr:function(e,t,n){var r;n!==undefined&&(r=this.attrs[e],r||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=n,this._fireChangeEvent(e,r,n))},_fireAndBubble:function(e,t,n){var r=!0;t&&this.nodeType===v&&(t.target=this),e===c&&n&&(this._id===n._id||this.isAncestorOf&&this.isAncestorOf(n))?r=!1:e===h&&n&&(this._id===n._id||this.isAncestorOf&&this.isAncestorOf(n))&&(r=!1);if(r){this._fire(e,t);var i=(e===c||e===h)&&(n&&n.isAncestorOf&&n.isAncestorOf(this)||!!n&&!!n.isAncestorOf);t&&!t.cancelBubble&&this.parent&&this.parent.isListening()&&!i&&(n&&n.parent?this._fireAndBubble.call(this.parent,e,t,n.parent):this._fireAndBubble.call(this.parent,e,t))}},_fire:function(e,t){var n=this.eventListeners[e],r;t.type=e;if(n)for(r=0;r<n.length;r++)n[r].handler.call(this,t)},draw:function(){return this.drawScene(),this.drawHit(),this}}),Kinetic.Node.create=function(e,t){return this._createNode(JSON.parse(e),t)},Kinetic.Node._createNode=function(e,t){var n=Kinetic.Node.prototype.getClassName.call(e),r=e.children,i,s,o;t&&(e.attrs.container=t),i=new Kinetic[n](e.attrs);if(r){s=r.length;for(o=0;o<s;o++)i.add(this._createNode(r[o]))}return i},Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0),Kinetic.Factory.addSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addSetter(Kinetic.Node,"width",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",undefined,function(e){return this._filterUpToDate=!1,e}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"size"),Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Kinetic.Collection.mapMethods(Kinetic.Node)}(),function(){Kinetic.Filters.Grayscale=function(e){var t=e.data,n=t.length,r,i;for(r=0;r<n;r+=4)i=.34*t[r]+.5*t[r+1]+.16*t[r+2],t[r]=i,t[r+1]=i,t[r+2]=i}}(),function(){Kinetic.Filters.Brighten=function(e){var t=this.brightness()*255,n=e.data,r=n.length,i;for(i=0;i<r;i+=4)n[i]+=t,n[i+1]+=t,n[i+2]+=t},Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Invert=function(e){var t=e.data,n=t.length,r;for(r=0;r<n;r+=4)t[r]=255-t[r],t[r+1]=255-t[r+1],t[r+2]=255-t[r+2]}}(),function(){function e(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function r(r,i){var s=r.data,o=r.width,u=r.height,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=i+i+1,D=o-1,P=u-1,H=i+1,B=H*(H+1)/2,j=new e,F=null,I=j,q=null,R=null,U=t[i],z=n[i];for(l=1;l<_;l++)I=I.next=new e,l==H&&(F=I);I.next=j,d=p=0;for(f=0;f<u;f++){x=T=N=C=v=m=g=y=0,b=H*(k=s[p]),w=H*(L=s[p+1]),E=H*(A=s[p+2]),S=H*(O=s[p+3]),v+=B*k,m+=B*L,g+=B*A,y+=B*O,I=j;for(l=0;l<H;l++)I.r=k,I.g=L,I.b=A,I.a=O,I=I.next;for(l=1;l<H;l++)c=p+((D<l?D:l)<<2),v+=(I.r=k=s[c])*(M=H-l),m+=(I.g=L=s[c+1])*M,g+=(I.b=A=s[c+2])*M,y+=(I.a=O=s[c+3])*M,x+=k,T+=L,N+=A,C+=O,I=I.next;q=j,R=F;for(a=0;a<o;a++)s[p+3]=O=y*U>>z,O!==0?(O=255/O,s[p]=(v*U>>z)*O,s[p+1]=(m*U>>z)*O,s[p+2]=(g*U>>z)*O):s[p]=s[p+1]=s[p+2]=0,v-=b,m-=w,g-=E,y-=S,b-=q.r,w-=q.g,E-=q.b,S-=q.a,c=d+((c=a+i+1)<D?c:D)<<2,x+=q.r=s[c],T+=q.g=s[c+1],N+=q.b=s[c+2],C+=q.a=s[c+3],v+=x,m+=T,g+=N,y+=C,q=q.next,b+=k=R.r,w+=L=R.g,E+=A=R.b,S+=O=R.a,x-=k,T-=L,N-=A,C-=O,R=R.next,p+=4;d+=o}for(a=0;a<o;a++){T=N=C=x=m=g=y=v=0,p=a<<2,b=H*(k=s[p]),w=H*(L=s[p+1]),E=H*(A=s[p+2]),S=H*(O=s[p+3]),v+=B*k,m+=B*L,g+=B*A,y+=B*O,I=j;for(l=0;l<H;l++)I.r=k,I.g=L,I.b=A,I.a=O,I=I.next;h=o;for(l=1;l<=i;l++)p=h+a<<2,v+=(I.r=k=s[p])*(M=H-l),m+=(I.g=L=s[p+1])*M,g+=(I.b=A=s[p+2])*M,y+=(I.a=O=s[p+3])*M,x+=k,T+=L,N+=A,C+=O,I=I.next,l<P&&(h+=o);p=a,q=j,R=F;for(f=0;f<u;f++)c=p<<2,s[c+3]=O=y*U>>z,O>0?(O=255/O,s[c]=(v*U>>z)*O,s[c+1]=(m*U>>z)*O,s[c+2]=(g*U>>z)*O):s[c]=s[c+1]=s[c+2]=0,v-=b,m-=w,g-=E,y-=S,b-=q.r,w-=q.g,E-=q.b,S-=q.a,c=a+((c=f+H)<P?c:P)*o<<2,v+=x+=q.r=s[c],m+=T+=q.g=s[c+1],g+=N+=q.b=s[c+2],y+=C+=q.a=s[c+3],q=q.next,b+=k=R.r,w+=L=R.g,E+=A=R.b,S+=O=R.a,x-=k,T-=L,N-=A,C-=O,R=R.next,p+=o}}var t=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],n=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(t){var n=Math.round(this.blurRadius());n>0&&r(t,n)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function e(e,t,n){var r=(n*e.width+t)*4,i=[];return i.push(e.data[r++],e.data[r++],e.data[r++],e.data[r++]),i}function t(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function n(e){var t=[0,0,0];for(var n=0;n<e.length;n++)t[0]+=e[n][0],t[1]+=e[n][1],t[2]+=e[n][2];return t[0]/=e.length,t[1]/=e.length,t[2]/=e.length,t}function r(r,i){var s=e(r,0,0),o=e(r,r.width-1,0),u=e(r,0,r.height-1),a=e(r,r.width-1,r.height-1),f=i||10;if(t(s,o)<f&&t(o,a)<f&&t(a,u)<f&&t(u,s)<f){var l=n([o,s,a,u]),c=[];for(var h=0;h<r.width*r.height;h++){var p=t(l,[r.data[h*4],r.data[h*4+1],r.data[h*4+2]]);c[h]=p<f?0:255}return c}}function i(e,t){for(var n=0;n<e.width*e.height;n++)e.data[4*n+3]=t[n]}function s(e,t,n){var r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(var u=0;u<n;u++)for(var a=0;a<t;a++){var f=u*t+a,l=0;for(var c=0;c<i;c++)for(var h=0;h<i;h++){var p=u+c-s,d=a+h-s;if(p>=0&&p<n&&d>=0&&d<t){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l===2040?255:0}return o}function o(e,t,n){var r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(var u=0;u<n;u++)for(var a=0;a<t;a++){var f=u*t+a,l=0;for(var c=0;c<i;c++)for(var h=0;h<i;h++){var p=u+c-s,d=a+h-s;if(p>=0&&p<n&&d>=0&&d<t){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l>=1020?255:0}return o}function u(e,t,n){var r=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(var u=0;u<n;u++)for(var a=0;a<t;a++){var f=u*t+a,l=0;for(var c=0;c<i;c++)for(var h=0;h<i;h++){var p=u+c-s,d=a+h-s;if(p>=0&&p<n&&d>=0&&d<t){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l}return o}Kinetic.Filters.Mask=function(e){var t=this.threshold(),n=r(e,t);return n&&(n=s(n,e.width,e.height),n=o(n,e.width,e.height),n=u(n,e.width,e.height),i(e,n)),e},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.RGB=function(e){var t=e.data,n=t.length,r=this.red(),i=this.green(),s=this.blue(),o,u;for(o=0;o<n;o+=4)u=(.34*t[o]+.5*t[o+1]+.16*t[o+2])/255,t[o]=u*r,t[o+1]=u*i,t[o+2]=u*s,t[o+3]=t[o+3]},Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(e){return this._filterUpToDate=!1,e>255?255:e<0?0:Math.round(e)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(e){return this._filterUpToDate=!1,e>255?255:e<0?0:Math.round(e)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.HSV=function(e){var t=e.data,n=t.length,r=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o,u=r*i*Math.cos(s*Math.PI/180),a=r*i*Math.sin(s*Math.PI/180),f=.299*r+.701*u+.167*a,l=.587*r-.587*u+.33*a,c=.114*r-.114*u-.497*a,h=.299*r-.299*u-.328*a,p=.587*r+.413*u+.035*a,d=.114*r-.114*u+.293*a,v=.299*r-.3*u+1.25*a,m=.587*r-.586*u-1.05*a,g=.114*r+.886*u-.2*a,y,b,w,E;for(o=0;o<n;o+=4)y=t[o+0],b=t[o+1],w=t[o+2],E=t[o+3],t[o+0]=f*y+l*b+c*w,t[o+1]=h*y+p*b+d*w,t[o+2]=v*y+m*b+g*w,t[o+3]=E},Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"luminance",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Filters.HSL=function(e){var t=e.data,n=t.length,r=1,i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=this.luminance()*127,u,a=r*i*Math.cos(s*Math.PI/180),f=r*i*Math.sin(s*Math.PI/180),l=.299*r+.701*a+.167*f,c=.587*r-.587*a+.33*f,h=.114*r-.114*a-.497*f,p=.299*r-.299*a-.328*f,d=.587*r+.413*a+.035*f,v=.114*r-.114*a+.293*f,m=.299*r-.3*a+1.25*f,g=.587*r-.586*a-1.05*f,y=.114*r+.886*a-.2*f,b,w,E,S;for(u=0;u<n;u+=4)b=t[u+0],w=t[u+1],E=t[u+2],S=t[u+3],t[u+0]=l*b+c*w+h*E+o,t[u+1]=p*b+d*w+v*E+o,t[u+2]=m*b+g*w+y*E+o,t[u+3]=S}}(),function(){Kinetic.Filters.Emboss=function(e){var t=this.embossStrength()*10,n=this.embossWhiteLevel()*255,r=this.embossDirection(),i=this.embossBlend(),s=0,o=0,u=e.data,a=e.width,f=e.height,l=a*4,c=f;switch(r){case"top-left":s=-1,o=-1;break;case"top":s=-1,o=0;break;case"top-right":s=-1,o=1;break;case"right":s=0,o=1;break;case"bottom-right":s=1,o=1;break;case"bottom":s=1,o=0;break;case"bottom-left":s=1,o=-1;break;case"left":s=0,o=-1}do{var h=(c-1)*l,p=s;c+p<1&&(p=0),c+p>f&&(p=0);var d=(c-1+p)*a*4,v=a;do{var m=h+(v-1)*4,g=o;v+g<1&&(g=0),v+g>a&&(g=0);var y=d+(v-1+g)*4,b=u[m]-u[y],w=u[m+1]-u[y+1],E=u[m+2]-u[y+2],S=b,x=S>0?S:-S,T=w>0?w:-w,N=E>0?E:-E;T>x&&(S=w),N>x&&(S=E),S*=t;if(i){var C=u[m]+S,k=u[m+1]+S,L=u[m+2]+S;u[m]=C>255?255:C<0?0:C,u[m+1]=k>255?255:k<0?0:k,u[m+2]=L>255?255:L<0?0:L}else{var A=n-S;A<0?A=0:A>255&&(A=255),u[m]=u[m+1]=u[m+2]=A}}while(--v)}while(--c)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossWhiteLevel",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",!1,null,Kinetic.Factory.afterSetFilter)}(),function(){function e(e,t,n,r,i){var s=n-t,o=i-r,u;return s===0?r+o/2:o===0?r:(u=(e-t)/s,u=o*u+r,u)}Kinetic.Filters.Enhance=function(t){var n=t.data,r=n.length,i=n[0],s=i,o,u=n[1],a=u,f,l=n[2],c=l,h,p=n[3],d=p,v,m=this.enhance();if(m===0)return;for(v=0;v<r;v+=4)o=n[v+0],o<i?i=o:o>s&&(s=o),f=n[v+1],f<u?u=f:f>a&&(a=f),h=n[v+2],h<l?l=h:h>c&&(c=h);s===i&&(s=255,i=0),a===u&&(a=255,u=0),c===l&&(c=255,l=0),d===p&&(d=255,p=0);var g,y,b,w,E,S,x,T,N,C,k,L;m>0?(y=s+m*(255-s),b=i-m*(i-0),E=a+m*(255-a),S=u-m*(u-0),T=c+m*(255-c),L=l-m*(l-0),k=d+m*(255-d),N=p-m*(p-0)):(g=(s+i)*.5,y=s+m*(s-g),b=i+m*(i-g),w=(a+u)*.5,E=a+m*(a-w),S=u+m*(u-w),x=(c+l)*.5,T=c+m*(c-x),L=l+m*(l-x),C=(d+p)*.5,k=d+m*(d-C),N=p+m*(p-C));for(v=0;v<r;v+=4)n[v+0]=e(n[v+0],i,s,b,y),n[v+1]=e(n[v+1],u,a,S,E),n[v+2]=e(n[v+2],l,c,L,T)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Posterize=function(e){var t=Math.round(this.levels()*254)+1,n=e.data,r=n.length,i=255/t,s;for(s=0;s<r;s+=1)n[s]=Math.floor(n[s]/i)*i},Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Noise=function(e){var t=this.noise()*255,n=e.data,r=n.length,i=t/2,s;for(s=0;s<r;s+=4)n[s+0]+=i-2*i*Math.random(),n[s+1]+=i-2*i*Math.random(),n[s+2]+=i-2*i*Math.random()},Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",.2,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Pixelate=function(e){var t=Math.ceil(this.pixelSize()),n=e.width,r=e.height,i,s,o,u,a,f,l,c=Math.ceil(n/t),h=Math.ceil(r/t),p,d,v,m,g,y,b;e=e.data;for(g=0;g<c;g+=1)for(y=0;y<h;y+=1){u=0,a=0,f=0,l=0,p=g*t,d=p+t,v=y*t,m=v+t,b=0;for(i=p;i<d;i+=1){if(i>=n)continue;for(s=v;s<m;s+=1){if(s>=r)continue;o=(n*s+i)*4,u+=e[o+0],a+=e[o+1],f+=e[o+2],l+=e[o+3],b+=1}}u/=b,a/=b,f/=b;for(i=p;i<d;i+=1){if(i>=n)continue;for(s=v;s<m;s+=1){if(s>=r)continue;o=(n*s+i)*4,e[o+0]=u,e[o+1]=a,e[o+2]=f,e[o+3]=l}}}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"pixelSize",8,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Threshold=function(e){var t=this.threshold()*255,n=e.data,r=n.length,i;for(i=0;i<r;i+=1)n[i]=n[i]<t?0:255},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Sepia=function(e){var t=e.data,n=e.width,r=e.height,i=n*4,s,o,u,a,f,l,c,h,p;do{s=(r-1)*i,o=n;do u=s+(o-1)*4,a=t[u],f=t[u+1],l=t[u+2],c=a*.393+f*.769+l*.189,h=a*.349+f*.686+l*.168,p=a*.272+f*.534+l*.131,t[u]=c>255?255:c,t[u+1]=h>255?255:h,t[u+2]=p>255?255:p,t[u+3]=t[u+3];while(--o)}while(--r)}}(),function(){Kinetic.Filters.Solarize=function(e){var t=e.data,n=e.width,r=e.height,i=n*4,s=r;do{var o=(s-1)*i,u=n;do{var a=o+(u-1)*4,f=t[a],l=t[a+1],c=t[a+2];f>127&&(f=255-f),l>127&&(l=255-l),c>127&&(c=255-c),t[a]=f,t[a+1]=l,t[a+2]=c}while(--u)}while(--s)}}(),function(){var e=function(e,t,n){var r=e.data,i=t.data,s=e.width,o=e.height,u=n.polarCenterX||s/2,a=n.polarCenterY||o/2,f,l,c,h=0,p=0,d=0,v=0,m,g=Math.sqrt(u*u+a*a);l=s-u,c=o-a,m=Math.sqrt(l*l+c*c),g=m>g?m:g;var y=o,b=s,w,E,S=360/b*Math.PI/180,x,T;for(E=0;E<b;E+=1){x=Math.sin(E*S),T=Math.cos(E*S);for(w=0;w<y;w+=1)l=Math.floor(u+g*w/y*T),c=Math.floor(a+g*w/y*x),f=(c*s+l)*4,h=r[f+0],p=r[f+1],d=r[f+2],v=r[f+3],f=(E+w*s)*4,i[f+0]=h,i[f+1]=p,i[f+2]=d,i[f+3]=v}},t=function(e,t,n){var r=e.data,i=t.data,s=e.width,o=e.height,u=n.polarCenterX||s/2,a=n.polarCenterY||o/2,f,l,c,h,p,d=0,v=0,m=0,g=0,y,b=Math.sqrt(u*u+a*a);l=s-u,c=o-a,y=Math.sqrt(l*l+c*c),b=y>b?y:b;var w=o,E=s,S,x,T=n.polarRotation||0,N,C;for(l=0;l<s;l+=1)for(c=0;c<o;c+=1)h=l-u,p=c-a,S=Math.sqrt(h*h+p*p)*w/b,x=(Math.atan2(p,h)*180/Math.PI+360+T)%360,x=x*E/360,N=Math.floor(x),C=Math.floor(S),f=(C*s+N)*4,d=r[f+0],v=r[f+1],m=r[f+2],g=r[f+3],f=(c*s+l)*4,i[f+0]=d,i[f+1]=v,i[f+2]=m,i[f+3]=g},n=Kinetic.Util.createCanvasElement();Kinetic.Filters.Kaleidoscope=function(r){var i=r.width,s=r.height,o,u,a,f,l,c,h,p,d,v,m=Math.round(this.kaleidoscopePower()),g=Math.round(this.kaleidoscopeAngle()),y=Math.floor(i*(g%360)/360);if(m<1)return;n.width=i,n.height=s;var b=n.getContext("2d").getImageData(0,0,i,s);e(r,b,{polarCenterX:i/2,polarCenterY:s/2});var w=i/Math.pow(2,m);while(w<=8)w*=2,m-=1;w=Math.ceil(w);var E=w,S=0,x=E,T=1;y+w>i&&(S=E,x=0,T=-1);for(u=0;u<s;u+=1)for(o=S;o!==x;o+=T)a=Math.round(o+y)%i,d=(i*u+a)*4,l=b.data[d+0],c=b.data[d+1],h=b.data[d+2],p=b.data[d+3],v=(i*u+o)*4,b.data[v+0]=l,b.data[v+1]=c,b.data[v+2]=h,b.data[v+3]=p;for(u=0;u<s;u+=1){E=Math.floor(w);for(f=0;f<m;f+=1){for(o=0;o<E+1;o+=1)d=(i*u+o)*4,l=b.data[d+0],c=b.data[d+1],h=b.data[d+2],p=b.data[d+3],v=(i*u+E*2-o-1)*4,b.data[v+0]=l,b.data[v+1]=c,b.data[v+2]=h,b.data[v+3]=p;E*=2}}t(b,r,{polarRotation:0})},Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function r(e){setTimeout(e,1e3/60)}function i(){return n.apply(Kinetic.root,arguments)}var e=500,t=function(){return Kinetic.root.performance&&Kinetic.root.performance.now?function(){return Kinetic.root.performance.now()}:function(){return(new Date).getTime()}}(),n=function(){return Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||r}();Kinetic.Animation=function(e,n){var r=Kinetic.Animation;this.func=e,this.setLayers(n),this.id=r.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:t()}},Kinetic.Animation.prototype={setLayers:function(e){var t=[];e?e.length>0?t=e:t=[e]:t=[],this.layers=t},getLayers:function(){return this.layers},addLayer:function(e){var t=this.layers,n,r;if(t){n=t.length;for(r=0;r<n;r++)if(t[r]._id===e._id)return!1}else this.layers=[];return this.layers.push(e),!0},isRunning:function(){var e=Kinetic.Animation,t=e.animations,n=t.length,r;for(r=0;r<n;r++)if(t[r].id===this.id)return!0;return!1},start:function(){var e=Kinetic.Animation;this.stop(),this.frame.timeDiff=0,this.frame.lastTime=t(),e._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(e){this.animations.push(e),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(e){var t=e.id,n=this.animations,r=n.length,i;for(i=0;i<r;i++)if(n[i].id===t){this.animations.splice(i,1);break}},Kinetic.Animation._runFrames=function(){var e={},n=this.animations,r,i,s,o,u,a,f,l,c=!1;for(o=0;o<n.length;o++){r=n[o],i=r.layers,s=r.func,r._updateFrameObject(t()),a=i.length;for(u=0;u<a;u++)f=i[u],f._id!==undefined&&(e[f._id]=f);s&&(c=s.call(r,r.frame)!==!1||c)}if(c)for(l in e)e[l].draw()},Kinetic.Animation._animationLoop=function(){var e=Kinetic.Animation;e.animations.length?(i(e._animationLoop),e._runFrames()):e.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var e=this;this.animRunning||(this.animRunning=!0,e._animationLoop())};var s=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(e){s.call(this,e)},Kinetic.BaseLayer.prototype.batchDraw=function(){var n=this,r=Kinetic.Animation;this.batchAnim||(this.batchAnim=new r(function(){n.lastBatchDrawTime&&t()-n.lastBatchDrawTime>e&&n.batchAnim.stop()},this)),this.lastBatchDrawTime=t(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(e){e.batchDraw()})}}(this),function(){var e={node:1,duration:1,easing:1,onFinish:1,yoyo:1},t=1,n=2,r=3,i=0;Kinetic.Tween=function(t){var n=this,r=t.node,o=r._id,u=t.duration||1,a=t.easing||Kinetic.Easings.Linear,f=!!t.yoyo,l;this.node=r,this._id=i++,this.anim=new Kinetic.Animation(function(){n.tween.onEnterFrame()},r.getLayer()),this.tween=new s(l,function(e){n._tweenFunc(e)},a,0,1,u*1e3,f),this._addListeners(),Kinetic.Tween.attrs[o]||(Kinetic.Tween.attrs[o]={}),Kinetic.Tween.attrs[o][this._id]||(Kinetic.Tween.attrs[o][this._id]={}),Kinetic.Tween.tweens[o]||(Kinetic.Tween.tweens[o]={});for(l in t)e[l]===undefined&&this._addAttr(l,t[l]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(e,t){var n=this.node,r=n._id,i,s,o,u,a;o=Kinetic.Tween.tweens[r][e],o&&delete Kinetic.Tween.attrs[r][o][e],i=n.getAttr(e);if(Kinetic.Util._isArray(t)){s=[],a=t.length;for(u=0;u<a;u++)s.push(t[u]-i[u])}else s=t-i;Kinetic.Tween.attrs[r][this._id][e]={start:i,diff:s},Kinetic.Tween.tweens[r][e]=this._id},_tweenFunc:function(e){var t=this.node,n=Kinetic.Tween.attrs[t._id][this._id],r,i,s,o,u,a,f;for(r in n){i=n[r],s=i.start,o=i.diff;if(Kinetic.Util._isArray(s)){u=[],f=s.length;for(a=0;a<f;a++)u.push(s[a]+o[a]*e)}else u=s+o*e;t.setAttr(r,u)}},_addListeners:function(){var e=this;this.tween.onPlay=function(){e.anim.start()},this.tween.onReverse=function(){e.anim.start()},this.tween.onPause=function(){e.anim.stop()},this.tween.onFinish=function(){e.onFinish&&e.onFinish()},this.tween.onReset=function(){e.onReset&&e.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var e=this.node;return this.tween.reset(),this},seek:function(e){var t=this.node;return this.tween.seek(e*1e3),this},pause:function(){return this.tween.pause(),this},finish:function(){var e=this.node;return this.tween.finish(),this},destroy:function(){var e=this.node._id,t=this._id,n=Kinetic.Tween.tweens[e],r;this.pause();for(r in n)delete Kinetic.Tween.tweens[e][r];delete Kinetic.Tween.attrs[e][t]}};var s=function(e,t,n,r,i,s,o){this.prop=e,this.propFunc=t,this.begin=r,this._pos=r,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=o,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=i-this.begin,this.pause()};s.prototype={fire:function(e){var t=this[e];t&&t()},setTime:function(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():e<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())},getTime:function(){return this._time},setPosition:function(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e},getPosition:function(e){return e===undefined&&(e=this._time),this.func(e,this.begin,this._change,this.duration)},play:function(){this.state=n,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=r,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var e=this.getTimer()-this._startTime;this.state===n?this.setTime(e):this.state===r&&this.setTime(this.duration-e)},pause:function(){this.state=t,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(e,t,n,r){var i=1.70158;return n*(e/=r)*e*((i+1)*e-i)+t},BackEaseOut:function(e,t,n,r){var i=1.70158;return n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},BackEaseInOut:function(e,t,n,r){var i=1.70158;return(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},ElasticEaseIn:function(e,t,n,r,i,s){var o=0;return e===0?t:(e/=r)==1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t)},ElasticEaseOut:function(e,t,n,r,i,s){var o=0;return e===0?t:(e/=r)==1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},ElasticEaseInOut:function(e,t,n,r,i,s){var o=0;return e===0?t:(e/=r/2)==2?t+n:(s||(s=r*.3*1.5),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),e<1?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t)},BounceEaseOut:function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},BounceEaseIn:function(e,t,n,r){return n-Kinetic.Easings.BounceEaseOut(r-e,0,n,r)+t},BounceEaseInOut:function(e,t,n,r){return e<r/2?Kinetic.Easings.BounceEaseIn(e*2,0,n,r)*.5+t:Kinetic.Easings.BounceEaseOut(e*2-r,0,n,r)*.5+n*.5+t},EaseIn:function(e,t,n,r){return n*(e/=r)*e+t},EaseOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},EaseInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},StrongEaseIn:function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},StrongEaseOut:function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},StrongEaseInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},Linear:function(e,t,n,r){return n*e/r+t}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation(function(e){var t=this.dirty;return this.dirty=!1,t}),isDragging:!1,justDragged:!1,offset:{x:0,y:0},node:null,_drag:function(e){var t=Kinetic.DD,n=t.node;if(n){if(!t.isDragging){var r=n.getStage().getPointerPosition(),i=n.dragDistance(),s=Math.max(Math.abs(r.x-t.startPointerPos.x),Math.abs(r.y-t.startPointerPos.y));if(s<i)return}n._setDragPosition(e),t.isDragging||(t.isDragging=!0,n.fire("dragstart",{type:"dragstart",target:n,evt:e},!0)),n.fire("dragmove",{type:"dragmove",target:n,evt:e},!0)}},_endDragBefore:function(e){var t=Kinetic.DD,n=t.node,r,i;n&&(r=n.nodeType,i=n.getLayer(),t.anim.stop(),t.isDragging&&(t.isDragging=!1,t.justDragged=!0,Kinetic.listenClickTap=!1,e&&(e.dragEndNode=n)),delete t.node,(i||n).draw())},_endDragAfter:function(e){e=e||{};var t=e.dragEndNode;e&&t&&t.fire("dragend",{type:"dragend",target:t,evt:e},!0)}},Kinetic.Node.prototype.startDrag=function(){var e=Kinetic.DD,t=this.getStage(),n=this.getLayer(),r=t.getPointerPosition(),i=this.getAbsolutePosition();r&&(e.node&&e.node.stopDrag(),e.node=this,e.startPointerPos=r,e.offset.x=r.x-i.x,e.offset.y=r.y-i.y,e.anim.setLayers(n||this.getLayers()),e.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(e){var t=Kinetic.DD,n=this.getStage().getPointerPosition(),r=this.getDragBoundFunc();if(!n)return;var i={x:n.x-t.offset.x,y:n.y-t.offset.y};r!==undefined&&(i=r.call(this,i,e)),this.setAbsolutePosition(i);if(!this._lastPos||this._lastPos.x!==i.x||this._lastPos.y!==i.y)t.anim.dirty=!0;this._lastPos=i},Kinetic.Node.prototype.stopDrag=function(){var e=Kinetic.DD,t={};e._endDragBefore(t),e._endDragAfter(t)},Kinetic.Node.prototype.setDraggable=function(e){this._setAttr("draggable",e),this._dragChange()};var e=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var t=Kinetic.DD;t.node&&t.node._id===this._id&&this.stopDrag(),e.call(this)},Kinetic.Node.prototype.isDragging=function(){var e=Kinetic.DD;return e.node&&e.node._id===this._id&&e.isDragging},Kinetic.Node.prototype._listenDrag=function(){var e=this;this._dragCleanup(),this.getClassName()==="Stage"?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(t){Kinetic.DD.node||e.startDrag(t)}):this.on("mousedown.kinetic touchstart.kinetic",function(t){Kinetic.DD.node||e.startDrag(t)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var e=this.getStage(),t=Kinetic.DD;e&&t.node&&t.node._id===this._id&&t.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.getClassName()==="Stage"?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))},Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var t=Kinetic.document.documentElement;t.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),t.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),t.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),t.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(e){this.children=new Kinetic.Collection,Kinetic.Node.call(this,e)},getChildren:function(e){if(!e)return this.children;var t=new Kinetic.Collection;return this.children.each(function(n){e(n)&&t.push(n)}),t},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){var e=Kinetic.Collection.toCollection(this.children),t;for(var n=0;n<e.length;n++)t=e[n],delete t.parent,t.index=0,t.hasChildren()&&t.removeChildren(),t.remove();return e=null,this.children=new Kinetic.Collection,this},destroyChildren:function(){var e=Kinetic.Collection.toCollection(this.children),t;for(var n=0;n<e.length;n++)t=e[n],delete t.parent,t.index=0,t.destroy();return e=null,this.children=new Kinetic.Collection,this},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return}if(e.getParent()){e.moveTo(this);return}var n=this.children;return this._validateAdd(e),e.index=n.length,e.parent=this,n.push(e),this._fire("add",{child:e}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},find:function(e){var t=[],n=e.replace(/ /g,"").split(","),r=n.length,i,s,o,u,a,f,l;for(i=0;i<r;i++){o=n[i];if(o.charAt(0)==="#")a=this._getNodeById(o.slice(1)),a&&t.push(a);else if(o.charAt(0)===".")u=this._getNodesByName(o.slice(1)),t=t.concat(u);else{f=this.getChildren(),l=f.length;for(s=0;s<l;s++)t=t.concat(f[s]._get(o))}}return Kinetic.Collection.toCollection(t)},_getNodeById:function(e){var t=Kinetic.ids[e];return t!==undefined&&this.isAncestorOf(t)?t:null},_getNodesByName:function(e){var t=Kinetic.names[e]||[];return this._getDescendants(t)},_get:function(e){var t=Kinetic.Node.prototype._get.call(this,e),n=this.getChildren(),r=n.length;for(var i=0;i<r;i++)t=t.concat(n[i]._get(e));return t},toObject:function(){var e=Kinetic.Node.prototype.toObject.call(this);e.children=[];var t=this.getChildren(),n=t.length;for(var r=0;r<n;r++){var i=t[r];e.children.push(i.toObject())}return e},_getDescendants:function(e){var t=[],n=e.length;for(var r=0;r<n;r++){var i=e[r];this.isAncestorOf(i)&&t.push(i)}return t},isAncestorOf:function(e){var t=e.getParent();while(t){if(t._id===this._id)return!0;t=t.getParent()}return!1},clone:function(e){var t=Kinetic.Node.prototype.clone.call(this,e);return this.getChildren().each(function(e){t.add(e.clone())}),t},getAllIntersections:function(e){var t=[];return this.find("Shape").each(function(n){n.isVisible()&&n.intersects(e)&&t.push(n)}),t},_setChildrenIndices:function(){this.children.each(function(e,t){e.index=t})},drawScene:function(e,t){var n=this.getLayer(),r=e||n&&n.getCanvas(),i=r&&r.getContext(),s=this._cache.canvas,o=s&&s.scene;return this.isVisible()&&(o?this._drawCachedSceneCanvas(i):this._drawChildren(r,"drawScene",t)),this},drawHit:function(e,t){var n=this.getLayer(),r=e||n&&n.hitCanvas,i=r&&r.getContext(),s=this._cache.canvas,o=s&&s.hit;return this.shouldDrawHit(r)&&(o?this._drawCachedHitCanvas(i):this._drawChildren(r,"drawHit",t)),this},_drawChildren:function(e,t,n){var r=this.getLayer(),i=e&&e.getContext(),s=this.getClipWidth(),o=this.getClipHeight(),u=s&&o,a,f;u&&r&&(a=this.getClipX(),f=this.getClipY(),i.save(),r._applyTransform(this,i),i.beginPath(),i.rect(a,f,s,o),i.clip(),i.reset()),this.children.each(function(r){r[t](e,n)}),u&&i.restore()},shouldDrawHit:function(e){var t=this.getLayer();return(e&&e.isCache||t&&t.hitGraphEnabled())&&this.isVisible()&&!Kinetic.isDragging()}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight"),Kinetic.Collection.mapMethods(Kinetic.Container)}(),function(){function t(e){e.fill()}function n(e){e.stroke()}function r(e){e.fill()}function i(e){e.stroke()}function s(){this._clearCache(e)}var e="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(e){this.nodeType="Shape",this._fillFunc=t,this._strokeFunc=n,this._fillFuncHit=r,this._strokeFuncHit=i;var o=Kinetic.shapes,u;for(;;){u=Kinetic.Util.getRandomColor();if(u&&!(u in o))break}this.colorKey=u,o[u]=this,Kinetic.Node.call(this,e),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",s)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(e,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&this.getShadowOpacity()!==0&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},intersects:function(e){var t=this.getStage(),n=t.bufferHitCanvas,r;return n.getContext().clear(),this.drawScene(n),r=n.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data,r[3]>0},destroy:function(){Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(e,t){var n=this.getLayer(),r=e||n.getCanvas(),i=r.getContext(),s=this._cache.canvas,o=this.sceneFunc(),u=this.hasShadow(),a,f,l;return this.isVisible()&&(s?this._drawCachedSceneCanvas(i):o&&(i.save(),this._useBufferCanvas()?(a=this.getStage(),f=a.bufferCanvas,l=f.getContext(),l.clear(),l.save(),l._applyLineJoin(this),n&&n._applyTransform(this,l,t),o.call(this,l),l.restore(),u&&(i.save(),i._applyShadow(this),i.drawImage(f._canvas,0,0),i.restore()),i._applyOpacity(this),i.drawImage(f._canvas,0,0)):(i._applyLineJoin(this),n&&n._applyTransform(this,i,t),u&&(i.save(),i._applyShadow(this),o.call(this,i),i.restore()),i._applyOpacity(this),o.call(this,i)),i.restore())),this},drawHit:function(e,t){var n=this.getLayer(),r=e||n.hitCanvas,i=r.getContext(),s=this.hitFunc()||this.sceneFunc(),o=this._cache.canvas,u=o&&o.hit;return this.shouldDrawHit(r)&&(u?this._drawCachedHitCanvas(i):s&&(i.save(),i._applyLineJoin(this),n&&n._applyTransform(this,i,t),s.call(this,i),i.restore())),this},drawHitFromCache:function(e){var t=e||0,n=this._cache.canvas,r=this._getCachedSceneCanvas(),i=r.getContext(),s=n.hit,o=s.getContext(),u=r.getWidth(),a=r.getHeight(),f,l,c,h,p,d,v,m;o.clear();try{f=i.getImageData(0,0,u,a),l=f.data,c=o.getImageData(0,0,u,a),h=c.data,p=l.length,d=Kinetic.Util._hexToRgb(this.colorKey);for(v=0;v<p;v+=4)m=l[v+3],m>t&&(h[v]=d.r,h[v+1]=d.g,h[v+2]=d.b,h[v+3]=255);o.putImageData(c,0,0)}catch(g){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+g.message)}return this}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0),Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),Kinetic.Collection.mapMethods(Kinetic.Shape)}(),function(){function R(e,t){e.content.addEventListener(t,function(n){e[B+t](n)},!1)}var e="Stage",t="string",n="px",r="mouseout",i="mouseleave",s="mouseover",o="mouseenter",u="mousemove",a="mousedown",f="mouseup",l="click",c="dblclick",h="touchstart",p="touchend",d="tap",v="dbltap",m="touchmove",g="contentMouseout",y="contentMouseleave",b="contentMouseover",w="contentMouseenter",E="contentMousemove",S="contentMousedown",x="contentMouseup",T="contentClick",N="contentDblclick",C="contentTouchstart",k="contentTouchend",L="contentTap",A="contentDbltap",O="contentTouchmove",M="div",_="relative",D="inline-block",P="kineticjs-content",H=" ",B="_",j="container",F="",I=[a,u,f,r,h,m,p,s],q=I.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(t){this.nodeType=e,Kinetic.Container.call(this,t),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,Kinetic.stages.push(this)},_validateAdd:function(e){e.getType()!=="Layer"&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(e){if(typeof e===t){var n=e;e=Kinetic.document.getElementById(e);if(!e)throw"Can not find container in document with id "+n}return this._setAttr(j,e),this},shouldDrawHit:function(){return!0},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(e){return Kinetic.Node.prototype.setHeight.call(this,e),this._resizeDOM(),this},setWidth:function(e){return Kinetic.Node.prototype.setWidth.call(this,e),this._resizeDOM(),this},clear:function(){var e=this.children,t=e.length,n;for(n=0;n<t;n++)e[n].clear();return this},clone:function(e){return e||(e={}),e.container=Kinetic.document.createElement(M),Kinetic.Container.prototype.clone.call(this,e)},destroy:function(){var e=this.content;Kinetic.Container.prototype.destroy.call(this),e&&Kinetic.Util._isInDocument(e)&&this.getContainer().removeChild(e);var t=Kinetic.stages.indexOf(this);t>-1&&Kinetic.stages.splice(t,1)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(e){function a(r){var i=u[r],f=i.toDataURL(),l=new Kinetic.window.Image;l.onload=function(){o.drawImage(l,0,0),r<u.length-1?a(r+1):e.callback(s.toDataURL(t,n))},l.src=f}e=e||{};var t=e.mimeType||null,n=e.quality||null,r=e.x||0,i=e.y||0,s=new Kinetic.SceneCanvas({width:e.width||this.getWidth(),height:e.height||this.getHeight(),pixelRatio:1}),o=s.getContext()._context,u=this.children;(r||i)&&o.translate(-1*r,-1*i),a(0)},toImage:function(e){var t=e.callback;e.callback=function(e){Kinetic.Util._getImage(e,function(e){t(e)})},this.toDataURL(e)},getIntersection:function(e){var t=this.getChildren(),n=t.length,r=n-1,i,s;for(i=r;i>=0;i--){s=t[i].getIntersection(e);if(s)return s}return null},_resizeDOM:function(){if(this.content){var e=this.getWidth(),t=this.getHeight(),r=this.getChildren(),i=r.length,s,o;this.content.style.width=e+n,this.content.style.height=t+n,this.bufferCanvas.setSize(e,t),this.bufferHitCanvas.setSize(e,t);for(s=0;s<i;s++)o=r[s],o.setSize(e,t),o.draw()}},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return}return Kinetic.Container.prototype.add.call(this,e),e._setCanvasSize(this.width(),this.height()),e.draw(),this.content.appendChild(e.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var e=0;e<q;e++)R(this,I[e])},_mouseover:function(e){Kinetic.UA.mobile||(this._setPointerPosition(e),this._fire(b,{evt:e}))},_mouseout:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=this.targetShape;t&&!Kinetic.isDragging()&&(t._fireAndBubble(r,{evt:e}),t._fireAndBubble(i,{evt:e}),this.targetShape=null),this.pointerPos=undefined,this._fire(g,{evt:e})}},_mousemove:function(e){if((typeof e.webkitMovementX!="undefined"||typeof e.webkitMovementY!="undefined")&&e.webkitMovementY===0&&e.webkitMovementX===0)return;if(Kinetic.UA.mobile)return;this._setPointerPosition(e);var t=Kinetic.DD,n;Kinetic.isDragging()||(n=this.getIntersection(this.getPointerPosition()),n&&n.isListening()?!Kinetic.isDragging()&&(!this.targetShape||this.targetShape._id!==n._id)?(this.targetShape&&(this.targetShape._fireAndBubble(r,{evt:e},n),this.targetShape._fireAndBubble(i,{evt:e},n)),n._fireAndBubble(s,{evt:e},this.targetShape),n._fireAndBubble(o,{evt:e},this.targetShape),this.targetShape=n):n._fireAndBubble(u,{evt:e}):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(r,{evt:e}),this.targetShape._fireAndBubble(i,{evt:e}),this.targetShape=null),this._fire(E,{evt:e})),t&&t._drag(e),e.preventDefault&&e.preventDefault()},_mousedown:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,t&&t.isListening()&&(this.clickStartShape=t,t._fireAndBubble(a,{evt:e})),this._fire(S,{evt:e})}e.preventDefault&&e.preventDefault()},_mouseup:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=this.clickStartShape,r=!1,i=Kinetic.DD;Kinetic.inDblClickWindow?(r=!0,Kinetic.inDblClickWindow=!1):!i||!i.justDragged?Kinetic.inDblClickWindow=!0:i&&(i.justDragged=!1),setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),t&&t.isListening()&&(t._fireAndBubble(f,{evt:e}),Kinetic.listenClickTap&&n&&n._id===t._id&&(t._fireAndBubble(l,{evt:e}),r&&t._fireAndBubble(c,{evt:e}))),this._fire(x,{evt:e}),Kinetic.listenClickTap&&(this._fire(T,{evt:e}),r&&this._fire(N,{evt:e})),Kinetic.listenClickTap=!1}e.preventDefault&&e.preventDefault()},_touchstart:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,t&&t.isListening()&&(this.tapStartShape=t,t._fireAndBubble(h,{evt:e}),t.isListening()&&e.preventDefault&&e.preventDefault()),this._fire(C,{evt:e})},_touchend:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=!1;Kinetic.inDblClickWindow?(n=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),t&&t.isListening()&&(t._fireAndBubble(p,{evt:e}),Kinetic.listenClickTap&&t._id===this.tapStartShape._id&&(t._fireAndBubble(d,{evt:e}),n&&t._fireAndBubble(v,{evt:e})),t.isListening()&&e.preventDefault&&e.preventDefault()),Kinetic.listenClickTap&&(this._fire(k,{evt:e}),n&&this._fire(A,{evt:e})),Kinetic.listenClickTap=!1},_touchmove:function(e){this._setPointerPosition(e);var t=Kinetic.DD,n;Kinetic.isDragging()||(n=this.getIntersection(this.getPointerPosition()),n&&n.isListening()&&(n._fireAndBubble(m,{evt:e}),n.isListening()&&e.preventDefault&&e.preventDefault()),this._fire(O,{evt:e})),t&&(t._drag(e),Kinetic.isDragging()&&e.preventDefault())},_setPointerPosition:function(e){var t=this._getContentPosition(),n=e.offsetX,r=e.clientX,i=null,s=null,o;e=e?e:window.event,e.touches!==undefined?e.touches.length>0&&(o=e.touches[0],i=o.clientX-t.left,s=o.clientY-t.top):n!==undefined?(i=n,s=e.offsetY):Kinetic.UA.browser==="mozilla"?(i=e.layerX,s=e.layerY):r!==undefined&&t&&(i=r-t.left,s=e.clientY-t.top),i!==null&&s!==null&&(this.pointerPos={x:i,y:s})},_getContentPosition:function(){var e=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:e.top,left:e.left}},_buildDOM:function(){var e=this.getContainer();if(!e){if(Kinetic.Util.isBrowser())throw"Stage has not container. But container is required";e=Kinetic.document.createElement(M)}e.innerHTML=F,this.content=Kinetic.document.createElement(M),this.content.style.position=_,this.content.style.display=D,this.content.className=P,this.content.setAttribute("role","presentation"),e.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1}),this.bufferHitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(e,t){var n=e.split(H),r=n.length,i,s;for(i=0;i<r;i++)s=n[i],this.content.addEventListener(s,t,!1)},cache:function(){Kinetic.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.");return},clearCache:function(){}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")}(),function(){Kinetic.Util.addMethods(Kinetic.BaseLayer,{___init:function(e){this.nodeType="Layer",Kinetic.Container.call(this,e)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this},setZIndex:function(e){Kinetic.Node.prototype.setZIndex.call(this,e);var t=this.getStage();return t&&(t.content.removeChild(this.getCanvas()._canvas),e<t.getChildren().length-1?t.content.insertBefore(this.getCanvas()._canvas,t.getChildren()[e+1].getCanvas()._canvas):t.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var e=this.getStage();e&&(e.content.removeChild(this.getCanvas()._canvas),e.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var e=this.getStage();e&&(e.content.removeChild(this.getCanvas()._canvas),this.index<e.getChildren().length-1?e.content.insertBefore(this.getCanvas()._canvas,e.getChildren()[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas),e.content.insertBefore(this.getCanvas()._canvas,t[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas),e.content.insertBefore(this.getCanvas()._canvas,t[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var e=this.getCanvas()._canvas;return Kinetic.Node.prototype.remove.call(this),e&&e.parentNode&&Kinetic.Util._isInDocument(e)&&e.parentNode.removeChild(e),this},getStage:function(){return this.parent},setSize:function(e,t){this.canvas.setSize(e,t)}}),Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,"clearBeforeDraw",!0),Kinetic.Collection.mapMethods(Kinetic.BaseLayer)}(),function(){var e="#",t="beforeDraw",n="draw",r=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],i=r.length;Kinetic.Util.addMethods(Kinetic.Layer,{____init:function(e){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.BaseLayer.call(this,e)},_setCanvasSize:function(e,t){this.canvas.setSize(e,t),this.hitCanvas.setSize(e,t)},_validateAdd:function(e){var t=e.getType();t!=="Group"&&t!=="Shape"&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(e){var t,n,s,o;if(!this.hitGraphEnabled()||!this.isVisible())return null;var u=1,a=!1;for(;;){for(n=0;n<i;n++){s=r[n],t=this._getIntersection({x:e.x+s.x*u,y:e.y+s.y*u}),o=t.shape;if(o)return o;t.antialiased&&(a=!0)}if(!a)return;u+=1}},_getIntersection:function(t){var n=this.hitCanvas.context._context.getImageData(t.x,t.y,1,1).data,r=n[3],i,s;return r===255?(i=Kinetic.Util._rgbToHex(n[0],n[1],n[2]),s=Kinetic.shapes[e+i],{shape:s}):r>0?{antialiased:!0}:{}},drawScene:function(e,r){var i=this.getLayer(),s=e||i&&i.getCanvas();return this._fire(t,{node:this}),this.getClearBeforeDraw()&&s.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,s,r),this._fire(n,{node:this}),this},_applyTransform:function(e,t,n){var r=e.getAbsoluteTransform(n).getMatrix();t.transform(r[0],r[1],r[2],r[3],r[4],r[5])},drawHit:function(e,t){var n=this.getLayer(),r=e||n&&n.hitCanvas;return n&&n.getClearBeforeDraw()&&n.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this,r,t),this},clear:function(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this},setVisible:function(e){return Kinetic.Node.prototype.setVisible.call(this,e),e?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this},setSize:function(e,t){Kinetic.BaseLayer.prototype.setSize.call(this,e,t),this.hitCanvas.setSize(e,t)}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0),Kinetic.Collection.mapMethods(Kinetic.Layer)}(),function(){var e="#",t="beforeDraw",n="draw";Kinetic.Util.addMethods(Kinetic.FastLayer,{____init:function(e){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,Kinetic.BaseLayer.call(this,e)},_validateAdd:function(e){var t=e.getType();t!=="Shape"&&Kinetic.Util.error("You may only add shapes to a fast layer.")},_setCanvasSize:function(e,t){this.canvas.setSize(e,t)},hitGraphEnabled:function(){return!1},getIntersection:function(){return null},drawScene:function(e){var t=this.getLayer(),n=e||t&&t.getCanvas();return this.getClearBeforeDraw()&&n.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,n),this},_applyTransform:function(e,t,n){if(!n||n._id!==this._id){var r=e.getTransform().getMatrix();t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}},draw:function(){return this.drawScene(),this},clear:function(e){return this.getContext().clear(e),this},setVisible:function(e){return Kinetic.Node.prototype.setVisible.call(this,e),e?this.getCanvas()._canvas.style.display="block":this.getCanvas()._canvas.style.display="none",this}}),Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer),Kinetic.Collection.mapMethods(Kinetic.FastLayer)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(e){this.nodeType="Group",Kinetic.Container.call(this,e)},_validateAdd:function(e){var t=e.getType();t!=="Group"&&t!=="Shape"&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container),Kinetic.Collection.mapMethods(Kinetic.Group)}(),function(){Kinetic.Rect=function(e){this.___init(e)},Kinetic.Rect.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Rect",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getCornerRadius(),n=this.getWidth(),r=this.getHeight();e.beginPath(),t?(e.moveTo(t,0),e.lineTo(n-t,0),e.arc(n-t,t,t,Math.PI*3/2,0,!1),e.lineTo(n,r-t),e.arc(n-t,r-t,t,0,Math.PI/2,!1),e.lineTo(t,r),e.arc(t,r-t,t,Math.PI/2,Math.PI,!1),e.lineTo(0,t),e.arc(t,t,t,Math.PI,Math.PI*3/2,!1)):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Rect)}(),function(){var e=Math.PI*2-1e-4,t="Circle";Kinetic.Circle=function(e){this.___init(e)},Kinetic.Circle.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){t.beginPath(),t.arc(0,0,this.getRadius(),0,e,!1),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return this.getRadius()*2},getHeight:function(){return this.getRadius()*2},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius(e/2)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0),Kinetic.Collection.mapMethods(Kinetic.Circle)}(),function(){var e=Math.PI*2-1e-4,t="Ellipse";Kinetic.Ellipse=function(e){this.___init(e)},Kinetic.Ellipse.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){var n=this.getRadius(),r=n.x,i=n.y;t.beginPath(),t.save(),r!==i&&t.scale(1,i/r),t.arc(0,0,r,0,e,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return this.getRadius().x*2},getHeight:function(){return this.getRadius().y*2},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius({x:e/2})},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius({y:e/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0),Kinetic.Collection.mapMethods(Kinetic.Ellipse)}(),function(){var e=Math.PI*2-1e-4;Kinetic.Ring=function(e){this.___init(e)},Kinetic.Ring.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Ring",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){t.beginPath(),t.arc(0,0,this.getInnerRadius(),0,e,!1),t.moveTo(this.getOuterRadius(),0),t.arc(0,0,this.getOuterRadius(),e,0,!0),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return this.getOuterRadius()*2},getHeight:function(){return this.getOuterRadius()*2},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setOuterRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setOuterRadius(e/2)}},Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Ring)}(),function(){Kinetic.Wedge=function(e){this.___init(e)},Kinetic.Wedge.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Wedge",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){e.beginPath(),e.arc(0,0,this.getRadius(),0,Kinetic.getAngle(this.getAngle()),this.getClockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1),Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Kinetic.Collection.mapMethods(Kinetic.Wedge)}(),function(){var e=Math.PI/180;Kinetic.Arc=function(e){this.___init(e)},Kinetic.Arc.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Arc",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=Kinetic.getAngle(this.angle()),n=this.clockwise();e.beginPath(),e.arc(0,0,this.getOuterRadius(),0,t,n),e.arc(0,0,this.getInnerRadius(),t,0,!n),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"outerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",!1),Kinetic.Collection.mapMethods(Kinetic.Arc)}(),function(){var e="Image";Kinetic.Image=function(e){this.___init(e)},Kinetic.Image.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className=e,this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()&&this.getStage()},_sceneFunc:function(e){var t=this.getWidth(),n=this.getHeight(),r=this.getImage(),i,s,o;r&&(i=this.getCropWidth(),s=this.getCropHeight(),i&&s?o=[r,this.getCropX(),this.getCropY(),i,s,0,0,t,n]:o=[r,0,0,t,n]);if(this.hasFill()||this.hasStroke()||this.hasShadow())e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this);r&&e.drawImage.apply(e,o)},_hitFunc:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)},getWidth:function(){var e=this.getImage();return this.attrs.width||(e?e.width:0)},getHeight:function(){var e=this.getImage();return this.attrs.height||(e?e.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,"crop",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0),Kinetic.Collection.mapMethods(Kinetic.Image)}(),function(){function w(e){e.fillText(this.partialText,0,0)}function E(e){e.strokeText(this.partialText,0,0)}var e="auto",t="center",n="Change.kinetic",r="2d",i="-",s="",o="left",u="text",a="Text",f="middle",l="normal",c="px ",h=" ",p="right",d="word",v="char",m="none",g=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","lineHeight","text","width","height","wrap"],y=g.length,b=Kinetic.Util.createCanvasElement().getContext(r);Kinetic.Text=function(e){this.___init(e)},Kinetic.Text.prototype={___init:function(t){var r=this;t.width===undefined&&(t.width=e),t.height===undefined&&(t.height=e),Kinetic.Shape.call(this,t),this._fillFunc=w,this._strokeFunc=E,this.className=a;for(var i=0;i<y;i++)this.on(g[i]+n,r._setTextData);this._setTextData(),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(e){var n=this.getPadding(),r=this.getTextHeight(),i=this.getLineHeight()*r,s=this.textArr,u=s.length,a=this.getWidth(),l;e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",f),e.setAttr("textAlign",o),e.save(),e.translate(n,0),e.translate(0,n+r/2);for(l=0;l<u;l++){var c=s[l],h=c.text,d=c.width;e.save(),this.getAlign()===p?e.translate(a-d-n*2,0):this.getAlign()===t&&e.translate((a-d-n*2)/2,0),this.partialText=h,e.fillStrokeShape(this),e.restore(),e.translate(0,i)}e.restore()},_hitFunc:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)},setText:function(e){var t=Kinetic.Util._isString(e)?e:e.toString();return this._setAttr(u,t),this},getWidth:function(){return this.attrs.width===e?this.getTextWidth()+this.getPadding()*2:this.attrs.width},getHeight:function(){return this.attrs.height===e?this.getTextHeight()*this.textArr.length*this.getLineHeight()+this.getPadding()*2:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(e){var t=b,n=this.getFontSize(),r;return t.save(),t.font=this._getContextFont(),r=t.measureText(e),t.restore(),{width:r.width,height:parseInt(n,10)}},_getContextFont:function(){return this.getFontStyle()+h+this.getFontVariant()+h+this.getFontSize()+c+this.getFontFamily()},_addTextLine:function(e,t){return this.textArr.push({text:e,width:t})},_getTextWidth:function(e){return b.measureText(e).width},_setTextData:function(){var t=this.getText().split("\n"),n=+this.getFontSize(),r=0,s=this.getLineHeight()*n,o=this.attrs.width,u=this.attrs.height,a=o!==e,f=u!==e,l=this.getPadding(),c=o-l*2,p=u-l*2,d=0,g=this.getWrap(),y=g!==m,w=g!==v&&y;this.textArr=[],b.save(),b.font=this._getContextFont();for(var E=0,S=t.length;E<S;++E){var x=t[E],T=this._getTextWidth(x);if(a&&T>c)while(x.length>0){var N=0,C=x.length,k="",L=0;while(N<C){var A=N+C>>>1,O=x.slice(0,A+1),M=this._getTextWidth(O);M<=c?(N=A+1,k=O,L=M):C=A}if(!k)break;if(w){var _=Math.max(k.lastIndexOf(h),k.lastIndexOf(i))+1;_>0&&(N=_,k=k.slice(0,N),L=this._getTextWidth(k))}this._addTextLine(k,L),r=Math.max(r,L),d+=s;if(!y||f&&d+s>p)break;x=x.slice(N);if(x.length>0){T=this._getTextWidth(x);if(T<=c){this._addTextLine(x,T),d+=s,r=Math.max(r,T);break}}}else this._addTextLine(x,T),d+=s,r=Math.max(r,T);if(f&&d+s>p)break}b.restore(),this.textHeight=n,this.textWidth=r}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",l),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontVariant",l),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",o),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",d),Kinetic.Factory.addGetter(Kinetic.Text,"text",s),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text"),Kinetic.Collection.mapMethods(Kinetic.Text)}(),function(){Kinetic.Line=function(e){this.___init(e)},Kinetic.Line.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Line",this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getPoints(),n=t.length,r=this.getTension(),i=this.getClosed(),s,o,u;e.beginPath(),e.moveTo(t[0],t[1]);if(r!==0&&n>4){s=this.getTensionPoints(),o=s.length,u=i?0:4,i||e.quadraticCurveTo(s[0],s[1],s[2],s[3]);while(u<o-2)e.bezierCurveTo(s[u++],s[u++],s[u++],s[u++],s[u++],s[u++]);i||e.quadraticCurveTo(s[o-2],s[o-1],t[n-2],t[n-1])}else for(u=2;u<n;u+=2)e.lineTo(t[u],t[u+1]);i?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var e=this.getPoints(),t=e.length,n=this.getTension(),r=Kinetic.Util,i=r._getControlPoints(e[t-2],e[t-1],e[0],e[1],e[2],e[3],n),s=r._getControlPoints(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],n),o=Kinetic.Util._expandPoints(e,n),u=[i[2],i[3]].concat(o).concat([s[0],s[1],e[t-2],e[t-1],s[2],s[3],i[0],i[1],e[0],e[1]]);return u}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",!1),Kinetic.Factory.addGetterSetter(Kinetic.Line,"tension",0),Kinetic.Factory.addGetterSetter(Kinetic.Line,"points"),Kinetic.Collection.mapMethods(Kinetic.Line)}(),function(){Kinetic.Sprite=function(e){this.___init(e)},Kinetic.Sprite.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Sprite",this.anim=new Kinetic.Animation,this.on("animationChange.kinetic",function(){this.frameIndex(0)}),this.on("frameRateChange.kinetic",function(){if(!this.anim.isRunning())return;clearInterval(this.interval),this._setInterval()}),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(e){var t=this.getAnimation(),n=this.frameIndex(),r=n*4,i=this.getAnimations()[t],s=i[r+0],o=i[r+1],u=i[r+2],a=i[r+3],f=this.getImage();f&&e.drawImage(f,s,o,u,a,0,0,u,a)},_hitFunc:function(e){var t=this.getAnimation(),n=this.frameIndex(),r=n*4,i=this.getAnimations()[t],s=i[r+2],o=i[r+3];e.beginPath(),e.rect(0,0,s,o),e.closePath(),e.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()},_setInterval:function(){var e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.getFrameRate())},start:function(){var e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var e=this.frameIndex(),t=this.getAnimation(),n=this.getAnimations(),r=n[t],i=r.length/4;e<i-1?this.frameIndex(e+1):this.frameIndex(0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17),Kinetic.Factory.backCompat(Kinetic.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Kinetic.Collection.mapMethods(Kinetic.Sprite)}(),function(){Kinetic.Path=function(e){this.___init(e)},Kinetic.Path.prototype={___init:function(e){this.dataArray=[];var t=this;Kinetic.Shape.call(this,e),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){t.dataArray=Kinetic.Path.parsePathData(this.getData())}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.dataArray,n=!1;e.beginPath();for(var r=0;r<t.length;r++){var i=t[r].command,s=t[r].points;switch(i){case"L":e.lineTo(s[0],s[1]);break;case"M":e.moveTo(s[0],s[1]);break;case"C":e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var o=s[0],u=s[1],a=s[2],f=s[3],l=s[4],c=s[5],h=s[6],p=s[7],d=a>f?a:f,v=a>f?1:a/f,m=a>f?f/a:1;e.translate(o,u),e.rotate(h),e.scale(v,m),e.arc(0,0,d,l,l+c,1-p),e.scale(1/v,1/m),e.rotate(-h),e.translate(-o,-u);break;case"z":e.closePath(),n=!0}}n?e.fillStrokeShape(this):e.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))},Kinetic.Path.getPointOnLine=function(e,t,n,r,i,s,o){s===undefined&&(s=t),o===undefined&&(o=n);var u=(i-n)/(r-t+1e-8),a=Math.sqrt(e*e/(1+u*u));r<t&&(a*=-1);var f=u*a,l;if(r===t)l={x:s,y:o+f};else if((o-n)/(s-t+1e-8)===u)l={x:s+a,y:o+f};else{var c,h,p=this.getLineLength(t,n,r,i);if(p<1e-8)return undefined;var d=(s-t)*(r-t)+(o-n)*(i-n);d/=p*p,c=t+d*(r-t),h=n+d*(i-n);var v=this.getLineLength(s,o,c,h),m=Math.sqrt(e*e-v*v);a=Math.sqrt(m*m/(1+u*u)),r<t&&(a*=-1),f=u*a,l={x:c+a,y:h+f}}return l},Kinetic.Path.getPointOnCubicBezier=function(e,t,n,r,i,s,o,u,a){function f(e){return e*e*e}function l(e){return 3*e*e*(1-e)}function c(e){return 3*e*(1-e)*(1-e)}function h(e){return(1-e)*(1-e)*(1-e)}var p=u*f(e)+s*l(e)+r*c(e)+t*h(e),d=a*f(e)+o*l(e)+i*c(e)+n*h(e);return{x:p,y:d}},Kinetic.Path.getPointOnQuadraticBezier=function(e,t,n,r,i,s,o){function u(e){return e*e}function a(e){return 2*e*(1-e)}function f(e){return(1-e)*(1-e)}var l=s*u(e)+r*a(e)+t*f(e),c=o*u(e)+i*a(e)+n*f(e);return{x:l,y:c}},Kinetic.Path.getPointOnEllipticalArc=function(e,t,n,r,i,s){var o=Math.cos(s),u=Math.sin(s),a={x:n*Math.cos(i),y:r*Math.sin(i)};return{x:e+(a.x*o-a.y*u),y:t+(a.x*u+a.y*o)}},Kinetic.Path.parsePathData=function(e){if(!e)return[];var t=e,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(var r=0;r<n.length;r++)t=t.replace(new RegExp(n[r],"g"),"|"+n[r]);var i=t.split("|"),s=[],o=0,u=0;for(r=1;r<i.length;r++){var a=i[r],f=a.charAt(0);a=a.slice(1),a=a.replace(new RegExp(",-","g"),"-"),a=a.replace(new RegExp("-","g"),",-"),a=a.replace(new RegExp("e,-","g"),"e-");var l=a.split(",");l.length>0&&l[0]===""&&l.shift();for(var c=0;c<l.length;c++)l[c]=parseFloat(l[c]);while(l.length>0){if(isNaN(l[0]))break;var h=null,p=[],d=o,v=u,m,g,y,b,w,E,S,x,T,N;switch(f){case"l":o+=l.shift(),u+=l.shift(),h="L",p.push(o,u);break;case"L":o=l.shift(),u=l.shift(),p.push(o,u);break;case"m":var C=l.shift(),k=l.shift();o+=C,u+=k,h="M";if(s.length>2&&s[s.length-1].command==="z")for(var L=s.length-2;L>=0;L--)if(s[L].command==="M"){o=s[L].points[0]+C,u=s[L].points[1]+k;break}p.push(o,u),f="l";break;case"M":o=l.shift(),u=l.shift(),h="M",p.push(o,u),f="L";break;case"h":o+=l.shift(),h="L",p.push(o,u);break;case"H":o=l.shift(),h="L",p.push(o,u);break;case"v":u+=l.shift(),h="L",p.push(o,u);break;case"V":u=l.shift(),h="L",p.push(o,u);break;case"C":p.push(l.shift(),l.shift(),l.shift(),l.shift()),o=l.shift(),u=l.shift(),p.push(o,u);break;case"c":p.push(o+l.shift(),u+l.shift(),o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),h="C",p.push(o,u);break;case"S":g=o,y=u,m=s[s.length-1],m.command==="C"&&(g=o+(o-m.points[2]),y=u+(u-m.points[3])),p.push(g,y,l.shift(),l.shift()),o=l.shift(),u=l.shift(),h="C",p.push(o,u);break;case"s":g=o,y=u,m=s[s.length-1],m.command==="C"&&(g=o+(o-m.points[2]),y=u+(u-m.points[3])),p.push(g,y,o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),h="C",p.push(o,u);break;case"Q":p.push(l.shift(),l.shift()),o=l.shift(),u=l.shift(),p.push(o,u);break;case"q":p.push(o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),h="Q",p.push(o,u);break;case"T":g=o,y=u,m=s[s.length-1],m.command==="Q"&&(g=o+(o-m.points[0]),y=u+(u-m.points[1])),o=l.shift(),u=l.shift(),h="Q",p.push(g,y,o,u);break;case"t":g=o,y=u,m=s[s.length-1],m.command==="Q"&&(g=o+(o-m.points[0]),y=u+(u-m.points[1])),o+=l.shift(),u+=l.shift(),h="Q",p.push(g,y,o,u);break;case"A":b=l.shift(),w=l.shift(),E=l.shift(),S=l.shift(),x=l.shift(),T=o,N=u,o=l.shift(),u=l.shift(),h="A",p=this.convertEndpointToCenterParameterization(T,N,o,u,S,x,b,w,E);break;case"a":b=l.shift(),w=l.shift(),E=l.shift(),S=l.shift(),x=l.shift(),T=o,N=u,o+=l.shift(),u+=l.shift(),h="A",p=this.convertEndpointToCenterParameterization(T,N,o,u,S,x,b,w,E)}s.push({command:h||f,points:p,start:{x:d,y:v},pathLength:this.calcLength(d,v,h||f,p)})}(f==="z"||f==="Z")&&s.push({command:"z",points:[],start:undefined,pathLength:0})}return s},Kinetic.Path.calcLength=function(e,t,n,r){var i,s,o,u,a=Kinetic.Path;switch(n){case"L":return a.getLineLength(e,t,r[0],r[1]);case"C":i=0,s=a.getPointOnCubicBezier(0,e,t,r[0],r[1],r[2],r[3],r[4],r[5]);for(u=.01;u<=1;u+=.01)o=a.getPointOnCubicBezier(u,e,t,r[0],r[1],r[2],r[3],r[4],r[5]),i+=a.getLineLength(s.x,s.y,o.x,o.y),s=o;return i;case"Q":i=0,s=a.getPointOnQuadraticBezier(0,e,t,r[0],r[1],r[2],r[3]);for(u=.01;u<=1;u+=.01)o=a.getPointOnQuadraticBezier(u,e,t,r[0],r[1],r[2],r[3]),i+=a.getLineLength(s.x,s.y,o.x,o.y),s=o;return i;case"A":i=0;var f=r[4],l=r[5],c=r[4]+l,h=Math.PI/180;Math.abs(f-c)<h&&(h=Math.abs(f-c)),s=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],f,0);if(l<0)for(u=f-h;u>c;u-=h)o=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],u,0),i+=a.getLineLength(s.x,s.y,o.x,o.y),s=o;else for(u=f+h;u<c;u+=h)o=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],u,0),i+=a.getLineLength(s.x,s.y,o.x,o.y),s=o;return o=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],c,0),i+=a.getLineLength(s.x,s.y,o.x,o.y),i}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(e,t,n,r,i,s,o,u,a){var f=a*(Math.PI/180),l=Math.cos(f)*(e-n)/2+Math.sin(f)*(t-r)/2,c=-1*Math.sin(f)*(e-n)/2+Math.cos(f)*(t-r)/2,h=l*l/(o*o)+c*c/(u*u);h>1&&(o*=Math.sqrt(h),u*=Math.sqrt(h));var p=Math.sqrt((o*o*u*u-o*o*c*c-u*u*l*l)/(o*o*c*c+u*u*l*l));i===s&&(p*=-1),isNaN(p)&&(p=0);var d=p*o*c/u,v=p*-u*l/o,m=(e+n)/2+Math.cos(f)*d-Math.sin(f)*v,g=(t+r)/2+Math.sin(f)*d+Math.cos(f)*v,y=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},b=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(y(e)*y(t))},w=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(b(e,t))},E=w([1,0],[(l-d)/o,(c-v)/u]),S=[(l-d)/o,(c-v)/u],x=[(-1*l-d)/o,(-1*c-v)/u],T=w(S,x);return b(S,x)<=-1&&(T=Math.PI),b(S,x)>=1&&(T=0),s===0&&T>0&&(T-=2*Math.PI),s===1&&T<0&&(T+=2*Math.PI),[m,g,o,u,E,T,f,s]},Kinetic.Factory.addGetterSetter(Kinetic.Path,"data"),Kinetic.Collection.mapMethods(Kinetic.Path)}(),function(){function n(e){e.fillText(this.partialText,0,0)}function r(e){e.strokeText(this.partialText,0,0)}var e="",t="normal";Kinetic.TextPath=function(e){this.___init(e)},Kinetic.TextPath.prototype={___init:function(e){var t=this;this.dummyCanvas=Kinetic.Util.createCanvasElement(),this.dataArray=[],Kinetic.Shape.call(this,e),this._fillFunc=n,this._strokeFunc=r,this._fillFuncHit=n,this._strokeFuncHit=r,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){t.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",t._setTextData),t._setTextData(),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline","middle"),e.setAttr("textAlign","left"),e.save();var t=this.glyphInfo;for(var n=0;n<t.length;n++){e.save();var r=t[n].p0;e.translate(r.x,r.y),e.rotate(t[n].rotation),this.partialText=t[n].text,e.fillStrokeShape(this),e.restore()}e.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(e){Kinetic.Text.prototype.setText.call(this,e)},_getTextSize:function(e){var t=this.dummyCanvas,n=t.getContext("2d");n.save(),n.font=this._getContextFont();var r=n.measureText(e);return n.restore(),{width:r.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var e=this,t=this._getTextSize(this.attrs.text);this.textWidth=t.width,this.textHeight=t.height,this.glyphInfo=[];var n=this.attrs.text.split(""),r,i,s,o=-1,u=0,a=function(){u=0;var t=e.dataArray;for(var n=o+1;n<t.length;n++){if(t[n].pathLength>0)return o=n,t[n];t[n].command=="M"&&(r={x:t[n].points[0],y:t[n].points[1]})}return{}},f=function(t){var n=e._getTextSize(t).width,o=0,f=0;i=undefined;while(Math.abs(n-o)/n>.01&&f<25){f++;var l=o;while(s===undefined)s=a(),s&&l+s.pathLength<n&&(l+=s.pathLength,s=undefined);if(s==={}||r===undefined)return undefined;var c=!1;switch(s.command){case"L":Kinetic.Path.getLineLength(r.x,r.y,s.points[0],s.points[1])>n?i=Kinetic.Path.getPointOnLine(n,r.x,r.y,s.points[0],s.points[1],r.x,r.y):s=undefined;break;case"A":var h=s.points[4],p=s.points[5],d=s.points[4]+p;u===0?u=h+1e-8:n>o?u+=Math.PI/180*p/Math.abs(p):u-=Math.PI/360*p/Math.abs(p);if(p<0&&u<d||p>=0&&u>d)u=d,c=!0;i=Kinetic.Path.getPointOnEllipticalArc(s.points[0],s.points[1],s.points[2],s.points[3],u,s.points[6]);break;case"C":u===0?n>s.pathLength?u=1e-8:u=n/s.pathLength:n>o?u+=(n-o)/s.pathLength:u-=(o-n)/s.pathLength,u>1&&(u=1,c=!0),i=Kinetic.Path.getPointOnCubicBezier(u,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3],s.points[4],s.points[5]);break;case"Q":u===0?u=n/s.pathLength:n>o?u+=(n-o)/s.pathLength:u-=(o-n)/s.pathLength,u>1&&(u=1,c=!0),i=Kinetic.Path.getPointOnQuadraticBezier(u,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3])}i!==undefined&&(o=Kinetic.Path.getLineLength(r.x,r.y,i.x,i.y)),c&&(c=!1,s=undefined)}};for(var l=0;l<n.length;l++){f(n[l]);if(r===undefined||i===undefined)break;var c=Kinetic.Path.getLineLength(r.x,r.y,i.x,i.y),h=0,p=Kinetic.Path.getPointOnLine(h+c/2,r.x,r.y,i.x,i.y),d=Math.atan2(i.y-r.y,i.x-r.x);this.glyphInfo.push({transposeX:p.x,transposeY:p.y,text:n[l],rotation:d,p0:r,p1:i}),r=i}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",t),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontVariant",t),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",e),Kinetic.Collection.mapMethods(Kinetic.TextPath)}(),function(){Kinetic.RegularPolygon=function(e){this.___init(e)},Kinetic.RegularPolygon.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="RegularPolygon",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.attrs.sides,n=this.attrs.radius,r,i,s;e.beginPath(),e.moveTo(0,0-n);for(r=1;r<t;r++)i=n*Math.sin(r*2*Math.PI/t),s=-1*n*Math.cos(r*2*Math.PI/t),e.lineTo(i,s);e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0),Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)}(),function(){Kinetic.Star=function(e){this.___init(e)},Kinetic.Star.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Star",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.innerRadius(),n=this.outerRadius(),r=this.numPoints();e.beginPath(),e.moveTo(0,0-n);for(var i=1;i<r*2;i++){var s=i%2===0?n:t,o=s*Math.sin(i*Math.PI/r),u=-1*s*Math.cos(i*Math.PI/r);e.lineTo(o,u)}e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",5),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Star)}(),function(){var e=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],t="Change.kinetic",n="none",r="up",i="right",s="down",o="left",u="Label",a=e.length;Kinetic.Label=function(e){this.____init(e)},Kinetic.Label.prototype={____init:function(e){var t=this;Kinetic.Group.call(this,e),this.className=u,this.on("add.kinetic",function(e){t._addListeners(e.child),t._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(n){var r=this,i,s=function(){r._sync()};for(i=0;i<a;i++)n.on(e[i]+t,s)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var e=this.getText(),t=this.getTag(),n,u,a,f,l,c,h;if(e&&t){n=e.getWidth(),u=e.getHeight(),a=t.getPointerDirection(),f=t.getPointerWidth(),h=t.getPointerHeight(),l=0,c=0;switch(a){case r:l=n/2,c=-1*h;break;case i:l=n+f,c=u/2;break;case s:l=n/2,c=u+h;break;case o:l=-1*f,c=u/2}t.setAttrs({x:-1*l,y:-1*c,width:n,height:u}),e.setAttrs({x:-1*l,y:-1*c})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Collection.mapMethods(Kinetic.Label),Kinetic.Tag=function(e){this.___init(e)},Kinetic.Tag.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Tag",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getWidth(),n=this.getHeight(),u=this.getPointerDirection(),a=this.getPointerWidth(),f=this.getPointerHeight();e.beginPath(),e.moveTo(0,0),u===r&&(e.lineTo((t-a)/2,0),e.lineTo(t/2,-1*f),e.lineTo((t+a)/2,0)),e.lineTo(t,0),u===i&&(e.lineTo(t,(n-f)/2),e.lineTo(t+a,n/2),e.lineTo(t,(n+f)/2)),e.lineTo(t,n),u===s&&(e.lineTo((t+a)/2,n),e.lineTo(t/2,n+f),e.lineTo((t-a)/2,n)),e.lineTo(0,n),u===o&&(e.lineTo(0,(n+f)/2),e.lineTo(-1*a,n/2),e.lineTo(0,(n-f)/2)),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",n),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Tag)}(),define("bpmn/util/diagram/Canvas",["kinetic"],function(e){var t=function(n){this.scale=n.scale;var r=this.stage=new e.Stage({container:n.container,width:n.width?n.width:500,height:n.height?n.height:500});r.scale({x:this.scale,y:this.scale}),this.shapeLayer=new e.Layer,this.connectionsLayer=new e.Layer,this.labelLayer=new e.Layer,r.add(this.shapeLayer),r.add(this.connectionsLayer),r.add(this.labelLayer),this.createGroup=function(t){return new e.Group(t)},this.createRect=function(t){return new e.Rect(t)},this.createCircle=function(t){return new e.Circle(t)},this.createLine=function(t){return new e.Line(t)},this.createText=function(t){return new e.Text(t)},this.createPolygon=function(t){return t.closed=!0,new e.Line(t)},this.createPath=function(t){return new e.Path(t)},this.createArrowLine=function(t,n,r){var i=r?r:6,s=t[t.length-2],o=t[t.length-1],u=t[t.length-4],a=t[t.length-3],f=Math.atan2(o-a,s-u);n.points=t.concat([s-i*Math.cos(f-Math.PI/6),o-i*Math.sin(f-Math.PI/6),s,o,s-i*Math.cos(f+Math.PI/6),o-i*Math.sin(f+Math.PI/6)]);var l=new e.Line(n);return l},this.expandCanvasIfNeeded=function(e){var t=10,n=e.getX(),r=e.getY(),i=e.getWidth(),s=e.getHeight();(n+i)*this.scale>this.stage.getWidth()&&this.stage.setWidth((n+i+t)*this.scale),(r+s)*this.scale>this.stage.getHeight()&&this.stage.setHeight((r+s+t)*this.scale)}};return t}),define("bpmn/editor/ActivityRenderer",[],function(){var e=function(e){this.markerPaths={"bpmn.ServiceTask":"m 22.701284,14.663851 c 0.432742,0 0.835353,-0.363368 0.894226,-0.807377 0,0 0.08274,-0.624013 0.08274,-1.366108 0,-0.742094 -0.08274,-1.366107 -0.08274,-1.366107 -0.05909,-0.444249 -0.461484,-0.807376 -0.894226,-0.807376 h -2.236261 c -0.432975,0 -0.882637,-0.285846 -0.998992,-0.6350536 -0.116355,-0.3492066 -0.276519,-1.4695496 0.02967,-1.7863558 L 21.076473,6.2586397 C 21.382428,5.9415935 21.40607,5.4006221 21.128856,5.0562152 L 19.269014,3.1299359 C 18.936402,2.8426498 18.414191,2.8671302 18.107771,3.1841824 L 16.526998,4.8210152 C 16.221042,5.1380613 15.710883,5.2657441 15.394032,5.1049407 15.076952,4.9441373 14.18852,4.2658838 14.18852,3.8175543 V 1.501988 c 0,-0.4483294 -0.350922,-0.86497745 -0.779725,-0.92617905 0,0 -0.60264,-0.085927 -1.319319,-0.085927 -0.716679,0 -1.319319,0.085927 -1.319319,0.085927 -0.429034,0.06096 -0.7799559,0.47784965 -0.7799559,0.92617905 v 2.3155663 c 0,0.4483295 -0.275824,0.9136994 -0.6133031,1.0344211 C 9.0394192,4.9724583 7.9576789,5.1383013 7.6514912,4.8212576 L 6.0707181,3.1844175 C 5.7645304,2.8673702 5.2420872,2.8428899 4.9097076,3.1299359 L 3.0496339,5.0559751 C 2.7721873,5.4003821 2.7958294,5.9413535 3.1020167,6.2583996 L 4.682558,7.8952336 C 4.9887458,8.2122798 5.1122872,8.7402903 4.9567595,9.0683769 4.8012323,9.3964637 4.14644,10.316643 3.7134658,10.316643 H 1.4774369 c -0.4329742,0 -0.83535274,0.363367 -0.89445788,0.807376 0,0 -0.082979,0.624013 -0.082979,1.366107 0,0.742335 0.082979,1.366108 0.082979,1.366108 0.0588733,0.444249 0.46148368,0.807376 0.89445788,0.807376 h 2.2362607 c 0.4329742,0 0.882405,0.285607 0.9987611,0.635054 0.116356,0.349206 0.2765193,1.46931 -0.029668,1.786356 l -1.5805412,1.636594 c -0.3061877,0.317046 -0.3298298,0.858017 -0.052384,1.202424 l 1.859842,1.926279 c 0.3326113,0.287047 0.8548228,0.262806 1.1610105,-0.05425 l 1.5807733,-1.636829 c 0.3061877,-0.316806 0.8161146,-0.444729 1.1331963,-0.283925 0.3170817,0.160802 1.2055136,0.839057 1.2055136,1.287386 v 2.315567 c 0,0.448089 0.3509218,0.864976 0.7799558,0.925938 0,0 0.602408,0.08568 1.319319,0.08568 0.71691,0 1.319319,-0.08568 1.319319,-0.08568 0.429035,-0.06119 0.779725,-0.477849 0.779725,-0.925938 v -2.315567 c 0,-0.448329 0.275825,-0.913939 0.613303,-1.034421 0.337479,-0.120482 1.419219,-0.286086 1.725407,0.03071 l 1.580541,1.636833 c 0.306188,0.316807 0.828631,0.341288 1.161243,0.05425 l 1.859842,-1.925559 c 0.277214,-0.344407 0.253804,-0.885138 -0.05262,-1.202424 l -1.58054,-1.636586 c -0.306188,-0.317046 -0.42973,-0.845056 -0.274202,-1.173383 0.155296,-0.328327 0.81032,-1.248266 1.243294,-1.248266 h 2.236492 z m -10.612039,2.218844 c -2.342882,0 -4.2421275,-1.966359 -4.2421275,-4.392569 0,-2.425728 1.8992455,-4.3925682 4.2421275,-4.3925682 2.342882,0 4.242127,1.9666002 4.242127,4.3925682 0,2.42597 -1.899245,4.392569 -4.242127,4.392569 z","bpmn.UserTask":"M 12.253681,11.77491 C 11.634895,10.657313 10.877364,9.7523027 10.117807,9.1196049 9.2316574,9.7684998 8.152074,10.163303 6.9752673,10.163303 5.7964351,10.163303 4.715839,9.7674875 3.8307021,9.1196049 3.0711453,9.7523027 2.313614,10.657313 1.6928029,11.77491 c -1.44011956,2.594568 -1.59810737,5.255948 -0.3544598,5.946348 0.5570083,0.310781 1.1413607,0.07896 1.7449552,-0.502109 -0.106338,0.589168 -0.1681153,1.22794 -0.1681153,1.896068 0,2.968112 1.1535136,5.372364 2.5754039,5.372364 0.8567801,0 1.2811192,-0.875654 1.4846804,-2.215961 0.2035612,1.340307 0.6279003,2.215961 1.4816421,2.215961 1.4239158,0 2.5774296,-2.404252 2.5774296,-5.372364 0,-0.668128 -0.06178,-1.3069 -0.170141,-1.896068 0.60562,0.581069 1.18896,0.81289 1.746981,0.502109 1.243647,-0.6904 1.082621,-3.35178 -0.357498,-5.946348 z M 6.9742546,9.1509867 c 2.3920975,0 4.3325124,-1.9395984 4.3325124,-4.3317023 0,-2.3921039 -1.9404149,-4.33170228 -4.3325124,-4.33170228 -2.3931103,0 -4.3345375,1.93959838 -4.3345375,4.33170228 0,2.3921039 1.9414272,4.3317023 4.3345375,4.3317023 z","bpmn.BusinessRuleTask":"M 0.49999997,0.68485673 V 3.8369982 H 24.501049 V 0.68485673 H 0.49999997 z m 0,17.05141427 H 24.501049 V 14.58413 H 0.49999997 v 3.152141 z m 0,-6.949637 H 24.501049 V 7.6344932 H 0.49999997 v 3.1521408 z m 0,13.898223 H 24.501049 V 21.532715 H 0.49999997 v 3.152142 z","bpmn.ReceiveTask":"M 1.7164479,0.59270005 9.5482144,6.784475 17.408905,0.54332386 z M 0.70000001,1.254341 l 0,11.06027 17.69642899,0 0,-11.06027 -8.8482146,6.6361608 z"},this.createRectangle=function(t){var n=e.skin().activity_corner_radius,r=e.canvas.createRect({width:t.width(),height:t.height(),cornerRadius:n,stroke:e.skin().activity_stroke,fill:e.skin().activity_fill,strokeWidth:2});return r},this.getPathForActivityType=function(e){return this.markerPaths[e.declaredClass]},this.createMarker=function(t){var n=e.canvas.createPath({x:3,y:3,data:t,stroke:e.skin().activity_stroke,fill:e.skin().activity_fill,scale:.6});return n},this.render=function(e,t){var n=e.getBounds(),r=this.createRectangle(n),i=this.getPathForActivityType(e),s=this.createMarker(i);return t.add(r),t.add(s),t}};return e}),define("bpmn/editor/EventRenderer",[],function(){var e=function(){this.render=function(e,t){var n=e.getBounds(),r=this.canvas.createCircle({width:n.width(),height:n.height(),stroke:this.skin().event_stroke,strokeWidth:2,draggable:!0});return t.add(r),t}};return e}),define("bpmn/editor/GatewayRenderer",[],function(){var e=function(){this.render=function(e,t){var n=e.getBounds(),r=this.canvas.createPolygon({points:[0,n.height()/2,n.width()/2,0,n.width(),n.height()/2,n.width()/2,n.height()],stroke:"black",fill:"white",strokeWidth:2,draggable:!0});return t.add(r),t}};return e}),define("bpmn/editor/LabelRenderer",[],function(){var e=function(e){this.renderCentered=function(e,t,n){var r=this.createLabelText(n);return r.setY(e.height()/2-r.getFontSize()),r.setWidth(e.width()),t.add(r),t},this.createLabelText=function(t){return e.canvas.createText({text:t,fontSize:e.skin().label_font_size,fontFamily:e.skin().label_font_family,fill:e.skin().label_fill,align:"center"})}};return e}),define("bpmn/editor/Renderer",["dojo/_base/declare","dojo/_base/array","bpmn/Activity","bpmn/Gateway","bpmn/Event","bpmn/SequenceFlow","bpmn/util/diagram/Canvas","bpmn/editor/ActivityRenderer","bpmn/editor/EventRenderer","bpmn/editor/GatewayRenderer","bpmn/editor/LabelRenderer"],function(e,t,n,r,i,s,o,u,a,f,l){var c={skins:{"default":{event_stroke:"black",activity_stroke:"black",activity_fill:"white",activity_corner_radius:10,label_font_family:"Arial",label_font_size:12,label_fill:"black"}},constructor:function(e,t){this.definitions=e,this.skinName="default",this.bindDelegates(),this.evaluateOptionsAndDefaults(t),this.canvas=new o(this.options)},bindDelegates:function(){this.activity=new u(this),this.renderEvent=(new a).render,this.renderGateway=(new f).render,this.label=new l(this)},evaluateOptionsAndDefaults:function(e){this.options=e,this.skinName=e.skin?e.skin:"default",this.options.scale=e.scale?e.scale:1},render:function(){this.renderElements(),this.canvas.shapeLayer.draw(),this.canvas.connectionsLayer.draw(),this.canvas.labelLayer.draw()},renderElements:function(){if(this.definitions.process().length>1)throw new Error("Only single process models are supported");t.forEach(this.definitions.process(),function(e){t.forEach(e.flowElements(),function(e){this.renderElement(e)},this)},this)},renderElement:function(e){var t=this.canvas.createGroup({draggable:!0});e instanceof s?(this.renderConnection(e,t),this.canvas.connectionsLayer.add(t)):e instanceof n?(this.label.renderCentered(e.getBounds(),this.activity.render(e,t),e.name()),this.canvas.shapeLayer.add(t),this.setGroupBounds(t,e.getBounds())):e instanceof i?(this.renderEvent(e,t),this.canvas.shapeLayer.add(t),this.setGroupBounds(t,this.eventBounds(e))):e instanceof r?(this.renderGateway(e,t),this.canvas.shapeLayer.add(t),this.setGroupBounds(t,e.getBounds())):console.log("unable to render flowElement",e),this.canvas.expandCanvasIfNeeded(t)},eventBounds:function(e){var t=e.getBounds();return{x:function(){return t.x()+t.width()/2},y:function(){return t.y()+t.height()/2},width:function(){return t.width()},height:function(){return t.height()}}},setGroupBounds:function(e,t){e.setX(t.x()),e.setY(t.y()),e.setWidth(t.width()),e.setHeight(t.height())},renderConnection:function(e,n){var r=[];t.forEach(e.getWaypoints(),function(e){r.push(e.x),r.push(e.y)});var i=this.canvas.createArrowLine(r,{stroke:"black",strokeWidth:2,lineCap:"round",lineJoin:"round"});return n.add(i),n},skin:function(){return this.skins[this.skinName]}};return e("bpmn.Renderer",null,c)}),define("bpmn/Bpmn",["dojo/_base/declare","bpmn/Definitions","bpmn/execution/Instance","bpmn/util/Serializer","bpmn/editor/Renderer"],function(e,t,n,r,i){var s={constructor:function(){this.renderer=i,this.serializer=new r}};return e("bpmn.Bpmn",null,s)});