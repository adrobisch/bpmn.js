/*(The MIT license)
 This is jsclass 4.0.5 minus the tracing methods

 Copyright (c) 2007-2013 James Coglan and contributors

 Permission is hereby granted, free of charge, to any person obtaining a copy of
 this software and associated documentation files (the "Software"), to deal in
 the Software without restriction, including without limitation the rights to
 use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
 of the Software, and to permit persons to whom the Software is furnished to do
 so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all
 copies or substantial portions of the Software.

 Parts of the Software build on techniques from the following open-source
 projects:

 * [Prototype](http://prototypejs.org/), (c) 2005-2010 Sam Stephenson (MIT
 license)
 * Alex Arnell's [Inheritance](http://www.twologic.com/projects/inheritance/)
 library, (c) 2006 Alex Arnell (MIT license)
 * [Base](http://dean.edwards.name/weblog/2006/03/base/), (c) 2006-2010 Dean
 Edwards (MIT license)

 The Software contains direct translations to JavaScript of these open-source
 Ruby libraries:

 * [Ruby standard library modules](http://www.ruby-lang.org/en/), (c) Yukihiro
 Matsumoto and contributors (Ruby license)
 * [Test::Unit](http://test-unit.rubyforge.org/), (c) 2000-2003 Nathaniel
 Talbott (Ruby license)
 * [Context](http://github.com/jm/context), (c) 2008 Jeremy McAnally (MIT
 license)
 * [EventMachine::Deferrable](http://rubyeventmachine.com/), (c) 2006-07 Francis
 Cianfrocca (Ruby license)

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.*/

/**
 * @license
 * Lo-Dash 2.4.1 <http://lodash.com/>
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */

/*! jQuery v2.1.1 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */

/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */

/*! KineticJS v5.1.1 2014-05-09 http://www.kineticjs.com by Eric Rowell @ericdrowell - MIT License https://github.com/ericdrowell/KineticJS/wiki/License*/

/*! bpmn.js https://github.com/adrobisch/bpmn.js by Andreas Drobisch @adrobisch - MIT License */

var JS=typeof this.JS=="undefined"?{}:this.JS;(function(e){var t=typeof this.global=="object"?this.global:this,n=typeof exports=="object";n?(exports.JS=exports,JS=exports):t.JS=JS,e(t,JS)})(function(e,t){var n={ENV:e};n.END_WITHOUT_DOT=/([^\.])$/,n.array=function(e){var t=[],n=e.length;while(n--)t[n]=e[n];return t},n.bind=function(e,t){return function(){return e.apply(t,arguments)}},n.Date=n.ENV.Date,n.extend=function(e,t,n){if(!e||!t)return e;for(var r in t){if(e[r]===t[r])continue;if(n===!1&&e.hasOwnProperty(r))continue;e[r]=t[r]}return e},n.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);var n=e.length;while(n--)if(e[n]===t)return n;return-1},n.isType=function(e,t){return typeof t=="string"?typeof e===t:e===null||e===undefined?!1:typeof t=="function"&&e instanceof t||e.isA&&e.isA(t)||e.constructor===t},n.makeBridge=function(e){var t=function(){};return t.prototype=e.prototype,new t},n.makeClass=function(e){e=e||Object;var t=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this};return t.prototype=n.makeBridge(e),t.superclass=e,t.subclasses=[],e.subclasses&&e.subclasses.push(t),t},n.match=function(e,t){return t===undefined?!1:typeof e.test=="function"?e.test(t):e.match(t)},n.Method=n.makeClass(),n.extend(n.Method.prototype,{initialize:function(e,t,n){this.module=e,this.name=t,this.callable=n,this._words={};if(typeof n!="function")return;this.arity=n.length;var r=n.toString().match(/\b[a-z\_\$][a-z0-9\_\$]*\b/ig),i=r.length;while(i--)this._words[r[i]]=!0},setName:function(e){this.callable.displayName=this.displayName=e},contains:function(e){return this._words.hasOwnProperty(e)},call:function(){return this.callable.call.apply(this.callable,arguments)},apply:function(e,t){return this.callable.apply(e,t)},compile:function(e){var t=this,r=t.module.__trace__||e.__trace__,i=t.callable,s=t._words,o=n.Method._keywords,u=o.length,a=[],f;while(u--)f=o[u],s[f.name]&&a.push(f);if(a.length===0&&!r)return i;var l=function(){var n=a.length,r=n,s={},o,u,f;while(r--){o=a[r],u=this[o.name];if(u&&!u.__kwd__)continue;s[o.name]={_value:u,_own:this.hasOwnProperty(o.name)},f=o.filter(t,e,this,arguments),f&&(f.__kwd__=!0),this[o.name]=f}var l=i.apply(this,arguments),r=n;while(r--){o=a[r];if(!s[o.name])continue;s[o.name]._own?this[o.name]=s[o.name]._value:delete this[o.name]}return l};return l},toString:function(){var e=this.displayName||this.module.toString()+"#"+this.name;return"#<Method:"+e+">"}}),n.Method.create=function(e,t,n){if(n&&n.__inc__&&n.__fns__)return n;var r=typeof n!="function"?n:new this(e,t,n);return this.notify(r),r},n.Method.compile=function(e,t){return e instanceof this?e.compile(t):e},n.Method.__listeners__=[],n.Method.added=function(e,t){this.__listeners__.push([e,t])},n.Method.notify=function(e){var t=this.__listeners__,n=t.length,r;while(n--)r=t[n],r[0].call(r[1],e)},n.Method._keywords=[],n.Method.keyword=function(e,t){this._keywords.push({name:e,filter:t})},n.Method.trace=function(e){var t=e.length;while(t--)e[t].__trace__=!0,e[t].resolve()},n.Method.untrace=function(e){var t=e.length;while(t--)e[t].__trace__=!1,e[t].resolve()},n.Module=n.makeClass(),n.Module.__queue__=[],n.extend(n.Module.prototype,{initialize:function(e,t,r){typeof e!="string"&&(r=arguments[1],t=arguments[0],e=undefined),r=r||{},this.__inc__=[],this.__dep__=[],this.__fns__={},this.__tgt__=r._target,this.__anc__=null,this.__mct__={},this.setName(e),this.include(t,{_resolve:!1}),n.Module.__queue__&&n.Module.__queue__.push(this)},setName:function(e){this.displayName=e||"";for(var t in this.__fns__)this.__name__(t);e&&this.__meta__&&this.__meta__.setName(e+".")},__name__:function(e){if(!this.displayName)return;var t=this.__fns__[e];if(!t)return;e=this.displayName.replace(n.END_WITHOUT_DOT,"$1#")+e;if(typeof t.setName=="function")return t.setName(e);typeof t=="function"&&(t.displayName=e)},define:function(e,t,r){var i=n.Method.create(this,e,t),s=(r||{})._resolve;this.__fns__[e]=i,this.__name__(e),s!==!1&&this.resolve()},include:function(e,t){if(!e)return this;var t=t||{},n=t._resolve!==!1,r=e.extend,i=e.include,s,o,u,a,f,l;if(e.__fns__&&e.__inc__)this.__inc__.push(e),(e.__dep__||{}).push&&e.__dep__.push(this),(s=t._extended)?typeof e.extended=="function"&&e.extended(s):typeof e.included=="function"&&e.included(this);else{if(this.shouldIgnore("extend",r)){a=[].concat(r);for(f=0,l=a.length;f<l;f++)this.extend(a[f])}if(this.shouldIgnore("include",i)){a=[].concat(i);for(f=0,l=a.length;f<l;f++)this.include(a[f],{_resolve:!1})}for(o in e){if(!e.hasOwnProperty(o))continue;u=e[o];if(this.shouldIgnore(o,u))continue;this.define(o,u,{_resolve:!1})}e.hasOwnProperty("toString")&&this.define("toString",e.toString,{_resolve:!1})}return n&&this.resolve(),this},alias:function(e){for(var t in e){if(!e.hasOwnProperty(t))continue;this.define(t,this.instanceMethod(e[t]),{_resolve:!1})}this.resolve()},resolve:function(e){var e=e||this,t=e.__tgt__,r=this.__inc__,i=this.__fns__,s,o,u,a;if(e===this){this.__anc__=null,this.__mct__={},s=this.__dep__.length;while(s--)this.__dep__[s].resolve()}if(!t)return;for(s=0,o=r.length;s<o;s++)r[s].resolve(e);for(u in i)a=n.Method.compile(i[u],e),t[u]!==a&&(t[u]=a);i.hasOwnProperty("toString")&&(t.toString=n.Method.compile(i.toString,e))},shouldIgnore:function(e,t){return(e==="extend"||e==="include")&&(typeof t!="function"||t.__fns__&&t.__inc__)},ancestors:function(e){var t=!e,e=e||[],r=this.__inc__;if(t&&this.__anc__)return this.__anc__.slice();for(var i=0,s=r.length;i<s;i++)r[i].ancestors(e);return n.indexOf(e,this)<0&&e.push(this),t&&(this.__anc__=e.slice()),e},lookup:function(e){var t=this.__mct__[e];if(t&&t.slice)return t.slice();var n=this.ancestors(),r=[],i;for(var s=0,o=n.length;s<o;s++)i=n[s].__fns__,i.hasOwnProperty(e)&&r.push(i[e]);return this.__mct__[e]=r.slice(),r},includes:function(e){if(e===this)return!0;var t=this.__inc__;for(var n=0,r=t.length;n<r;n++)if(t[n].includes(e))return!0;return!1},instanceMethod:function(e){return this.lookup(e).pop()},instanceMethods:function(e,t){var r=t||[],i=this.__fns__,s;for(s in i){if(!n.isType(this.__fns__[s],n.Method))continue;if(n.indexOf(r,s)>=0)continue;r.push(s)}if(e!==!1){var o=this.ancestors(),u=o.length;while(u--)o[u].instanceMethods(!1,r)}return r},match:function(e){return e&&e.isA&&e.isA(this)},toString:function(){return this.displayName}}),n.Kernel=new n.Module("Kernel",{__eigen__:function(){if(this.__meta__)return this.__meta__;var e=this.toString()+".";return this.__meta__=new n.Module(e,null,{_target:this}),this.__meta__.include(this.klass,{_resolve:!1})},equals:function(e){return this===e},extend:function(e,t){var n=(t||{})._resolve;return this.__eigen__().include(e,{_extended:this,_resolve:n}),this},hash:function(){return n.Kernel.hashFor(this)},isA:function(e){return typeof e=="function"&&this instanceof e||this.__eigen__().includes(e)},method:function(e){var t=this.__mct__=this.__mct__||{},r=t[e],i=this[e];if(typeof i!="function")return i;if(r&&i===r._value)return r._bound;var s=n.bind(i,this);return t[e]={_value:i,_bound:s},s},methods:function(){return this.__eigen__().instanceMethods()},tap:function(e,t){return e.call(t,this),this},toString:function(){if(this.displayName)return this.displayName;var e=this.klass.displayName||this.klass.toString();return"#<"+e+":"+this.hash()+">"}}),function(){var e=1;n.Kernel.hashFor=function(t){return t.__hash__!==undefined?t.__hash__:(t.__hash__=((new n.Date).getTime()+e).toString(16),e+=1,t.__hash__)}}(),n.Class=n.makeClass(n.Module),n.extend(n.Class.prototype,{initialize:function(e,t,r,i){typeof e!="string"&&(i=arguments[2],r=arguments[1],t=arguments[0],e=undefined),typeof t!="function"&&(i=r,r=t,t=Object),n.Module.prototype.initialize.call(this,e),i=i||{};var s=n.makeClass(t);n.extend(s,this),s.prototype.constructor=s.prototype.klass=s,s.__eigen__().include(t.__meta__,{_resolve:i._resolve}),s.setName(e),s.__tgt__=s.prototype;var o=t===Object?{}:t.__fns__?t:new n.Module(t.prototype,{_resolve:!1});return s.include(n.Kernel,{_resolve:!1}).include(o,{_resolve:!1}).include(r,{_resolve:!1}),i._resolve!==!1&&s.resolve(),typeof t.inherited=="function"&&t.inherited(s),s}}),function(){var e=function(e){var t={},r=e.prototype;for(var i in r){if(!r.hasOwnProperty(i))continue;t[i]=n.Method.create(e,i,r[i])}return t},t=function(t,r){var i=n[t],s=n[r];i.__inc__=[],i.__dep__=[],i.__fns__=e(i),i.__tgt__=i.prototype,i.prototype.constructor=i.prototype.klass=i,n.extend(i,n.Class.prototype),i.include(s||n.Kernel),i.setName(t),i.constructor=i.klass=n.Class};t("Method"),t("Module"),t("Class","Module");var r=n.Kernel.instanceMethod("__eigen__");r.call(n.Method).resolve(),r.call(n.Module).resolve(),r.call(n.Class).include(n.Module.__meta__)}(),n.NotImplementedError=new n.Class("NotImplementedError",Error),n.Method.keyword("callSuper",function(e,t,r,i){var s=t.lookup(e.name),o=s.length-1,u=n.array(i);if(o===0)return undefined;var a=function(){var e=arguments.length;while(e--)u[e]=arguments[e];o-=1,o===0&&delete r.callSuper;var t=s[o].apply(r,u);return r.callSuper=a,o+=1,t};return a}),n.Method.keyword("blockGiven",function(e,t,n,r){var i=Array.prototype.slice.call(r,e.arity),s=typeof i[0]=="function";return function(){return s}}),n.Method.keyword("yieldWith",function(e,t,n,r){var i=Array.prototype.slice.call(r,e.arity);return function(){if(typeof i[0]!="function")return;return i[0].apply(i[1]||null,arguments)}}),n.Interface=new n.Class("Interface",{initialize:function(e){this.test=function(t,n){var r=e.length;while(r--)if(typeof t[e[r]]!="function")return n?e[r]:!1;return!0}},extend:{ensure:function(){var e=n.array(arguments),t=e.shift(),r,i;while(r=e.shift()){i=r.test(t,!0);if(i!==!0)throw new Error("object does not implement "+i+"()")}}}}),n.Singleton=new n.Class("Singleton",{initialize:function(e,t,r){return new new n.Class(e,t,r)}}),n.extend(t,n),e.JS&&n.extend(e.JS,n)}),define("bpmn/util/JSClass",function(){}),define("bpmn/util/Index",["bpmn/util/JSClass"],function(e){var t={initialize:function(){this._={}},add:function(e,t){this._[e]=t},addArray:function(e,t){this._[e]||(this._[e]=[]),this._[e].push(t)},addMap:function(e,t,n){this._[e]||(this._[e]={}),this._[e][t]=n},item:function(e){return this._[e]}};return new e.Class(t)}),define("bpmn/Clazz",["bpmn/util/JSClass"],function(e){var t={initialize:function(){this.text=null,this.reference={},this.attribute={}},addReference:function(e){this.reference[e.name]=e;var t=this.__internalFieldName(e.name);e.containment===!0?this[t]=[]:this[t]=null,this[e.name]=function(t){return this.accessor(e.name,t)}},addAttribute:function(e){this.attribute[e.name]=e,this[e.name]=function(t){return this.accessor(e.name,t)}},accessor:function(e,t){var n=this.__internalFieldName(e);return t!=null&&t!=undefined&&(this[n]=t),this[n]},__internalFieldName:function(e){return"_"+e},init:function(){},setText:function(e){this.text=e}};return new e.Class(t)}),define("bpmn/BaseElement",["bpmn/util/JSClass","bpmn/Clazz"],function(e,t){var n={tag:"baseElement",initialize:function(){this.callSuper(),this.addReference({name:"documentation",type:function(){}}),this.addAttribute({name:"id",type:String}),this.addAttribute({name:"name",type:String});var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)});this.id(e)},init:function(){var e=this.id();this._definitions.index.add(e,this),this._definitions.index.addMap(this.declaredClass,e,this)}};return new e.Class(t,n)}),define("bpmn/CallableElement",["bpmn/util/JSClass","bpmn/BaseElement"],function(e,t){var n={initialize:function(){this.callSuper(),this.addAttribute({name:"name",type:String})},init:function(){this.callSuper()}};return new e.Class(t,n)}),define("bpmn/Package",["bpmn/util/JSClass"],function(e){var t={tagMap:{},initialize:function(){},registerClass:function(e){var t=e.prototype.tag;return t&&(this.tagMap[t.toLowerCase()]=e),e}},n=new e.Class(t);return new n}),define("bpmn/FlowElement",["bpmn/util/JSClass","bpmn/BaseElement","bpmn/Package"],function(e,t,n){var r={tag:"flowElement",initialize:function(){this.callSuper()},init:function(){this.callSuper()},getDiagramElement:function(){return this._definitions.index.item(this.id()+":di")},getBounds:function(){return this.getDiagramElement().bounds()},getWaypoints:function(){return this.getDiagramElement().waypoints()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/FlowElementsContainer",["bpmn/util/JSClass","bpmn/BaseElement","bpmn/FlowElement"],function(e,t,n){var r={initialize:function(){this.callSuper(),this.addReference({name:"flowElements",containment:!0,type:n})},init:function(){this.callSuper()}};return new e.Module(r)}),define("bpmn/Process",["bpmn/util/JSClass","bpmn/CallableElement","bpmn/FlowElementsContainer","bpmn/Package"],function(e,t,n,r){var i={include:[n],tag:"process",initialize:function(){this.callSuper(),this.addAttribute({name:"isExecutable",type:"boolean"}),this.addAttribute({name:"name",type:String})}},s=new e.Class(t,i);return r.registerClass(s)}),define("bpmn/Collaboration",["bpmn/util/JSClass","bpmn/Package"],function(e,t){var n={tag:"collaboration",initialize:function(){}},r=new e.Class(n);return t.registerClass(r),r}),define("bpmn/di/DiagramElement",["bpmn/util/JSClass","bpmn/Clazz","bpmn/Package"],function(e,t,n){var r={tag:"diagramElement",initialize:function(){this.callSuper(),this.addAttribute({name:"id",type:String}),this.addAttribute({name:"bpmnElement",type:String})},init:function(){this._definitions.index.add(this.bpmnElement()+":di",this)}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/di/Bounds",["bpmn/util/JSClass","bpmn/Clazz","bpmn/Package"],function(e,t,n){var r={tag:"Bounds",initialize:function(){this.callSuper(),this.addAttribute({name:"x",type:"float"}),this.addAttribute({name:"y",type:"float"}),this.addAttribute({name:"width",type:"float"}),this.addAttribute({name:"height",type:"float"})},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/di/BPMNShape",["bpmn/util/JSClass","bpmn/di/DiagramElement","bpmn/di/Bounds","bpmn/Package"],function(e,t,n,r){var i={tag:"BPMNShape",initialize:function(){this.callSuper(),this.addReference({name:"bounds",type:n})},init:function(){this.callSuper()}},s=new e.Class(t,i);return r.registerClass(s),s}),define("bpmn/di/Waypoint",["bpmn/util/JSClass","bpmn/Clazz","bpmn/Package"],function(e,t,n){var r={tag:"waypoint",initialize:function(){this.callSuper(),this.addAttribute({name:"x",type:"float"}),this.addAttribute({name:"y",type:"float"})},init:function(){this.callSuper()},__internalFieldName:function(e){return e}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/di/BPMNEdge",["bpmn/util/JSClass","bpmn/di/DiagramElement","bpmn/di/Waypoint","bpmn/Package"],function(e,t,n,r){var i={tag:"BPMNEdge",initialize:function(){this.callSuper(),this.addReference({name:"waypoints",containment:!0,type:n})},init:function(){this.callSuper()}},s=new e.Class(t,i);return r.registerClass(s),s}),define("bpmn/di/BPMNPlane",["bpmn/util/JSClass","bpmn/Clazz","bpmn/Package","bpmn/di/BPMNShape","bpmn/di/BPMNEdge","bpmn/di/DiagramElement"],function(e,t,n,r,i,s){var o={tag:"BPMNPlane",initialize:function(){this.callSuper(),this.addReference({name:"diagramElements",containment:!0,type:s})},init:function(){this.callSuper()}},u=new e.Class(t,o);return n.registerClass(u),u}),define("bpmn/di/BPMNDiagram",["bpmn/util/JSClass","bpmn/Clazz","bpmn/di/BPMNPlane","bpmn/Package"],function(e,t,n,r){var i={tag:"BPMNDiagram",initialize:function(){this.callSuper(),this.addReference({name:"plane",type:n})}},s=new e.Class(t,i);return r.registerClass(s),s}),define("bpmn/FlowNode",["bpmn/util/JSClass","bpmn/FlowElement","bpmn/Package"],function(e,t,n){var r={tag:"flowNode",initialize:function(){this.callSuper()},init:function(){this.callSuper()},incoming:function(){var e=this._definitions.index.item("target:"+this.id());return e?e:[]},outgoing:function(){var e=this._definitions.index.item("source:"+this.id());return e?e:[]}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/Event",["bpmn/util/JSClass","bpmn/FlowNode","bpmn/Package"],function(e,t,n){var r={tag:"event",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/CatchEvent",["bpmn/util/JSClass","bpmn/Event","bpmn/Package"],function(e,t,n){var r={tag:"catchEvent",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/StartEvent",["bpmn/util/JSClass","bpmn/CatchEvent","bpmn/Package"],function(e,t,n){var r={tag:"startEvent",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/ThrowEvent",["bpmn/util/JSClass","bpmn/Event","bpmn/Package"],function(e,t,n){var r={tag:"throwEvent",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/EndEvent",["bpmn/util/JSClass","bpmn/ThrowEvent","bpmn/Package"],function(e,t,n){var r={tag:"endEvent",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/BoundaryEvent",["bpmn/util/JSClass","bpmn/CatchEvent","bpmn/Package"],function(e,t,n){var r={tag:"boundaryEvent",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/Activity",["bpmn/util/JSClass","bpmn/FlowNode","bpmn/Package"],function(e,t,n){var r={tag:"activity",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/Task",["bpmn/util/JSClass","bpmn/Activity","bpmn/Package"],function(e,t,n){var r={tag:"task",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/UserTask",["bpmn/util/JSClass","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"userTask",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/ServiceTask",["bpmn/util/JSClass","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"serviceTask",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/BusinessRuleTask",["bpmn/util/JSClass","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"businessRuleTask",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/ReceiveTask",["bpmn/util/JSClass","bpmn/Task","bpmn/Package"],function(e,t,n){var r={tag:"receiveTask",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/SubProcess",["bpmn/util/JSClass","bpmn/Activity","bpmn/FlowElementsContainer","bpmn/Package"],function(e,t,n,r){var i={include:[n],tag:"subProcess",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},s=new e.Class(t,i);return r.registerClass(s),s}),define("bpmn/Gateway",["bpmn/util/JSClass","bpmn/FlowNode","bpmn/Package"],function(e,t,n){var r={tag:"gateway",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/ExclusiveGateway",["bpmn/util/JSClass","bpmn/Gateway","bpmn/Package"],function(e,t,n){var r={tag:"exclusiveGateway",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/ParallelGateway",["bpmn/util/JSClass","bpmn/Gateway","bpmn/Package"],function(e,t,n){var r={tag:"parallelGateway",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/ConditionExpression",["bpmn/util/JSClass","bpmn/BaseElement","bpmn/Package"],function(e,t,n){var r={tag:"conditionExpression",initialize:function(){this.callSuper()},init:function(){this.callSuper()}},i=new e.Class(t,r);return n.registerClass(i),i}),define("bpmn/SequenceFlow",["bpmn/util/JSClass","bpmn/FlowElement","bpmn/ConditionExpression","bpmn/Package"],function(e,t,n,r){var i={tag:"sequenceFlow",initialize:function(){this.callSuper(),this.addAttribute({name:"sourceRef",type:String}),this.addAttribute({name:"targetRef",type:String}),this.addReference({name:"conditionExpression",type:n})},getSourceRef:function(){return this._definitions.index.item(this._sourceRef)},getTargetRef:function(){return this._definitions.index.item(this._targetRef)},init:function(){this.callSuper(),this._definitions.index.addArray||(console.log("cant addArray"+this.id()),console.log(this._definitions.index.tag)),this._definitions.index.addArray("target:"+this.targetRef(),this),this._definitions.index.addArray("source:"+this.sourceRef(),this)}},s=new e.Class(t,i);return r.registerClass(s),s}),define("bpmn/Definitions",["bpmn/util/JSClass","bpmn/util/Index","bpmn/BaseElement","bpmn/Process","bpmn/Collaboration","bpmn/di/BPMNDiagram","bpmn/StartEvent","bpmn/EndEvent","bpmn/BoundaryEvent","bpmn/UserTask","bpmn/ServiceTask","bpmn/BusinessRuleTask","bpmn/ReceiveTask","bpmn/SubProcess","bpmn/ExclusiveGateway","bpmn/ParallelGateway","bpmn/SequenceFlow"],function(e,t,n,r,i,s){var o={tag:"definitions",initialize:function(){this.callSuper(),this.addReference({name:"collaboration",type:i}),this.addReference({name:"process",containment:!0,type:r}),this.addReference({name:"bpmnDiagram",type:s}),this.index=new t}};return new e.Class(n,o)}),define("bpmn/execution/TokenStore",["bpmn/util/JSClass"],function(e){var t={constructor:function(e){this.tokenMap=e?e:{}},add:function(e,t){this.tokenMap[e]||(this.tokenMap[e]=[]),this.tokenMap[e].push(t)},drop:function(e,t){if(this.tokenMap[e])for(var n=0;n<t;n++)this.tokenMap[e].pop()},query:function(e){return this.tokenMap[e]?this.tokenMap[e]:[]},count:function(){var e=0;for(var t in this.tokenMap)e+=this.tokenMap[t].length;return e}};return new e.Class(t)}),function(){function W(e,t,n){var r=(n||0)-1,i=e?e.length:0;while(++r<i)if(e[r]===t)return r;return-1}function X(e,t){var n=typeof t;e=e.cache;if(n=="boolean"||t==null)return e[t]?0:-1;n!="number"&&n!="string"&&(n="object");var r=n=="number"?t:s+t;return e=(e=e[n])&&e[r],n=="object"?e&&W(e,t)>-1?0:-1:e?0:-1}function V(e){var t=this.cache,n=typeof e;if(n=="boolean"||e==null)t[e]=!0;else{n!="number"&&n!="string"&&(n="object");var r=n=="number"?e:s+e,i=t[n]||(t[n]={});n=="object"?(i[r]||(i[r]=[])).push(e):i[r]=!0}}function $(e){return e.charCodeAt(0)}function J(e,t){var n=e.criteria,r=t.criteria,i=-1,s=n.length;while(++i<s){var o=n[i],u=r[i];if(o!==u){if(o>u||typeof o=="undefined")return 1;if(o<u||typeof u=="undefined")return-1}}return e.index-t.index}function K(e){var t=-1,n=e.length,r=e[0],i=e[n/2|0],s=e[n-1];if(r&&typeof r=="object"&&i&&typeof i=="object"&&s&&typeof s=="object")return!1;var o=Y();o["false"]=o["null"]=o["true"]=o["undefined"]=!1;var u=Y();u.array=e,u.cache=o,u.push=V;while(++t<n)u.push(e[t]);return u}function Q(e){return"\\"+F[e]}function G(){return t.pop()||[]}function Y(){return n.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,"undefined":!1,value:null}}function Z(e){return typeof e.toString!="function"&&typeof (e+"")=="string"}function et(e){e.length=0,t.length<u&&t.push(e)}function tt(e){var t=e.cache;t&&tt(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,n.length<u&&n.push(e)}function nt(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i)s[r]=e[t+r];return s}function rt(t){function Ft(e){return e&&typeof e=="object"&&!ln(e)&&wt.call(e,"__wrapped__")?e:new It(e)}function It(e,t){this.__chain__=!!t,this.__wrapped__=e}function Ut(e){function i(){if(n){var e=nt(n);Et.apply(e,arguments)}if(this instanceof i){var s=Wt(t.prototype),o=t.apply(s,e||arguments);return Un(o)?o:s}return t.apply(r,e||arguments)}var t=e[0],n=e[2],r=e[4];return on(i,e),i}function zt(e,t,n,r,i){if(n){var s=n(e);if(typeof s!="undefined")return s}var o=Un(e);if(!o)return e;var u=pt.call(e);if(!D[u]||!qt.nodeClass&&Z(e))return e;var a=Bt[u];switch(u){case N:case C:return new a(+e);case A:case _:return new a(e);case M:return s=a(e.source,p.exec(e)),s.lastIndex=e.lastIndex,s}var f=ln(e);if(t){var l=!r;r||(r=G()),i||(i=G());var c=r.length;while(c--)if(r[c]==e)return i[c];s=f?a(e.length):{}}else s=f?nt(e):En({},e);return f&&(wt.call(e,"index")&&(s.index=e.index),wt.call(e,"input")&&(s.input=e.input)),t?(r.push(e),i.push(s),(f?wn:On)(e,function(e,o){s[o]=zt(e,t,n,r,i)}),l&&(et(r),et(i)),s):s}function Wt(e,t){return Un(e)?kt(e):{}}function Xt(e,t,n){if(typeof e!="function")return vi;if(typeof t!="undefined"&&"prototype"in e){var r=e.__bindData__;if(typeof r=="undefined"){qt.funcNames&&(r=!e.name),r=r||!qt.funcDecomp;if(!r){var i=yt.call(e);qt.funcNames||(r=!d.test(i)),r||(r=y.test(i),on(e,r))}}if(r===!1||r!==!0&&r[1]&1)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return Yr(e,t)}return e}function Vt(e){function h(){var e=u?s:this;if(r){var p=nt(r);Et.apply(p,arguments)}if(i||f){p||(p=nt(arguments)),i&&Et.apply(p,i);if(f&&p.length<o)return n|=16,Vt([t,l?n:n&-4,p,null,s,o])}p||(p=arguments),a&&(t=e[c]);if(this instanceof h){e=Wt(t.prototype);var d=t.apply(e,p);return Un(d)?d:e}return t.apply(e,p)}var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=n&1,a=n&2,f=n&4,l=n&8,c=t;return on(h,e),h}function $t(e,t){var n=-1,r=rn(),i=e?e.length:0,s=i>=o&&r===W,u=[];if(s){var a=K(t);a?(r=X,t=a):s=!1}while(++n<i){var f=e[n];r(t,f)<0&&u.push(f)}return s&&tt(t),u}function Jt(e,t,n,r){var i=(r||0)-1,s=e?e.length:0,o=[];while(++i<s){var u=e[i];if(u&&typeof u=="object"&&typeof u.length=="number"&&(ln(u)||fn(u))){t||(u=Jt(u,t,n));var a=-1,f=u.length,l=o.length;o.length+=f;while(++a<f)o[l++]=u[a]}else n||o.push(u)}return o}function Kt(e,t,n,r,i,s){if(n){var o=n(e,t);if(typeof o!="undefined")return!!o}if(e===t)return e!==0||1/e==1/t;var u=typeof e,a=typeof t;if(e===e&&(!e||!j[u])&&(!t||!j[a]))return!1;if(e==null||t==null)return e===t;var f=pt.call(e),l=pt.call(t);f==x&&(f=O),l==x&&(l=O);if(f!=l)return!1;switch(f){case N:case C:return+e==+t;case A:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case M:case _:return e==ot(t)}var c=f==T;if(!c){var h=wt.call(e,"__wrapped__"),p=wt.call(t,"__wrapped__");if(h||p)return Kt(h?e.__wrapped__:e,p?t.__wrapped__:t,n,r,i,s);if(f!=O||!qt.nodeClass&&(Z(e)||Z(t)))return!1;var d=!qt.argsObject&&fn(e)?V:e.constructor,v=!qt.argsObject&&fn(t)?V:t.constructor;if(d!=v&&!(Rn(d)&&d instanceof d&&Rn(v)&&v instanceof v)&&"constructor"in e&&"constructor"in t)return!1}var m=!i;i||(i=G()),s||(s=G());var g=i.length;while(g--)if(i[g]==e)return s[g]==t;var y=0;o=!0,i.push(e),s.push(t);if(c){g=e.length,y=t.length,o=y==g;if(o||r)while(y--){var b=g,w=t[y];if(r){while(b--)if(o=Kt(e[b],w,n,r,i,s))break}else if(!(o=Kt(e[y],w,n,r,i,s)))break}}else Ln(t,function(t,u,a){if(wt.call(a,u))return y++,o=wt.call(e,u)&&Kt(e[u],t,n,r,i,s)}),o&&!r&&Ln(e,function(e,t,n){if(wt.call(n,t))return o=--y>-1});return i.pop(),s.pop(),m&&(et(i),et(s)),o}function Qt(e,t,n,r,i){(ln(t)?lr:On)(t,function(t,s){var o,u,a=t,f=e[s];if(t&&((u=ln(t))||Vn(t))){var l=r.length;while(l--)if(o=r[l]==t){f=i[l];break}if(!o){var c;if(n){a=n(f,t);if(c=typeof a!="undefined")f=a}c||(f=u?ln(f)?f:[]:Vn(f)?f:{}),r.push(t),i.push(f),c||Qt(f,t,n,r,i)}}else n&&(a=n(f,t),typeof a=="undefined"&&(a=t)),typeof a!="undefined"&&(f=a);e[s]=f})}function Gt(e,t){return e+gt(Ht()*(t-e+1))}function Yt(e,t,n){var r=-1,i=rn(),s=e?e.length:0,u=[],a=!t&&s>=o&&i===W,f=n||a?G():u;if(a){var l=K(f);i=X,f=l}while(++r<s){var c=e[r],h=n?n(c,r,e):c;if(t?!r||f[f.length-1]!==h:i(f,h)<0)(n||a)&&f.push(h),u.push(c)}return a?(et(f.array),tt(f)):n&&et(f),u}function Zt(e){return function(t,n,r){var i={};n=Ft.createCallback(n,r,3);if(ln(t)){var s=-1,o=t.length;while(++s<o){var u=t[s];e(i,u,n(u,s,t),t)}}else wn(t,function(t,r,s){e(i,t,n(t,r,s),s)});return i}}function en(e,t,n,r,i,s){var o=t&1,u=t&2,a=t&4,f=t&8,l=t&16,c=t&32;if(!u&&!Rn(e))throw new ut;l&&!n.length&&(t&=-17,l=n=!1),c&&!r.length&&(t&=-33,c=r=!1);var h=e&&e.__bindData__;if(h&&h!==!0)return h=nt(h),h[2]&&(h[2]=nt(h[2])),h[3]&&(h[3]=nt(h[3])),o&&!(h[1]&1)&&(h[4]=i),!o&&h[1]&1&&(t|=8),a&&!(h[1]&4)&&(h[5]=s),l&&Et.apply(h[2]||(h[2]=[]),n),c&&Nt.apply(h[3]||(h[3]=[]),r),h[1]|=t,en.apply(null,h);var p=t==1||t===17?Ut:Vt;return p([e,t,n,r,i,s])}function tn(){B.shadowedProps=E,B.support=qt,B.array=B.bottom=B.loop=B.top="",B.init="iterable",B.useHas=!0;for(var e,t=0;e=arguments[t];t++)for(var n in e)B[n]=e[n];var r=B.args;B.firstArg=/^[^,]+/.exec(r)[0];var s=R("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+r+") {\n"+Rt(B)+"\n}");return s(Xt,k,ft,wt,i,fn,ln,Jn,B.keys,lt,j,jt,_,ct,pt)}function nn(e){return mn[e]}function rn(){var e=(e=Ft.indexOf)===Hr?W:e;return e}function sn(e){return typeof e=="function"&&dt.test(e)}function un(e){var t,n;return!e||pt.call(e)!=O||(t=e.constructor,Rn(t)&&!(t instanceof t))||!qt.argsClass&&fn(e)||!qt.nodeClass&&Z(e)?!1:qt.ownLast?(Ln(e,function(e,t,r){return n=wt.call(r,t),!1}),n!==!1):(Ln(e,function(e,t){n=t}),typeof n=="undefined"||wt.call(e,n))}function an(e){return gn[e]}function fn(e){return e&&typeof e=="object"&&typeof e.length=="number"&&pt.call(e)==x||!1}function Sn(e,t,n,r){return typeof t!="boolean"&&t!=null&&(r=n,n=t,t=!1),zt(e,t,typeof n=="function"&&Xt(n,r,1))}function xn(e,t,n){return zt(e,!0,typeof t=="function"&&Xt(t,n,1))}function Tn(e,t){var n=Wt(e);return t?En(n,t):n}function Cn(e,t,n){var r;return t=Ft.createCallback(t,n,3),On(e,function(e,n,i){if(t(e,n,i))return r=n,!1}),r}function kn(e,t,n){var r;return t=Ft.createCallback(t,n,3),Mn(e,function(e,n,i){if(t(e,n,i))return r=n,!1}),r}function An(e,t,n){var r=[];Ln(e,function(e,t){r.push(t,e)});var i=r.length;t=Xt(t,n,3);while(i--)if(t(r[i--],r[i],e)===!1)break;return e}function Mn(e,t,n){var r=hn(e),i=r.length;t=Xt(t,n,3);while(i--){var s=r[i];if(t(e[s],s,e)===!1)break}return e}function _n(e){var t=[];return Ln(e,function(e,n){Rn(e)&&t.push(n)}),t.sort()}function Dn(e,t){return e?wt.call(e,t):!1}function Pn(e){var t=-1,n=hn(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function Hn(e){return e===!0||e===!1||e&&typeof e=="object"&&pt.call(e)==N||!1}function Bn(e){return e&&typeof e=="object"&&pt.call(e)==C||!1}function jn(e){return e&&e.nodeType===1||!1}function Fn(e){var t=!0;if(!e)return t;var n=pt.call(e),r=e.length;return n==T||n==_||(qt.argsClass?n==x:fn(e))||n==O&&typeof r=="number"&&Rn(e.splice)?!r:(On(e,function(){return t=!1}),t)}function In(e,t,n,r){return Kt(e,t,typeof n=="function"&&Xt(n,r,2))}function qn(e){return At(e)&&!Ot(parseFloat(e))}function Rn(e){return typeof e=="function"}function Un(e){return!!e&&!!j[typeof e]}function zn(e){return Xn(e)&&e!=+e}function Wn(e){return e===null}function Xn(e){return typeof e=="number"||e&&typeof e=="object"&&pt.call(e)==A||!1}function $n(e){return e&&j[typeof e]&&pt.call(e)==M||!1}function Jn(e){return typeof e=="string"||e&&typeof e=="object"&&pt.call(e)==_||!1}function Kn(e){return typeof e=="undefined"}function Qn(e,t,n){var r={};return t=Ft.createCallback(t,n,3),On(e,function(e,n,i){r[n]=t(e,n,i)}),r}function Gn(e){var t=arguments,n=2;if(!Un(e))return e;typeof t[2]!="number"&&(n=t.length);if(n>3&&typeof t[n-2]=="function")var r=Xt(t[--n-1],t[n--],2);else n>2&&typeof t[n-1]=="function"&&(r=t[--n]);var i=nt(arguments,1,n),s=-1,o=G(),u=G();while(++s<n)Qt(e,i[s],r,o,u);return et(o),et(u),e}function Yn(e,t,n){var r={};if(typeof t!="function"){var i=[];Ln(e,function(e,t){i.push(t)}),i=$t(i,Jt(arguments,!0,!1,1));var s=-1,o=i.length;while(++s<o){var u=i[s];r[u]=e[u]}}else t=Ft.createCallback(t,n,3),Ln(e,function(e,n,i){t(e,n,i)||(r[n]=e)});return r}function Zn(e){var t=-1,r=hn(e),i=r.length,s=n(i);while(++t<i){var o=r[t];s[t]=[o,e[o]]}return s}function er(e,t,n){var r={};if(typeof t!="function"){var i=-1,s=Jt(arguments,!0,!1,1),o=Un(e)?s.length:0;while(++i<o){var u=s[i];u in e&&(r[u]=e[u])}}else t=Ft.createCallback(t,n,3),Ln(e,function(e,n,i){t(e,n,i)&&(r[n]=e)});return r}function tr(e,t,n,r){var i=ln(e);if(n==null)if(i)n=[];else{var s=e&&e.constructor,o=s&&s.prototype;n=Wt(o)}return t&&(t=Ft.createCallback(t,r,4),(i?wn:On)(e,function(e,r,i){return t(n,e,r,i)})),n}function nr(e){var t=-1,r=hn(e),i=r.length,s=n(i);while(++t<i)s[t]=e[r[t]];return s}function rr(e){var t=arguments,r=-1,i=Jt(t,!0,!1,1),s=t[2]&&t[2][t[1]]===e?1:i.length,o=n(s);qt.unindexedChars&&Jn(e)&&(e=e.split(""));while(++r<s)o[r]=e[i[r]];return o}function ir(e,t,n){var r=-1,i=rn(),s=e?e.length:0,o=!1;return n=(n<0?_t(0,s+n):n)||0,ln(e)?o=i(e,t,n)>-1:typeof s=="number"?o=(Jn(e)?e.indexOf(t,n):i(e,t,n))>-1:wn(e,function(e){if(++r>=n)return!(o=e===t)}),o}function or(e,t,n){var r=!0;t=Ft.createCallback(t,n,3);if(ln(e)){var i=-1,s=e.length;while(++i<s)if(!(r=!!t(e[i],i,e)))break}else wn(e,function(e,n,i){return r=!!t(e,n,i)});return r}function ur(e,t,n){var r=[];t=Ft.createCallback(t,n,3);if(ln(e)){var i=-1,s=e.length;while(++i<s){var o=e[i];t(o,i,e)&&r.push(o)}}else wn(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function ar(e,t,n){t=Ft.createCallback(t,n,3);if(!ln(e)){var o;return wn(e,function(e,n,r){if(t(e,n,r))return o=e,!1}),o}var r=-1,i=e.length;while(++r<i){var s=e[r];if(t(s,r,e))return s}}function fr(e,t,n){var r;return t=Ft.createCallback(t,n,3),cr(e,function(e,n,i){if(t(e,n,i))return r=e,!1}),r}function lr(e,t,n){if(t&&typeof n=="undefined"&&ln(e)){var r=-1,i=e.length;while(++r<i)if(t(e[r],r,e)===!1)break}else wn(e,t,n);return e}function cr(e,t,n){var r=e,i=e?e.length:0;t=t&&typeof n=="undefined"?t:Xt(t,n,3);if(ln(e)){while(i--)if(t(e[i],i,e)===!1)break}else{if(typeof i!="number"){var s=hn(e);i=s.length}else qt.unindexedChars&&Jn(e)&&(r=e.split(""));wn(e,function(e,n,o){return n=s?s[--i]:--i,t(r[n],n,o)})}return e}function dr(e,t){var r=nt(arguments,2),i=-1,s=typeof t=="function",o=e?e.length:0,u=n(typeof o=="number"?o:0);return lr(e,function(e){u[++i]=(s?t:e[t]).apply(e,r)}),u}function vr(e,t,r){var i=-1,s=e?e.length:0,o=n(typeof s=="number"?s:0);t=Ft.createCallback(t,r,3);if(ln(e))while(++i<s)o[i]=t(e[i],i,e);else wn(e,function(e,n,r){o[++i]=t(e,n,r)});return o}function mr(e,t,n){var r=-Infinity,i=r;typeof t!="function"&&n&&n[t]===e&&(t=null);if(t==null&&ln(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u>i&&(i=u)}}else t=t==null&&Jn(e)?$:Ft.createCallback(t,n,3),wn(e,function(e,n,s){var o=t(e,n,s);o>r&&(r=o,i=e)});return i}function gr(e,t,n){var r=Infinity,i=r;typeof t!="function"&&n&&n[t]===e&&(t=null);if(t==null&&ln(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u<i&&(i=u)}}else t=t==null&&Jn(e)?$:Ft.createCallback(t,n,3),wn(e,function(e,n,s){var o=t(e,n,s);o<r&&(r=o,i=e)});return i}function br(e,t,n,r){var i=arguments.length<3;t=Ft.createCallback(t,r,4);if(ln(e)){var s=-1,o=e.length;i&&(n=e[++s]);while(++s<o)n=t(n,e[s],s,e)}else wn(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function wr(e,t,n,r){var i=arguments.length<3;return t=Ft.createCallback(t,r,4),cr(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)}),n}function Er(e,t,n){return t=Ft.createCallback(t,n,3),ur(e,function(e,n,r){return!t(e,n,r)})}function Sr(t,n,r){t&&typeof t.length!="number"?t=nr(t):qt.unindexedChars&&Jn(t)&&(t=t.split(""));if(n==null||r)return t?t[Gt(0,t.length-1)]:e;var i=xr(t);return i.length=Dt(_t(0,n),i.length),i}function xr(e){var t=-1,r=e?e.length:0,i=n(typeof r=="number"?r:0);return lr(e,function(e){var n=Gt(0,++t);i[t]=i[n],i[n]=e}),i}function Tr(e){var t=e?e.length:0;return typeof t=="number"?t:hn(e).length}function Nr(e,t,n){var r;t=Ft.createCallback(t,n,3);if(ln(e)){var i=-1,s=e.length;while(++i<s)if(r=t(e[i],i,e))break}else wn(e,function(e,n,i){return!(r=t(e,n,i))});return!!r}function Cr(e,t,r){var i=-1,s=ln(t),o=e?e.length:0,u=n(typeof o=="number"?o:0);s||(t=Ft.createCallback(t,r,3)),lr(e,function(e,n,r){var o=u[++i]=Y();s?o.criteria=vr(t,function(t){return e[t]}):(o.criteria=G())[0]=t(e,n,r),o.index=i,o.value=e}),o=u.length,u.sort(J);while(o--){var a=u[o];u[o]=a.value,s||et(a.criteria),tt(a)}return u}function kr(e){return e&&typeof e.length=="number"?qt.unindexedChars&&Jn(e)?e.split(""):nt(e):nr(e)}function Ar(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];i&&r.push(i)}return r}function Or(e){return $t(e,Jt(arguments,!0,!0,1))}function Mr(e,t,n){var r=-1,i=e?e.length:0;t=Ft.createCallback(t,n,3);while(++r<i)if(t(e[r],r,e))return r;return-1}function _r(e,t,n){var r=e?e.length:0;t=Ft.createCallback(t,n,3);while(r--)if(t(e[r],r,e))return r;return-1}function Dr(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=-1;n=Ft.createCallback(n,r,3);while(++o<s&&n(t[o],o,t))i++}else{i=n;if(i==null||r)return t?t[0]:e}return nt(t,0,Dt(_t(0,i),s))}function Pr(e,t,n,r){return typeof t!="boolean"&&t!=null&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=!1),n!=null&&(e=vr(e,n,r)),Jt(e,t)}function Hr(e,t,n){if(typeof n=="number"){var r=e?e.length:0;n=n<0?_t(0,r+n):n||0}else if(n){var i=Wr(e,t);return e[i]===t?i:-1}return W(e,t,n)}function Br(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&t!=null){var s=i;t=Ft.createCallback(t,n,3);while(s--&&t(e[s],s,e))r++}else r=t==null||n?1:t||r;return nt(e,0,Dt(_t(0,i-r),i))}function jr(){var e=[],t=-1,n=arguments.length,r=G(),i=rn(),s=i===W,u=G();while(++t<n){var a=arguments[t];if(ln(a)||fn(a))e.push(a),r.push(s&&a.length>=o&&K(t?e[t]:u))}var f=e[0],l=-1,c=f?f.length:0,h=[];e:while(++l<c){var p=r[0];a=f[l];if((p?X(p,a):i(u,a))<0){t=n,(p||u).push(a);while(--t){p=r[t];if((p?X(p,a):i(e[t],a))<0)continue e}h.push(a)}}while(n--)p=r[n],p&&tt(p);return et(r),et(u),h}function Fr(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=s;n=Ft.createCallback(n,r,3);while(o--&&n(t[o],o,t))i++}else{i=n;if(i==null||r)return t?t[s-1]:e}return nt(t,_t(0,s-i))}function Ir(e,t,n){var r=e?e.length:0;typeof n=="number"&&(r=(n<0?_t(0,r+n):Dt(n,r-1))+1);while(r--)if(e[r]===t)return r;return-1}function qr(e){var t=arguments,n=0,r=t.length,i=e?e.length:0;while(++n<r){var s=-1,o=t[n];while(++s<i)e[s]===o&&(Tt.call(e,s--,1),i--)}return e}function Rr(e,t,r){e=+e||0,r=typeof r=="number"?r:+r||1,t==null&&(t=e,e=0);var i=-1,s=_t(0,vt((t-e)/(r||1))),o=n(s);while(++i<s)o[i]=e,e+=r;return o}function Ur(e,t,n){var r=-1,i=e?e.length:0,s=[];t=Ft.createCallback(t,n,3);while(++r<i){var o=e[r];t(o,r,e)&&(s.push(o),Tt.call(e,r--,1),i--)}return s}function zr(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=Ft.createCallback(t,n,3);while(++i<s&&t(e[i],i,e))r++}else r=t==null||n?1:_t(0,t);return nt(e,r)}function Wr(e,t,n,r){var i=0,s=e?e.length:i;n=n?Ft.createCallback(n,r,1):vi,t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function Xr(){return Yt(Jt(arguments,!0,!0))}function Vr(e,t,n,r){return typeof t!="boolean"&&t!=null&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=!1),n!=null&&(n=Ft.createCallback(n,r,3)),Yt(e,t,n)}function $r(e){return $t(e,nt(arguments,1))}function Jr(){var e=-1,t=arguments.length;while(++e<t){var n=arguments[e];if(ln(n)||fn(n))var r=r?Yt($t(r,n).concat($t(n,r))):n}return r||[]}function Kr(){var e=arguments.length>1?arguments:arguments[0],t=-1,r=e?mr(yr(e,"length")):0,i=n(r<0?0:r);while(++t<r)i[t]=yr(e,t);return i}function Qr(e,t){var n=-1,r=e?e.length:0,i={};!t&&r&&!ln(e[0])&&(t=[]);while(++n<r){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function Gr(e,t){if(!Rn(t))throw new ut;return function(){if(--e<1)return t.apply(this,arguments)}}function Yr(e,t){return arguments.length>2?en(e,17,nt(arguments,2),null,t):en(e,1,null,null,t)}function Zr(e){var t=arguments.length>1?Jt(arguments,!0,!1,1):_n(e),n=-1,r=t.length;while(++n<r){var i=t[n];e[i]=en(e[i],1,null,null,e)}return e}function ei(e,t){return arguments.length>2?en(t,19,nt(arguments,2),null,e):en(t,3,null,null,e)}function ti(){var e=arguments,t=e.length;while(t--)if(!Rn(e[t]))throw new ut;return function(){var t=arguments,n=e.length;while(n--)t=[e[n].apply(this,t)];return t[0]}}function ni(e,t){return t=typeof t=="number"?t:+t||e.length,en(e,4,null,null,null,t)}function ri(t,n,r){var i,s,o,u,a,f,l,c=0,h=!1,p=!0;if(!Rn(t))throw new ut;n=_t(0,n)||0;if(r===!0){var d=!0;p=!1}else Un(r)&&(d=r.leading,h="maxWait"in r&&(_t(n,r.maxWait)||0),p="trailing"in r?r.trailing:p);var v=function(){var r=n-(bi()-u);if(r<=0){s&&mt(s);var h=l;s=f=l=e,h&&(c=bi(),o=t.apply(a,i),!f&&!s&&(i=a=null))}else f=xt(v,r)},m=function(){f&&mt(f),s=f=l=e;if(p||h!==n)c=bi(),o=t.apply(a,i),!f&&!s&&(i=a=null)};return function(){i=arguments,u=bi(),a=this,l=p&&(f||!d);if(h===!1)var e=d&&!f;else{!s&&!d&&(c=u);var r=h-(u-c),g=r<=0;g?(s&&(s=mt(s)),c=u,o=t.apply(a,i)):s||(s=xt(m,r))}return g&&f?f=mt(f):!f&&n!==h&&(f=xt(v,n)),e&&(g=!0,o=t.apply(a,i)),g&&!f&&!s&&(i=a=null),o}}function ii(t){if(!Rn(t))throw new ut;var n=nt(arguments,1);return xt(function(){t.apply(e,n)},1)}function si(t,n){if(!Rn(t))throw new ut;var r=nt(arguments,2);return xt(function(){t.apply(e,r)},n)}function oi(e,t){if(!Rn(e))throw new ut;var n=function(){var r=n.cache,i=t?t.apply(this,arguments):s+arguments[0];return wt.call(r,i)?r[i]:r[i]=e.apply(this,arguments)};return n.cache={},n}function ui(e){var t,n;if(!Rn(e))throw new ut;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function ai(e){return en(e,16,nt(arguments,1))}function fi(e){return en(e,32,null,nt(arguments,1))}function li(e,t,n){var r=!0,i=!0;if(!Rn(e))throw new ut;return n===!1?r=!1:Un(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),P.leading=r,P.maxWait=t,P.trailing=i,ri(e,t,P)}function ci(e,t){return en(t,16,[e])}function hi(e){return function(){return e}}function pi(e,t,n){var r=typeof e;if(e==null||r=="function")return Xt(e,t,n);if(r!="object")return Ei(e);var i=hn(e),s=i[0],o=e[s];return i.length==1&&o===o&&!Un(o)?function(e){var t=e[s];return o===t&&(o!==0||1/o==1/t)}:function(t){var n=i.length,r=!1;while(n--)if(!(r=Kt(t[i[n]],e[i[n]],null,!0)))break;return r}}function di(e){return e==null?"":ot(e).replace(bn,nn)}function vi(e){return e}function mi(e,t,n){var r=!0,i=t&&_n(t);if(!t||!n&&!i.length)n==null&&(n=t),s=It,t=e,e=Ft,i=_n(t);n===!1?r=!1:Un(n)&&"chain"in n&&(r=n.chain);var s=e,o=Rn(s);lr(i,function(n){var i=e[n]=t[n];o&&(s.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,o=[n];Et.apply(o,arguments);var u=i.apply(e,o);if(r||t){if(n===u&&Un(u))return this;u=new s(u),u.__chain__=t}return u})})}function gi(){return t._=ht,this}function yi(){}function Ei(e){return function(t){return t[e]}}function Si(e,t,n){var r=e==null,i=t==null;n==null&&(typeof e=="boolean"&&i?(n=e,e=1):!i&&typeof t=="boolean"&&(n=t,i=!0)),r&&i&&(t=1),e=+e||0,i?(t=e,e=0):t=+t||0;if(n||e%1||t%1){var s=Ht();return Dt(e+s*(t-e+parseFloat("1e-"+((s+"").length-1))),t)}return Gt(e,t)}function xi(e,t){if(e){var n=e[t];return Rn(n)?e[t]():n}}function Ti(t,n,r){var i=Ft.templateSettings;t=ot(t||""),r=Rt?Nn({},r,i):i;var s=Rt&&Nn({},r.imports,i.imports),o=Rt?hn(s):["_"],u=Rt?nr(s):[Ft],a,p=0,d=r.interpolate||g,m="__p += '",y=st((r.escape||g).source+"|"+d.source+"|"+(d===v?h:g).source+"|"+(r.evaluate||g).source+"|$","g");t.replace(y,function(e,n,r,i,s,o){return r||(r=i),m+=t.slice(p,o).replace(b,Q),n&&(m+="' +\n__e("+n+") +\n'"),s&&(a=!0,m+="';\n"+s+";\n__p += '"),r&&(m+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),p=o+e.length,e}),m+="';\n";var w=r.variable,E=w;E||(w="obj",m="with ("+w+") {\n"+m+"\n}\n"),m=(a?m.replace(f,""):m).replace(l,"$1").replace(c,"$1;"),m="function("+w+") {\n"+(E?"":w+" || ("+w+" = {});\n")+"var __t, __p = '', __e = _.escape"+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var x="\n/*\n//# sourceURL="+(r.sourceURL||"/lodash/template/source["+S++ +"]")+"\n*/";try{var T=R(o,"return "+m+x).apply(e,u)}catch(N){throw N.source=m,N}return n?T(n):(T.source=m,T)}function Ni(e,t,r){e=(e=+e)>-1?e:0;var i=-1,s=n(e);t=Xt(t,r,1);while(++i<e)s[i]=t(i);return s}function Ci(e){return e==null?"":ot(e).replace(yn,an)}function ki(e){var t=++r;return ot(e==null?"":e)+t}function Li(e){return e=new It(e),e.__chain__=!0,e}function Ai(e,t){return t(e),e}function Oi(){return this.__chain__=!0,this}function Mi(){return ot(this.__wrapped__)}function _i(){return this.__wrapped__}t=t?it.defaults(I.Object(),t,it.pick(I,w)):I;var n=t.Array,u=t.Boolean,F=t.Date,q=t.Error,R=t.Function,U=t.Math,z=t.Number,V=t.Object,st=t.RegExp,ot=t.String,ut=t.TypeError,at=[],ft=q.prototype,lt=V.prototype,ct=ot.prototype,ht=t._,pt=lt.toString,dt=st("^"+ot(pt).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),vt=U.ceil,mt=t.clearTimeout,gt=U.floor,yt=R.prototype.toString,bt=sn(bt=V.getPrototypeOf)&&bt,wt=lt.hasOwnProperty,Et=at.push,St=lt.propertyIsEnumerable,xt=t.setTimeout,Tt=at.splice,Nt=at.unshift,Ct=function(){try{var e={},t=sn(t=V.defineProperty)&&t,n=t(e,e,e)&&t}catch(r){}return n}(),kt=sn(kt=V.create)&&kt,Lt=sn(Lt=n.isArray)&&Lt,At=t.isFinite,Ot=t.isNaN,Mt=sn(Mt=V.keys)&&Mt,_t=U.max,Dt=U.min,Pt=t.parseInt,Ht=U.random,Bt={};Bt[T]=n,Bt[N]=u,Bt[C]=F,Bt[L]=R,Bt[O]=V,Bt[A]=z,Bt[M]=st,Bt[_]=ot;var jt={};jt[T]=jt[C]=jt[A]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},jt[N]=jt[_]={constructor:!0,toString:!0,valueOf:!0},jt[k]=jt[L]=jt[M]={constructor:!0,toString:!0},jt[O]={constructor:!0},function(){var e=E.length;while(e--){var t=E[e];for(var n in jt)wt.call(jt,n)&&!wt.call(jt[n],t)&&(jt[n][t]=!1)}}(),It.prototype=Ft.prototype;var qt=Ft.support={};(function(){var e=function(){this.x=1},r={0:1,length:1},i=[];e.prototype={valueOf:1,y:1};for(var s in new e)i.push(s);for(s in arguments);qt.argsClass=pt.call(arguments)==x,qt.argsObject=arguments.constructor==V&&!(arguments instanceof n),qt.enumErrorProps=St.call(ft,"message")||St.call(ft,"name"),qt.enumPrototypes=St.call(e,"prototype"),qt.funcDecomp=!sn(t.WinRTError)&&y.test(rt),qt.funcNames=typeof R.name=="string",qt.nonEnumArgs=s!=0,qt.nonEnumShadows=!/valueOf/.test(i),qt.ownLast=i[0]!="x",qt.spliceObjects=(at.splice.call(r,0,1),!r[0]),qt.unindexedChars="x"[0]+V("x")[0]!="xx";try{qt.nodeClass=pt.call(document)!=O||!!({toString:0}+"")}catch(o){qt.nodeClass=!0}})(1),Ft.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:v,variable:"",imports:{_:Ft}};var Rt=Ti("var index, iterable = <%= firstArg %>, result = <%= init %>;\nif (!iterable) return result;\n<%= top %>;<% if (array) { %>\nvar length = iterable.length; index = -1;\nif (<%= array %>) {  <% if (support.unindexedChars) { %>\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  <% } %>\n  while (++index < length) {\n    <%= loop %>;\n  }\n}\nelse {  <% } else if (support.nonEnumArgs) { %>\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      <%= loop %>;\n    }\n  } else {  <% } %>  <% if (support.enumPrototypes) { %>\n  var skipProto = typeof iterable == 'function';\n  <% } %>  <% if (support.enumErrorProps) { %>\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  <% } %>  <%    var conditions = [];    if (support.enumPrototypes) { conditions.push('!(skipProto && index == \"prototype\")'); }    if (support.enumErrorProps)  { conditions.push('!(skipErrorProps && (index == \"message\" || index == \"name\"))'); }  %>  <% if (useHas && keys) { %>\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n<%    if (conditions.length) { %>    if (<%= conditions.join(' && ') %>) {\n  <% } %>    <%= loop %>;    <% if (conditions.length) { %>\n    }<% } %>\n  }  <% } else { %>\n  for (index in iterable) {\n<%    if (useHas) { conditions.push(\"hasOwnProperty.call(iterable, index)\"); }    if (conditions.length) { %>    if (<%= conditions.join(' && ') %>) {\n  <% } %>    <%= loop %>;    <% if (conditions.length) { %>\n    }<% } %>\n  }    <% if (support.nonEnumShadows) { %>\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      <% for (k = 0; k < 7; k++) { %>\n    index = '<%= shadowedProps[k] %>';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))<%        if (!useHas) { %> || (!nonEnum[index] && iterable[index] !== objectProto[index])<% }      %>) {\n      <%= loop %>;\n    }      <% } %>\n  }    <% } %>  <% } %>  <% if (array || support.nonEnumArgs) { %>\n}<% } %>\n<%= bottom %>;\nreturn result");kt||(Wt=function(){function e(){}return function(n){if(Un(n)){e.prototype=n;var r=new e;e.prototype=null}return r||t.Object()}}());var on=Ct?function(e,t){H.value=t,Ct(e,"__bindData__",H)}:yi;qt.argsClass||(fn=function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&wt.call(e,"callee")&&!St.call(e,"callee")||!1});var ln=Lt||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&pt.call(e)==T||!1},cn=tn({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),hn=Mt?function(e){return Un(e)?qt.enumPrototypes&&typeof e=="function"||qt.nonEnumArgs&&e.length&&fn(e)?cn(e):Mt(e):[]}:cn,pn={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:hn,loop:"if (callback(iterable[index], index, collection) === false) return result"},dn={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:hn,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},vn={top:"if (!objectTypes[typeof iterable]) return result;\n"+pn.top,array:!1},mn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},gn=Pn(mn),yn=st("("+hn(gn).join("|")+")","g"),bn=st("["+hn(mn).join("")+"]","g"),wn=tn(pn),En=tn(dn,{top:dn.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Nn=tn(dn),Ln=tn(pn,vn,{useHas:!1}),On=tn(pn,vn);Rn(/x/)&&(Rn=function(e){return typeof e=="function"&&pt.call(e)==L});var Vn=bt?function(e){if(!e||pt.call(e)!=O||!qt.argsClass&&fn(e))return!1;var t=e.valueOf,n=sn(t)&&(n=bt(t))&&bt(n);return n?e==n||bt(e)==n:un(e)}:un,sr=Zt(function(e,t,n){wt.call(e,n)?e[n]++:e[n]=1}),hr=Zt(function(e,t,n){(wt.call(e,n)?e[n]:e[n]=[]).push(t)}),pr=Zt(function(e,t,n){e[n]=t}),yr=vr,Lr=ur,bi=sn(bi=F.now)&&bi||function(){return(new F).getTime()},wi=Pt(a+"08")==8?Pt:function(e,t){return Pt(Jn(e)?e.replace(m,""):e,t||0)};return Ft.after=Gr,Ft.assign=En,Ft.at=rr,Ft.bind=Yr,Ft.bindAll=Zr,Ft.bindKey=ei,Ft.chain=Li,Ft.compact=Ar,Ft.compose=ti,Ft.constant=hi,Ft.countBy=sr,Ft.create=Tn,Ft.createCallback=pi,Ft.curry=ni,Ft.debounce=ri,Ft.defaults=Nn,Ft.defer=ii,Ft.delay=si,Ft.difference=Or,Ft.filter=ur,Ft.flatten=Pr,Ft.forEach=lr,Ft.forEachRight=cr,Ft.forIn=Ln,Ft.forInRight=An,Ft.forOwn=On,Ft.forOwnRight=Mn,Ft.functions=_n,Ft.groupBy=hr,Ft.indexBy=pr,Ft.initial=Br,Ft.intersection=jr,Ft.invert=Pn,Ft.invoke=dr,Ft.keys=hn,Ft.map=vr,Ft.mapValues=Qn,Ft.max=mr,Ft.memoize=oi,Ft.merge=Gn,Ft.min=gr,Ft.omit=Yn,Ft.once=ui,Ft.pairs=Zn,Ft.partial=ai,Ft.partialRight=fi,Ft.pick=er,Ft.pluck=yr,Ft.property=Ei,Ft.pull=qr,Ft.range=Rr,Ft.reject=Er,Ft.remove=Ur,Ft.rest=zr,Ft.shuffle=xr,Ft.sortBy=Cr,Ft.tap=Ai,Ft.throttle=li,Ft.times=Ni,Ft.toArray=kr,Ft.transform=tr,Ft.union=Xr,Ft.uniq=Vr,Ft.values=nr,Ft.where=Lr,Ft.without=$r,Ft.wrap=ci,Ft.xor=Jr,Ft.zip=Kr,Ft.zipObject=Qr,Ft.collect=vr,Ft.drop=zr,Ft.each=lr,Ft.eachRight=cr,Ft.extend=En,Ft.methods=_n,Ft.object=Qr,Ft.select=ur,Ft.tail=zr,Ft.unique=Vr,Ft.unzip=Kr,mi(Ft),Ft.clone=Sn,Ft.cloneDeep=xn,Ft.contains=ir,Ft.escape=di,Ft.every=or,Ft.find=ar,Ft.findIndex=Mr,Ft.findKey=Cn,Ft.findLast=fr,Ft.findLastIndex=_r,Ft.findLastKey=kn,Ft.has=Dn,Ft.identity=vi,Ft.indexOf=Hr,Ft.isArguments=fn,Ft.isArray=ln,Ft.isBoolean=Hn,Ft.isDate=Bn,Ft.isElement=jn,Ft.isEmpty=Fn,Ft.isEqual=In,Ft.isFinite=qn,Ft.isFunction=Rn,Ft.isNaN=zn,Ft.isNull=Wn,Ft.isNumber=Xn,Ft.isObject=Un,Ft.isPlainObject=Vn,Ft.isRegExp=$n,Ft.isString=Jn,Ft.isUndefined=Kn,Ft.lastIndexOf=Ir,Ft.mixin=mi,Ft.noConflict=gi,Ft.noop=yi,Ft.now=bi,Ft.parseInt=wi,Ft.random=Si,Ft.reduce=br,Ft.reduceRight=wr,Ft.result=xi,Ft.runInContext=rt,Ft.size=Tr,Ft.some=Nr,Ft.sortedIndex=Wr,Ft.template=Ti,Ft.unescape=Ci,Ft.uniqueId=ki,Ft.all=or,Ft.any=Nr,Ft.detect=ar,Ft.findWhere=ar,Ft.foldl=br,Ft.foldr=wr,Ft.include=ir,Ft.inject=br,mi(function(){var e={};return On(Ft,function(t,n){Ft.prototype[n]||(e[n]=t)}),e}(),!1),Ft.first=Dr,Ft.last=Fr,Ft.sample=Sr,Ft.take=Dr,Ft.head=Dr,On(Ft,function(e,t){var n=t!=="sample";Ft.prototype[t]||(Ft.prototype[t]=function(t,r){var i=this.__chain__,s=e(this.__wrapped__,t,r);return!i&&(t==null||r&&(!n||typeof t!="function"))?s:new It(s,i)})}),Ft.VERSION="2.4.1",Ft.prototype.chain=Oi,Ft.prototype.toString=Mi,Ft.prototype.value=_i,Ft.prototype.valueOf=_i,wn(["join","pop","shift"],function(e){var t=at[e];Ft.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new It(n,e):n}}),wn(["push","reverse","sort","unshift"],function(e){var t=at[e];Ft.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),wn(["concat","slice","splice"],function(e){var t=at[e];Ft.prototype[e]=function(){return new It(t.apply(this.__wrapped__,arguments),this.__chain__)}}),qt.spliceObjects||wn(["pop","shift","splice"],function(e){var t=at[e],n=e=="splice";Ft.prototype[e]=function(){var e=this.__chain__,r=this.__wrapped__,i=t.apply(r,arguments);return r.length===0&&delete r[0],e||n?new It(i,e):i}}),Ft._baseEach=wn,Ft._iteratorTemplate=Rt,Ft._shimKeys=cn,Ft}var e,t=[],n=[],r=0,i={},s=+(new Date)+"",o=75,u=40,a=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",f=/\b__p \+= '';/g,l=/\b(__p \+=) '' \+/g,c=/(__e\(.*?\)|\b__t\)) \+\n'';/g,h=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,p=/\w*$/,d=/^\s*function[ \n\r\t]+\w/,v=/<%=([\s\S]+?)%>/g,m=RegExp("^["+a+"]*0+(?=.$)"),g=/($^)/,y=/\bthis\b/,b=/['\n\r\t\u2028\u2029\\]/g,w=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],E=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],S=0,x="[object Arguments]",T="[object Array]",N="[object Boolean]",C="[object Date]",k="[object Error]",L="[object Function]",A="[object Number]",O="[object Object]",M="[object RegExp]",_="[object String]",D={};D[L]=!1,D[x]=D[T]=D[N]=D[C]=D[A]=D[O]=D[M]=D[_]=!0;var P={leading:!1,maxWait:0,trailing:!1},H={configurable:!1,enumerable:!1,value:null,writable:!1},B={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},j={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},F={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},I=j[typeof window]&&window||this,q=j[typeof exports]&&exports&&!exports.nodeType&&exports,R=j[typeof module]&&module&&!module.nodeType&&module,U=R&&R.exports===q&&q,z=j[typeof global]&&global;z&&(z.global===z||z.window===z)&&(I=z);var it=rt();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(I._=it,define("lodash",[],function(){return it})):q&&R?U?(R.exports=it)._=it:q._=it:I._=it}.call(this),!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(a,b){function s(e){var t=e.length,r=n.type(e);return"function"===r||n.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e}function x(e,t,r){if(n.isFunction(t))return n.grep(e,function(e,n){return!!t.call(e,n,e)!==r});if(t.nodeType)return n.grep(e,function(e){return e===t!==r});if("string"==typeof t){if(w.test(t))return n.filter(t,e,r);t=n.filter(t,e)}return n.grep(e,function(e){return g.call(t,e)>=0!==r})}function D(e,t){while((e=e[t])&&1!==e.nodeType);return e}function G(e){var t=F[e]={};return n.each(e.match(E)||[],function(e,n){t[n]=!0}),t}function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+Math.random()}function P(e,t,r){var i;if(void 0===r&&1===e.nodeType)if(i="data-"+t.replace(O,"-$1").toLowerCase(),r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:N.test(r)?n.parseJSON(r):r}catch(s){}M.set(e,t,r)}else r=void 0;return r}function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(e){}}function jb(e,t){return n.nodeName(e,"table")&&n.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function kb(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function lb(e){var t=gb.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function mb(e,t){for(var n=0,r=e.length;r>n;n++)L.set(e[n],"globalEval",!t||L.get(t[n],"globalEval"))}function nb(e,t){var r,i,s,o,u,a,f,l;if(1===t.nodeType){if(L.hasData(e)&&(o=L.access(e),u=L.set(t,o),l=o.events)){delete u.handle,u.events={};for(s in l)for(r=0,i=l[s].length;i>r;r++)n.event.add(t,s,l[s][r])}M.hasData(e)&&(a=M.access(e),f=n.extend({},a),M.set(t,f))}}function ob(e,t){var r=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&n.nodeName(e,t)?n.merge([e],r):r}function pb(e,t){var n=t.nodeName.toLowerCase();"input"===n&&T.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function sb(e,t){var r,i=n(t.createElement(e)).appendTo(t.body),s=a.getDefaultComputedStyle&&(r=a.getDefaultComputedStyle(i[0]))?r.display:n.css(i[0],"display");return i.detach(),s}function tb(e){var t=l,r=rb[e];return r||(r=sb(e,t),"none"!==r&&r||(qb=(qb||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=qb[0].contentDocument,t.write(),t.close(),r=sb(e,t),qb.detach()),rb[e]=r),r}function xb(e,t,r){var i,s,o,u,a=e.style;return r=r||wb(e),r&&(u=r.getPropertyValue(t)||r[t]),r&&(""!==u||n.contains(e.ownerDocument,e)||(u=n.style(e,t)),vb.test(u)&&ub.test(t)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=r.width,a.width=i,a.minWidth=s,a.maxWidth=o)),void 0!==u?u+"":u}function yb(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function Fb(e,t){if(t in e)return t;var n=t[0].toUpperCase()+t.slice(1),r=t,i=Eb.length;while(i--)if(t=Eb[i]+n,t in e)return t;return r}function Gb(e,t,n){var r=Ab.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Hb(e,t,r,i,s){for(var o=r===(i?"border":"content")?4:"width"===t?1:0,u=0;4>o;o+=2)"margin"===r&&(u+=n.css(e,r+R[o],!0,s)),i?("content"===r&&(u-=n.css(e,"padding"+R[o],!0,s)),"margin"!==r&&(u-=n.css(e,"border"+R[o]+"Width",!0,s))):(u+=n.css(e,"padding"+R[o],!0,s),"padding"!==r&&(u+=n.css(e,"border"+R[o]+"Width",!0,s)));return u}function Ib(e,t,r){var i=!0,s="width"===t?e.offsetWidth:e.offsetHeight,o=wb(e),u="border-box"===n.css(e,"boxSizing",!1,o);if(0>=s||null==s){if(s=xb(e,t,o),(0>s||null==s)&&(s=e.style[t]),vb.test(s))return s;i=u&&(k.boxSizingReliable()||s===e.style[t]),s=parseFloat(s)||0}return s+Hb(e,t,r||(u?"border":"content"),i,o)+"px"}function Jb(e,t){for(var r,i,s,o=[],u=0,a=e.length;a>u;u++)i=e[u],i.style&&(o[u]=L.get(i,"olddisplay"),r=i.style.display,t?(o[u]||"none"!==r||(i.style.display=""),""===i.style.display&&S(i)&&(o[u]=L.access(i,"olddisplay",tb(i.nodeName)))):(s=S(i),"none"===r&&s||L.set(i,"olddisplay",s?r:n.css(i,"display"))));for(u=0;a>u;u++)i=e[u],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[u]||"":"none"));return e}function Kb(e,t,n,r,i){return new Kb.prototype.init(e,t,n,r,i)}function Sb(){return setTimeout(function(){Lb=void 0}),Lb=n.now()}function Tb(e,t){var n,r=0,i={height:e};for(t=t?1:0;4>r;r+=2-t)n=R[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function Ub(e,t,n){for(var r,i=(Rb[t]||[]).concat(Rb["*"]),s=0,o=i.length;o>s;s++)if(r=i[s].call(n,t,e))return r}function Vb(e,t,r){var i,s,o,u,a,f,l,c,h=this,p={},d=e.style,v=e.nodeType&&S(e),m=L.get(e,"fxshow");r.queue||(a=n._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,f=a.empty.fire,a.empty.fire=function(){a.unqueued||f()}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,n.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[d.overflow,d.overflowX,d.overflowY],l=n.css(e,"display"),c="none"===l?L.get(e,"olddisplay")||tb(e.nodeName):l,"inline"===c&&"none"===n.css(e,"float")&&(d.display="inline-block")),r.overflow&&(d.overflow="hidden",h.always(function(){d.overflow=r.overflow[0],d.overflowX=r.overflow[1],d.overflowY=r.overflow[2]}));for(i in t)if(s=t[i],Nb.exec(s)){if(delete t[i],o=o||"toggle"===s,s===(v?"hide":"show")){if("show"!==s||!m||void 0===m[i])continue;v=!0}p[i]=m&&m[i]||n.style(e,i)}else l=void 0;if(n.isEmptyObject(p))"inline"===("none"===l?tb(e.nodeName):l)&&(d.display=l);else{m?"hidden"in m&&(v=m.hidden):m=L.access(e,"fxshow",{}),o&&(m.hidden=!v),v?n(e).show():h.done(function(){n(e).hide()}),h.done(function(){var t;L.remove(e,"fxshow");for(t in p)n.style(e,t,p[t])});for(i in p)u=Ub(v?m[i]:0,i,h),i in m||(m[i]=u.start,v&&(u.end=u.start,u.start="width"===i||"height"===i?1:0))}}function Wb(e,t){var r,i,s,o,u;for(r in e)if(i=n.camelCase(r),s=t[i],o=e[r],n.isArray(o)&&(s=o[1],o=e[r]=o[0]),r!==i&&(e[i]=o,delete e[r]),u=n.cssHooks[i],u&&"expand"in u){o=u.expand(o),delete e[i];for(r in o)r in e||(e[r]=o[r],t[r]=s)}else t[i]=s}function Xb(e,t,r){var i,s,o=0,u=Qb.length,a=n.Deferred().always(function(){delete f.elem}),f=function(){if(s)return!1;for(var t=Lb||Sb(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,i=1-r,o=0,u=l.tweens.length;u>o;o++)l.tweens[o].run(i);return a.notifyWith(e,[l,i,n]),1>i&&u?n:(a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:n.extend({},t),opts:n.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:Lb||Sb(),duration:r.duration,tweens:[],createTween:function(t,r){var i=n.Tween(e,l.opts,t,r,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(i),i},stop:function(t){var n=0,r=t?l.tweens.length:0;if(s)return this;for(s=!0;r>n;n++)l.tweens[n].run(1);return t?a.resolveWith(e,[l,t]):a.rejectWith(e,[l,t]),this}}),c=l.props;for(Wb(c,l.opts.specialEasing);u>o;o++)if(i=Qb[o].call(l,e,c,l.opts))return i;return n.map(c,Ub,l),n.isFunction(l.opts.start)&&l.opts.start.call(e,l),n.fx.timer(n.extend(f,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function rc(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var i,s=0,o=t.toLowerCase().match(E)||[];if(n.isFunction(r))while(i=o[s++])"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(r)):(e[i]=e[i]||[]).push(r)}}function sc(e,t,r,i){function u(l){var h;return s[l]=!0,n.each(e[l]||[],function(e,n){var a=n(t,r,i);return"string"!=typeof a||o||s[a]?o?!(h=a):void 0:(t.dataTypes.unshift(a),u(a),!1)}),h}var s={},o=e===oc;return u(t.dataTypes[0])||!s["*"]&&u("*")}function tc(e,t){var r,i,s=n.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((s[r]?e:i||(i={}))[r]=t[r]);return i&&n.extend(!0,e,i),e}function uc(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while("*"===a[0])a.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}return s?(s!==a[0]&&a.unshift(s),n[s]):void 0}function vc(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function Bc(e,t,r,i){var s;if(n.isArray(t))n.each(t,function(t,n){r||xc.test(e)?i(e,n):Bc(e+"["+("object"==typeof n?t:"")+"]",n,r,i)});else if(r||"object"!==n.type(t))i(e,t);else for(s in t)Bc(e+"["+s+"]",t[s],r,i)}function Kc(e){return n.isWindow(e)?e:9===e.nodeType&&e.defaultView}var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.1",n=function(e,t){return new n.fn.init(e,t)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(e,t){return t.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:d.call(this)},pushStack:function(e){var t=n.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return n.each(this,e,t)},map:function(e){return this.pushStack(n.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var e,t,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[a]||{},a++),"object"==typeof u||n.isFunction(u)||(u={}),a===f&&(u=this,a--);f>a;a++)if(null!=(e=arguments[a]))for(t in e)r=u[t],i=e[t],u!==i&&(l&&i&&(n.isPlainObject(i)||(s=n.isArray(i)))?(s?(s=!1,o=r&&n.isArray(r)?r:[]):o=r&&n.isPlainObject(r)?r:{},u[t]=n.extend(l,o,i)):void 0!==i&&(u[t]=i));return u},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===n.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!n.isArray(e)&&e-parseFloat(e)>=0},isPlainObject:function(e){return"object"!==n.type(e)||e.nodeType||n.isWindow(e)?!1:e.constructor&&!j.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[i.call(e)]||"object":typeof e},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(e){return e.replace(p,"ms-").replace(q,r)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,u=s(e);if(n){if(u){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(u){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(o,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(s(Object(e))?n.merge(r,"string"==typeof e?[e]:e):f.call(r,e)),r},inArray:function(e,t,n){return null==t?-1:g.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;n>r;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],s=0,o=e.length,u=!n;o>s;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(t,n,r){var i,o=0,u=t.length,a=s(t),f=[];if(a)for(;u>o;o++)i=n(t[o],o,r),null!=i&&f.push(i);else for(o in t)i=n(t[o],o,r),null!=i&&f.push(i);return e.apply([],f)},guid:1,proxy:function(e,t){var r,i,s;return"string"==typeof t&&(r=e[t],t=e,e=r),n.isFunction(e)?(i=d.call(arguments,2),s=function(){return e.apply(t||this,i.concat(d.call(arguments)))},s.guid=e.guid=e.guid||n.guid++,s):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){h["[object "+t+"]"]=t.toLowerCase()});var t=function(e){function st(e,t,r,i){var s,u,f,l,c,d,g,y,S,x;if((t?t.ownerDocument||t:E)!==p&&h(t),t=t||p,r=r||[],!e||"string"!=typeof e)return r;if(1!==(l=t.nodeType)&&9!==l)return[];if(v&&!i){if(s=Z.exec(e))if(f=s[1]){if(9===l){if(u=t.getElementById(f),!u||!u.parentNode)return r;if(u.id===f)return r.push(u),r}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&b(t,u)&&u.id===f)return r.push(u),r}else{if(s[2])return P.apply(r,t.getElementsByTagName(e)),r;if((f=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return P.apply(r,t.getElementsByClassName(f)),r}if(n.qsa&&(!m||!m.test(e))){if(y=g=w,S=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){d=o(e),(g=t.getAttribute("id"))?y=g.replace(tt,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",c=d.length;while(c--)d[c]=y+mt(d[c]);S=et.test(e)&&dt(t.parentNode)||t,x=d.join(",")}if(x)try{return P.apply(r,S.querySelectorAll(x)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return a(e.replace(z,"$1"),t,r,i)}function ot(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function ut(e){return e[w]=!0,e}function at(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function lt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function dt(e){return e&&typeof e.getElementsByTagName!==L&&e}function vt(){}function mt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function gt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=x++;return t.first?function(t,n,s){while(t=t[r])if(1===t.nodeType||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[S,s];if(o){while(t=t[r])if((1===t.nodeType||i)&&e(t,n,o))return!0}else while(t=t[r])if(1===t.nodeType||i){if(a=t[w]||(t[w]={}),(u=a[r])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(a[r]=f,f[2]=e(t,n,o))return!0}}}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n){for(var r=0,i=t.length;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r,i){for(var s,o=[],u=0,a=e.length,f=null!=t;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function Et(e,t,n,r,i,s){return r&&!r[w]&&(r=Et(r)),i&&!i[w]&&(i=Et(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||bt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:wt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function St(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],u=o||r.relative[" "],a=o?1:0,l=gt(function(e){return e===t},u,!0),c=gt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];s>a;a++)if(n=r.relative[e[a].type])h=[gt(yt(h),n)];else{if(n=r.filter[e[a].type].apply(null,e[a].matches),n[w]){for(i=++a;s>i;i++)if(r.relative[e[i].type])break;return Et(a>1&&yt(h),a>1&&mt(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(z,"$1"),n,i>a&&St(e.slice(a,i)),s>i&&St(e=e.slice(i)),s>i&&mt(e))}h.push(n)}return yt(h)}function xt(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,u,a,l){var c,h,d,v=0,m="0",g=s&&[],y=[],b=f,w=s||i&&r.find.TAG("*",l),E=S+=null==b?1:Math.random()||.1,x=w.length;for(l&&(f=o!==p&&o);m!==x&&null!=(c=w[m]);m++){if(i&&c){h=0;while(d=e[h++])if(d(c,o,u)){a.push(c);break}l&&(S=E)}n&&((c=!d&&c)&&v--,s&&g.push(c))}if(v+=m,n&&m!==v){h=0;while(d=t[h++])d(g,y,o,u);if(s){if(v>0)while(m--)g[m]||y[m]||(y[m]=_.call(a));y=wt(y)}P.apply(a,y),l&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(a)}return l&&(S=E,f=b),g};return n?ut(s):s}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="sizzle"+ -(new Date),E=e.document,S=0,x=0,T=ot(),N=ot(),C=ot(),k=function(e,t){return e===t&&(c=!0),0},L="undefined",A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+q+"))|)"+F+"*\\]",U=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp("="+F+"*([^\\]'\"]*?)"+F+"*\\]","g"),$=new RegExp(U),J=new RegExp("^"+q+"$"),K={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{P.apply(M=H.call(E.childNodes),E.childNodes),M[E.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=st.support={},s=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},h=st.setDocument=function(e){var t,i=e?e.ownerDocument||e:E,o=i.defaultView;return i!==p&&9===i.nodeType&&i.documentElement?(p=i,d=i.documentElement,v=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){h()},!1):o.attachEvent&&o.attachEvent("onunload",function(){h()})),n.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=at(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Y.test(i.getElementsByClassName)&&at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),n.getById=at(function(e){return d.appendChild(e).id=w,!i.getElementsByName||!i.getElementsByName(w).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!==L&&v){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==L?t.getElementsByTagName(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==L&&v?t.getElementsByClassName(e):void 0},g=[],m=[],(n.qsa=Y.test(i.querySelectorAll))&&(at(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&m.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||m.push(":checked")}),at(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+F+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(n.matchesSelector=Y.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&at(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),g.push("!=",U)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Y.test(d.compareDocumentPosition),b=t||Y.test(d.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return c=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===E&&b(E,e)?-1:t===i||t.ownerDocument===E&&b(E,t)?1:l?B.call(l,e)-B.call(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:l?B.call(l,e)-B.call(l,t):0;if(s===o)return lt(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)a.unshift(n);while(u[r]===a[r])r++;return r?lt(u[r],a[r]):u[r]===E?-1:a[r]===E?1:0},i):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&h(e),t=t.replace(V,"='$1']"),!(!n.matchesSelector||!v||g&&g.test(t)||m&&m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),b(e,t)},st.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var i=r.attrHandle[t.toLowerCase()],s=i&&O.call(r.attrHandle,t.toLowerCase())?i(e,t,!v):void 0;return void 0!==s?s:n.attributes||!v?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,r=[],i=0,s=0;if(c=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(k),c){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return l=null,e},i=st.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===s||4===s)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},r=st.selectors={cacheLength:50,createPseudo:ut,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[3]||e[4]||e[5]||"").replace(nt,rt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&$.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[S,h]),c===t))break;return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=B.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:ut(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[w]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return st(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:ut(function(e){return J.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ct(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=ht(t);return vt.prototype=r.filters=r.pseudos,r.setFilters=new vt,o=st.tokenize=function(e,t){var n,i,s,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){(!n||(i=W.exec(u)))&&(i&&(u=u.slice(i[0].length)||u),a.push(s=[])),n=!1,(i=X.exec(u))&&(n=i.shift(),s.push({value:n,type:i[0].replace(z," ")}),u=u.slice(n.length));for(o in r.filter)!(i=K[o].exec(u))||f[o]&&!(i=f[o](i))||(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):N(e,a).slice(0)},u=st.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=o(e)),n=t.length;while(n--)s=St(t[n]),s[w]?r.push(s):i.push(s);s=C(e,xt(i,r)),s.selector=e}return s},a=st.select=function(e,t,i,s){var a,f,l,c,h,p="function"==typeof e&&e,d=!s&&o(e=p.selector||e);if(i=i||[],1===d.length){if(f=d[0]=d[0].slice(0),f.length>2&&"ID"===(l=f[0]).type&&n.getById&&9===t.nodeType&&v&&r.relative[f[1].type]){if(t=(r.find.ID(l.matches[0].replace(nt,rt),t)||[])[0],!t)return i;p&&(t=t.parentNode),e=e.slice(f.shift().value.length)}a=K.needsContext.test(e)?0:f.length;while(a--){if(l=f[a],r.relative[c=l.type])break;if((h=r.find[c])&&(s=h(l.matches[0].replace(nt,rt),et.test(f[0].type)&&dt(t.parentNode)||t))){if(f.splice(a,1),e=s.length&&mt(f),!e)return P.apply(i,s),i;break}}}return(p||u(e,d))(s,t,!v,i,et.test(e)&&dt(t.parentNode)||t),i},n.sortStable=w.split("").sort(k).join("")===w,n.detectDuplicates=!!c,h(),n.sortDetached=at(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))}),at(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ft("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&at(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ft("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),at(function(e){return null==e.getAttribute("disabled")})||ft(j,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),st}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;n.filter=function(e,t,r){var i=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?n.find.matchesSelector(i,e)?[i]:[]:n.find.matches(e,n.grep(t,function(e){return 1===e.nodeType}))},n.fn.extend({find:function(e){var t,r=this.length,i=[],s=this;if("string"!=typeof e)return this.pushStack(n(e).filter(function(){for(t=0;r>t;t++)if(n.contains(s[t],this))return!0}));for(t=0;r>t;t++)n.find(e,s[t],i);return i=this.pushStack(r>1?n.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(x(this,e||[],!1))},not:function(e){return this.pushStack(x(this,e||[],!0))},is:function(e){return!!x(this,"string"==typeof e&&u.test(e)?n(e):e||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(e,t){var r,i;if(!e)return this;if("string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:z.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||y).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof n?t[0]:t,n.merge(this,n.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:l,!0)),v.test(r[1])&&n.isPlainObject(t))for(r in t)n.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=l.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=l,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):n.isFunction(e)?"undefined"!=typeof y.ready?y.ready(e):e(n):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),n.makeArray(e,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(e,t,r){var i=[],s=void 0!==r;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(s&&n(e).is(r))break;i.push(e)}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),n.fn.extend({has:function(e){var t=n(e,this),r=t.length;return this.filter(function(){for(var e=0;r>e;e++)if(n.contains(this,t[e]))return!0})},closest:function(e,t){for(var r,i=0,s=this.length,o=[],a=u.test(e)||"string"!=typeof e?n(e,t||this.context):0;s>i;i++)for(r=this[i];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(a?a.index(r)>-1:1===r.nodeType&&n.find.matchesSelector(r,e))){o.push(r);break}return this.pushStack(o.length>1?n.unique(o):o)},index:function(e){return e?"string"==typeof e?g.call(n(e),this[0]):g.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(n.unique(n.merge(this.get(),n(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),n.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return n.dir(e,"parentNode")},parentsUntil:function(e,t,r){return n.dir(e,"parentNode",r)},next:function(e){return D(e,"nextSibling")},prev:function(e){return D(e,"previousSibling")},nextAll:function(e){return n.dir(e,"nextSibling")},prevAll:function(e){return n.dir(e,"previousSibling")},nextUntil:function(e,t,r){return n.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return n.dir(e,"previousSibling",r)},siblings:function(e){return n.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return n.sibling(e.firstChild)},contents:function(e){return e.contentDocument||n.merge([],e.childNodes)}},function(e,t){n.fn[e]=function(r,i){var s=n.map(this,t,r);return"Until"!==e.slice(-5)&&(i=r),i&&"string"==typeof i&&(s=n.filter(i,s)),this.length>1&&(C[e]||n.unique(s),B.test(e)&&s.reverse()),this.pushStack(s)}});var E=/\S+/g,F={};n.Callbacks=function(e){e="string"==typeof e?F[e]||G(e):n.extend({},e);var t,r,i,s,o,u,a=[],f=!e.once&&[],l=function(n){for(t=e.memory&&n,r=!0,u=s||0,s=0,o=a.length,i=!0;a&&o>u;u++)if(a[u].apply(n[0],n[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):t?a=[]:c.disable())},c={add:function(){if(a){var r=a.length;!function u(t){n.each(t,function(t,r){var i=n.type(r);"function"===i?e.unique&&c.has(r)||a.push(r):r&&r.length&&"string"!==i&&u(r)})}(arguments),i?o=a.length:t&&(s=r,l(t))}return this},remove:function(){return a&&n.each(arguments,function(e,t){var r;while((r=n.inArray(t,a,r))>-1)a.splice(r,1),i&&(o>=r&&o--,u>=r&&u--)}),this},has:function(e){return e?n.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],o=0,this},disable:function(){return a=f=t=void 0,this},disabled:function(){return!a},lock:function(){return f=void 0,t||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return!a||r&&!f||(t=t||[],t=[e,t.slice?t.slice():t],i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},n.extend({Deferred:function(e){var t=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],r="pending",i={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var e=arguments;return n.Deferred(function(r){n.each(t,function(t,o){var u=n.isFunction(e[t])&&e[t];s[o[1]](function(){var e=u&&u.apply(this,arguments);e&&n.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[o[0]+"With"](this===i?r.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?n.extend(e,i):i}},s={};return i.pipe=i.then,n.each(t,function(e,n){var o=n[2],u=n[3];i[n[1]]=o.add,u&&o.add(function(){r=u},t[1^e][2].disable,t[2][2].lock),s[n[0]]=function(){return s[n[0]+"With"](this===s?i:this,arguments),this},s[n[0]+"With"]=o.fireWith}),i.promise(s),e&&e.call(s,s),s},when:function(e){var t=0,r=d.call(arguments),i=r.length,s=1!==i||e&&n.isFunction(e.promise)?i:0,o=1===s?e:n.Deferred(),u=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1)for(a=new Array(i),f=new Array(i),l=new Array(i);i>t;t++)r[t]&&n.isFunction(r[t].promise)?r[t].promise().done(u(t,l,r)).fail(o.reject).progress(u(t,f,a)):--s;return s||o.resolveWith(l,r),o.promise()}});var H;n.fn.ready=function(e){return n.ready.promise().done(e),this},n.extend({isReady:!1,readyWait:1,holdReady:function(e){e?n.readyWait++:n.ready(!0)},ready:function(e){(e===!0?--n.readyWait:n.isReady)||(n.isReady=!0,e!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}}),n.ready.promise=function(e){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(e)},n.ready.promise();var J=n.access=function(e,t,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===n.type(r)){s=!0;for(a in r)n.access(e,t,a,r[a],!0,o,u)}else if(void 0!==i&&(s=!0,n.isFunction(i)||(u=!0),l&&(u?(t.call(e,i),t=null):(l=t,t=function(e,t,r){return l.call(n(e),r)})),t))for(;f>a;a++)t(e[a],r,u?i:i.call(e[a],a,t(e[a],r)));return s?e:l?t.call(e):f?t(e[0],r):o};n.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(e){if(!K.accepts(e))return 0;var t={},r=e[this.expando];if(!r){r=K.uid++;try{t[this.expando]={value:r},Object.defineProperties(e,t)}catch(i){t[this.expando]=r,n.extend(e,t)}}return this.cache[r]||(this.cache[r]={}),r},set:function(e,t,r){var i,s=this.key(e),o=this.cache[s];if("string"==typeof t)o[t]=r;else if(n.isEmptyObject(o))n.extend(this.cache[s],t);else for(i in t)o[i]=t[i];return o},get:function(e,t){var n=this.cache[this.key(e)];return void 0===t?n:n[t]},access:function(e,t,r){var i;return void 0===t||t&&"string"==typeof t&&void 0===r?(i=this.get(e,t),void 0!==i?i:this.get(e,n.camelCase(t))):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,i,s,o=this.key(e),u=this.cache[o];if(void 0===t)this.cache[o]={};else{n.isArray(t)?i=t.concat(t.map(n.camelCase)):(s=n.camelCase(t),t in u?i=[t,s]:(i=s,i=i in u?[i]:i.match(E)||[])),r=i.length;while(r--)delete u[i[r]]}},hasData:function(e){return!n.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;n.extend({hasData:function(e){return M.hasData(e)||L.hasData(e)},data:function(e,t,n){return M.access(e,t,n)},removeData:function(e,t){M.remove(e,t)},_data:function(e,t,n){return L.access(e,t,n)},_removeData:function(e,t){L.remove(e,t)}}),n.fn.extend({data:function(e,t){var r,i,s,o=this[0],u=o&&o.attributes;if(void 0===e){if(this.length&&(s=M.get(o),1===o.nodeType&&!L.get(o,"hasDataAttrs"))){r=u.length;while(r--)u[r]&&(i=u[r].name,0===i.indexOf("data-")&&(i=n.camelCase(i.slice(5)),P(o,i,s[i])));L.set(o,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each(function(){M.set(this,e)}):J(this,function(t){var r,i=n.camelCase(e);if(o&&void 0===t){if(r=M.get(o,e),void 0!==r)return r;if(r=M.get(o,i),void 0!==r)return r;if(r=P(o,i,void 0),void 0!==r)return r}else this.each(function(){var n=M.get(this,i);M.set(this,i,t),-1!==e.indexOf("-")&&void 0!==n&&M.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){M.remove(this,e)})}}),n.extend({queue:function(e,t,r){var i;return e?(t=(t||"fx")+"queue",i=L.get(e,t),r&&(!i||n.isArray(r)?i=L.access(e,t,n.makeArray(r)):i.push(r)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var r=n.queue(e,t),i=r.length,s=r.shift(),o=n._queueHooks(e,t),u=function(){n.dequeue(e,t)};"inprogress"===s&&(s=r.shift(),i--),s&&("fx"===t&&r.unshift("inprogress"),delete o.stop,s.call(e,u,o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return L.get(e,r)||L.access(e,r,{empty:n.Callbacks("once memory").add(function(){L.remove(e,[t+"queue",r])})})}}),n.fn.extend({queue:function(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?n.queue(this[0],e):void 0===t?this:this.each(function(){var r=n.queue(this,e,t);n._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&n.dequeue(this,e)})},dequeue:function(e){return this.each(function(){n.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var r,i=1,s=n.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(u--)r=L.get(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(t)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(e,t){return e=t||e,"none"===n.css(e,"display")||!n.contains(e.ownerDocument,e)},T=/^(?:checkbox|radio)$/i;!function(){var e=l.createDocumentFragment(),t=e.appendChild(l.createElement("div")),n=l.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),k.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;n.event={global:{},add:function(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.get(e);if(g){r.handler&&(o=r,r=o.handler,s=o.selector),r.guid||(r.guid=n.guid++),(f=g.events)||(f=g.events={}),(u=g.handle)||(u=g.handle=function(t){return typeof n!==U&&n.event.triggered!==t.type?n.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(E)||[""],l=t.length;while(l--)a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d&&(h=n.event.special[d]||{},d=(s?h.delegateType:h.bindType)||d,h=n.event.special[d]||{},c=n.extend({type:d,origType:m,data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&n.expr.match.needsContext.test(s),namespace:v.join(".")},o),(p=f[d])||(p=f[d]=[],p.delegateCount=0,h.setup&&h.setup.call(e,i,v,u)!==!1||e.addEventListener&&e.addEventListener(d,u,!1)),h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=r.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),n.event.global[d]=!0)}},remove:function(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.hasData(e)&&L.get(e);if(g&&(f=g.events)){t=(t||"").match(E)||[""],l=t.length;while(l--)if(a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d){h=n.event.special[d]||{},d=(i?h.delegateType:h.bindType)||d,p=f[d]||[],a=a[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=p.length;while(o--)c=p[o],!s&&m!==c.origType||r&&r.guid!==c.guid||a&&!a.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,h.remove&&h.remove.call(e,c));u&&!p.length&&(h.teardown&&h.teardown.call(e,v,g.handle)!==!1||n.removeEvent(e,d,g.handle),delete f[d])}else for(d in f)n.event.remove(e,d+t[l],r,i,!0);n.isEmptyObject(f)&&(delete g.handle,L.remove(e,"events"))}},trigger:function(e,t,r,i){var s,o,u,f,c,h,p,d=[r||l],v=j.call(e,"type")?e.type:e,m=j.call(e,"namespace")?e.namespace.split("."):[];if(o=u=r=r||l,3!==r.nodeType&&8!==r.nodeType&&!X.test(v+n.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),c=v.indexOf(":")<0&&"on"+v,e=e[n.expando]?e:new n.Event(v,"object"==typeof e&&e),e.isTrigger=i?2:3,e.namespace=m.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:n.makeArray(t,[e]),p=n.event.special[v]||{},i||!p.trigger||p.trigger.apply(r,t)!==!1)){if(!i&&!p.noBubble&&!n.isWindow(r)){for(f=p.delegateType||v,X.test(f+v)||(o=o.parentNode);o;o=o.parentNode)d.push(o),u=o;u===(r.ownerDocument||l)&&d.push(u.defaultView||u.parentWindow||a)}s=0;while((o=d[s++])&&!e.isPropagationStopped())e.type=s>1?f:p.bindType||v,h=(L.get(o,"events")||{})[e.type]&&L.get(o,"handle"),h&&h.apply(o,t),h=c&&o[c],h&&h.apply&&n.acceptData(o)&&(e.result=h.apply(o,t),e.result===!1&&e.preventDefault());return e.type=v,i||e.isDefaultPrevented()||p._default&&p._default.apply(d.pop(),t)!==!1||!n.acceptData(r)||c&&n.isFunction(r[v])&&!n.isWindow(r)&&(u=r[c],u&&(r[c]=null),n.event.triggered=v,r[v](),n.event.triggered=void 0,u&&(r[c]=u)),e.result}},dispatch:function(e){e=n.event.fix(e);var t,r,i,s,o,u=[],a=d.call(arguments),f=(L.get(this,"events")||{})[e.type]||[],l=n.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=n.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,r=0;while((o=s.handlers[r++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((n.event.special[o.origType]||{}).handle||o.handler).apply(s.elem,a),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var r,i,s,o,u=[],a=t.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type))for(;f!==this;f=f.parentNode||this)if(f.disabled!==!0||"click"!==e.type){for(i=[],r=0;a>r;r++)o=t[r],s=o.selector+" ",void 0===i[s]&&(i[s]=o.needsContext?n(s,this).index(f)>=0:n.find(s,this,null,[f]).length),i[s]&&i.push(o);i.length&&u.push({elem:f,handlers:i})}return a<t.length&&u.push({elem:this,handlers:t.slice(a)}),u},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||l,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[n.expando])return e;var t,r,i,s=e.type,o=e,u=this.fixHooks[s];u||(this.fixHooks[s]=u=W.test(s)?this.mouseHooks:V.test(s)?this.keyHooks:{}),i=u.props?this.props.concat(u.props):this.props,e=new n.Event(o),t=i.length;while(t--)r=i[t],e[r]=o[r];return e.target||(e.target=l),3===e.target.nodeType&&(e.target=e.target.parentNode),u.filter?u.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return n.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,r,i){var s=n.extend(new n.Event,r,{type:e,isSimulated:!0,originalEvent:{}});i?n.event.trigger(s,null,t):n.event.dispatch.call(t,s),s.isDefaultPrevented()&&r.preventDefault()}},n.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},n.Event=function(e,t){return this instanceof n.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?Z:$):this.type=e,t&&n.extend(this,t),this.timeStamp=e&&e.timeStamp||n.now(),void (this[n.expando]=!0)):new n.Event(e,t)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Z,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Z,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Z,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){n.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,i=this,s=e.relatedTarget,o=e.handleObj;return(!s||s!==i&&!n.contains(i,s))&&(e.type=o.origType,r=o.handler.apply(this,arguments),e.type=t),r}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(e,t){var r=function(e){n.event.simulate(t,e.target,n.event.fix(e),!0)};n.event.special[t]={setup:function(){var n=this.ownerDocument||this,i=L.access(n,t);i||n.addEventListener(e,r,!0),L.access(n,t,(i||0)+1)},teardown:function(){var n=this.ownerDocument||this,i=L.access(n,t)-1;i?L.access(n,t,i):(n.removeEventListener(e,r,!0),L.remove(n,t))}}}),n.fn.extend({on:function(e,t,r,i,s){var o,u;if("object"==typeof e){"string"!=typeof t&&(r=r||t,t=void 0);for(u in e)this.on(u,t,r,e[u],s);return this}if(null==r&&null==i?(i=t,r=t=void 0):null==i&&("string"==typeof t?(i=r,r=void 0):(i=r,r=t,t=void 0)),i===!1)i=$;else if(!i)return this;return 1===s&&(o=i,i=function(e){return n().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=n.guid++)),this.each(function(){n.event.add(this,e,i,r,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,n(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(s in e)this.off(s,t,e[s]);return this}return(t===!1||"function"==typeof t)&&(r=t,t=void 0),r===!1&&(r=$),this.each(function(){n.event.remove(this,e,r,t)})},trigger:function(e,t){return this.each(function(){n.event.trigger(e,t,this)})},triggerHandler:function(e,t){var r=this[0];return r?n.event.trigger(e,t,r,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td,n.extend({clone:function(e,t,r){var i,s,o,u,a=e.cloneNode(!0),f=n.contains(e.ownerDocument,e);if(!(k.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||n.isXMLDoc(e)))for(u=ob(a),o=ob(e),i=0,s=o.length;s>i;i++)pb(o[i],u[i]);if(t)if(r)for(o=o||ob(e),u=u||ob(a),i=0,s=o.length;s>i;i++)nb(o[i],u[i]);else nb(e,a);return u=ob(a,"script"),u.length>0&&mb(u,!f&&ob(e,"script")),a},buildFragment:function(e,t,r,i){for(var s,o,u,a,f,l,c=t.createDocumentFragment(),h=[],p=0,d=e.length;d>p;p++)if(s=e[p],s||0===s)if("object"===n.type(s))n.merge(h,s.nodeType?[s]:s);else if(cb.test(s)){o=o||c.appendChild(t.createElement("div")),u=(bb.exec(s)||["",""])[1].toLowerCase(),a=ib[u]||ib._default,o.innerHTML=a[1]+s.replace(ab,"<$1></$2>")+a[2],l=a[0];while(l--)o=o.lastChild;n.merge(h,o.childNodes),o=c.firstChild,o.textContent=""}else h.push(t.createTextNode(s));c.textContent="",p=0;while(s=h[p++])if((!i||-1===n.inArray(s,i))&&(f=n.contains(s.ownerDocument,s),o=ob(c.appendChild(s),"script"),f&&mb(o),r)){l=0;while(s=o[l++])fb.test(s.type||"")&&r.push(s)}return c},cleanData:function(e){for(var t,r,i,s,o=n.event.special,u=0;void 0!==(r=e[u]);u++){if(n.acceptData(r)&&(s=r[L.expando],s&&(t=L.cache[s]))){if(t.events)for(i in t.events)o[i]?n.event.remove(r,i):n.removeEvent(r,i,t.handle);L.cache[s]&&delete L.cache[s]}delete M.cache[r[M.expando]]}}}),n.fn.extend({text:function(e){return J(this,function(e){return void 0===e?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=jb(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=jb(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var r,i=e?n.filter(e,this):this,s=0;null!=(r=i[s]);s++)t||1!==r.nodeType||n.cleanData(ob(r)),r.parentNode&&(t&&n.contains(r.ownerDocument,r)&&mb(ob(r,"script")),r.parentNode.removeChild(r));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(n.cleanData(ob(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return n.clone(this,e,t)})},html:function(e){return J(this,function(e){var t=this[0]||{},r=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!db.test(e)&&!ib[(bb.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(ab,"<$1></$2>");try{for(;i>r;r++)t=this[r]||{},1===t.nodeType&&(n.cleanData(ob(t,!1)),t.innerHTML=e);t=0}catch(s){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,n.cleanData(ob(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(t,r){t=e.apply([],t);var i,s,o,u,a,f,l=0,c=this.length,h=this,p=c-1,d=t[0],v=n.isFunction(d);if(v||c>1&&"string"==typeof d&&!k.checkClone&&eb.test(d))return this.each(function(e){var n=h.eq(e);v&&(t[0]=d.call(this,e,n.html())),n.domManip(t,r)});if(c&&(i=n.buildFragment(t,this[0].ownerDocument,!1,this),s=i.firstChild,1===i.childNodes.length&&(i=s),s)){for(o=n.map(ob(i,"script"),kb),u=o.length;c>l;l++)a=i,l!==p&&(a=n.clone(a,!0,!0),u&&n.merge(o,ob(a,"script"))),r.call(this[l],a,l);if(u)for(f=o[o.length-1].ownerDocument,n.map(o,lb),l=0;u>l;l++)a=o[l],fb.test(a.type||"")&&!L.access(a,"globalEval")&&n.contains(f,a)&&(a.src?n._evalUrl&&n._evalUrl(a.src):n.globalEval(a.textContent.replace(hb,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){n.fn[e]=function(e){for(var r,i=[],s=n(e),o=s.length-1,u=0;o>=u;u++)r=u===o?this:this.clone(!0),n(s[u])[t](r),f.apply(i,r.get());return this.pushStack(i)}});var qb,rb={},ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)};!function(){var e,t,r=l.documentElement,i=l.createElement("div"),s=l.createElement("div");if(s.style){s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===s.style.backgroundClip,i.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",i.appendChild(s);function o(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",r.appendChild(i);var n=a.getComputedStyle(s,null);e="1%"!==n.top,t="4px"===n.width,r.removeChild(i)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return o(),e},boxSizingReliable:function(){return null==t&&o(),t},reliableMarginRight:function(){var e,t=s.appendChild(l.createElement("div"));return t.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",t.style.marginRight=t.style.width="0",s.style.width="1px",r.appendChild(i),e=!parseFloat(a.getComputedStyle(t,null).marginRight),r.removeChild(i),e}})}}(),n.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:"0",fontWeight:"400"},Eb=["Webkit","O","Moz","ms"];n.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=xb(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=n.camelCase(t),f=e.style;return t=n.cssProps[a]||(n.cssProps[a]=Fb(f,a)),u=n.cssHooks[t]||n.cssHooks[a],void 0===r?u&&"get"in u&&void 0!==(s=u.get(e,!1,i))?s:f[t]:(o=typeof r,"string"===o&&(s=Bb.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(n.css(e,t)),o="number"),null!=r&&r===r&&("number"!==o||n.cssNumber[a]||(r+="px"),k.clearCloneStyle||""!==r||0!==t.indexOf("background")||(f[t]="inherit"),u&&"set"in u&&void 0===(r=u.set(e,r,i))||(f[t]=r)),void 0)}},css:function(e,t,r,i){var s,o,u,a=n.camelCase(t);return t=n.cssProps[a]||(n.cssProps[a]=Fb(e.style,a)),u=n.cssHooks[t]||n.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,r)),void 0===s&&(s=xb(e,t,i)),"normal"===s&&t in Db&&(s=Db[t]),""===r||r?(o=parseFloat(s),r===!0||n.isNumeric(o)?o||0:s):s}}),n.each(["height","width"],function(e,t){n.cssHooks[t]={get:function(e,r,i){return r?zb.test(n.css(e,"display"))&&0===e.offsetWidth?n.swap(e,Cb,function(){return Ib(e,t,i)}):Ib(e,t,i):void 0},set:function(e,r,i){var s=i&&wb(e);return Gb(e,r,i?Hb(e,t,i,"border-box"===n.css(e,"boxSizing",!1,s),s):0)}}}),n.cssHooks.marginRight=yb(k.reliableMarginRight,function(e,t){return t?n.swap(e,{display:"inline-block"},xb,[e,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(e,t){n.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+R[r]+t]=s[r]||s[r-2]||s[0];return i}},ub.test(e)||(n.cssHooks[e+t].set=Gb)}),n.fn.extend({css:function(e,t){return J(this,function(e,t,r){var i,s,o={},u=0;if(n.isArray(t)){for(i=wb(e),s=t.length;s>u;u++)o[t[u]]=n.css(e,t[u],!1,i);return o}return void 0!==r?n.style(e,t,r):n.css(e,t)},e,t,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}}),n.Tween=Kb,Kb.prototype={constructor:Kb,init:function(e,t,r,i,s,o){this.elem=e,this.prop=r,this.easing=s||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(n.cssNumber[r]?"":"px")},cur:function(){var e=Kb.propHooks[this.prop];return e&&e.get?e.get(this):Kb.propHooks._default.get(this)},run:function(e){var t,r=Kb.propHooks[this.prop];return this.pos=t=this.options.duration?n.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=n.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){n.fx.step[e.prop]?n.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[n.cssProps[e.prop]]||n.cssHooks[e.prop])?n.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},n.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},n.fx=Kb.prototype.init,n.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(e,t){var r=this.createTween(e,t),i=r.cur(),s=Ob.exec(t),o=s&&s[3]||(n.cssNumber[e]?"":"px"),u=(n.cssNumber[e]||"px"!==o&&+i)&&Ob.exec(n.css(r.elem,e)),a=1,f=20;if(u&&u[3]!==o){o=o||u[3],s=s||[],u=+i||1;do a=a||".5",u/=a,n.style(r.elem,e,u+o);while(a!==(a=r.cur()/i)&&1!==a&&--f)}return s&&(u=r.start=+u||+i||0,r.unit=o,r.end=s[1]?u+(s[1]+1)*s[2]:+s[2]),r}]};n.Animation=n.extend(Xb,{tweener:function(e,t){n.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var r,i=0,s=e.length;s>i;i++)r=e[i],Rb[r]=Rb[r]||[],Rb[r].unshift(t)},prefilter:function(e,t){t?Qb.unshift(e):Qb.push(e)}}),n.speed=function(e,t,r){var i=e&&"object"==typeof e?n.extend({},e):{complete:r||!r&&t||n.isFunction(e)&&e,duration:e,easing:r&&t||t&&!n.isFunction(t)&&t};return i.duration=n.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in n.fx.speeds?n.fx.speeds[i.duration]:n.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){n.isFunction(i.old)&&i.old.call(this),i.queue&&n.dequeue(this,i.queue)},i},n.fn.extend({fadeTo:function(e,t,n,r){return this.filter(S).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,r,i){var s=n.isEmptyObject(e),o=n.speed(t,r,i),u=function(){var t=Xb(this,n.extend({},e),o);(s||L.get(this,"finish"))&&t.stop(!0)};return u.finish=u,s||o.queue===!1?this.each(u):this.queue(o.queue,u)},stop:function(e,t,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,s=null!=e&&e+"queueHooks",o=n.timers,u=L.get(this);if(s)u[s]&&u[s].stop&&i(u[s]);else for(s in u)u[s]&&u[s].stop&&Pb.test(s)&&i(u[s]);for(s=o.length;s--;)o[s].elem!==this||null!=e&&o[s].queue!==e||(o[s].anim.stop(r),t=!1,o.splice(s,1));(t||!r)&&n.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,r=L.get(this),i=r[e+"queue"],s=r[e+"queueHooks"],o=n.timers,u=i?i.length:0;for(r.finish=!0,n.queue(this,e,[]),s&&s.stop&&s.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;u>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete r.finish})}}),n.each(["toggle","show","hide"],function(e,t){var r=n.fn[t];n.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(Tb(t,!0),e,n,i)}}),n.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){n.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),n.timers=[],n.fx.tick=function(){var e,t=0,r=n.timers;for(Lb=n.now();t<r.length;t++)e=r[t],e()||r[t]!==e||r.splice(t--,1);r.length||n.fx.stop(),Lb=void 0},n.fx.timer=function(e){n.timers.push(e),e()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Mb||(Mb=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Mb),Mb=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(e,t){return e=n.fx?n.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e=l.createElement("input"),t=l.createElement("select"),n=t.appendChild(l.createElement("option"));e.type="checkbox",k.checkOn=""!==e.value,k.optSelected=n.selected,t.disabled=!0,k.optDisabled=!n.disabled,e=l.createElement("input"),e.value="t",e.type="radio",k.radioValue="t"===e.value}();var Yb,Zb,$b=n.expr.attrHandle;n.fn.extend({attr:function(e,t){return J(this,n.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){n.removeAttr(this,e)})}}),n.extend({attr:function(e,t,r){var i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===U?n.prop(e,t,r):(1===o&&n.isXMLDoc(e)||(t=t.toLowerCase(),i=n.attrHooks[t]||(n.expr.match.bool.test(t)?Zb:Yb)),void 0===r?i&&"get"in i&&null!==(s=i.get(e,t))?s:(s=n.find.attr(e,t),null==s?void 0:s):null!==r?i&&"set"in i&&void 0!==(s=i.set(e,r,t))?s:(e.setAttribute(t,r+""),r):void n.removeAttr(e,t))},removeAttr:function(e,t){var r,i,s=0,o=t&&t.match(E);if(o&&1===e.nodeType)while(r=o[s++])i=n.propFix[r]||r,n.expr.match.bool.test(r)&&(e[i]=!1),e.removeAttribute(r)},attrHooks:{type:{set:function(e,t){if(!k.radioValue&&"radio"===t&&n.nodeName(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}}}),Zb={set:function(e,t,r){return t===!1?n.removeAttr(e,r):e.setAttribute(r,r),r}},n.each(n.expr.match.bool.source.match(/\w+/g),function(e,t){var r=$b[t]||n.find.attr;$b[t]=function(e,t,n){var i,s;return n||(s=$b[t],$b[t]=i,i=null!=r(e,t,n)?t.toLowerCase():null,$b[t]=s),i}});var _b=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(e,t){return J(this,n.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[n.propFix[e]||e]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return o=1!==u||!n.isXMLDoc(e),o&&(t=n.propFix[t]||t,s=n.propHooks[t]),void 0!==r?s&&"set"in s&&void 0!==(i=s.set(e,r,t))?i:e[t]=r:s&&"get"in s&&null!==(i=s.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||_b.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;n.fn.extend({addClass:function(e){var t,r,i,s,o,u,a="string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];l>f;f++)if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ac," "):" ")){o=0;while(s=t[o++])i.indexOf(" "+s+" ")<0&&(i+=s+" ");u=n.trim(i),r.className!==u&&(r.className=u)}return this},removeClass:function(e){var t,r,i,s,o,u,a=0===arguments.length||"string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];l>f;f++)if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ac," "):"")){o=0;while(s=t[o++])while(i.indexOf(" "+s+" ")>=0)i=i.replace(" "+s+" "," ");u=e?n.trim(i):"",r.className!==u&&(r.className=u)}return this},toggleClass:function(e,t){var r=typeof e;return"boolean"==typeof t&&"string"===r?t?this.addClass(e):this.removeClass(e):this.each(n.isFunction(e)?function(r){n(this).toggleClass(e.call(this,r,this.className,t),t)}:function(){if("string"===r){var t,i=0,s=n(this),o=e.match(E)||[];while(t=o[i++])s.hasClass(t)?s.removeClass(t):s.addClass(t)}else(r===U||"boolean"===r)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||e===!1?"":L.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(ac," ").indexOf(t)>=0)return!0;return!1}});var bc=/\r/g;n.fn.extend({val:function(e){var t,r,i,s=this[0];if(arguments.length)return i=n.isFunction(e),this.each(function(r){var s;1===this.nodeType&&(s=i?e.call(this,r,n(this).val()):e,null==s?s="":"number"==typeof s?s+="":n.isArray(s)&&(s=n.map(s,function(e){return null==e?"":e+""})),t=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,s,"value")||(this.value=s))});if(s)return t=n.valHooks[s.type]||n.valHooks[s.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(r=t.get(s,"value"))?r:(r=s.value,"string"==typeof r?r.replace(bc,""):null==r?"":r)}}),n.extend({valHooks:{option:{get:function(e){var t=n.find.attr(e,"value");return null!=t?t:n.trim(n.text(e))}},select:{get:function(e){for(var t,r,i=e.options,s=e.selectedIndex,o="select-one"===e.type||0>s,u=o?null:[],a=o?s+1:i.length,f=0>s?a:o?s:0;a>f;f++)if(r=i[f],!(!r.selected&&f!==s||(k.optDisabled?r.disabled:null!==r.getAttribute("disabled"))||r.parentNode.disabled&&n.nodeName(r.parentNode,"optgroup"))){if(t=n(r).val(),o)return t;u.push(t)}return u},set:function(e,t){var r,i,s=e.options,o=n.makeArray(t),u=s.length;while(u--)i=s[u],(i.selected=n.inArray(i.value,o)>=0)&&(r=!0);return r||(e.selectedIndex=-1),o}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(e,t){return n.isArray(t)?e.checked=n.inArray(n(e).val(),t)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){n.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),n.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var cc=n.now(),dc=/\?/;n.parseJSON=function(e){return JSON.parse(e+"")},n.parseXML=function(e){var t,r;if(!e||"string"!=typeof e)return null;try{r=new DOMParser,t=r.parseFromString(e,"text/xml")}catch(i){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+e),t};var ec,fc,gc=/#.*$/,hc=/([?&])_=[^&]*/,ic=/^(.*?):[ \t]*([^\r\n]*)$/gm,jc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,kc=/^(?:GET|HEAD)$/,lc=/^\/\//,mc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,nc={},oc={},pc="*/".concat("*");try{fc=location.href}catch(qc){fc=l.createElement("a"),fc.href="",fc=fc.href}ec=mc.exec(fc.toLowerCase())||[],n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:jc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?tc(tc(e,n.ajaxSettings),t):tc(n.ajaxSettings,e)},ajaxPrefilter:rc(nc),ajaxTransport:rc(oc),ajax:function(e,t){function T(e,t,o,a){var l,g,y,w,E,x=t;2!==b&&(b=2,u&&clearTimeout(u),r=void 0,s=a||"",S.readyState=e>0?4:0,l=e>=200&&300>e||304===e,o&&(w=uc(c,S,o)),w=vc(c,w,S,l),l?(c.ifModified&&(E=S.getResponseHeader("Last-Modified"),E&&(n.lastModified[i]=E),E=S.getResponseHeader("etag"),E&&(n.etag[i]=E)),204===e||"HEAD"===c.type?x="nocontent":304===e?x="notmodified":(x=w.state,g=w.data,y=w.error,l=!y)):(y=x,(e||!x)&&(x="error",0>e&&(e=0))),S.status=e,S.statusText=(t||x)+"",l?d.resolveWith(h,[g,x,S]):d.rejectWith(h,[S,x,y]),S.statusCode(m),m=void 0,f&&p.trigger(l?"ajaxSuccess":"ajaxError",[S,c,l?g:y]),v.fireWith(h,[S,x]),f&&(p.trigger("ajaxComplete",[S,c]),--n.active||n.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,i,s,o,u,a,f,l,c=n.ajaxSetup({},t),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?n(h):n.event,d=n.Deferred(),v=n.Callbacks("once memory"),m=c.statusCode||{},g={},y={},b=0,w="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!o){o={};while(t=ic.exec(s))o[t[1].toLowerCase()]=t[2]}t=o[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else S.always(e[S.status]);return this},abort:function(e){var t=e||w;return r&&r.abort(t),T(0,t),this}};if(d.promise(S).complete=v.add,S.success=S.done,S.error=S.fail,c.url=((e||c.url||fc)+"").replace(gc,"").replace(lc,ec[1]+"//"),c.type=t.method||t.type||c.method||c.type,c.dataTypes=n.trim(c.dataType||"*").toLowerCase().match(E)||[""],null==c.crossDomain&&(a=mc.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ec[1]&&a[2]===ec[2]&&(a[3]||("http:"===a[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=n.param(c.data,c.traditional)),sc(nc,c,t,S),2===b)return S;f=c.global,f&&0===n.active++&&n.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!kc.test(c.type),i=c.url,c.hasContent||(c.data&&(i=c.url+=(dc.test(i)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=hc.test(i)?i.replace(hc,"$1_="+cc++):i+(dc.test(i)?"&":"?")+"_="+cc++)),c.ifModified&&(n.lastModified[i]&&S.setRequestHeader("If-Modified-Since",n.lastModified[i]),n.etag[i]&&S.setRequestHeader("If-None-Match",n.etag[i])),(c.data&&c.hasContent&&c.contentType!==!1||t.contentType)&&S.setRequestHeader("Content-Type",c.contentType),S.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+pc+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)S.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,S,c)!==!1&&2!==b){w="abort";for(l in{success:1,error:1,complete:1})S[l](c[l]);if(r=sc(oc,c,t,S)){S.readyState=1,f&&p.trigger("ajaxSend",[S,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){S.abort("timeout")},c.timeout));try{b=1,r.send(g,T)}catch(x){if(!(2>b))throw x;T(-1,x)}}else T(-1,"No Transport");return S}return S.abort()},getJSON:function(e,t,r){return n.get(e,t,r,"json")},getScript:function(e,t){return n.get(e,void 0,t,"script")}}),n.each(["get","post"],function(e,t){n[t]=function(e,r,i,s){return n.isFunction(r)&&(s=s||i,i=r,r=void 0),n.ajax({url:e,type:t,dataType:s,data:r,success:i})}}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){n.fn[t]=function(e){return this.on(t,e)}}),n._evalUrl=function(e){return n.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(e){var t;return n.isFunction(e)?this.each(function(t){n(this).wrapAll(e.call(this,t))}):(this[0]&&(t=n(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(n.isFunction(e)?function(t){n(this).wrapInner(e.call(this,t))}:function(){var t=n(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=n.isFunction(e);return this.each(function(r){n(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},n.expr.filters.visible=function(e){return!n.expr.filters.hidden(e)};var wc=/%20/g,xc=/\[\]$/,yc=/\r?\n/g,zc=/^(?:submit|button|image|reset|file)$/i,Ac=/^(?:input|select|textarea|keygen)/i;n.param=function(e,t){var r,i=[],s=function(e,t){t=n.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(e)||e.jquery&&!n.isPlainObject(e))n.each(e,function(){s(this.name,this.value)});else for(r in e)Bc(r,e[r],t,s);return i.join("&").replace(wc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=n.prop(this,"elements");return e?n.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!n(this).is(":disabled")&&Ac.test(this.nodeName)&&!zc.test(e)&&(this.checked||!T.test(e))}).map(function(e,t){var r=n(this).val();return null==r?null:n.isArray(r)?n.map(r,function(e){return{name:t.name,value:e.replace(yc,"\r\n")}}):{name:t.name,value:r.replace(yc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var e in Dc)Dc[e]()}),k.cors=!!Fc&&"withCredentials"in Fc,k.ajax=Fc=!!Fc,n.ajaxTransport(function(e){var t;return k.cors||Fc&&!e.crossDomain?{send:function(n,r){var i,s=e.xhr(),o=++Cc;if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)s.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete Dc[o],t=s.onload=s.onerror=null,"abort"===e?s.abort():"error"===e?r(s.status,s.statusText):r(Ec[s.status]||s.status,s.statusText,"string"==typeof s.responseText?{text:s.responseText}:void 0,s.getAllResponseHeaders()))}},s.onload=t(),s.onerror=t("error"),t=Dc[o]=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(u){if(t)throw u}},abort:function(){t&&t()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return n.globalEval(e),e}}}),n.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),n.ajaxTransport("script",function(e){if(e.crossDomain){var t,r;return{send:function(i,s){t=n("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",r=function(e){t.remove(),r=null,e&&s("error"===e.type?404:200,e.type)}),l.head.appendChild(t[0])},abort:function(){r&&r()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Gc.pop()||n.expando+"_"+cc++;return this[e]=!0,e}}),n.ajaxPrefilter("json jsonp",function(e,t,r){var i,s,o,u=e.jsonp!==!1&&(Hc.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(e.data)&&"data");return u||"jsonp"===e.dataTypes[0]?(i=e.jsonpCallback=n.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,u?e[u]=e[u].replace(Hc,"$1"+i):e.jsonp!==!1&&(e.url+=(dc.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||n.error(i+" was not called"),o[0]},e.dataTypes[0]="json",s=a[i],a[i]=function(){o=arguments},r.always(function(){a[i]=s,e[i]&&(e.jsonpCallback=t.jsonpCallback,Gc.push(i)),o&&n.isFunction(s)&&s(o[0]),o=s=void 0}),"script"):void 0}),n.parseHTML=function(e,t,r){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(r=t,t=!1),t=t||l;var i=v.exec(e),s=!r&&[];return i?[t.createElement(i[1])]:(i=n.buildFragment([e],t,s),s&&s.length&&n(s).remove(),n.merge([],i.childNodes))};var Ic=n.fn.load;n.fn.load=function(e,t,r){if("string"!=typeof e&&Ic)return Ic.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=n.trim(e.slice(a)),e=e.slice(0,a)),n.isFunction(t)?(r=t,t=void 0):t&&"object"==typeof t&&(s="POST"),u.length>0&&n.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){o=arguments,u.html(i?n("<div>").append(n.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,o||[e.responseText,t,e])}),this},n.expr.filters.animated=function(e){return n.grep(n.timers,function(t){return e===t.elem}).length};var Jc=a.document.documentElement;n.offset={setOffset:function(e,t,r){var i,s,o,u,a,f,l,c=n.css(e,"position"),h=n(e),p={};"static"===c&&(e.style.position="relative"),a=h.offset(),o=n.css(e,"top"),f=n.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+f).indexOf("auto")>-1,l?(i=h.position(),u=i.top,s=i.left):(u=parseFloat(o)||0,s=parseFloat(f)||0),n.isFunction(t)&&(t=t.call(e,r,a)),null!=t.top&&(p.top=t.top-a.top+u),null!=t.left&&(p.left=t.left-a.left+s),"using"in t?t.using.call(e,p):h.css(p)}},n.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){n.offset.setOffset(this,e,t)});var t,r,i=this[0],s={top:0,left:0},o=i&&i.ownerDocument;if(o)return t=o.documentElement,n.contains(t,i)?(typeof i.getBoundingClientRect!==U&&(s=i.getBoundingClientRect()),r=Kc(o),{top:s.top+r.pageYOffset-t.clientTop,left:s.left+r.pageXOffset-t.clientLeft}):s},position:function(){if(this[0]){var e,t,r=this[0],i={top:0,left:0};return"fixed"===n.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),n.nodeName(e[0],"html")||(i=e.offset()),i.top+=n.css(e[0],"borderTopWidth",!0),i.left+=n.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-n.css(r,"marginTop",!0),left:t.left-i.left-n.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||Jc;while(e&&!n.nodeName(e,"html")&&"static"===n.css(e,"position"))e=e.offsetParent;return e||Jc})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var r="pageYOffset"===t;n.fn[e]=function(n){return J(this,function(e,n,i){var s=Kc(e);return void 0===i?s?s[t]:e[n]:void (s?s.scrollTo(r?a.pageXOffset:i,r?i:a.pageYOffset):e[n]=i)},e,n,arguments.length,null)}}),n.each(["top","left"],function(e,t){n.cssHooks[t]=yb(k.pixelPosition,function(e,r){return r?(r=xb(e,t),vb.test(r)?n(e).position()[t]+"px":r):void 0})}),n.each({Height:"height",Width:"width"},function(e,t){n.each({padding:"inner"+e,content:t,"":"outer"+e},function(r,i){n.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return J(this,function(t,r,i){var s;return n.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===i?n.css(t,r,u):n.style(t,r,i,u)},t,o?i:void 0,o,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Lc=a.jQuery,Mc=a.$;return n.noConflict=function(e){return a.$===n&&(a.$=Mc),e&&a.jQuery===n&&(a.jQuery=Lc),n},typeof b===U&&(a.jQuery=a.$=n),n}),define("bpmn/util/Topic",["bpmn/util/JSClass"],function(e){var t={publish:function(e,t){}};return new e.Class(t)}),define("bpmn/execution/Instance",["bpmn/execution/TokenStore","bpmn/util/JSClass","lodash","jquery","bpmn/util/Topic"],function(e,t,n,r,i){var s={constructor:function(t,n,r,i){this.definitions=t,this.configuration=n,this.tokenStore=new e(r),this.variables=i?i:{},this.behaviours["bpmn.StartEvent"]=this.behaviours.takeAll,this.behaviours["bpmn.EndEvent"]=this.behaviours.takeNone,this.behaviours["bpmn.UserTask"]=this.behaviours.takeNone,this.behaviours["bpmn.ServiceTask"]=this.behaviours.takeAll,this.behaviours["bpmn.ExclusiveGateway"]=this.behaviours.xor,this.behaviours["bpmn.ParallelGateway"]=this.behaviours.and},behaviours:{takeAll:function(e){return this.dropToken(e.id(),this.tokenStore),e.outgoing()},takeNone:function(e){return[]},xor:function(e){this.dropToken(e.id(),this.tokenStore);if(e.outgoing().length==1)return e.outgoing();var t=null;n.map(e.outgoing(),function(e){var n=this.configuration[e.id()];!t&&n&&n(this)&&(t=e)},this);if(!t&&!e.getDefault())throw new Error("No transition evaluated to true and no default defined");return t},and:function(e){var t=!0,r=this.tokenStore.query(e.id()),i={};if(e.incoming().length==1)return n.bind(this.behaviours.takeAll,this)(e);for(var s=0;s<r.length;s++){var o=r[s];i[o.from]=o}var u=[];return n.map(e.incoming(),function(e){i[e.id()]?u.push(e):t=!1},this),t?(n.map(u,function(e){n.bind(this.dropToken,this)(e.sourceRef(),this.tokenStore)},this),n.bind(this.behaviours.takeAll,this)(e)):[]}},dropToken:function(e,t,n){t.query(e).length>0&&t.drop(e,n?n:1)},copyVariables:function(e){if(e)for(var t in e)this.variables[t]=e[t]},start:function(e,t){return this.tokenStore.add(e,{from:null}),this.trigger(e,t)},trigger:function(e,t,s,o){console.log("trigger",e);var u=r.Deferred(),o=o?o:r.Deferred();this.copyVariables(t);var a=this.definitions.index.item(e),f=s?this.behaviours[s]:this.behaviours[a.declaredClass],l=[].concat(n.bind(f,this)(a,this.tokenStore));return console.log("next",l),l.length>0&&this.configuration.leave&&(this.configuration.leave(a),i.publish("flow:leave:"+a.id(),a)),l.length==0&&o.resolve(),l.map(function(e){this.tokenStore.add(e.targetRef(),{from:e.id()});var t="flow:enter:"+e.targetRef();i.publish(t,e.getTargetRef()),this.configuration.enter&&this.configuration.enter(e.getTargetRef());var n=this;u.then(function(){console.log("then for",e.id()),n.trigger(e.targetRef(),null,null,o)})},this),this.configuration[e]&&this.configuration[e]?this.configuration[e]({instance:this,promise:u}):(console.log("resolving",e,this.tokenStore.tokenMap),u.resolve()),o}};return new t.Class(s)}),function(e){function n(t,r){if(!(this instanceof n))return new n(t,r);var s=this;i(s),s.q=s.c="",s.bufferCheckPosition=e.MAX_BUFFER_LENGTH,s.opt=r||{},s.opt.lowercase=s.opt.lowercase||s.opt.lowercasetags,s.looseCase=s.opt.lowercase?"toLowerCase":"toUpperCase",s.tags=[],s.closed=s.closedRoot=s.sawRoot=!1,s.tag=s.error=null,s.strict=!!t,s.noscript=!!t||!!s.opt.noscript,s.state=L.BEGIN,s.ENTITIES=Object.create(e.ENTITIES),s.attribList=[],s.opt.xmlns&&(s.ns=Object.create(E)),s.trackPosition=s.opt.position!==!1,s.trackPosition&&(s.position=s.line=s.column=0),A(s,"onready")}function r(n){var r=Math.max(e.MAX_BUFFER_LENGTH,10),i=0;for(var s=0,o=t.length;s<o;s++){var u=n[t[s]].length;if(u>r)switch(t[s]){case"textNode":M(n);break;case"cdata":O(n,"oncdata",n.cdata),n.cdata="";break;case"script":O(n,"onscript",n.script),n.script="";break;default:D(n,"Max buffer length exceeded: "+t[s])}i=Math.max(i,u)}n.bufferCheckPosition=e.MAX_BUFFER_LENGTH-i+n.position}function i(e){for(var n=0,r=t.length;n<r;n++)e[t[n]]=""}function s(e){M(e),e.cdata!==""&&(O(e,"oncdata",e.cdata),e.cdata=""),e.script!==""&&(O(e,"onscript",e.script),e.script="")}function f(e,t){return new l(e,t)}function l(e,t){if(!(this instanceof l))return new l(e,t);o.apply(this),this._parser=new n(e,t),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(e){r.emit("error",e),r._parser.error=null},this._decoder=null,a.forEach(function(e){Object.defineProperty(r,"on"+e,{get:function(){return r._parser["on"+e]},set:function(t){if(!t)return r.removeAllListeners(e),r._parser["on"+e]=t;r.on(e,t)},enumerable:!0,configurable:!1})})}function T(e){return e.split("").reduce(function(e,t){return e[t]=!0,e},{})}function N(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function C(e,t){return N(e)?!!t.match(e):e[t]}function k(e,t){return!C(e,t)}function A(e,t,n){e[t]&&e[t](n)}function O(e,t,n){e.textNode&&M(e),A(e,t,n)}function M(e){e.textNode=_(e.opt,e.textNode),e.textNode&&A(e,"ontext",e.textNode),e.textNode=""}function _(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function D(e,t){return M(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,A(e,"onerror",t),e}function P(e){return e.closedRoot||H(e,"Unclosed root tag"),e.state!==L.BEGIN&&e.state!==L.TEXT&&D(e,"Unexpected end"),M(e),e.c="",e.closed=!0,A(e,"onend"),n.call(e,e.strict,e.opt),e}function H(e,t){if(!(typeof e=="object"&&e instanceof n))throw new Error("bad call to strictFail");e.strict&&D(e,t)}function B(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0}function j(e,t){var n=e.indexOf(":"),r=n<0?["",e]:e.split(":"),i=r[0],s=r[1];return t&&e==="xmlns"&&(i="xmlns",s=""),{prefix:i,local:s}}function F(e){e.strict||(e.attribName=e.attribName[e.looseCase]());if(e.attribList.indexOf(e.attribName)!==-1||e.tag.attributes.hasOwnProperty(e.attribName))return e.attribName=e.attribValue="";if(e.opt.xmlns){var t=j(e.attribName,!0),n=t.prefix,r=t.local;if(n==="xmlns")if(r==="xml"&&e.attribValue!==b)H(e,"xml: prefix must be bound to "+b+"\n"+"Actual: "+e.attribValue);else if(r==="xmlns"&&e.attribValue!==w)H(e,"xmlns: prefix must be bound to "+w+"\n"+"Actual: "+e.attribValue);else{var i=e.tag,s=e.tags[e.tags.length-1]||e;i.ns===s.ns&&(i.ns=Object.create(s.ns)),i.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,O(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}function I(e,t){if(e.opt.xmlns){var n=e.tag,r=j(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(H(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var i=e.tags[e.tags.length-1]||e;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach(function(t){O(e,"onopennamespace",{prefix:t,uri:n.ns[t]})});for(var s=0,o=e.attribList.length;s<o;s++){var u=e.attribList[s],a=u[0],f=u[1],l=j(a,!0),c=l.prefix,h=l.local,p=c==""?"":n.ns[c]||"",d={name:a,value:f,prefix:c,local:h,uri:p};c&&c!="xmlns"&&!p&&(H(e,"Unbound namespace prefix: "+JSON.stringify(c)),d.uri=c),e.tag.attributes[a]=d,O(e,"onattribute",d)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),O(e,"onopentag",e.tag),t||(!e.noscript&&e.tagName.toLowerCase()==="script"?e.state=L.SCRIPT:e.state=L.TEXT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function q(e){if(!e.tagName){H(e,"Weird empty close tag."),e.textNode+="</>",e.state=L.TEXT;return}if(e.script){if(e.tagName!=="script"){e.script+="</"+e.tagName+">",e.tagName="",e.state=L.SCRIPT;return}O(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());var r=n;while(t--){var i=e.tags[t];if(i.name===r)break;H(e,"Unexpected close tag")}if(t<0){H(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",e.state=L.TEXT;return}e.tagName=n;var s=e.tags.length;while(s-->t){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,O(e,"onclosetag",e.tagName);var u={};for(var a in o.ns)u[a]=o.ns[a];var f=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==f.ns&&Object.keys(o.ns).forEach(function(t){var n=o.ns[t];O(e,"onclosenamespace",{prefix:t,uri:n})})}t===0&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=L.TEXT}function R(e){var t=e.entity,n=t.toLowerCase(),r,i="";return e.ENTITIES[t]?e.ENTITIES[t]:e.ENTITIES[n]?e.ENTITIES[n]:(t=n,t.charAt(0)==="#"&&(t.charAt(1)==="x"?(t=t.slice(2),r=parseInt(t,16),i=r.toString(16)):(t=t.slice(1),r=parseInt(t,10),i=r.toString(10))),t=t.replace(/^0+/,""),i.toLowerCase()!==t?(H(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(r))}function U(e){var t=this;if(this.error)throw this.error;if(t.closed)return D(t,"Cannot write after close. Assign an onready handler.");if(e===null)return P(t);var n=0,i="";while(t.c=i=e.charAt(n++)){t.trackPosition&&(t.position++,i==="\n"?(t.line++,t.column=0):t.column++);switch(t.state){case L.BEGIN:i==="<"?(t.state=L.OPEN_WAKA,t.startTagPosition=t.position):k(c,i)&&(H(t,"Non-whitespace before first tag."),t.textNode=i,t.state=L.TEXT);continue;case L.TEXT:if(t.sawRoot&&!t.closedRoot){var s=n-1;while(i&&i!=="<"&&i!=="&")i=e.charAt(n++),i&&t.trackPosition&&(t.position++,i==="\n"?(t.line++,t.column=0):t.column++);t.textNode+=e.substring(s,n-1)}i==="<"?(t.state=L.OPEN_WAKA,t.startTagPosition=t.position):(k(c,i)&&(!t.sawRoot||t.closedRoot)&&H(t,"Text data outside of root node."),i==="&"?t.state=L.TEXT_ENTITY:t.textNode+=i);continue;case L.SCRIPT:i==="<"?t.state=L.SCRIPT_ENDING:t.script+=i;continue;case L.SCRIPT_ENDING:i==="/"?t.state=L.CLOSE_TAG:(t.script+="<"+i,t.state=L.SCRIPT);continue;case L.OPEN_WAKA:if(i==="!")t.state=L.SGML_DECL,t.sgmlDecl="";else if(!C(c,i))if(C(S,i))t.state=L.OPEN_TAG,t.tagName=i;else if(i==="/")t.state=L.CLOSE_TAG,t.tagName="";else if(i==="?")t.state=L.PROC_INST,t.procInstName=t.procInstBody="";else{H(t,"Unencoded <");if(t.startTagPosition+1<t.position){var o=t.position-t.startTagPosition;i=(new Array(o)).join(" ")+i}t.textNode+="<"+i,t.state=L.TEXT}continue;case L.SGML_DECL:(t.sgmlDecl+i).toUpperCase()===g?(O(t,"onopencdata"),t.state=L.CDATA,t.sgmlDecl="",t.cdata=""):t.sgmlDecl+i==="--"?(t.state=L.COMMENT,t.comment="",t.sgmlDecl=""):(t.sgmlDecl+i).toUpperCase()===y?(t.state=L.DOCTYPE,(t.doctype||t.sawRoot)&&H(t,"Inappropriately located doctype declaration"),t.doctype="",t.sgmlDecl=""):i===">"?(O(t,"onsgmldeclaration",t.sgmlDecl),t.sgmlDecl="",t.state=L.TEXT):C(d,i)?(t.state=L.SGML_DECL_QUOTED,t.sgmlDecl+=i):t.sgmlDecl+=i;continue;case L.SGML_DECL_QUOTED:i===t.q&&(t.state=L.SGML_DECL,t.q=""),t.sgmlDecl+=i;continue;case L.DOCTYPE:i===">"?(t.state=L.TEXT,O(t,"ondoctype",t.doctype),t.doctype=!0):(t.doctype+=i,i==="["?t.state=L.DOCTYPE_DTD:C(d,i)&&(t.state=L.DOCTYPE_QUOTED,t.q=i));continue;case L.DOCTYPE_QUOTED:t.doctype+=i,i===t.q&&(t.q="",t.state=L.DOCTYPE);continue;case L.DOCTYPE_DTD:t.doctype+=i,i==="]"?t.state=L.DOCTYPE:C(d,i)&&(t.state=L.DOCTYPE_DTD_QUOTED,t.q=i);continue;case L.DOCTYPE_DTD_QUOTED:t.doctype+=i,i===t.q&&(t.state=L.DOCTYPE_DTD,t.q="");continue;case L.COMMENT:i==="-"?t.state=L.COMMENT_ENDING:t.comment+=i;continue;case L.COMMENT_ENDING:i==="-"?(t.state=L.COMMENT_ENDED,t.comment=_(t.opt,t.comment),t.comment&&O(t,"oncomment",t.comment),t.comment=""):(t.comment+="-"+i,t.state=L.COMMENT);continue;case L.COMMENT_ENDED:i!==">"?(H(t,"Malformed comment"),t.comment+="--"+i,t.state=L.COMMENT):t.state=L.TEXT;continue;case L.CDATA:i==="]"?t.state=L.CDATA_ENDING:t.cdata+=i;continue;case L.CDATA_ENDING:i==="]"?t.state=L.CDATA_ENDING_2:(t.cdata+="]"+i,t.state=L.CDATA);continue;case L.CDATA_ENDING_2:i===">"?(t.cdata&&O(t,"oncdata",t.cdata),O(t,"onclosecdata"),t.cdata="",t.state=L.TEXT):i==="]"?t.cdata+="]":(t.cdata+="]]"+i,t.state=L.CDATA);continue;case L.PROC_INST:i==="?"?t.state=L.PROC_INST_ENDING:C(c,i)?t.state=L.PROC_INST_BODY:t.procInstName+=i;continue;case L.PROC_INST_BODY:if(!t.procInstBody&&C(c,i))continue;i==="?"?t.state=L.PROC_INST_ENDING:t.procInstBody+=i;continue;case L.PROC_INST_ENDING:i===">"?(O(t,"onprocessinginstruction",{name:t.procInstName,body:t.procInstBody}),t.procInstName=t.procInstBody="",t.state=L.TEXT):(t.procInstBody+="?"+i,t.state=L.PROC_INST_BODY);continue;case L.OPEN_TAG:C(x,i)?t.tagName+=i:(B(t),i===">"?I(t):i==="/"?t.state=L.OPEN_TAG_SLASH:(k(c,i)&&H(t,"Invalid character in tag name"),t.state=L.ATTRIB));continue;case L.OPEN_TAG_SLASH:i===">"?(I(t,!0),q(t)):(H(t,"Forward-slash in opening tag not followed by >"),t.state=L.ATTRIB);continue;case L.ATTRIB:if(C(c,i))continue;i===">"?I(t):i==="/"?t.state=L.OPEN_TAG_SLASH:C(S,i)?(t.attribName=i,t.attribValue="",t.state=L.ATTRIB_NAME):H(t,"Invalid attribute name");continue;case L.ATTRIB_NAME:i==="="?t.state=L.ATTRIB_VALUE:i===">"?(H(t,"Attribute without value"),t.attribValue=t.attribName,F(t),I(t)):C(c,i)?t.state=L.ATTRIB_NAME_SAW_WHITE:C(x,i)?t.attribName+=i:H(t,"Invalid attribute name");continue;case L.ATTRIB_NAME_SAW_WHITE:if(i==="=")t.state=L.ATTRIB_VALUE;else{if(C(c,i))continue;H(t,"Attribute without value"),t.tag.attributes[t.attribName]="",t.attribValue="",O(t,"onattribute",{name:t.attribName,value:""}),t.attribName="",i===">"?I(t):C(S,i)?(t.attribName=i,t.state=L.ATTRIB_NAME):(H(t,"Invalid attribute name"),t.state=L.ATTRIB)}continue;case L.ATTRIB_VALUE:if(C(c,i))continue;C(d,i)?(t.q=i,t.state=L.ATTRIB_VALUE_QUOTED):(H(t,"Unquoted attribute value"),t.state=L.ATTRIB_VALUE_UNQUOTED,t.attribValue=i);continue;case L.ATTRIB_VALUE_QUOTED:if(i!==t.q){i==="&"?t.state=L.ATTRIB_VALUE_ENTITY_Q:t.attribValue+=i;continue}F(t),t.q="",t.state=L.ATTRIB_VALUE_CLOSED;continue;case L.ATTRIB_VALUE_CLOSED:C(c,i)?t.state=L.ATTRIB:i===">"?I(t):i==="/"?t.state=L.OPEN_TAG_SLASH:C(S,i)?(H(t,"No whitespace between attributes"),t.attribName=i,t.attribValue="",t.state=L.ATTRIB_NAME):H(t,"Invalid attribute name");continue;case L.ATTRIB_VALUE_UNQUOTED:if(k(m,i)){i==="&"?t.state=L.ATTRIB_VALUE_ENTITY_U:t.attribValue+=i;continue}F(t),i===">"?I(t):t.state=L.ATTRIB;continue;case L.CLOSE_TAG:if(!t.tagName){if(C(c,i))continue;k(S,i)?t.script?(t.script+="</"+i,t.state=L.SCRIPT):H(t,"Invalid tagname in closing tag."):t.tagName=i}else i===">"?q(t):C(x,i)?t.tagName+=i:t.script?(t.script+="</"+t.tagName,t.tagName="",t.state=L.SCRIPT):(k(c,i)&&H(t,"Invalid tagname in closing tag"),t.state=L.CLOSE_TAG_SAW_WHITE);continue;case L.CLOSE_TAG_SAW_WHITE:if(C(c,i))continue;i===">"?q(t):H(t,"Invalid characters in closing tag");continue;case L.TEXT_ENTITY:case L.ATTRIB_VALUE_ENTITY_Q:case L.ATTRIB_VALUE_ENTITY_U:switch(t.state){case L.TEXT_ENTITY:var u=L.TEXT,a="textNode";break;case L.ATTRIB_VALUE_ENTITY_Q:var u=L.ATTRIB_VALUE_QUOTED,a="attribValue";break;case L.ATTRIB_VALUE_ENTITY_U:var u=L.ATTRIB_VALUE_UNQUOTED,a="attribValue"}i===";"?(t[a]+=R(t),t.entity="",t.state=u):C(v,i)?t.entity+=i:(H(t,"Invalid character entity"),t[a]+="&"+t.entity+i,t.entity="",t.state=u);continue;default:throw new Error(t,"Unknown state: "+t.state)}}return t.position>=t.bufferCheckPosition&&r(t),t}e.parser=function(e,t){return new n(e,t)},e.SAXParser=n,e.SAXStream=l,e.createStream=f,e.MAX_BUFFER_LENGTH=65536;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),n.prototype={end:function(){P(this)},write:U,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){s(this)}};try{var o=require("stream").Stream}catch(u){var o=function(){}}var a=e.EVENTS.filter(function(e){return e!=="error"&&e!=="end"});l.prototype=Object.create(o.prototype,{constructor:{value:l}}),l.prototype.write=function(e){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(e)){if(!this._decoder){var t=require("string_decoder").StringDecoder;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},l.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},l.prototype.on=function(e,t){var n=this;return!n._parser["on"+e]&&a.indexOf(e)!==-1&&(n._parser["on"+e]=function(){var t=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),o.prototype.on.call(n,e,t)};var c="\r\n	 ",h="0124356789",p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",d="'\"",v=h+p+"#",m=c+">",g="[CDATA[",y="DOCTYPE",b="http://www.w3.org/XML/1998/namespace",w="http://www.w3.org/2000/xmlns/",E={xml:b,xmlns:w};c=T(c),h=T(h),p=T(p);var S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,x=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;d=T(d),v=T(v),m=T(m);var L=0;e.STATE={BEGIN:L++,TEXT:L++,TEXT_ENTITY:L++,OPEN_WAKA:L++,SGML_DECL:L++,SGML_DECL_QUOTED:L++,DOCTYPE:L++,DOCTYPE_QUOTED:L++,DOCTYPE_DTD:L++,DOCTYPE_DTD_QUOTED:L++,COMMENT_STARTING:L++,COMMENT:L++,COMMENT_ENDING:L++,COMMENT_ENDED:L++,CDATA:L++,CDATA_ENDING:L++,CDATA_ENDING_2:L++,PROC_INST:L++,PROC_INST_BODY:L++,PROC_INST_ENDING:L++,OPEN_TAG:L++,OPEN_TAG_SLASH:L++,ATTRIB:L++,ATTRIB_NAME:L++,ATTRIB_NAME_SAW_WHITE:L++,ATTRIB_VALUE:L++,ATTRIB_VALUE_QUOTED:L++,ATTRIB_VALUE_CLOSED:L++,ATTRIB_VALUE_UNQUOTED:L++,ATTRIB_VALUE_ENTITY_Q:L++,ATTRIB_VALUE_ENTITY_U:L++,CLOSE_TAG:L++,CLOSE_TAG_SAW_WHITE:L++,SCRIPT:L++,SCRIPT_ENDING:L++},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var n=e.ENTITIES[t],r=typeof n=="number"?String.fromCharCode(n):n;e.ENTITIES[t]=r});for(var L in e.STATE)e.STATE[e.STATE[L]]=L;L=e.STATE,String.fromCodePoint||function(){var e=String.fromCharCode,t=Math.floor,n=function(){var n=16384,r=[],i,s,o=-1,u=arguments.length;if(!u)return"";var a="";while(++o<u){var f=Number(arguments[o]);if(!isFinite(f)||f<0||f>1114111||t(f)!=f)throw RangeError("Invalid code point: "+f);f<=65535?r.push(f):(f-=65536,i=(f>>10)+55296,s=f%1024+56320,r.push(i,s));if(o+1==u||r.length>n)a+=e.apply(null,r),r.length=0}return a};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:n,configurable:!0,writable:!0}):String.fromCodePoint=n}()}(typeof exports=="undefined"?sax={}:exports),define("sax",function(e){return function(){var t,n;return t||e.sax}}(this)),define("bpmn/util/Serializer",["bpmn/util/JSClass","bpmn/Package","bpmn/Definitions","bpmn/BaseElement","sax"],function(e,t,n,r){var i={initialize:function(){},fromXML:function(e){if(!e)return;var i=function(e,t,n,r){if(t.attributes[e]){var i=t.attributes[e].value;r=="float"&&(i=parseFloat(i)),r=="boolean"&&(i=i.toLowerCase()=="true"),r=="integer"&&(i=parseInt(i)),n[e](i)}},s=sax.parser(!0,{xmlns:!0,lowercase:!0,trim:!0});s.stack=[],Array.prototype.peek=function(){return this.length==0?null:this[this.length-1]};var o={definitions:function(e){s.definitions=new n,s.stack.push(s.definitions)},"default":function(e){var n=s.stack.peek(),o=e.local.toLowerCase(),u=t.tagMap[o],a=u?new u:new r;s.stack.push(a),a._definitions=s.definitions;for(var f in a.attribute)i(f,e,a,a.attribute[f].type);var l=null;for(var c in n.reference){var h=n.reference[c];if(a.isA(h.type)){l=h;break}}a.init(),l&&l.containment===!0?n[l.name]().push(a):l&&n[l.name](a)}};return s.onerror=function(e){console.log("error",e)},s.onopentag=function(e){o[e.local]?o[e.local](e):o["default"](e)},s.onclosetag=function(e){s.stack.pop()},s.ontext=function(e){s.stack.peek().setText(e)},s.onend=function(){},s.write(e).close(),s.definitions}};return new e.Class(i)});var Kinetic={};!function(e){var t=Math.PI/180;Kinetic={version:"5.1.1",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,UA:function(){var t=e.navigator&&e.navigator.userAgent||"",n=t.toLowerCase(),r=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[],i=!!t.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);return{browser:r[1]||"",version:r[2]||"0",mobile:i}}(),Filters:{},Node:function(e){this._init(e)},Shape:function(e){this.__init(e)},Container:function(e){this.__init(e)},Stage:function(e){this.___init(e)},BaseLayer:function(e){this.___init(e)},Layer:function(e){this.____init(e)},FastLayer:function(e){this.____init(e)},Group:function(e){this.___init(e)},isDragging:function(){var e=Kinetic.DD;return e?e.isDragging:!1},isDragReady:function(){var e=Kinetic.DD;return e?!!e.node:!1},_addId:function(e,t){void 0!==t&&(this.ids[t]=e)},_removeId:function(e){void 0!==e&&delete this.ids[e]},_addName:function(e,t){void 0!==t&&(void 0===this.names[t]&&(this.names[t]=[]),this.names[t].push(e))},_removeName:function(e,t){if(void 0!==e){var n=this.names[e];if(void 0!==n){for(var r=0;r<n.length;r++){var i=n[r];i._id===t&&n.splice(r,1)}0===n.length&&delete this.names[e]}}},getAngle:function(e){return this.angleDeg?e*t:e}}}(this),function(e,t){if("object"==typeof exports){var n=t();if(global.window===global)Kinetic.document=global.document,Kinetic.window=global;else{var r=require("canvas"),i=require("jsdom").jsdom,s=i("<!DOCTYPE html><html><head></head><body></body></html>");Kinetic.document=s,Kinetic.window=Kinetic.document.createWindow(),Kinetic.window.Image=r.Image,Kinetic._nodeCanvas=r}return Kinetic.root=e,void (module.exports=n)}"function"==typeof define&&define.amd&&define("kinetic",t),Kinetic.document=document,Kinetic.window=window,Kinetic.root=e}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var e=[].slice.call(arguments),t=e.length,n=0;for(this.length=t;t>n;n++)this[n]=e[n];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(e){for(var t=0;t<this.length;t++)e(this[t],t)},Kinetic.Collection.prototype.toArray=function(){var e,t=[],n=this.length;for(e=0;n>e;e++)t.push(this[e]);return t},Kinetic.Collection.toCollection=function(e){var t,n=new Kinetic.Collection,r=e.length;for(t=0;r>t;t++)n.push(e[t]);return n},Kinetic.Collection._mapMethod=function(e){Kinetic.Collection.prototype[e]=function(){var t,n=this.length,r=[].slice.call(arguments);for(t=0;n>t;t++)this[t][e].apply(this[t],r);return this}},Kinetic.Collection.mapMethods=function(e){var t=e.prototype;for(var n in t)Kinetic.Collection._mapMethod(n)},Kinetic.Transform=function(e){this.m=e&&e.slice()||[1,0,0,1,0,0]},Kinetic.Transform.prototype={copy:function(){return new Kinetic.Transform(this.m)},point:function(e){var t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}},translate:function(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this},scale:function(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,s=this.m[0]*-n+this.m[2]*t,o=this.m[1]*-n+this.m[3]*t;return this.m[0]=r,this.m[1]=i,this.m[2]=s,this.m[3]=o,this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(e,t){var n=this.m[0]+this.m[2]*t,r=this.m[1]+this.m[3]*t,i=this.m[2]+this.m[0]*e,s=this.m[3]+this.m[1]*e;return this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=s,this},multiply:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],i=this.m[1]*e.m[2]+this.m[3]*e.m[3],s=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],o=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o,this},invert:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,i=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=s,this.m[5]=o,this},getMatrix:function(){return this.m},setAbsolutePosition:function(e,t){var n=this.m[0],r=this.m[1],i=this.m[2],s=this.m[3],o=this.m[4],u=this.m[5],a=(n*(t-u)-r*(e-o))/(n*s-r*i),f=(e-o-i*a)/n;return this.translate(f,a)}};var e="2d",t="[object Array]",n="[object Number]",r="[object String]",i=Math.PI/180,s=180/Math.PI,o="#",u="",a="0",f="Kinetic warning: ",l="Kinetic error: ",c="rgb(",h={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},p=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(e){return!!e&&1==e.nodeType},_isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isObject:function(e){return!!e&&e.constructor==Object},_isArray:function(e){return Object.prototype.toString.call(e)==t},_isNumber:function(e){return Object.prototype.toString.call(e)==n},_isString:function(e){return Object.prototype.toString.call(e)==r},_throttle:function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:(new Date).getTime(),o=null,s=e.apply(r,i),r=i=null};return function(){var f=(new Date).getTime();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),r=i=null):o||n.trailing===!1||(o=setTimeout(a,l)),s}},_hasMethods:function(e){var t,n=[];for(t in e)this._isFunction(e[t])&&n.push(t);return n.length>0},createCanvasElement:function(){var e=Kinetic.document.createElement("canvas");return e.style=e.style||{},e},isBrowser:function(){return"object"!=typeof exports},_isInDocument:function(e){for(;e=e.parentNode;)if(e==Kinetic.document)return!0;return!1},_simplifyArray:function(e){var t,n,r=[],i=e.length,s=Kinetic.Util;for(t=0;i>t;t++)n=e[t],s._isNumber(n)?n=Math.round(1e3*n)/1e3:s._isString(n)||(n=n.toString()),r.push(n);return r},_getImage:function(t,n){var r,i;if(t)if(this._isElement(t))n(t);else if(this._isString(t))r=new Kinetic.window.Image,r.onload=function(){n(r)},r.src=t;else if(t.data){i=Kinetic.Util.createCanvasElement(),i.width=t.width,i.height=t.height;var s=i.getContext(e);s.putImageData(t,0,0),this._getImage(i.toDataURL(),n)}else n(null);else n(null)},_getRGBAString:function(e){var t=e.red||0,n=e.green||0,r=e.blue||0,i=e.alpha||1;return["rgba(",t,",",n,",",r,",",i,")"].join(u)},_rgbToHex:function(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},_hexToRgb:function(e){e=e.replace(o,u);var t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}},getRandomColor:function(){for(var e=(16777215*Math.random()<<0).toString(16);e.length<6;)e=a+e;return o+e},get:function(e,t){return void 0===e?t:e},getRGB:function(e){var t;return e in h?(t=h[e],{r:t[0],g:t[1],b:t[2]}):e[0]===o?this._hexToRgb(e.substring(1)):e.substr(0,4)===c?(t=p.exec(e.replace(/ /g,"")),{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}):{r:0,g:0,b:0}},_merge:function(e,t){var n=this._clone(t);for(var r in e)n[r]=this._isObject(e[r])?this._merge(e[r],n[r]):e[r];return n},cloneObject:function(e){var t={};for(var n in e)t[n]=this._isObject(e[n])?this.cloneObject(e[n]):this._isArray(e[n])?this.cloneArray(e[n]):e[n];return t},cloneArray:function(e){return e.slice(0)},_degToRad:function(e){return e*i},_radToDeg:function(e){return e*s},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},error:function(e){throw new Error(l+e)},warn:function(e){Kinetic.root.console&&console.warn&&console.warn(f+e)},extend:function(e,t){for(var n in t.prototype)n in e.prototype||(e.prototype[n]=t.prototype[n])},addMethods:function(e,t){var n;for(n in t)e.prototype[n]=t[n]},_getControlPoints:function(e,t,n,r,i,s,o){var u=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),a=Math.sqrt(Math.pow(i-n,2)+Math.pow(s-r,2)),f=o*u/(u+a),l=o*a/(u+a),c=n-f*(i-e),h=r-f*(s-t),p=n+l*(i-e),d=r+l*(s-t);return[c,h,p,d]},_expandPoints:function(e,t){var n,r,i=e.length,s=[];for(n=2;i-2>n;n+=2)r=Kinetic.Util._getControlPoints(e[n-2],e[n-1],e[n],e[n+1],e[n+2],e[n+3],t),s.push(r[0]),s.push(r[1]),s.push(e[n]),s.push(e[n+1]),s.push(r[2]),s.push(r[3]);return s},_removeLastLetter:function(e){return e.substring(0,e.length-1)}}}(),function(){var e=Kinetic.Util.createCanvasElement(),t=e.getContext("2d"),n=Kinetic.UA.mobile?function(){var e=window.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return e/n}():1;Kinetic.Canvas=function(e){this.init(e)},Kinetic.Canvas.prototype={init:function(e){e=e||{};var t=e.pixelRatio||Kinetic.pixelRatio||n;this.pixelRatio=t,this._canvas=Kinetic.Util.createCanvasElement(),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(e){this.pixelRatio=e,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px"},setHeight:function(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(e,t){this.setWidth(e),this.setHeight(t)},toDataURL:function(e,t){try{return this._canvas.toDataURL(e,t)}catch(n){try{return this._canvas.toDataURL()}catch(r){return Kinetic.Util.warn("Unable to get data URL. "+r.message),""}}}},Kinetic.SceneCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e),this.context=new Kinetic.SceneContext(this),this.setSize(t,n)},Kinetic.SceneCanvas.prototype={setWidth:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,e),n.scale(t,t)},setHeight:function(e){var t=this.pixelRatio,n=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,e),n.scale(t,t)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(e){e=e||{};var t=e.width||0,n=e.height||0;Kinetic.Canvas.call(this,e),this.context=new Kinetic.HitContext(this),this.setSize(t,n)},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var e=",",t="(",n=")",r="([",i="])",s=";",o="()",u="=",a=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(e){this.init(e)},Kinetic.Context.prototype={init:function(e){this.canvas=e,this._context=e._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(e){e.getFillEnabled()&&this._fill(e)},strokeShape:function(e){e.getStrokeEnabled()&&this._stroke(e)},fillStrokeShape:function(e){var t=e.getFillEnabled();t&&this._fill(e),e.getStrokeEnabled()&&this._stroke(e)},getTrace:function(a){var l,p,v,m,y=this.traceArr,w=y.length,E="";for(l=0;w>l;l++)p=y[l],v=p.method,v?(m=p.args,E+=v,E+=a?o:Kinetic.Util._isArray(m[0])?r+m.join(e)+i:t+m.join(e)+n):(E+=p.property,a||(E+=u+p.val)),E+=s;return E},clearTrace:function(){this.traceArr=[]},_trace:function(e){var t,n=this.traceArr;n.push(e),t=n.length,t>=Kinetic.traceArrMax&&n.shift()},reset:function(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)},getCanvas:function(){return this.canvas},clear:function(e){var t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth(),t.getHeight())},_applyLineCap:function(e){var t=e.getLineCap();t&&this.setAttr("lineCap",t)},_applyOpacity:function(e){var t=e.getAbsoluteOpacity();1!==t&&this.setAttr("globalAlpha",t)},_applyLineJoin:function(e){var t=e.getLineJoin();t&&this.setAttr("lineJoin",t)},setAttr:function(e,t){this._context[e]=t},arc:function(){var e=arguments;this._context.arc(e[0],e[1],e[2],e[3],e[4],e[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var e=arguments;this._context.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])},clearRect:function(){var e=arguments;this._context.clearRect(e[0],e[1],e[2],e[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var e=arguments;return 2===e.length?this._context.createImageData(e[0],e[1]):1===e.length?this._context.createImageData(e[0]):void 0},createLinearGradient:function(){var e=arguments;return this._context.createLinearGradient(e[0],e[1],e[2],e[3])},createPattern:function(){var e=arguments;return this._context.createPattern(e[0],e[1])},createRadialGradient:function(){var e=arguments;return this._context.createRadialGradient(e[0],e[1],e[2],e[3],e[4],e[5])},drawImage:function(){var e=arguments,t=this._context;3===e.length?t.drawImage(e[0],e[1],e[2]):5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},fill:function(){this._context.fill()},fillText:function(){var e=arguments;this._context.fillText(e[0],e[1],e[2])},getImageData:function(){var e=arguments;return this._context.getImageData(e[0],e[1],e[2],e[3])},lineTo:function(){var e=arguments;this._context.lineTo(e[0],e[1])},moveTo:function(){var e=arguments;this._context.moveTo(e[0],e[1])},rect:function(){var e=arguments;this._context.rect(e[0],e[1],e[2],e[3])},putImageData:function(){var e=arguments;this._context.putImageData(e[0],e[1],e[2])},quadraticCurveTo:function(){var e=arguments;this._context.quadraticCurveTo(e[0],e[1],e[2],e[3])},restore:function(){this._context.restore()},rotate:function(){var e=arguments;this._context.rotate(e[0])},save:function(){this._context.save()},scale:function(){var e=arguments;this._context.scale(e[0],e[1])},setLineDash:function(){var e=arguments,t=this._context;this._context.setLineDash?t.setLineDash(e[0]):"mozDash"in t?t.mozDash=e[0]:"webkitLineDash"in t&&(t.webkitLineDash=e[0])},setTransform:function(){var e=arguments;this._context.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},stroke:function(){this._context.stroke()},strokeText:function(){var e=arguments;this._context.strokeText(e[0],e[1],e[2])},transform:function(){var e=arguments;this._context.transform(e[0],e[1],e[2],e[3],e[4],e[5])},translate:function(){var e=arguments;this._context.translate(e[0],e[1])},_enableTrace:function(){var e,t,n=this,r=a.length,i=Kinetic.Util._simplifyArray,s=this.setAttr,o=function(e){var r,s=n[e];n[e]=function(){return t=i(Array.prototype.slice.call(arguments,0)),r=s.apply(n,arguments),n._trace({method:e,args:t}),r}};for(e=0;r>e;e++)o(a[e]);n.setAttr=function(){s.apply(n,arguments),n._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(e){Kinetic.Context.call(this,e)},Kinetic.SceneContext.prototype={_fillColor:function(e){var t=e.fill()||Kinetic.Util._getRGBAString({red:e.fillRed(),green:e.fillGreen(),blue:e.fillBlue(),alpha:e.fillAlpha()});this.setAttr("fillStyle",t),e._fillFunc(this)},_fillPattern:function(e){var t=e.getFillPatternImage(),n=e.getFillPatternX(),r=e.getFillPatternY(),i=e.getFillPatternScale(),s=Kinetic.getAngle(e.getFillPatternRotation()),o=e.getFillPatternOffset(),u=e.getFillPatternRepeat();(n||r)&&this.translate(n||0,r||0),s&&this.rotate(s),i&&this.scale(i.x,i.y),o&&this.translate(-1*o.x,-1*o.y),this.setAttr("fillStyle",this.createPattern(t,u||"repeat")),this.fill()},_fillLinearGradient:function(e){var t=e.getFillLinearGradientStartPoint(),n=e.getFillLinearGradientEndPoint(),r=e.getFillLinearGradientColorStops(),i=this.createLinearGradient(t.x,t.y,n.x,n.y);if(r){for(var s=0;s<r.length;s+=2)i.addColorStop(r[s],r[s+1]);this.setAttr("fillStyle",i),this.fill()}},_fillRadialGradient:function(e){for(var t=e.getFillRadialGradientStartPoint(),n=e.getFillRadialGradientEndPoint(),r=e.getFillRadialGradientStartRadius(),i=e.getFillRadialGradientEndRadius(),s=e.getFillRadialGradientColorStops(),o=this.createRadialGradient(t.x,t.y,r,n.x,n.y,i),u=0;u<s.length;u+=2)o.addColorStop(s[u],s[u+1]);this.setAttr("fillStyle",o),this.fill()},_fill:function(e){var t=e.fill()||e.fillRed()||e.fillGreen()||e.fillBlue(),n=e.getFillPatternImage(),r=e.getFillLinearGradientColorStops(),i=e.getFillRadialGradientColorStops(),s=e.getFillPriority();t&&"color"===s?this._fillColor(e):n&&"pattern"===s?this._fillPattern(e):r&&"linear-gradient"===s?this._fillLinearGradient(e):i&&"radial-gradient"===s?this._fillRadialGradient(e):t?this._fillColor(e):n?this._fillPattern(e):r?this._fillLinearGradient(e):i&&this._fillRadialGradient(e)},_stroke:function(e){var t=e.dash(),n=e.getStrokeScaleEnabled();e.hasStroke()&&(n||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(e),t&&e.dashEnabled()&&this.setLineDash(t),this.setAttr("lineWidth",e.strokeWidth()),this.setAttr("strokeStyle",e.stroke()||Kinetic.Util._getRGBAString({red:e.strokeRed(),green:e.strokeGreen(),blue:e.strokeBlue(),alpha:e.strokeAlpha()})),e._strokeFunc(this),n||this.restore())},_applyShadow:function(e){var t=Kinetic.Util,n=e.getAbsoluteOpacity(),r=t.get(e.getShadowColor(),"black"),i=t.get(e.getShadowBlur(),5),s=t.get(e.getShadowOpacity(),1),o=t.get(e.getShadowOffset(),{x:0,y:0});s&&this.setAttr("globalAlpha",s*n),this.setAttr("shadowColor",r),this.setAttr("shadowBlur",i),this.setAttr("shadowOffsetX",o.x),this.setAttr("shadowOffsetY",o.y)}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(e){Kinetic.Context.call(this,e)},Kinetic.HitContext.prototype={_fill:function(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()},_stroke:function(e){e.hasStroke()&&(this._applyLineCap(e),this.setAttr("lineWidth",e.strokeWidth()),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this))}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var e="get",t="set";Kinetic.Factory={addGetterSetter:function(e,t,n,r,i){this.addGetter(e,t,n),this.addSetter(e,t,r,i),this.addOverloadedGetterSetter(e,t)},addGetter:function(t,n,r){var i=e+Kinetic.Util._capitalize(n);t.prototype[i]=function(){var e=this.attrs[n];return void 0===e?r:e}},addSetter:function(e,n,r,i){var s=t+Kinetic.Util._capitalize(n);e.prototype[s]=function(e){return r&&(e=r.call(this,e)),this._setAttr(n,e),i&&i.call(this),this}},addComponentsGetterSetter:function(n,r,i,s,o){var u,f,l=i.length,c=Kinetic.Util._capitalize,h=e+c(r),p=t+c(r);n.prototype[h]=function(){var e={};for(u=0;l>u;u++)f=i[u],e[f]=this.getAttr(r+c(f));return e},n.prototype[p]=function(e){var t,n=this.attrs[r];s&&(e=s.call(this,e));for(t in e)this._setAttr(r+c(t),e[t]);return this._fireChangeEvent(r,n,e),o&&o.call(this),this},this.addOverloadedGetterSetter(n,r)},addOverloadedGetterSetter:function(n,r){var i=Kinetic.Util._capitalize(r),s=t+i,o=e+i;n.prototype[r]=function(){return arguments.length?(this[s](arguments[0]),this):this[o]()}},backCompat:function(e,t){var n;for(n in t)e.prototype[n]=e.prototype[t[n]]},afterSetFilter:function(){this._filterUpToDate=!1}},Kinetic.Validators={RGBComponent:function(e){return e>255?255:0>e?0:Math.round(e)},alphaComponent:function(e){return e>1?1:1e-4>e?1e-4:e}}}(),function(){var e="absoluteOpacity",t="absoluteTransform",n="Change",r="children",i=".",s="",o="get",u="id",a="kinetic",f="listening",l="mouseenter",c="mouseleave",h="name",p="set",d="Shape",v=" ",m="stage",g="transform",y="Stage",b="visible",w=["id"],E=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(v);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(n){var r=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this._cache={},this._filterUpToDate=!1,this.setAttrs(n),this.on(E,function(){this._clearCache(g),r._clearSelfAndDescendantCache(t)}),this.on("visibleChange.kinetic",function(){r._clearSelfAndDescendantCache(b)}),this.on("listeningChange.kinetic",function(){r._clearSelfAndDescendantCache(f)}),this.on("opacityChange.kinetic",function(){r._clearSelfAndDescendantCache(e)})},_clearCache:function(e){e?delete this._cache[e]:this._cache={}},_getCache:function(e,t){var n=this._cache[e];return void 0===n&&(this._cache[e]=t.call(this)),this._cache[e]},_clearSelfAndDescendantCache:function(e){this._clearCache(e),this.children&&this.getChildren().each(function(t){t._clearSelfAndDescendantCache(e)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(e){var t=e||{},n=t.x||0,r=t.y||0,i=t.width||this.width(),s=t.height||this.height(),o=t.drawBorder||!1,u=this.getLayer();if(0===i||0===s)return void Kinetic.Util.warn("Width or height of caching configuration equals 0. Cache is ignored.");var a=new Kinetic.SceneCanvas({pixelRatio:1,width:i,height:s}),f=new Kinetic.SceneCanvas({pixelRatio:1,width:i,height:s}),l=new Kinetic.HitCanvas({width:i,height:s}),c=(this.transformsEnabled(),this.x(),this.y(),a.getContext()),h=l.getContext();return l.isCache=!0,this.clearCache(),c.save(),h.save(),o&&(c.save(),c.beginPath(),c.rect(0,0,i,s),c.closePath(),c.setAttr("strokeStyle","red"),c.setAttr("lineWidth",5),c.stroke(),c.restore()),c.translate(-1*n,-1*r),h.translate(-1*n,-1*r),"Shape"===this.nodeType&&u&&(c.translate(-1*this.x(),-1*this.y()),h.translate(-1*this.x(),-1*this.y())),this.drawScene(a,this),this.drawHit(l,this),c.restore(),h.restore(),this._cache.canvas={scene:a,filter:f,hit:l},this},_drawCachedSceneCanvas:function(e){e.save(),this.getLayer()._applyTransform(this,e),e.drawImage(this._getCachedSceneCanvas()._canvas,0,0),e.restore()},_getCachedSceneCanvas:function(){var e,t,n,r,i=this.filters(),s=this._cache.canvas,o=s.scene,u=s.filter,a=u.getContext();if(i){if(!this._filterUpToDate){try{for(e=i.length,a.clear(),a.drawImage(o._canvas,0,0),t=a.getImageData(0,0,u.getWidth(),u.getHeight()),n=0;e>n;n++)r=i[n],r.call(this,t),a.putImageData(t,0,0)}catch(f){Kinetic.Util.warn("Unable to apply filter. "+f.message)}this._filterUpToDate=!0}return u}return o},_drawCachedHitCanvas:function(e){var t=this._cache.canvas,n=t.hit;e.save(),this.getLayer()._applyTransform(this,e),e.drawImage(n._canvas,0,0),e.restore()},on:function(e,t){var n,r,o,u,a,f=e.split(v),l=f.length;for(n=0;l>n;n++)r=f[n],o=r.split(i),u=o[0],a=o[1]||s,this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:a,handler:t});return this},off:function(e){var t,n,r,s,o,u,a=e.split(v),f=a.length;for(t=0;f>t;t++)if(r=a[t],s=r.split(i),o=s[0],u=s[1],o)this.eventListeners[o]&&this._off(o,u);else for(n in this.eventListeners)this._off(n,u);return this},dispatchEvent:function(e){var t={target:this,type:e.type,evt:e};this.fire(e.type,t)},addEventListener:function(e,t){this.on(e,function(e){t.call(this,e.evt)})},removeEventListener:function(e){this.off(e)},remove:function(){var n=this.getParent();return n&&n.children&&(n.children.splice(this.index,1),n._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache(m),this._clearSelfAndDescendantCache(t),this._clearSelfAndDescendantCache(b),this._clearSelfAndDescendantCache(f),this._clearSelfAndDescendantCache(e),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(e){var t=o+Kinetic.Util._capitalize(e);return Kinetic.Util._isFunction(this[t])?this[t]():this.attrs[e]},getAncestors:function(){for(var e=this.getParent(),t=new Kinetic.Collection;e;)t.push(e),e=e.getParent();return t},getAttrs:function(){return this.attrs||{}},setAttrs:function(e){var t,n;if(e)for(t in e)t===r||(n=p+Kinetic.Util._capitalize(t),Kinetic.Util._isFunction(this[n])?this[n](e[t]):this._setAttr(t,e[t]));return this},isListening:function(){return this._getCache(f,this._isListening)},_isListening:function(){var e=this.getListening(),t=this.getParent();return"inherit"===e?t?t.isListening():!0:e},isVisible:function(){return this._getCache(b,this._isVisible)},_isVisible:function(){var e=this.getVisible(),t=this.getParent();return"inherit"===e?t?t.isVisible():!0:e},shouldDrawHit:function(e){var t=this.getLayer();return(e&&e.isCache||t&&t.hitGraphEnabled())&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function e(a){for(t=[],n=a.length,r=0;n>r;r++)i=a[r],u++,i.nodeType!==d&&(t=t.concat(i.getChildren().toArray())),i._id===o._id&&(r=n);t.length>0&&t[0].getDepth()<=s&&e(t)}var t,n,r,i,s=this.getDepth(),o=this,u=0;return o.nodeType!==y&&e(o.getStage().getChildren()),u},getDepth:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},setPosition:function(e){return this.setX(e.x),this.setY(e.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var e=this.getAbsoluteTransform().getMatrix(),t=new Kinetic.Transform,n=this.offset();return t.m=e.slice(),t.translate(n.x,n.y),t.getTranslation()},setAbsolutePosition:function(e){var t,n=this._clearTransform();return this.attrs.x=n.x,this.attrs.y=n.y,delete n.x,delete n.y,t=this.getAbsoluteTransform(),t.invert(),t.translate(e.x,e.y),e={x:this.attrs.x+t.getTranslation().x,y:this.attrs.y+t.getTranslation().y},this.setPosition({x:e.x,y:e.y}),this._setTransform(n),this},_setTransform:function(e){var n;for(n in e)this.attrs[n]=e[n];this._clearCache(g),this._clearSelfAndDescendantCache(t)},_clearTransform:function(){var e={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(g),this._clearSelfAndDescendantCache(t),e},move:function(e){var t=e.x,n=e.y,r=this.getX(),i=this.getY();return void 0!==t&&(r+=t),void 0!==n&&(i+=n),this.setPosition({x:r,y:i}),this},_eachAncestorReverse:function(e,t){var n,r,i=[],s=this.getParent();if(t&&t._id===this._id)return e(this),!0;for(i.unshift(this);s&&(!t||s._id!==t._id);)i.unshift(s),s=s.parent;for(n=i.length,r=0;n>r;r++)e(i[r])},rotate:function(e){return this.setRotation(this.getRotation()+e),this},moveToTop:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveToTop function is ignored.");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveUp function is ignored.");var e=this.index,t=this.parent.getChildren().length;return t-1>e?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveDown function is ignored.");var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveToBottom function is ignored.");var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(e){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. zIndex parameter is ignored.");var t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(e,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var e=this.getOpacity();return this.getParent()&&(e*=this.getParent().getAbsoluteOpacity()),e},moveTo:function(e){return Kinetic.Node.prototype.remove.call(this),e.add(this),this},toObject:function(){var e,t,n,r,i=Kinetic.Util,s={},o=this.getAttrs();s.attrs={};for(e in o)t=o[e],i._isFunction(t)||i._isElement(t)||i._isObject(t)&&i._hasMethods(t)||(n=this[e],delete o[e],r=n?n.call(this):null,o[e]=t,r!==t&&(s.attrs[e]=t));return s.className=this.getClassName(),s},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var e=this.getParent();return e?e.getLayer():null},getStage:function(){return this._getCache(m,this._getStage)},_getStage:function(){var e=this.getParent();return e?e.getStage():void 0},fire:function(e,t,n){return n?this._fireAndBubble(e,t||{}):this._fire(e,t||{}),this},getAbsoluteTransform:function(e){return e?this._getAbsoluteTransform(e):this._getCache(t,this._getAbsoluteTransform)},_getAbsoluteTransform:function(e){var t,n,r=new Kinetic.Transform;return this._eachAncestorReverse(function(e){t=e.transformsEnabled(),n=e.getTransform(),"all"===t?r.multiply(n):"position"===t&&r.translate(e.x(),e.y())},e),r},getTransform:function(){return this._getCache(g,this._getTransform)},_getTransform:function(){var e=new Kinetic.Transform,t=this.getX(),n=this.getY(),r=Kinetic.getAngle(this.getRotation()),i=this.getScaleX(),s=this.getScaleY(),o=this.getSkewX(),u=this.getSkewY(),a=this.getOffsetX(),f=this.getOffsetY();return(0!==t||0!==n)&&e.translate(t,n),0!==r&&e.rotate(r),(0!==o||0!==u)&&e.skew(o,u),(1!==i||1!==s)&&e.scale(i,s),(0!==a||0!==f)&&e.translate(-1*a,-1*f),e},clone:function(e){var t,n,r,i,s,o=this.getClassName(),u=Kinetic.Util.cloneObject(this.attrs);for(var f in w){var l=w[f];delete u[l]}for(t in e)u[t]=e[t];var c=new Kinetic[o](u);for(t in this.eventListeners)for(n=this.eventListeners[t],r=n.length,i=0;r>i;i++)s=n[i],s.name.indexOf(a)<0&&(c.eventListeners[t]||(c.eventListeners[t]=[]),c.eventListeners[t].push(s));return c},toDataURL:function(e){e=e||{};var t=e.mimeType||null,n=e.quality||null,r=this.getStage(),i=e.x||0,s=e.y||0,o=new Kinetic.SceneCanvas({width:e.width||this.getWidth()||(r?r.getWidth():0),height:e.height||this.getHeight()||(r?r.getHeight():0),pixelRatio:1}),u=o.getContext();return u.save(),(i||s)&&u.translate(-1*i,-1*s),this.drawScene(o),u.restore(),o.toDataURL(t,n)},toImage:function(e){Kinetic.Util._getImage(this.toDataURL(e),function(t){e.callback(t)})},setSize:function(e){return this.setWidth(e.width),this.setHeight(e.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Kinetic.dragDistance},_get:function(e){return this.className===e||this.nodeType===e?[this]:[]},_off:function(e,t){var n,r,i=this.eventListeners[e];for(n=0;n<i.length;n++)if(r=i[n].name,!("kinetic"===r&&"kinetic"!==t||t&&r!==t)){if(i.splice(n,1),0===i.length){delete this.eventListeners[e];break}n--}},_fireChangeEvent:function(e,t,r){this._fire(e+n,{oldVal:t,newVal:r})},setId:function(e){var t=this.getId();return Kinetic._removeId(t),Kinetic._addId(this,e),this._setAttr(u,e),this},setName:function(e){var t=this.getName();return Kinetic._removeName(t,this._id),Kinetic._addName(this,e),this._setAttr(h,e),this},setAttr:function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],r=p+Kinetic.Util._capitalize(t),i=this[r];return Kinetic.Util._isFunction(i)?i.call(this,n):this._setAttr(t,n),this},_setAttr:function(e,t){var n;void 0!==t&&(n=this.attrs[e],this.attrs[e]=t,this._fireChangeEvent(e,n,t))},_setComponentAttr:function(e,t,n){var r;void 0!==n&&(r=this.attrs[e],r||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=n,this._fireChangeEvent(e,r,n))},_fireAndBubble:function(e,t,n){var r=!0;if(t&&this.nodeType===d&&(t.target=this),e===l&&n&&(this._id===n._id||this.isAncestorOf&&this.isAncestorOf(n))?r=!1:e===c&&n&&(this._id===n._id||this.isAncestorOf&&this.isAncestorOf(n))&&(r=!1),r){this._fire(e,t);var i=(e===l||e===c)&&(n&&n.isAncestorOf&&n.isAncestorOf(this)||!!n&&!!n.isAncestorOf);t&&!t.cancelBubble&&this.parent&&this.parent.isListening()&&!i&&(n&&n.parent?this._fireAndBubble.call(this.parent,e,t,n.parent):this._fireAndBubble.call(this.parent,e,t))}},_fire:function(e,t){var n,r=this.eventListeners[e];if(t.type=e,r)for(n=0;n<r.length;n++)r[n].handler.call(this,t)},draw:function(){return this.drawScene(),this.drawHit(),this}}),Kinetic.Node.create=function(e,t){return this._createNode(JSON.parse(e),t)},Kinetic.Node._createNode=function(e,t){var n,r,i,s=Kinetic.Node.prototype.getClassName.call(e),o=e.children;if(t&&(e.attrs.container=t),n=new Kinetic[s](e.attrs),o)for(r=o.length,i=0;r>i;i++)n.add(this._createNode(o[i]));return n},Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0),Kinetic.Factory.addSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addSetter(Kinetic.Node,"width",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",void 0,function(e){return this._filterUpToDate=!1,e}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"size"),Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Kinetic.Collection.mapMethods(Kinetic.Node)}(),function(){Kinetic.Filters.Grayscale=function(e){var t,n,r=e.data,i=r.length;for(t=0;i>t;t+=4)n=.34*r[t]+.5*r[t+1]+.16*r[t+2],r[t]=n,r[t+1]=n,r[t+2]=n}}(),function(){Kinetic.Filters.Brighten=function(e){var t,n=255*this.brightness(),r=e.data,i=r.length;for(t=0;i>t;t+=4)r[t]+=n,r[t+1]+=n,r[t+2]+=n},Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Invert=function(e){var t,n=e.data,r=n.length;for(t=0;r>t;t+=4)n[t]=255-n[t],n[t+1]=255-n[t+1],n[t+2]=255-n[t+2]}}(),function(){function e(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function t(t,i){var s,o,u,f,l,h,p,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=t.data,D=t.width,P=t.height,H=i+i+1,B=D-1,j=P-1,F=i+1,I=F*(F+1)/2,q=new e,R=null,U=q,z=null,W=null,X=n[i],V=r[i];for(u=1;H>u;u++)U=U.next=new e,u==F&&(R=U);for(U.next=q,p=h=0,o=0;P>o;o++){for(x=T=N=C=v=m=g=y=0,b=F*(k=_[h]),w=F*(L=_[h+1]),E=F*(A=_[h+2]),S=F*(O=_[h+3]),v+=I*k,m+=I*L,g+=I*A,y+=I*O,U=q,u=0;F>u;u++)U.r=k,U.g=L,U.b=A,U.a=O,U=U.next;for(u=1;F>u;u++)f=h+((u>B?B:u)<<2),v+=(U.r=k=_[f])*(M=F-u),m+=(U.g=L=_[f+1])*M,g+=(U.b=A=_[f+2])*M,y+=(U.a=O=_[f+3])*M,x+=k,T+=L,N+=A,C+=O,U=U.next;for(z=q,W=R,s=0;D>s;s++)_[h+3]=O=y*X>>V,0!==O?(O=255/O,_[h]=(v*X>>V)*O,_[h+1]=(m*X>>V)*O,_[h+2]=(g*X>>V)*O):_[h]=_[h+1]=_[h+2]=0,v-=b,m-=w,g-=E,y-=S,b-=z.r,w-=z.g,E-=z.b,S-=z.a,f=p+((f=s+i+1)<B?f:B)<<2,x+=z.r=_[f],T+=z.g=_[f+1],N+=z.b=_[f+2],C+=z.a=_[f+3],v+=x,m+=T,g+=N,y+=C,z=z.next,b+=k=W.r,w+=L=W.g,E+=A=W.b,S+=O=W.a,x-=k,T-=L,N-=A,C-=O,W=W.next,h+=4;p+=D}for(s=0;D>s;s++){for(T=N=C=x=m=g=y=v=0,h=s<<2,b=F*(k=_[h]),w=F*(L=_[h+1]),E=F*(A=_[h+2]),S=F*(O=_[h+3]),v+=I*k,m+=I*L,g+=I*A,y+=I*O,U=q,u=0;F>u;u++)U.r=k,U.g=L,U.b=A,U.a=O,U=U.next;for(l=D,u=1;i>=u;u++)h=l+s<<2,v+=(U.r=k=_[h])*(M=F-u),m+=(U.g=L=_[h+1])*M,g+=(U.b=A=_[h+2])*M,y+=(U.a=O=_[h+3])*M,x+=k,T+=L,N+=A,C+=O,U=U.next,j>u&&(l+=D);for(h=s,z=q,W=R,o=0;P>o;o++)f=h<<2,_[f+3]=O=y*X>>V,O>0?(O=255/O,_[f]=(v*X>>V)*O,_[f+1]=(m*X>>V)*O,_[f+2]=(g*X>>V)*O):_[f]=_[f+1]=_[f+2]=0,v-=b,m-=w,g-=E,y-=S,b-=z.r,w-=z.g,E-=z.b,S-=z.a,f=s+((f=o+F)<j?f:j)*D<<2,v+=x+=z.r=_[f],m+=T+=z.g=_[f+1],g+=N+=z.b=_[f+2],y+=C+=z.a=_[f+3],z=z.next,b+=k=W.r,w+=L=W.g,E+=A=W.b,S+=O=W.a,x-=k,T-=L,N-=A,C-=O,W=W.next,h+=D}}var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(e){var n=Math.round(this.blurRadius());n>0&&t(e,n)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function e(e,t,n){var r=4*(n*e.width+t),i=[];return i.push(e.data[r++],e.data[r++],e.data[r++],e.data[r++]),i}function t(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function n(e){for(var t=[0,0,0],n=0;n<e.length;n++)t[0]+=e[n][0],t[1]+=e[n][1],t[2]+=e[n][2];return t[0]/=e.length,t[1]/=e.length,t[2]/=e.length,t}function r(r,i){var s=e(r,0,0),o=e(r,r.width-1,0),u=e(r,0,r.height-1),f=e(r,r.width-1,r.height-1),l=i||10;if(t(s,o)<l&&t(o,f)<l&&t(f,u)<l&&t(u,s)<l){for(var h=n([o,s,f,u]),p=[],d=0;d<r.width*r.height;d++){var v=t(h,[r.data[4*d],r.data[4*d+1],r.data[4*d+2]]);p[d]=l>v?0:255}return p}}function i(e,t){for(var n=0;n<e.width*e.height;n++)e.data[4*n+3]=t[n]}function s(e,t,n){for(var r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[],u=0;n>u;u++)for(var a=0;t>a;a++){for(var f=u*t+a,l=0,c=0;i>c;c++)for(var h=0;i>h;h++){var p=u+c-s,d=a+h-s;if(p>=0&&n>p&&d>=0&&t>d){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=2040===l?255:0}return o}function o(e,t,n){for(var r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[],u=0;n>u;u++)for(var a=0;t>a;a++){for(var f=u*t+a,l=0,c=0;i>c;c++)for(var h=0;i>h;h++){var p=u+c-s,d=a+h-s;if(p>=0&&n>p&&d>=0&&t>d){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l>=1020?255:0}return o}function u(e,t,n){for(var r=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[],u=0;n>u;u++)for(var a=0;t>a;a++){for(var f=u*t+a,l=0,c=0;i>c;c++)for(var h=0;i>h;h++){var p=u+c-s,d=a+h-s;if(p>=0&&n>p&&d>=0&&t>d){var v=p*t+d,m=r[c*i+h];l+=e[v]*m}}o[f]=l}return o}Kinetic.Filters.Mask=function(e){var t=this.threshold(),n=r(e,t);return n&&(n=s(n,e.width,e.height),n=o(n,e.width,e.height),n=u(n,e.width,e.height),i(e,n)),e},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.RGB=function(e){var t,n,r=e.data,i=r.length,s=this.red(),o=this.green(),u=this.blue();for(t=0;i>t;t+=4)n=(.34*r[t]+.5*r[t+1]+.16*r[t+2])/255,r[t]=n*s,r[t+1]=n*o,r[t+2]=n*u,r[t+3]=r[t+3]},Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(e){return this._filterUpToDate=!1,e>255?255:0>e?0:Math.round(e)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(e){return this._filterUpToDate=!1,e>255?255:0>e?0:Math.round(e)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.HSV=function(e){var t,n,r,i,s,o=e.data,u=o.length,a=Math.pow(2,this.value()),f=Math.pow(2,this.saturation()),l=Math.abs(this.hue()+360)%360,c=a*f*Math.cos(l*Math.PI/180),h=a*f*Math.sin(l*Math.PI/180),p=.299*a+.701*c+.167*h,d=.587*a-.587*c+.33*h,v=.114*a-.114*c-.497*h,m=.299*a-.299*c-.328*h,g=.587*a+.413*c+.035*h,y=.114*a-.114*c+.293*h,b=.299*a-.3*c+1.25*h,w=.587*a-.586*c-1.05*h,E=.114*a+.886*c-.2*h;for(t=0;u>t;t+=4)n=o[t+0],r=o[t+1],i=o[t+2],s=o[t+3],o[t+0]=p*n+d*r+v*i,o[t+1]=m*n+g*r+y*i,o[t+2]=b*n+w*r+E*i,o[t+3]=s},Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"luminance",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Filters.HSL=function(e){var t,n,r,i,s,o=e.data,u=o.length,a=1,f=Math.pow(2,this.saturation()),l=Math.abs(this.hue()+360)%360,c=127*this.luminance(),h=a*f*Math.cos(l*Math.PI/180),p=a*f*Math.sin(l*Math.PI/180),d=.299*a+.701*h+.167*p,v=.587*a-.587*h+.33*p,m=.114*a-.114*h-.497*p,g=.299*a-.299*h-.328*p,y=.587*a+.413*h+.035*p,b=.114*a-.114*h+.293*p,w=.299*a-.3*h+1.25*p,E=.587*a-.586*h-1.05*p,S=.114*a+.886*h-.2*p;for(t=0;u>t;t+=4)n=o[t+0],r=o[t+1],i=o[t+2],s=o[t+3],o[t+0]=d*n+v*r+m*i+c,o[t+1]=g*n+y*r+b*i+c,o[t+2]=w*n+E*r+S*i+c,o[t+3]=s}}(),function(){Kinetic.Filters.Emboss=function(e){var t=10*this.embossStrength(),n=255*this.embossWhiteLevel(),r=this.embossDirection(),i=this.embossBlend(),s=0,o=0,u=e.data,a=e.width,f=e.height,l=4*a,c=f;switch(r){case"top-left":s=-1,o=-1;break;case"top":s=-1,o=0;break;case"top-right":s=-1,o=1;break;case"right":s=0,o=1;break;case"bottom-right":s=1,o=1;break;case"bottom":s=1,o=0;break;case"bottom-left":s=1,o=-1;break;case"left":s=0,o=-1}do{var h=(c-1)*l,p=s;1>c+p&&(p=0),c+p>f&&(p=0);var d=(c-1+p)*a*4,v=a;do{var m=h+4*(v-1),g=o;1>v+g&&(g=0),v+g>a&&(g=0);var y=d+4*(v-1+g),b=u[m]-u[y],w=u[m+1]-u[y+1],E=u[m+2]-u[y+2],S=b,x=S>0?S:-S,T=w>0?w:-w,N=E>0?E:-E;if(T>x&&(S=w),N>x&&(S=E),S*=t,i){var C=u[m]+S,k=u[m+1]+S,L=u[m+2]+S;u[m]=C>255?255:0>C?0:C,u[m+1]=k>255?255:0>k?0:k,u[m+2]=L>255?255:0>L?0:L}else{var A=n-S;0>A?A=0:A>255&&(A=255),u[m]=u[m+1]=u[m+2]=A}}while(--v)}while(--c)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossWhiteLevel",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",!1,null,Kinetic.Factory.afterSetFilter)}(),function(){function e(e,t,n,r,i){var s,o=n-t,u=i-r;return 0===o?r+u/2:0===u?r:(s=(e-t)/o,s=u*s+r)}Kinetic.Filters.Enhance=function(t){var n,r,i,s,o=t.data,u=o.length,f=o[0],l=f,c=o[1],h=c,p=o[2],d=p,v=o[3],m=v,g=this.enhance();if(0!==g){for(s=0;u>s;s+=4)n=o[s+0],f>n?f=n:n>l&&(l=n),r=o[s+1],c>r?c=r:r>h&&(h=r),i=o[s+2],p>i?p=i:i>d&&(d=i);l===f&&(l=255,f=0),h===c&&(h=255,c=0),d===p&&(d=255,p=0),m===v&&(m=255,v=0);var y,b,w,E,S,x,T,N,C,k,L,A;for(g>0?(b=l+g*(255-l),w=f-g*(f-0),S=h+g*(255-h),x=c-g*(c-0),N=d+g*(255-d),A=p-g*(p-0),L=m+g*(255-m),C=v-g*(v-0)):(y=.5*(l+f),b=l+g*(l-y),w=f+g*(f-y),E=.5*(h+c),S=h+g*(h-E),x=c+g*(c-E),T=.5*(d+p),N=d+g*(d-T),A=p+g*(p-T),k=.5*(m+v),L=m+g*(m-k),C=v+g*(v-k)),s=0;u>s;s+=4)o[s+0]=e(o[s+0],f,l,w,b),o[s+1]=e(o[s+1],c,h,x,S),o[s+2]=e(o[s+2],p,d,A,N)}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Posterize=function(e){var t,n=Math.round(254*this.levels())+1,r=e.data,i=r.length,s=255/n;for(t=0;i>t;t+=1)r[t]=Math.floor(r[t]/s)*s},Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Noise=function(e){var t,n=255*this.noise(),r=e.data,i=r.length,s=n/2;for(t=0;i>t;t+=4)r[t+0]+=s-2*s*Math.random(),r[t+1]+=s-2*s*Math.random(),r[t+2]+=s-2*s*Math.random()},Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",.2,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Pixelate=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=Math.ceil(this.pixelSize()),m=e.width,g=e.height,y=Math.ceil(m/v),b=Math.ceil(g/v);for(e=e.data,h=0;y>h;h+=1)for(p=0;b>p;p+=1){for(i=0,s=0,o=0,u=0,a=h*v,f=a+v,l=p*v,c=l+v,d=0,t=a;f>t;t+=1)if(!(t>=m))for(n=l;c>n;n+=1)n>=g||(r=4*(m*n+t),i+=e[r+0],s+=e[r+1],o+=e[r+2],u+=e[r+3],d+=1);for(i/=d,s/=d,o/=d,t=a;f>t;t+=1)if(!(t>=m))for(n=l;c>n;n+=1)n>=g||(r=4*(m*n+t),e[r+0]=i,e[r+1]=s,e[r+2]=o,e[r+3]=u)}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"pixelSize",8,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Threshold=function(e){var t,n=255*this.threshold(),r=e.data,i=r.length;for(t=0;i>t;t+=1)r[t]=r[t]<n?0:255},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Sepia=function(e){var t,n,r,i,s,o,u,a,f,l=e.data,c=e.width,h=e.height,p=4*c;do{t=(h-1)*p,n=c;do r=t+4*(n-1),i=l[r],s=l[r+1],o=l[r+2],u=.393*i+.769*s+.189*o,a=.349*i+.686*s+.168*o,f=.272*i+.534*s+.131*o,l[r]=u>255?255:u,l[r+1]=a>255?255:a,l[r+2]=f>255?255:f,l[r+3]=l[r+3];while(--n)}while(--h)}}(),function(){Kinetic.Filters.Solarize=function(e){var t=e.data,n=e.width,r=e.height,i=4*n,s=r;do{var o=(s-1)*i,u=n;do{var a=o+4*(u-1),f=t[a],l=t[a+1],c=t[a+2];f>127&&(f=255-f),l>127&&(l=255-l),c>127&&(c=255-c),t[a]=f,t[a+1]=l,t[a+2]=c}while(--u)}while(--s)}}(),function(){var e=function(e,t,n){var r,i,s,o,u=e.data,a=t.data,f=e.width,l=e.height,c=n.polarCenterX||f/2,h=n.polarCenterY||l/2,p=0,d=0,v=0,m=0,g=Math.sqrt(c*c+h*h);i=f-c,s=l-h,o=Math.sqrt(i*i+s*s),g=o>g?o:g;var y,b,w,E,S=l,x=f,T=360/x*Math.PI/180;for(b=0;x>b;b+=1)for(w=Math.sin(b*T),E=Math.cos(b*T),y=0;S>y;y+=1)i=Math.floor(c+g*y/S*E),s=Math.floor(h+g*y/S*w),r=4*(s*f+i),p=u[r+0],d=u[r+1],v=u[r+2],m=u[r+3],r=4*(b+y*f),a[r+0]=p,a[r+1]=d,a[r+2]=v,a[r+3]=m},t=function(e,t,n){var r,i,s,o,u,a,f=e.data,l=t.data,c=e.width,h=e.height,p=n.polarCenterX||c/2,d=n.polarCenterY||h/2,v=0,m=0,g=0,y=0,b=Math.sqrt(p*p+d*d);i=c-p,s=h-d,a=Math.sqrt(i*i+s*s),b=a>b?a:b;var w,E,S,x,T=h,N=c,C=n.polarRotation||0;for(i=0;c>i;i+=1)for(s=0;h>s;s+=1)o=i-p,u=s-d,w=Math.sqrt(o*o+u*u)*T/b,E=(180*Math.atan2(u,o)/Math.PI+360+C)%360,E=E*N/360,S=Math.floor(E),x=Math.floor(w),r=4*(x*c+S),v=f[r+0],m=f[r+1],g=f[r+2],y=f[r+3],r=4*(s*c+i),l[r+0]=v,l[r+1]=m,l[r+2]=g,l[r+3]=y},n=Kinetic.Util.createCanvasElement();Kinetic.Filters.Kaleidoscope=function(r){var i,s,o,u,f,l,h,p,d,v,m=r.width,g=r.height,y=Math.round(this.kaleidoscopePower()),w=Math.round(this.kaleidoscopeAngle()),E=Math.floor(m*(w%360)/360);if(!(1>y)){n.width=m,n.height=g;var S=n.getContext("2d").getImageData(0,0,m,g);e(r,S,{polarCenterX:m/2,polarCenterY:g/2});for(var x=m/Math.pow(2,y);8>=x;)x=2*x,y-=1;x=Math.ceil(x);var T=x,N=0,C=T,k=1;for(E+x>m&&(N=T,C=0,k=-1),s=0;g>s;s+=1)for(i=N;i!==C;i+=k)o=Math.round(i+E)%m,d=4*(m*s+o),f=S.data[d+0],l=S.data[d+1],h=S.data[d+2],p=S.data[d+3],v=4*(m*s+i),S.data[v+0]=f,S.data[v+1]=l,S.data[v+2]=h,S.data[v+3]=p;for(s=0;g>s;s+=1)for(T=Math.floor(x),u=0;y>u;u+=1){for(i=0;T+1>i;i+=1)d=4*(m*s+i),f=S.data[d+0],l=S.data[d+1],h=S.data[d+2],p=S.data[d+3],v=4*(m*s+2*T-i-1),S.data[v+0]=f,S.data[v+1]=l,S.data[v+2]=h,S.data[v+3]=p;T*=2}t(S,r,{polarRotation:0})}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function e(e){setTimeout(e,1e3/60)}function t(){return i.apply(Kinetic.root,arguments)}var n=500,r=function(){return Kinetic.root.performance&&Kinetic.root.performance.now?function(){return Kinetic.root.performance.now()}:function(){return(new Date).getTime()}}(),i=function(){return Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||e}();Kinetic.Animation=function(e,t){var n=Kinetic.Animation;this.func=e,this.setLayers(t),this.id=n.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:r()}},Kinetic.Animation.prototype={setLayers:function(e){var t=[];t=e?e.length>0?e:[e]:[],this.layers=t},getLayers:function(){return this.layers},addLayer:function(e){var t,n,r=this.layers;if(r){for(t=r.length,n=0;t>n;n++)if(r[n]._id===e._id)return!1}else this.layers=[];return this.layers.push(e),!0},isRunning:function(){var e,t=Kinetic.Animation,n=t.animations,r=n.length;for(e=0;r>e;e++)if(n[e].id===this.id)return!0;return!1},start:function(){var e=Kinetic.Animation;this.stop(),this.frame.timeDiff=0,this.frame.lastTime=r(),e._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(e){this.animations.push(e),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(e){var t,n=e.id,r=this.animations,i=r.length;for(t=0;i>t;t++)if(r[t].id===n){this.animations.splice(t,1);break}},Kinetic.Animation._runFrames=function(){var e,t,n,i,s,o,u,a,f={},l=this.animations,c=!1;for(i=0;i<l.length;i++){for(e=l[i],t=e.layers,n=e.func,e._updateFrameObject(r()),o=t.length,s=0;o>s;s++)u=t[s],void 0!==u._id&&(f[u._id]=u);n&&(c=n.call(e,e.frame)!==!1||c)}if(c)for(a in f)f[a].draw()},Kinetic.Animation._animationLoop=function(){var e=Kinetic.Animation;e.animations.length?(t(e._animationLoop),e._runFrames()):e.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var e=this;this.animRunning||(this.animRunning=!0,e._animationLoop())};var s=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(e){s.call(this,e)},Kinetic.BaseLayer.prototype.batchDraw=function(){var e=this,t=Kinetic.Animation;this.batchAnim||(this.batchAnim=new t(function(){e.lastBatchDrawTime&&r()-e.lastBatchDrawTime>n&&e.batchAnim.stop()},this)),this.lastBatchDrawTime=r(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(e){e.batchDraw()})}}(this),function(){var e={node:1,duration:1,easing:1,onFinish:1,yoyo:1},t=1,n=2,r=3,i=0;Kinetic.Tween=function(t){var n,r=this,o=t.node,u=o._id,l=t.duration||1,c=t.easing||Kinetic.Easings.Linear,h=!!t.yoyo;this.node=o,this._id=i++,this.anim=new Kinetic.Animation(function(){r.tween.onEnterFrame()},o.getLayer()),this.tween=new s(n,function(e){r._tweenFunc(e)},c,0,1,1e3*l,h),this._addListeners(),Kinetic.Tween.attrs[u]||(Kinetic.Tween.attrs[u]={}),Kinetic.Tween.attrs[u][this._id]||(Kinetic.Tween.attrs[u][this._id]={}),Kinetic.Tween.tweens[u]||(Kinetic.Tween.tweens[u]={});for(n in t)void 0===e[n]&&this._addAttr(n,t[n]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(e,t){var n,r,i,s,o,u=this.node,a=u._id;if(i=Kinetic.Tween.tweens[a][e],i&&delete Kinetic.Tween.attrs[a][i][e],n=u.getAttr(e),Kinetic.Util._isArray(t))for(r=[],o=t.length,s=0;o>s;s++)r.push(t[s]-n[s]);else r=t-n;Kinetic.Tween.attrs[a][this._id][e]={start:n,diff:r},Kinetic.Tween.tweens[a][e]=this._id},_tweenFunc:function(e){var t,n,r,i,s,o,u,a=this.node,f=Kinetic.Tween.attrs[a._id][this._id];for(t in f){if(n=f[t],r=n.start,i=n.diff,Kinetic.Util._isArray(r))for(s=[],u=r.length,o=0;u>o;o++)s.push(r[o]+i[o]*e);else s=r+i*e;a.setAttr(t,s)}},_addListeners:function(){var e=this;this.tween.onPlay=function(){e.anim.start()},this.tween.onReverse=function(){e.anim.start()},this.tween.onPause=function(){e.anim.stop()},this.tween.onFinish=function(){e.onFinish&&e.onFinish()},this.tween.onReset=function(){e.onReset&&e.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){return this.node,this.tween.reset(),this},seek:function(e){return this.node,this.tween.seek(1e3*e),this},pause:function(){return this.tween.pause(),this},finish:function(){return this.node,this.tween.finish(),this},destroy:function(){var e,t=this.node._id,n=this._id,r=Kinetic.Tween.tweens[t];this.pause();for(e in r)delete Kinetic.Tween.tweens[t][e];delete Kinetic.Tween.attrs[t][n]}};var s=function(e,t,n,r,i,s,o){this.prop=e,this.propFunc=t,this.begin=r,this._pos=r,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=o,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=i-this.begin,this.pause()};s.prototype={fire:function(e){var t=this[e];t&&t()},setTime:function(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>e?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())},getTime:function(){return this._time},setPosition:function(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e},getPosition:function(e){return void 0===e&&(e=this._time),this.func(e,this.begin,this._change,this.duration)},play:function(){this.state=n,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=r,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var e=this.getTimer()-this._startTime;this.state===n?this.setTime(e):this.state===r&&this.setTime(this.duration-e)},pause:function(){this.state=t,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(e,t,n,r){var i=1.70158;return n*(e/=r)*e*((i+1)*e-i)+t},BackEaseOut:function(e,t,n,r){var i=1.70158;return n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},BackEaseInOut:function(e,t,n,r){var i=1.70158;return(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},ElasticEaseIn:function(e,t,n,r,i,s){var o=0;return 0===e?t:1==(e/=r)?t+n:(s||(s=.3*r),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin(2*(e*r-o)*Math.PI/s))+t)},ElasticEaseOut:function(e,t,n,r,i,s){var o=0;return 0===e?t:1==(e/=r)?t+n:(s||(s=.3*r),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin(2*(e*r-o)*Math.PI/s)+n+t)},ElasticEaseInOut:function(e,t,n,r,i,s){var o=0;return 0===e?t:2==(e/=r/2)?t+n:(s||(s=.3*r*1.5),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),1>e?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin(2*(e*r-o)*Math.PI/s)+t:i*Math.pow(2,-10*(e-=1))*Math.sin(2*(e*r-o)*Math.PI/s)*.5+n+t)},BounceEaseOut:function(e,t,n,r){return(e/=r)<1/2.75?7.5625*n*e*e+t:2/2.75>e?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},BounceEaseIn:function(e,t,n,r){return n-Kinetic.Easings.BounceEaseOut(r-e,0,n,r)+t},BounceEaseInOut:function(e,t,n,r){return r/2>e?.5*Kinetic.Easings.BounceEaseIn(2*e,0,n,r)+t:.5*Kinetic.Easings.BounceEaseOut(2*e-r,0,n,r)+.5*n+t},EaseIn:function(e,t,n,r){return n*(e/=r)*e+t},EaseOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},EaseInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},StrongEaseIn:function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},StrongEaseOut:function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},StrongEaseInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},Linear:function(e,t,n,r){return n*e/r+t}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation(function(){var e=this.dirty;return this.dirty=!1,e}),isDragging:!1,justDragged:!1,offset:{x:0,y:0},node:null,_drag:function(e){var t=Kinetic.DD,n=t.node;if(n){if(!t.isDragging){var r=n.getStage().getPointerPosition(),i=n.dragDistance(),s=Math.max(Math.abs(r.x-t.startPointerPos.x),Math.abs(r.y-t.startPointerPos.y));if(i>s)return}n._setDragPosition(e),t.isDragging||(t.isDragging=!0,n.fire("dragstart",{type:"dragstart",target:n,evt:e},!0)),n.fire("dragmove",{type:"dragmove",target:n,evt:e},!0)}},_endDragBefore:function(e){var t,n,r=Kinetic.DD,i=r.node;i&&(t=i.nodeType,n=i.getLayer(),r.anim.stop(),r.isDragging&&(r.isDragging=!1,r.justDragged=!0,Kinetic.listenClickTap=!1,e&&(e.dragEndNode=i)),delete r.node,(n||i).draw())},_endDragAfter:function(e){e=e||{};var t=e.dragEndNode;e&&t&&t.fire("dragend",{type:"dragend",target:t,evt:e},!0)}},Kinetic.Node.prototype.startDrag=function(){var e=Kinetic.DD,t=this.getStage(),n=this.getLayer(),r=t.getPointerPosition(),i=this.getAbsolutePosition();r&&(e.node&&e.node.stopDrag(),e.node=this,e.startPointerPos=r,e.offset.x=r.x-i.x,e.offset.y=r.y-i.y,e.anim.setLayers(n||this.getLayers()),e.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(e){var t=Kinetic.DD,n=this.getStage().getPointerPosition(),r=this.getDragBoundFunc();if(n){var i={x:n.x-t.offset.x,y:n.y-t.offset.y};void 0!==r&&(i=r.call(this,i,e)),this.setAbsolutePosition(i),this._lastPos&&this._lastPos.x===i.x&&this._lastPos.y===i.y||(t.anim.dirty=!0),this._lastPos=i}},Kinetic.Node.prototype.stopDrag=function(){var e=Kinetic.DD,t={};e._endDragBefore(t),e._endDragAfter(t)},Kinetic.Node.prototype.setDraggable=function(e){this._setAttr("draggable",e),this._dragChange()};var e=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var t=Kinetic.DD;t.node&&t.node._id===this._id&&this.stopDrag(),e.call(this)},Kinetic.Node.prototype.isDragging=function(){var e=Kinetic.DD;return e.node&&e.node._id===this._id&&e.isDragging},Kinetic.Node.prototype._listenDrag=function(){var e=this;this._dragCleanup(),"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(t){Kinetic.DD.node||e.startDrag(t)}):this.on("mousedown.kinetic touchstart.kinetic",function(t){Kinetic.DD.node||e.startDrag(t)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var e=this.getStage(),t=Kinetic.DD;e&&t.node&&t.node._id===this._id&&t.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))},Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var t=Kinetic.document.documentElement;t.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),t.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),t.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),t.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(e){this.children=new Kinetic.Collection,Kinetic.Node.call(this,e)},getChildren:function(e){if(e){var t=new Kinetic.Collection;return this.children.each(function(n){e(n)&&t.push(n)}),t}return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var e,t=Kinetic.Collection.toCollection(this.children),n=0;n<t.length;n++)e=t[n],delete e.parent,e.index=0,e.hasChildren()&&e.removeChildren(),e.remove();return t=null,this.children=new Kinetic.Collection,this},destroyChildren:function(){for(var e,t=Kinetic.Collection.toCollection(this.children),n=0;n<t.length;n++)e=t[n],delete e.parent,e.index=0,e.destroy();return t=null,this.children=new Kinetic.Collection,this},add:function(e){if(!(arguments.length>1)){if(e.getParent())return void e.moveTo(this);var t=this.children;return this._validateAdd(e),e.index=t.length,e.parent=this,t.push(e),this._fire("add",{child:e}),this}for(var n=0;n<arguments.length;n++)this.add(arguments[n])},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},find:function(e){var t,n,r,i,s,o,u,a=[],f=e.replace(/ /g,"").split(","),l=f.length;for(t=0;l>t;t++)if(r=f[t],"#"===r.charAt(0))s=this._getNodeById(r.slice(1)),s&&a.push(s);else if("."===r.charAt(0))i=this._getNodesByName(r.slice(1)),a=a.concat(i);else for(o=this.getChildren(),u=o.length,n=0;u>n;n++)a=a.concat(o[n]._get(r));return Kinetic.Collection.toCollection(a)},_getNodeById:function(e){var t=Kinetic.ids[e];return void 0!==t&&this.isAncestorOf(t)?t:null},_getNodesByName:function(e){var t=Kinetic.names[e]||[];return this._getDescendants(t)},_get:function(e){for(var t=Kinetic.Node.prototype._get.call(this,e),n=this.getChildren(),r=n.length,i=0;r>i;i++)t=t.concat(n[i]._get(e));return t},toObject:function(){var e=Kinetic.Node.prototype.toObject.call(this);e.children=[];for(var t=this.getChildren(),n=t.length,r=0;n>r;r++){var i=t[r];e.children.push(i.toObject())}return e},_getDescendants:function(e){for(var t=[],n=e.length,r=0;n>r;r++){var i=e[r];this.isAncestorOf(i)&&t.push(i)}return t},isAncestorOf:function(e){for(var t=e.getParent();t;){if(t._id===this._id)return!0;t=t.getParent()}return!1},clone:function(e){var t=Kinetic.Node.prototype.clone.call(this,e);return this.getChildren().each(function(e){t.add(e.clone())}),t},getAllIntersections:function(e){var t=[];return this.find("Shape").each(function(n){n.isVisible()&&n.intersects(e)&&t.push(n)}),t},_setChildrenIndices:function(){this.children.each(function(e,t){e.index=t})},drawScene:function(e,t){var n=this.getLayer(),r=e||n&&n.getCanvas(),i=r&&r.getContext(),s=this._cache.canvas,o=s&&s.scene;return this.isVisible()&&(o?this._drawCachedSceneCanvas(i):this._drawChildren(r,"drawScene",t)),this},drawHit:function(e,t){var n=this.getLayer(),r=e||n&&n.hitCanvas,i=r&&r.getContext(),s=this._cache.canvas,o=s&&s.hit;return this.shouldDrawHit(r)&&(o?this._drawCachedHitCanvas(i):this._drawChildren(r,"drawHit",t)),this},_drawChildren:function(e,t,n){var r,i,s=this.getLayer(),o=e&&e.getContext(),u=this.getClipWidth(),a=this.getClipHeight(),f=u&&a;f&&s&&(r=this.getClipX(),i=this.getClipY(),o.save(),s._applyTransform(this,o),o.beginPath(),o.rect(r,i,u,a),o.clip(),o.reset()),this.children.each(function(r){r[t](e,n)}),f&&o.restore()},shouldDrawHit:function(e){var t=this.getLayer();return(e&&e.isCache||t&&t.hitGraphEnabled())&&this.isVisible()&&!Kinetic.isDragging()}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight"),Kinetic.Collection.mapMethods(Kinetic.Container)}(),function(){function e(e){e.fill()}function t(e){e.stroke()}function n(e){e.fill()}function r(e){e.stroke()}function i(){this._clearCache(s)}var s="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(s){this.nodeType="Shape",this._fillFunc=e,this._strokeFunc=t,this._fillFuncHit=n,this._strokeFuncHit=r;for(var o,u=Kinetic.shapes;;)if(o=Kinetic.Util.getRandomColor(),o&&!(o in u))break;this.colorKey=o,u[o]=this,Kinetic.Node.call(this,s),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",i)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(s,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},intersects:function(e){var t,n=this.getStage(),r=n.bufferHitCanvas;return r.getContext().clear(),this.drawScene(r),t=r.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data,t[3]>0},destroy:function(){Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(e,t){var n,r,i,s=this.getLayer(),o=e||s.getCanvas(),u=o.getContext(),a=this._cache.canvas,f=this.sceneFunc(),l=this.hasShadow();return this.isVisible()&&(a?this._drawCachedSceneCanvas(u):f&&(u.save(),this._useBufferCanvas()?(n=this.getStage(),r=n.bufferCanvas,i=r.getContext(),i.clear(),i.save(),i._applyLineJoin(this),s&&s._applyTransform(this,i,t),f.call(this,i),i.restore(),l&&(u.save(),u._applyShadow(this),u.drawImage(r._canvas,0,0),u.restore()),u._applyOpacity(this),u.drawImage(r._canvas,0,0)):(u._applyLineJoin(this),s&&s._applyTransform(this,u,t),l&&(u.save(),u._applyShadow(this),f.call(this,u),u.restore()),u._applyOpacity(this),f.call(this,u)),u.restore())),this},drawHit:function(e,t){var n=this.getLayer(),r=e||n.hitCanvas,i=r.getContext(),s=this.hitFunc()||this.sceneFunc(),o=this._cache.canvas,u=o&&o.hit;return this.shouldDrawHit(r)&&(u?this._drawCachedHitCanvas(i):s&&(i.save(),i._applyLineJoin(this),n&&n._applyTransform(this,i,t),s.call(this,i),i.restore())),this},drawHitFromCache:function(e){var t,n,r,i,s,o,u,a,f=e||0,l=this._cache.canvas,c=this._getCachedSceneCanvas(),h=c.getContext(),p=l.hit,d=p.getContext(),v=c.getWidth(),m=c.getHeight();d.clear();try{for(t=h.getImageData(0,0,v,m),n=t.data,r=d.getImageData(0,0,v,m),i=r.data,s=n.length,o=Kinetic.Util._hexToRgb(this.colorKey),u=0;s>u;u+=4)a=n[u+3],a>f&&(i[u]=o.r,i[u+1]=o.g,i[u+2]=o.b,i[u+3]=255);d.putImageData(r,0,0)}catch(g){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+g.message)}return this}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0),Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),Kinetic.Collection.mapMethods(Kinetic.Shape)}(),function(){function e(e,t){e.content.addEventListener(t,function(n){e[P+t](n)},!1)}var t="Stage",n="string",r="px",i="mouseout",s="mouseleave",o="mouseover",u="mouseenter",a="mousemove",f="mousedown",l="mouseup",c="click",h="dblclick",p="touchstart",d="touchend",v="tap",m="dbltap",g="touchmove",y="contentMouseout",b="contentMouseover",w="contentMousemove",E="contentMousedown",S="contentMouseup",x="contentClick",T="contentDblclick",N="contentTouchstart",C="contentTouchend",k="contentDbltap",L="contentTouchmove",A="div",O="relative",M="inline-block",_="kineticjs-content",D=" ",P="_",H="container",B="",j=[f,a,l,i,p,g,d,o],F=j.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(e){this.nodeType=t,Kinetic.Container.call(this,e),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,Kinetic.stages.push(this)},_validateAdd:function(e){"Layer"!==e.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(e){if(typeof e===n){var t=e;if(e=Kinetic.document.getElementById(e),!e)throw"Can not find container in document with id "+t}return this._setAttr(H,e),this},shouldDrawHit:function(){return!0},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(e){return Kinetic.Node.prototype.setHeight.call(this,e),this._resizeDOM(),this},setWidth:function(e){return Kinetic.Node.prototype.setWidth.call(this,e),this._resizeDOM(),this},clear:function(){var e,t=this.children,n=t.length;for(e=0;n>e;e++)t[e].clear();return this},clone:function(e){return e||(e={}),e.container=Kinetic.document.createElement(A),Kinetic.Container.prototype.clone.call(this,e)},destroy:function(){var e=this.content;Kinetic.Container.prototype.destroy.call(this),e&&Kinetic.Util._isInDocument(e)&&this.getContainer().removeChild(e);var t=Kinetic.stages.indexOf(this);t>-1&&Kinetic.stages.splice(t,1)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(e){function t(i){var s=a[i],f=s.toDataURL(),l=new Kinetic.window.Image;l.onload=function(){u.drawImage(l,0,0),i<a.length-1?t(i+1):e.callback(o.toDataURL(n,r))},l.src=f}e=e||{};var n=e.mimeType||null,r=e.quality||null,i=e.x||0,s=e.y||0,o=new Kinetic.SceneCanvas({width:e.width||this.getWidth(),height:e.height||this.getHeight(),pixelRatio:1}),u=o.getContext()._context,a=this.children;(i||s)&&u.translate(-1*i,-1*s),t(0)},toImage:function(e){var t=e.callback;e.callback=function(e){Kinetic.Util._getImage(e,function(e){t(e)})},this.toDataURL(e)},getIntersection:function(e){var t,n,r=this.getChildren(),i=r.length,s=i-1;for(t=s;t>=0;t--)if(n=r[t].getIntersection(e))return n;return null},_resizeDOM:function(){if(this.content){var e,t,n=this.getWidth(),i=this.getHeight(),s=this.getChildren(),o=s.length;for(this.content.style.width=n+r,this.content.style.height=i+r,this.bufferCanvas.setSize(n,i),this.bufferHitCanvas.setSize(n,i),e=0;o>e;e++)t=s[e],t.setSize(n,i),t.draw()}},add:function(e){if(!(arguments.length>1))return Kinetic.Container.prototype.add.call(this,e),e._setCanvasSize(this.width(),this.height()),e.draw(),this.content.appendChild(e.canvas._canvas),this;for(var t=0;t<arguments.length;t++)this.add(arguments[t])},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var t=0;F>t;t++)e(this,j[t])},_mouseover:function(e){Kinetic.UA.mobile||(this._setPointerPosition(e),this._fire(b,{evt:e}))},_mouseout:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=this.targetShape;t&&!Kinetic.isDragging()&&(t._fireAndBubble(i,{evt:e}),t._fireAndBubble(s,{evt:e}),this.targetShape=null),this.pointerPos=void 0,this._fire(y,{evt:e})}},_mousemove:function(e){if(("undefined"==typeof e.webkitMovementX&&"undefined"==typeof e.webkitMovementY||0!==e.webkitMovementY||0!==e.webkitMovementX)&&!Kinetic.UA.mobile){this._setPointerPosition(e);var t,n=Kinetic.DD;Kinetic.isDragging()||(t=this.getIntersection(this.getPointerPosition()),t&&t.isListening()?Kinetic.isDragging()||this.targetShape&&this.targetShape._id===t._id?t._fireAndBubble(a,{evt:e}):(this.targetShape&&(this.targetShape._fireAndBubble(i,{evt:e},t),this.targetShape._fireAndBubble(s,{evt:e},t)),t._fireAndBubble(o,{evt:e},this.targetShape),t._fireAndBubble(u,{evt:e},this.targetShape),this.targetShape=t):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(i,{evt:e}),this.targetShape._fireAndBubble(s,{evt:e}),this.targetShape=null),this._fire(w,{evt:e})),n&&n._drag(e),e.preventDefault&&e.preventDefault()}},_mousedown:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,t&&t.isListening()&&(this.clickStartShape=t,t._fireAndBubble(f,{evt:e})),this._fire(E,{evt:e})}e.preventDefault&&e.preventDefault()},_mouseup:function(e){if(!Kinetic.UA.mobile){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=this.clickStartShape,r=!1,i=Kinetic.DD;Kinetic.inDblClickWindow?(r=!0,Kinetic.inDblClickWindow=!1):i&&i.justDragged?i&&(i.justDragged=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),t&&t.isListening()&&(t._fireAndBubble(l,{evt:e}),Kinetic.listenClickTap&&n&&n._id===t._id&&(t._fireAndBubble(c,{evt:e}),r&&t._fireAndBubble(h,{evt:e}))),this._fire(S,{evt:e}),Kinetic.listenClickTap&&(this._fire(x,{evt:e}),r&&this._fire(T,{evt:e})),Kinetic.listenClickTap=!1}e.preventDefault&&e.preventDefault()},_touchstart:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,t&&t.isListening()&&(this.tapStartShape=t,t._fireAndBubble(p,{evt:e}),t.isListening()&&e.preventDefault&&e.preventDefault()),this._fire(N,{evt:e})},_touchend:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),n=!1;Kinetic.inDblClickWindow?(n=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),t&&t.isListening()&&(t._fireAndBubble(d,{evt:e}),Kinetic.listenClickTap&&t._id===this.tapStartShape._id&&(t._fireAndBubble(v,{evt:e}),n&&t._fireAndBubble(m,{evt:e})),t.isListening()&&e.preventDefault&&e.preventDefault()),Kinetic.listenClickTap&&(this._fire(C,{evt:e}),n&&this._fire(k,{evt:e})),Kinetic.listenClickTap=!1},_touchmove:function(e){this._setPointerPosition(e);var t,n=Kinetic.DD;Kinetic.isDragging()||(t=this.getIntersection(this.getPointerPosition()),t&&t.isListening()&&(t._fireAndBubble(g,{evt:e}),t.isListening()&&e.preventDefault&&e.preventDefault()),this._fire(L,{evt:e})),n&&(n._drag(e),Kinetic.isDragging()&&e.preventDefault())},_setPointerPosition:function(e){var t,n=this._getContentPosition(),r=e.offsetX,i=e.clientX,s=null,o=null;e=e?e:window.event,void 0!==e.touches?e.touches.length>0&&(t=e.touches[0],s=t.clientX-n.left,o=t.clientY-n.top):void 0!==r?(s=r,o=e.offsetY):"mozilla"===Kinetic.UA.browser?(s=e.layerX,o=e.layerY):void 0!==i&&n&&(s=i-n.left,o=e.clientY-n.top),null!==s&&null!==o&&(this.pointerPos={x:s,y:o})},_getContentPosition:function(){var e=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:e.top,left:e.left}},_buildDOM:function(){var e=this.getContainer();if(!e){if(Kinetic.Util.isBrowser())throw"Stage has not container. But container is required";e=Kinetic.document.createElement(A)}e.innerHTML=B,this.content=Kinetic.document.createElement(A),this.content.style.position=O,this.content.style.display=M,this.content.className=_,this.content.setAttribute("role","presentation"),e.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1}),this.bufferHitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(e,t){var n,r,i=e.split(D),s=i.length;for(n=0;s>n;n++)r=i[n],this.content.addEventListener(r,t,!1)},cache:function(){Kinetic.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")},clearCache:function(){}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")}(),function(){Kinetic.Util.addMethods(Kinetic.BaseLayer,{___init:function(e){this.nodeType="Layer",Kinetic.Container.call(this,e)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this},setZIndex:function(e){Kinetic.Node.prototype.setZIndex.call(this,e);var t=this.getStage();return t&&(t.content.removeChild(this.getCanvas()._canvas),e<t.getChildren().length-1?t.content.insertBefore(this.getCanvas()._canvas,t.getChildren()[e+1].getCanvas()._canvas):t.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var e=this.getStage();e&&(e.content.removeChild(this.getCanvas()._canvas),e.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var e=this.getStage();e&&(e.content.removeChild(this.getCanvas()._canvas),this.index<e.getChildren().length-1?e.content.insertBefore(this.getCanvas()._canvas,e.getChildren()[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas),e.content.insertBefore(this.getCanvas()._canvas,t[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var t=e.getChildren();e.content.removeChild(this.getCanvas()._canvas),e.content.insertBefore(this.getCanvas()._canvas,t[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var e=this.getCanvas()._canvas;return Kinetic.Node.prototype.remove.call(this),e&&e.parentNode&&Kinetic.Util._isInDocument(e)&&e.parentNode.removeChild(e),this},getStage:function(){return this.parent},setSize:function(e,t){this.canvas.setSize(e,t)}}),Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,"clearBeforeDraw",!0),Kinetic.Collection.mapMethods(Kinetic.BaseLayer)}(),function(){var e="#",t="beforeDraw",n="draw",r=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],i=r.length;Kinetic.Util.addMethods(Kinetic.Layer,{____init:function(e){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.BaseLayer.call(this,e)},_setCanvasSize:function(e,t){this.canvas.setSize(e,t),this.hitCanvas.setSize(e,t)},_validateAdd:function(e){var t=e.getType();"Group"!==t&&"Shape"!==t&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(e){var t,n,s,o;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(var u=1,a=!1;;){for(n=0;i>n;n++){if(s=r[n],t=this._getIntersection({x:e.x+s.x*u,y:e.y+s.y*u}),o=t.shape)return o;t.antialiased&&(a=!0)}if(!a)return;u+=1}},_getIntersection:function(t){var n,r,i=this.hitCanvas.context._context.getImageData(t.x,t.y,1,1).data,s=i[3];return 255===s?(n=Kinetic.Util._rgbToHex(i[0],i[1],i[2]),r=Kinetic.shapes[e+n],{shape:r}):s>0?{antialiased:!0}:{}},drawScene:function(e,r){var i=this.getLayer(),s=e||i&&i.getCanvas();return this._fire(t,{node:this}),this.getClearBeforeDraw()&&s.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,s,r),this._fire(n,{node:this}),this},_applyTransform:function(e,t,n){var r=e.getAbsoluteTransform(n).getMatrix();t.transform(r[0],r[1],r[2],r[3],r[4],r[5])},drawHit:function(e,t){var n=this.getLayer(),r=e||n&&n.hitCanvas;return n&&n.getClearBeforeDraw()&&n.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this,r,t),this},clear:function(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this},setVisible:function(e){return Kinetic.Node.prototype.setVisible.call(this,e),e?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this},setSize:function(e,t){Kinetic.BaseLayer.prototype.setSize.call(this,e,t),this.hitCanvas.setSize(e,t)}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0),Kinetic.Collection.mapMethods(Kinetic.Layer)}(),function(){Kinetic.Util.addMethods(Kinetic.FastLayer,{____init:function(e){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,Kinetic.BaseLayer.call(this,e)},_validateAdd:function(e){var t=e.getType();"Shape"!==t&&Kinetic.Util.error("You may only add shapes to a fast layer.")},_setCanvasSize:function(e,t){this.canvas.setSize(e,t)},hitGraphEnabled:function(){return!1},getIntersection:function(){return null},drawScene:function(e){var t=this.getLayer(),n=e||t&&t.getCanvas();return this.getClearBeforeDraw()&&n.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,n),this},_applyTransform:function(e,t,n){if(!n||n._id!==this._id){var r=e.getTransform().getMatrix();t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}},draw:function(){return this.drawScene(),this},clear:function(e){return this.getContext().clear(e),this},setVisible:function(e){return Kinetic.Node.prototype.setVisible.call(this,e),this.getCanvas()._canvas.style.display=e?"block":"none",this}}),Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer),Kinetic.Collection.mapMethods(Kinetic.FastLayer)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(e){this.nodeType="Group",Kinetic.Container.call(this,e)},_validateAdd:function(e){var t=e.getType();"Group"!==t&&"Shape"!==t&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container),Kinetic.Collection.mapMethods(Kinetic.Group)}(),function(){Kinetic.Rect=function(e){this.___init(e)},Kinetic.Rect.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Rect",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getCornerRadius(),n=this.getWidth(),r=this.getHeight();e.beginPath(),t?(e.moveTo(t,0),e.lineTo(n-t,0),e.arc(n-t,t,t,3*Math.PI/2,0,!1),e.lineTo(n,r-t),e.arc(n-t,r-t,t,0,Math.PI/2,!1),e.lineTo(t,r),e.arc(t,r-t,t,Math.PI/2,Math.PI,!1),e.lineTo(0,t),e.arc(t,t,t,Math.PI,3*Math.PI/2,!1)):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Rect)}(),function(){var e=2*Math.PI-1e-4,t="Circle";Kinetic.Circle=function(e){this.___init(e)},Kinetic.Circle.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){t.beginPath(),t.arc(0,0,this.getRadius(),0,e,!1),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius(e/2)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0),Kinetic.Collection.mapMethods(Kinetic.Circle)}(),function(){var e=2*Math.PI-1e-4,t="Ellipse";Kinetic.Ellipse=function(e){this.___init(e)},Kinetic.Ellipse.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className=t,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){var n=this.getRadius(),r=n.x,i=n.y;t.beginPath(),t.save(),r!==i&&t.scale(1,i/r),t.arc(0,0,r,0,e,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setRadius({x:e/2})},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setRadius({y:e/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0),Kinetic.Collection.mapMethods(Kinetic.Ellipse)}(),function(){var e=2*Math.PI-1e-4;Kinetic.Ring=function(e){this.___init(e)},Kinetic.Ring.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Ring",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(t){t.beginPath(),t.arc(0,0,this.getInnerRadius(),0,e,!1),t.moveTo(this.getOuterRadius(),0),t.arc(0,0,this.getOuterRadius(),e,0,!0),t.closePath(),t.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(e){Kinetic.Node.prototype.setWidth.call(this,e),this.setOuterRadius(e/2)},setHeight:function(e){Kinetic.Node.prototype.setHeight.call(this,e),this.setOuterRadius(e/2)}},Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Ring)}(),function(){Kinetic.Wedge=function(e){this.___init(e)},Kinetic.Wedge.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Wedge",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){e.beginPath(),e.arc(0,0,this.getRadius(),0,Kinetic.getAngle(this.getAngle()),this.getClockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1),Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Kinetic.Collection.mapMethods(Kinetic.Wedge)}(),function(){Math.PI/180,Kinetic.Arc=function(e){this.___init(e)},Kinetic.Arc.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Arc",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=Kinetic.getAngle(this.angle()),n=this.clockwise();e.beginPath(),e.arc(0,0,this.getOuterRadius(),0,t,n),e.arc(0,0,this.getInnerRadius(),t,0,!n),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"outerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",!1),Kinetic.Collection.mapMethods(Kinetic.Arc)}(),function(){var e="Image";Kinetic.Image=function(e){this.___init(e)},Kinetic.Image.prototype={___init:function(t){Kinetic.Shape.call(this,t),this.className=e,this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()&&this.getStage()},_sceneFunc:function(e){var t,n,r,i=this.getWidth(),s=this.getHeight(),o=this.getImage();o&&(t=this.getCropWidth(),n=this.getCropHeight(),r=t&&n?[o,this.getCropX(),this.getCropY(),t,n,0,0,i,s]:[o,0,0,i,s]),(this.hasFill()||this.hasStroke()||this.hasShadow())&&(e.beginPath(),e.rect(0,0,i,s),e.closePath(),e.fillStrokeShape(this)),o&&e.drawImage.apply(e,r)},_hitFunc:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)},getWidth:function(){var e=this.getImage();return this.attrs.width||(e?e.width:0)},getHeight:function(){var e=this.getImage();return this.attrs.height||(e?e.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,"crop",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0),Kinetic.Collection.mapMethods(Kinetic.Image)}(),function(){function e(e){e.fillText(this.partialText,0,0)}function t(e){e.strokeText(this.partialText,0,0)}var n="auto",r="center",i="Change.kinetic",s="2d",o="-",u="",a="left",f="text",l="Text",c="middle",h="normal",p="px ",d=" ",v="right",m="word",g="char",y="none",b=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","lineHeight","text","width","height","wrap"],w=b.length,E=Kinetic.Util.createCanvasElement().getContext(s);Kinetic.Text=function(e){this.___init(e)},Kinetic.Text.prototype={___init:function(r){var s=this;void 0===r.width&&(r.width=n),void 0===r.height&&(r.height=n),Kinetic.Shape.call(this,r),this._fillFunc=e,this._strokeFunc=t,this.className=l;for(var o=0;w>o;o++)this.on(b[o]+i,s._setTextData);this._setTextData(),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(e){var t,n=this.getPadding(),i=this.getTextHeight(),s=this.getLineHeight()*i,o=this.textArr,u=o.length,f=this.getWidth();for(e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",c),e.setAttr("textAlign",a),e.save(),e.translate(n,0),e.translate(0,n+i/2),t=0;u>t;t++){var l=o[t],h=l.text,p=l.width;e.save(),this.getAlign()===v?e.translate(f-p-2*n,0):this.getAlign()===r&&e.translate((f-p-2*n)/2,0),this.partialText=h,e.fillStrokeShape(this),e.restore(),e.translate(0,s)}e.restore()},_hitFunc:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)},setText:function(e){var t=Kinetic.Util._isString(e)?e:e.toString();return this._setAttr(f,t),this},getWidth:function(){return this.attrs.width===n?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===n?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(e){var t,n=E,r=this.getFontSize();return n.save(),n.font=this._getContextFont(),t=n.measureText(e),n.restore(),{width:t.width,height:parseInt(r,10)}},_getContextFont:function(){return this.getFontStyle()+d+this.getFontVariant()+d+this.getFontSize()+p+this.getFontFamily()},_addTextLine:function(e,t){return this.textArr.push({text:e,width:t})},_getTextWidth:function(e){return E.measureText(e).width},_setTextData:function(){var e=this.getText().split("\n"),t=+this.getFontSize(),r=0,i=this.getLineHeight()*t,s=this.attrs.width,u=this.attrs.height,a=s!==n,f=u!==n,l=this.getPadding(),c=s-2*l,h=u-2*l,p=0,v=this.getWrap(),m=v!==y,b=v!==g&&m;this.textArr=[],E.save(),E.font=this._getContextFont();for(var w=0,S=e.length;S>w;++w){var x=e[w],T=this._getTextWidth(x);if(a&&T>c)for(;x.length>0;){for(var N=0,C=x.length,k="",L=0;C>N;){var A=N+C>>>1,O=x.slice(0,A+1),M=this._getTextWidth(O);c>=M?(N=A+1,k=O,L=M):C=A}if(!k)break;if(b){var _=Math.max(k.lastIndexOf(d),k.lastIndexOf(o))+1;_>0&&(N=_,k=k.slice(0,N),L=this._getTextWidth(k))}if(this._addTextLine(k,L),r=Math.max(r,L),p+=i,!m||f&&p+i>h)break;if(x=x.slice(N),x.length>0&&(T=this._getTextWidth(x),c>=T)){this._addTextLine(x,T),p+=i,r=Math.max(r,T);break}}else this._addTextLine(x,T),p+=i,r=Math.max(r,T);if(f&&p+i>h)break}E.restore(),this.textHeight=t,this.textWidth=r}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",h),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontVariant",h),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",a),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",m),Kinetic.Factory.addGetter(Kinetic.Text,"text",u),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text"),Kinetic.Collection.mapMethods(Kinetic.Text)}(),function(){Kinetic.Line=function(e){this.___init(e)},Kinetic.Line.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Line",this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t,n,r,i=this.getPoints(),s=i.length,o=this.getTension(),u=this.getClosed();if(e.beginPath(),e.moveTo(i[0],i[1]),0!==o&&s>4){for(t=this.getTensionPoints(),n=t.length,r=u?0:4,u||e.quadraticCurveTo(t[0],t[1],t[2],t[3]);n-2>r;)e.bezierCurveTo(t[r++],t[r++],t[r++],t[r++],t[r++],t[r++]);u||e.quadraticCurveTo(t[n-2],t[n-1],i[s-2],i[s-1])}else for(r=2;s>r;r+=2)e.lineTo(i[r],i[r+1]);u?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var e=this.getPoints(),t=e.length,n=this.getTension(),r=Kinetic.Util,i=r._getControlPoints(e[t-2],e[t-1],e[0],e[1],e[2],e[3],n),s=r._getControlPoints(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],n),o=Kinetic.Util._expandPoints(e,n),u=[i[2],i[3]].concat(o).concat([s[0],s[1],e[t-2],e[t-1],s[2],s[3],i[0],i[1],e[0],e[1]]);return u}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",!1),Kinetic.Factory.addGetterSetter(Kinetic.Line,"tension",0),Kinetic.Factory.addGetterSetter(Kinetic.Line,"points"),Kinetic.Collection.mapMethods(Kinetic.Line)}(),function(){Kinetic.Sprite=function(e){this.___init(e)},Kinetic.Sprite.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Sprite",this.anim=new Kinetic.Animation,this.on("animationChange.kinetic",function(){this.frameIndex(0)}),this.on("frameRateChange.kinetic",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(e){var t=this.getAnimation(),n=this.frameIndex(),r=4*n,i=this.getAnimations()[t],s=i[r+0],o=i[r+1],u=i[r+2],a=i[r+3],f=this.getImage();f&&e.drawImage(f,s,o,u,a,0,0,u,a)},_hitFunc:function(e){var t=this.getAnimation(),n=this.frameIndex(),r=4*n,i=this.getAnimations()[t],s=i[r+2],o=i[r+3];e.beginPath(),e.rect(0,0,s,o),e.closePath(),e.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_setInterval:function(){var e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.getFrameRate())},start:function(){var e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var e=this.frameIndex(),t=this.getAnimation(),n=this.getAnimations(),r=n[t],i=r.length/4;this.frameIndex(i-1>e?e+1:0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17),Kinetic.Factory.backCompat(Kinetic.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Kinetic.Collection.mapMethods(Kinetic.Sprite)}(),function(){Kinetic.Path=function(e){this.___init(e)},Kinetic.Path.prototype={___init:function(e){this.dataArray=[];var t=this;Kinetic.Shape.call(this,e),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){t.dataArray=Kinetic.Path.parsePathData(this.getData())}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.dataArray,n=!1;e.beginPath();for(var r=0;r<t.length;r++){var i=t[r].command,s=t[r].points;switch(i){case"L":e.lineTo(s[0],s[1]);break;case"M":e.moveTo(s[0],s[1]);break;case"C":e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var o=s[0],u=s[1],a=s[2],f=s[3],l=s[4],c=s[5],h=s[6],p=s[7],d=a>f?a:f,v=a>f?1:a/f,m=a>f?f/a:1;e.translate(o,u),e.rotate(h),e.scale(v,m),e.arc(0,0,d,l,l+c,1-p),e.scale(1/v,1/m),e.rotate(-h),e.translate(-o,-u);break;case"z":e.closePath(),n=!0}}n?e.fillStrokeShape(this):e.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))},Kinetic.Path.getPointOnLine=function(e,t,n,r,i,s,o){void 0===s&&(s=t),void 0===o&&(o=n);var u=(i-n)/(r-t+1e-8),a=Math.sqrt(e*e/(1+u*u));t>r&&(a*=-1);var f,l=u*a;if(r===t)f={x:s,y:o+l};else if((o-n)/(s-t+1e-8)===u)f={x:s+a,y:o+l};else{var c,h,p=this.getLineLength(t,n,r,i);if(1e-8>p)return void 0;var d=(s-t)*(r-t)+(o-n)*(i-n);d/=p*p,c=t+d*(r-t),h=n+d*(i-n);var v=this.getLineLength(s,o,c,h),m=Math.sqrt(e*e-v*v);a=Math.sqrt(m*m/(1+u*u)),t>r&&(a*=-1),l=u*a,f={x:c+a,y:h+l}}return f},Kinetic.Path.getPointOnCubicBezier=function(e,t,n,r,i,s,o,u,a){function f(e){return e*e*e}function l(e){return 3*e*e*(1-e)}function c(e){return 3*e*(1-e)*(1-e)}function h(e){return(1-e)*(1-e)*(1-e)}var p=u*f(e)+s*l(e)+r*c(e)+t*h(e),d=a*f(e)+o*l(e)+i*c(e)+n*h(e);return{x:p,y:d}},Kinetic.Path.getPointOnQuadraticBezier=function(e,t,n,r,i,s,o){function u(e){return e*e}function a(e){return 2*e*(1-e)}function f(e){return(1-e)*(1-e)}var l=s*u(e)+r*a(e)+t*f(e),c=o*u(e)+i*a(e)+n*f(e);return{x:l,y:c}},Kinetic.Path.getPointOnEllipticalArc=function(e,t,n,r,i,s){var o=Math.cos(s),u=Math.sin(s),a={x:n*Math.cos(i),y:r*Math.sin(i)};return{x:e+(a.x*o-a.y*u),y:t+(a.x*u+a.y*o)}},Kinetic.Path.parsePathData=function(e){if(!e)return[];var t=e,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(var r=0;r<n.length;r++)t=t.replace(new RegExp(n[r],"g"),"|"+n[r]);var i=t.split("|"),s=[],o=0,u=0;for(r=1;r<i.length;r++){var a=i[r],f=a.charAt(0);a=a.slice(1),a=a.replace(new RegExp(",-","g"),"-"),a=a.replace(new RegExp("-","g"),",-"),a=a.replace(new RegExp("e,-","g"),"e-");var l=a.split(",");l.length>0&&""===l[0]&&l.shift();for(var c=0;c<l.length;c++)l[c]=parseFloat(l[c]);for(;l.length>0&&!isNaN(l[0]);){var h,p,d,v,m,g,y,b,w,E,S=null,x=[],T=o,N=u;switch(f){case"l":o+=l.shift(),u+=l.shift(),S="L",x.push(o,u);break;case"L":o=l.shift(),u=l.shift(),x.push(o,u);break;case"m":var C=l.shift(),k=l.shift();if(o+=C,u+=k,S="M",s.length>2&&"z"===s[s.length-1].command)for(var L=s.length-2;L>=0;L--)if("M"===s[L].command){o=s[L].points[0]+C,u=s[L].points[1]+k;break}x.push(o,u),f="l";break;case"M":o=l.shift(),u=l.shift(),S="M",x.push(o,u),f="L";break;case"h":o+=l.shift(),S="L",x.push(o,u);break;case"H":o=l.shift(),S="L",x.push(o,u);break;case"v":u+=l.shift(),S="L",x.push(o,u);break;case"V":u=l.shift(),S="L",x.push(o,u);break;case"C":x.push(l.shift(),l.shift(),l.shift(),l.shift()),o=l.shift(),u=l.shift(),x.push(o,u);break;case"c":x.push(o+l.shift(),u+l.shift(),o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),S="C",x.push(o,u);break;case"S":p=o,d=u,h=s[s.length-1],"C"===h.command&&(p=o+(o-h.points[2]),d=u+(u-h.points[3])),x.push(p,d,l.shift(),l.shift()),o=l.shift(),u=l.shift(),S="C",x.push(o,u);break;case"s":p=o,d=u,h=s[s.length-1],"C"===h.command&&(p=o+(o-h.points[2]),d=u+(u-h.points[3])),x.push(p,d,o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),S="C",x.push(o,u);break;case"Q":x.push(l.shift(),l.shift()),o=l.shift(),u=l.shift(),x.push(o,u);break;case"q":x.push(o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),S="Q",x.push(o,u);break;case"T":p=o,d=u,h=s[s.length-1],"Q"===h.command&&(p=o+(o-h.points[0]),d=u+(u-h.points[1])),o=l.shift(),u=l.shift(),S="Q",x.push(p,d,o,u);break;case"t":p=o,d=u,h=s[s.length-1],"Q"===h.command&&(p=o+(o-h.points[0]),d=u+(u-h.points[1])),o+=l.shift(),u+=l.shift(),S="Q",x.push(p,d,o,u);break;case"A":v=l.shift(),m=l.shift(),g=l.shift(),y=l.shift(),b=l.shift(),w=o,E=u,o=l.shift(),u=l.shift(),S="A",x=this.convertEndpointToCenterParameterization(w,E,o,u,y,b,v,m,g);break;case"a":v=l.shift(),m=l.shift(),g=l.shift(),y=l.shift(),b=l.shift(),w=o,E=u,o+=l.shift(),u+=l.shift(),S="A",x=this.convertEndpointToCenterParameterization(w,E,o,u,y,b,v,m,g)}s.push({command:S||f,points:x,start:{x:T,y:N},pathLength:this.calcLength(T,N,S||f,x)})}("z"===f||"Z"===f)&&s.push({command:"z",points:[],start:void 0,pathLength:0})}return s},Kinetic.Path.calcLength=function(e,t,n,r){var i,s,o,u,a=Kinetic.Path;switch(n){case"L":return a.getLineLength(e,t,r[0],r[1]);case"C":for(i=0,s=a.getPointOnCubicBezier(0,e,t,r[0],r[1],r[2],r[3],r[4],r[5]),u=.01;1>=u;u+=.01)o=a.getPointOnCubicBezier(u,e,t,r[0],r[1],r[2],r[3],r[4],r[5]),i+=a.getLineLength(s.x,s.y,o.x,o.y),s=o;return i;case"Q":for(i=0,s=a.getPointOnQuadraticBezier(0,e,t,r[0],r[1],r[2],r[3]),u=.01;1>=u;u+=.01)o=a.getPointOnQuadraticBezier(u,e,t,r[0],r[1],r[2],r[3]),i+=a.getLineLength(s.x,s.y,o.x,o.y),s=o;return i;case"A":i=0;var f=r[4],l=r[5],c=r[4]+l,h=Math.PI/180;if(Math.abs(f-c)<h&&(h=Math.abs(f-c)),s=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],f,0),0>l)for(u=f-h;u>c;u-=h)o=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],u,0),i+=a.getLineLength(s.x,s.y,o.x,o.y),s=o;else for(u=f+h;c>u;u+=h)o=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],u,0),i+=a.getLineLength(s.x,s.y,o.x,o.y),s=o;return o=a.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],c,0),i+=a.getLineLength(s.x,s.y,o.x,o.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(e,t,n,r,i,s,o,u,a){var f=a*(Math.PI/180),l=Math.cos(f)*(e-n)/2+Math.sin(f)*(t-r)/2,c=-1*Math.sin(f)*(e-n)/2+Math.cos(f)*(t-r)/2,h=l*l/(o*o)+c*c/(u*u);h>1&&(o*=Math.sqrt(h),u*=Math.sqrt(h));var p=Math.sqrt((o*o*u*u-o*o*c*c-u*u*l*l)/(o*o*c*c+u*u*l*l));i===s&&(p*=-1),isNaN(p)&&(p=0);var d=p*o*c/u,v=p*-u*l/o,m=(e+n)/2+Math.cos(f)*d-Math.sin(f)*v,g=(t+r)/2+Math.sin(f)*d+Math.cos(f)*v,y=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},b=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(y(e)*y(t))},w=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(b(e,t))},E=w([1,0],[(l-d)/o,(c-v)/u]),S=[(l-d)/o,(c-v)/u],x=[(-1*l-d)/o,(-1*c-v)/u],T=w(S,x);return b(S,x)<=-1&&(T=Math.PI),b(S,x)>=1&&(T=0),0===s&&T>0&&(T-=2*Math.PI),1===s&&0>T&&(T+=2*Math.PI),[m,g,o,u,E,T,f,s]},Kinetic.Factory.addGetterSetter(Kinetic.Path,"data"),Kinetic.Collection.mapMethods(Kinetic.Path)}(),function(){function e(e){e.fillText(this.partialText,0,0)}function t(e){e.strokeText(this.partialText,0,0)}var n="",r="normal";Kinetic.TextPath=function(e){this.___init(e)},Kinetic.TextPath.prototype={___init:function(n){var r=this;this.dummyCanvas=Kinetic.Util.createCanvasElement(),this.dataArray=[],Kinetic.Shape.call(this,n),this._fillFunc=e,this._strokeFunc=t,this._fillFuncHit=e,this._strokeFuncHit=t,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){r.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",r._setTextData),r._setTextData(),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline","middle"),e.setAttr("textAlign","left"),e.save();for(var t=this.glyphInfo,n=0;n<t.length;n++){e.save();var r=t[n].p0;e.translate(r.x,r.y),e.rotate(t[n].rotation),this.partialText=t[n].text,e.fillStrokeShape(this),e.restore()}e.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(e){Kinetic.Text.prototype.setText.call(this,e)},_getTextSize:function(e){var t=this.dummyCanvas,n=t.getContext("2d");n.save(),n.font=this._getContextFont();var r=n.measureText(e);return n.restore(),{width:r.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var e=this,t=this._getTextSize(this.attrs.text);this.textWidth=t.width,this.textHeight=t.height,this.glyphInfo=[];for(var n,r,i,s=this.attrs.text.split(""),o=-1,u=0,a=function(){u=0;for(var t=e.dataArray,r=o+1;r<t.length;r++){if(t[r].pathLength>0)return o=r,t[r];"M"==t[r].command&&(n={x:t[r].points[0],y:t[r].points[1]})}return{}},f=function(t){var s=e._getTextSize(t).width,o=0,f=0;for(r=void 0;Math.abs(s-o)/s>.01&&25>f;){f++;for(var l=o;void 0===i;)i=a(),i&&l+i.pathLength<s&&(l+=i.pathLength,i=void 0);if(i==={}||void 0===n)return void 0;var c=!1;switch(i.command){case"L":Kinetic.Path.getLineLength(n.x,n.y,i.points[0],i.points[1])>s?r=Kinetic.Path.getPointOnLine(s,n.x,n.y,i.points[0],i.points[1],n.x,n.y):i=void 0;break;case"A":var h=i.points[4],p=i.points[5],d=i.points[4]+p;0===u?u=h+1e-8:s>o?u+=Math.PI/180*p/Math.abs(p):u-=Math.PI/360*p/Math.abs(p),(0>p&&d>u||p>=0&&u>d)&&(u=d,c=!0),r=Kinetic.Path.getPointOnEllipticalArc(i.points[0],i.points[1],i.points[2],i.points[3],u,i.points[6]);break;case"C":0===u?u=s>i.pathLength?1e-8:s/i.pathLength:s>o?u+=(s-o)/i.pathLength:u-=(o-s)/i.pathLength,u>1&&(u=1,c=!0),r=Kinetic.Path.getPointOnCubicBezier(u,i.start.x,i.start.y,i.points[0],i.points[1],i.points[2],i.points[3],i.points[4],i.points[5]);break;case"Q":0===u?u=s/i.pathLength:s>o?u+=(s-o)/i.pathLength:u-=(o-s)/i.pathLength,u>1&&(u=1,c=!0),r=Kinetic.Path.getPointOnQuadraticBezier(u,i.start.x,i.start.y,i.points[0],i.points[1],i.points[2],i.points[3])}void 0!==r&&(o=Kinetic.Path.getLineLength(n.x,n.y,r.x,r.y)),c&&(c=!1,i=void 0)}},l=0;l<s.length&&(f(s[l]),void 0!==n&&void 0!==r);l++){var c=Kinetic.Path.getLineLength(n.x,n.y,r.x,r.y),h=0,p=Kinetic.Path.getPointOnLine(h+c/2,n.x,n.y,r.x,r.y),d=Math.atan2(r.y-n.y,r.x-n.x);this.glyphInfo.push({transposeX:p.x,transposeY:p.y,text:s[l],rotation:d,p0:n,p1:r}),n=r}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",r),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontVariant",r),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",n),Kinetic.Collection.mapMethods(Kinetic.TextPath)}(),function(){Kinetic.RegularPolygon=function(e){this.___init(e)},Kinetic.RegularPolygon.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="RegularPolygon",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t,n,r,i=this.attrs.sides,s=this.attrs.radius;for(e.beginPath(),e.moveTo(0,0-s),t=1;i>t;t++)n=s*Math.sin(2*t*Math.PI/i),r=-1*s*Math.cos(2*t*Math.PI/i),e.lineTo(n,r);e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0),Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)}(),function(){Kinetic.Star=function(e){this.___init(e)},Kinetic.Star.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Star",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.innerRadius(),n=this.outerRadius(),r=this.numPoints();e.beginPath(),e.moveTo(0,0-n);for(var i=1;2*r>i;i++){var s=i%2===0?n:t,o=s*Math.sin(i*Math.PI/r),u=-1*s*Math.cos(i*Math.PI/r);e.lineTo(o,u)}e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",5),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Star)}(),function(){var e=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],t="Change.kinetic",n="none",r="up",i="right",s="down",o="left",u="Label",a=e.length;Kinetic.Label=function(e){this.____init(e)},Kinetic.Label.prototype={____init:function(e){var t=this;Kinetic.Group.call(this,e),this.className=u,this.on("add.kinetic",function(e){t._addListeners(e.child),t._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(n){var r,i=this,s=function(){i._sync()};for(r=0;a>r;r++)n.on(e[r]+t,s)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var e,t,n,u,a,l,c,h=this.getText(),p=this.getTag();if(h&&p){switch(e=h.getWidth(),t=h.getHeight(),n=p.getPointerDirection(),u=p.getPointerWidth(),c=p.getPointerHeight(),a=0,l=0,n){case r:a=e/2,l=-1*c;break;case i:a=e+u,l=t/2;break;case s:a=e/2,l=t+c;break;case o:a=-1*u,l=t/2}p.setAttrs({x:-1*a,y:-1*l,width:e,height:t}),h.setAttrs({x:-1*a,y:-1*l})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Collection.mapMethods(Kinetic.Label),Kinetic.Tag=function(e){this.___init(e)},Kinetic.Tag.prototype={___init:function(e){Kinetic.Shape.call(this,e),this.className="Tag",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(e){var t=this.getWidth(),n=this.getHeight(),u=this.getPointerDirection(),a=this.getPointerWidth(),l=this.getPointerHeight();e.beginPath(),e.moveTo(0,0),u===r&&(e.lineTo((t-a)/2,0),e.lineTo(t/2,-1*l),e.lineTo((t+a)/2,0)),e.lineTo(t,0),u===i&&(e.lineTo(t,(n-l)/2),e.lineTo(t+a,n/2),e.lineTo(t,(n+l)/2)),e.lineTo(t,n),u===s&&(e.lineTo((t+a)/2,n),e.lineTo(t/2,n+l),e.lineTo((t-a)/2,n)),e.lineTo(0,n),u===o&&(e.lineTo(0,(n+l)/2),e.lineTo(-1*a,n/2),e.lineTo(0,(n-l)/2)),e.closePath(),e.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",n),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Tag)}(),define("bpmn/util/diagram/Canvas",["kinetic"],function(e){var t=function(n){this.scale=n.scale;var r=this.stage=new e.Stage({container:n.container,width:n.width?n.width:500,height:n.height?n.height:500});r.scale({x:this.scale,y:this.scale}),this.shapeLayer=new e.Layer,this.connectionsLayer=new e.Layer,this.labelLayer=new e.Layer,r.add(this.shapeLayer),r.add(this.connectionsLayer),r.add(this.labelLayer),this.createGroup=function(t){return new e.Group(t)},this.createRect=function(t){return new e.Rect(t)},this.createCircle=function(t){return new e.Circle(t)},this.createLine=function(t){return new e.Line(t)},this.createText=function(t){return new e.Text(t)},this.createPolygon=function(t){return t.closed=!0,new e.Line(t)},this.createPath=function(t){return new e.Path(t)},this.createArrowLine=function(t,n,r){var i=r?r:6,s=t[t.length-2],o=t[t.length-1],u=t[t.length-4],a=t[t.length-3],f=Math.atan2(o-a,s-u);n.points=t.concat([s-i*Math.cos(f-Math.PI/6),o-i*Math.sin(f-Math.PI/6),s,o,s-i*Math.cos(f+Math.PI/6),o-i*Math.sin(f+Math.PI/6)]);var l=new e.Line(n);return l},this.expandCanvasIfNeeded=function(e){var t=10,n=e.getX(),r=e.getY(),i=e.getWidth(),s=e.getHeight();(n+i)*this.scale>this.stage.getWidth()&&this.stage.setWidth((n+i+t)*this.scale),(r+s)*this.scale>this.stage.getHeight()&&this.stage.setHeight((r+s+t)*this.scale)}};return t}),define("bpmn/editor/ActivityRenderer",[],function(){var e=function(e){this.markerPaths={"bpmn.ServiceTask":"m 22.701284,14.663851 c 0.432742,0 0.835353,-0.363368 0.894226,-0.807377 0,0 0.08274,-0.624013 0.08274,-1.366108 0,-0.742094 -0.08274,-1.366107 -0.08274,-1.366107 -0.05909,-0.444249 -0.461484,-0.807376 -0.894226,-0.807376 h -2.236261 c -0.432975,0 -0.882637,-0.285846 -0.998992,-0.6350536 -0.116355,-0.3492066 -0.276519,-1.4695496 0.02967,-1.7863558 L 21.076473,6.2586397 C 21.382428,5.9415935 21.40607,5.4006221 21.128856,5.0562152 L 19.269014,3.1299359 C 18.936402,2.8426498 18.414191,2.8671302 18.107771,3.1841824 L 16.526998,4.8210152 C 16.221042,5.1380613 15.710883,5.2657441 15.394032,5.1049407 15.076952,4.9441373 14.18852,4.2658838 14.18852,3.8175543 V 1.501988 c 0,-0.4483294 -0.350922,-0.86497745 -0.779725,-0.92617905 0,0 -0.60264,-0.085927 -1.319319,-0.085927 -0.716679,0 -1.319319,0.085927 -1.319319,0.085927 -0.429034,0.06096 -0.7799559,0.47784965 -0.7799559,0.92617905 v 2.3155663 c 0,0.4483295 -0.275824,0.9136994 -0.6133031,1.0344211 C 9.0394192,4.9724583 7.9576789,5.1383013 7.6514912,4.8212576 L 6.0707181,3.1844175 C 5.7645304,2.8673702 5.2420872,2.8428899 4.9097076,3.1299359 L 3.0496339,5.0559751 C 2.7721873,5.4003821 2.7958294,5.9413535 3.1020167,6.2583996 L 4.682558,7.8952336 C 4.9887458,8.2122798 5.1122872,8.7402903 4.9567595,9.0683769 4.8012323,9.3964637 4.14644,10.316643 3.7134658,10.316643 H 1.4774369 c -0.4329742,0 -0.83535274,0.363367 -0.89445788,0.807376 0,0 -0.082979,0.624013 -0.082979,1.366107 0,0.742335 0.082979,1.366108 0.082979,1.366108 0.0588733,0.444249 0.46148368,0.807376 0.89445788,0.807376 h 2.2362607 c 0.4329742,0 0.882405,0.285607 0.9987611,0.635054 0.116356,0.349206 0.2765193,1.46931 -0.029668,1.786356 l -1.5805412,1.636594 c -0.3061877,0.317046 -0.3298298,0.858017 -0.052384,1.202424 l 1.859842,1.926279 c 0.3326113,0.287047 0.8548228,0.262806 1.1610105,-0.05425 l 1.5807733,-1.636829 c 0.3061877,-0.316806 0.8161146,-0.444729 1.1331963,-0.283925 0.3170817,0.160802 1.2055136,0.839057 1.2055136,1.287386 v 2.315567 c 0,0.448089 0.3509218,0.864976 0.7799558,0.925938 0,0 0.602408,0.08568 1.319319,0.08568 0.71691,0 1.319319,-0.08568 1.319319,-0.08568 0.429035,-0.06119 0.779725,-0.477849 0.779725,-0.925938 v -2.315567 c 0,-0.448329 0.275825,-0.913939 0.613303,-1.034421 0.337479,-0.120482 1.419219,-0.286086 1.725407,0.03071 l 1.580541,1.636833 c 0.306188,0.316807 0.828631,0.341288 1.161243,0.05425 l 1.859842,-1.925559 c 0.277214,-0.344407 0.253804,-0.885138 -0.05262,-1.202424 l -1.58054,-1.636586 c -0.306188,-0.317046 -0.42973,-0.845056 -0.274202,-1.173383 0.155296,-0.328327 0.81032,-1.248266 1.243294,-1.248266 h 2.236492 z m -10.612039,2.218844 c -2.342882,0 -4.2421275,-1.966359 -4.2421275,-4.392569 0,-2.425728 1.8992455,-4.3925682 4.2421275,-4.3925682 2.342882,0 4.242127,1.9666002 4.242127,4.3925682 0,2.42597 -1.899245,4.392569 -4.242127,4.392569 z","bpmn.UserTask":"M 12.253681,11.77491 C 11.634895,10.657313 10.877364,9.7523027 10.117807,9.1196049 9.2316574,9.7684998 8.152074,10.163303 6.9752673,10.163303 5.7964351,10.163303 4.715839,9.7674875 3.8307021,9.1196049 3.0711453,9.7523027 2.313614,10.657313 1.6928029,11.77491 c -1.44011956,2.594568 -1.59810737,5.255948 -0.3544598,5.946348 0.5570083,0.310781 1.1413607,0.07896 1.7449552,-0.502109 -0.106338,0.589168 -0.1681153,1.22794 -0.1681153,1.896068 0,2.968112 1.1535136,5.372364 2.5754039,5.372364 0.8567801,0 1.2811192,-0.875654 1.4846804,-2.215961 0.2035612,1.340307 0.6279003,2.215961 1.4816421,2.215961 1.4239158,0 2.5774296,-2.404252 2.5774296,-5.372364 0,-0.668128 -0.06178,-1.3069 -0.170141,-1.896068 0.60562,0.581069 1.18896,0.81289 1.746981,0.502109 1.243647,-0.6904 1.082621,-3.35178 -0.357498,-5.946348 z M 6.9742546,9.1509867 c 2.3920975,0 4.3325124,-1.9395984 4.3325124,-4.3317023 0,-2.3921039 -1.9404149,-4.33170228 -4.3325124,-4.33170228 -2.3931103,0 -4.3345375,1.93959838 -4.3345375,4.33170228 0,2.3921039 1.9414272,4.3317023 4.3345375,4.3317023 z","bpmn.BusinessRuleTask":"M 0.49999997,0.68485673 V 3.8369982 H 24.501049 V 0.68485673 H 0.49999997 z m 0,17.05141427 H 24.501049 V 14.58413 H 0.49999997 v 3.152141 z m 0,-6.949637 H 24.501049 V 7.6344932 H 0.49999997 v 3.1521408 z m 0,13.898223 H 24.501049 V 21.532715 H 0.49999997 v 3.152142 z","bpmn.ReceiveTask":"M 1.7164479,0.59270005 9.5482144,6.784475 17.408905,0.54332386 z M 0.70000001,1.254341 l 0,11.06027 17.69642899,0 0,-11.06027 -8.8482146,6.6361608 z"},this.createRectangle=function(t){var n=e.skin().activity_corner_radius,r=e.canvas.createRect({width:t.width(),height:t.height(),cornerRadius:n,stroke:e.skin().activity_stroke,fill:e.skin().activity_fill,strokeWidth:2});return r},this.getPathForActivityType=function(e){return this.markerPaths[e.declaredClass]},this.createMarker=function(t){var n=e.canvas.createPath({x:3,y:3,data:t,stroke:e.skin().activity_stroke,fill:e.skin().activity_fill,scale:.6});return n},this.render=function(e,t){var n=e.getBounds(),r=this.createRectangle(n),i=this.getPathForActivityType(e),s=this.createMarker(i);return t.add(r),t.add(s),t}};return e}),define("bpmn/editor/EventRenderer",[],function(){var e=function(){this.render=function(e,t){var n=e.getBounds(),r=this.canvas.createCircle({width:n.width(),height:n.height(),stroke:this.skin().event_stroke,strokeWidth:2,draggable:!0});return t.add(r),t}};return e}),define("bpmn/editor/GatewayRenderer",[],function(){var e=function(){this.render=function(e,t){var n=e.getBounds(),r=this.canvas.createPolygon({points:[0,n.height()/2,n.width()/2,0,n.width(),n.height()/2,n.width()/2,n.height()],stroke:"black",fill:"white",strokeWidth:2,draggable:!0});return t.add(r),t}};return e}),define("bpmn/editor/LabelRenderer",[],function(){var e=function(e){this.renderCentered=function(e,t,n){var r=this.createLabelText(n);return r.setY(e.height()/2-r.getFontSize()),r.setWidth(e.width()),t.add(r),t},this.createLabelText=function(t){return e.canvas.createText({text:t,fontSize:e.skin().label_font_size,fontFamily:e.skin().label_font_family,fill:e.skin().label_fill,align:"center"})}};return e}),define("bpmn/editor/Renderer",["bpmn/util/JSClass","lodash","bpmn/Activity","bpmn/Gateway","bpmn/Event","bpmn/SequenceFlow","bpmn/util/diagram/Canvas","bpmn/editor/ActivityRenderer","bpmn/editor/EventRenderer","bpmn/editor/GatewayRenderer","bpmn/editor/LabelRenderer"],function(e,t,n,r,i,s,o,u,a,f,l){var c={skins:{"default":{event_stroke:"black",activity_stroke:"black",activity_fill:"white",activity_corner_radius:10,label_font_family:"Arial",label_font_size:12,label_fill:"black"}},initialize:function(e,t){this.definitions=e,this.skinName="default",this.bindDelegates(),this.evaluateOptionsAndDefaults(t),this.canvas=new o(this.options)},bindDelegates:function(){this.activity=new u(this),this.renderEvent=(new a).render,this.renderGateway=(new f).render,this.label=new l(this)},evaluateOptionsAndDefaults:function(e){this.options=e,this.skinName=e.skin?e.skin:"default",this.options.scale=e.scale?e.scale:1},render:function(){this.renderElements(),this.canvas.shapeLayer.draw(),this.canvas.connectionsLayer.draw(),this.canvas.labelLayer.draw()},renderElements:function(){if(this.definitions.process().length>1)throw new Error("Only single process models are supported");t.forEach(this.definitions.process(),function(e){t.forEach(e.flowElements(),function(e){this.renderElement(e)},this)},this)},renderElement:function(e){var t=this.canvas.createGroup({draggable:!0});e instanceof s?(this.renderConnection(e,t),this.canvas.connectionsLayer.add(t)):e instanceof n?(this.label.renderCentered(e.getBounds(),this.activity.render(e,t),e.name()),this.canvas.shapeLayer.add(t),this.setGroupBounds(t,e.getBounds())):e instanceof i?(this.renderEvent(e,t),this.canvas.shapeLayer.add(t),this.setGroupBounds(t,this.eventBounds(e))):e instanceof r?(this.renderGateway(e,t),this.canvas.shapeLayer.add(t),this.setGroupBounds(t,e.getBounds())):console.log("unable to render flowElement",e),this.canvas.expandCanvasIfNeeded(t)},eventBounds:function(e){var t=e.getBounds();return{x:function(){return t.x()+t.width()/2},y:function(){return t.y()+t.height()/2},width:function(){return t.width()},height:function(){return t.height()}}},setGroupBounds:function(e,t){e.setX(t.x()),e.setY(t.y()),e.setWidth(t.width()),e.setHeight(t.height())},renderConnection:function(e,n){var r=[];t.forEach(e.getWaypoints(),function(e){r.push(e.x),r.push(e.y)});var i=this.canvas.createArrowLine(r,{stroke:"black",strokeWidth:2,lineCap:"round",lineJoin:"round"});return n.add(i),n},skin:function(){return this.skins[this.skinName]}};return new e.Class(c)}),define("bpmn/Bpmn",["bpmn/util/JSClass","bpmn/Definitions","bpmn/execution/Instance","bpmn/util/Serializer","bpmn/editor/Renderer"],function(e,t,n,r,i){var s={initialize:function(){this.serializer=new r},renderer:function(e,t){return new i(e,t)},fromXML:function(e){return this.serializer.fromXML(e)}};return new e.Class(s)});